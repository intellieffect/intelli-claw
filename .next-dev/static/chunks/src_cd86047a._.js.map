{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/lib/hooks/use-mobile.ts"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from \"react\";\n\nconst MOBILE_BREAKPOINT = 768;\n\nexport function useIsMobile(): boolean {\n  const [isMobile, setIsMobile] = useState(false);\n\n  useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`);\n    const handler = (e: MediaQueryListEvent | MediaQueryList) => setIsMobile(e.matches);\n    handler(mql);\n    mql.addEventListener(\"change\", handler);\n    return () => mql.removeEventListener(\"change\", handler);\n  }, []);\n\n  return isMobile;\n}\n"],"names":[],"mappings":";;;;AAEA;;AAFA;;AAIA,MAAM,oBAAoB;AAEnB,SAAS;;IACd,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,2UAAQ,EAAC;IAEzC,IAAA,4UAAS;iCAAC;YACR,MAAM,MAAM,OAAO,UAAU,CAAC,AAAC,eAAoC,OAAtB,oBAAoB,GAAE;YACnE,MAAM;iDAAU,CAAC,IAA4C,YAAY,EAAE,OAAO;;YAClF,QAAQ;YACR,IAAI,gBAAgB,CAAC,UAAU;YAC/B;yCAAO,IAAM,IAAI,mBAAmB,CAAC,UAAU;;QACjD;gCAAG,EAAE;IAEL,OAAO;AACT;GAZgB","debugId":null}},
    {"offset": {"line": 39, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/chat/connection-status.tsx"],"sourcesContent":["\"use client\";\n\nimport type { ConnectionState } from \"@/lib/gateway/client\";\n\nconst STATUS_CONFIG: Record<\n  ConnectionState,\n  { label: string; color: string; pulse: boolean }\n> = {\n  disconnected: { label: \"연결 끊김\", color: \"bg-red-500\", pulse: false },\n  connecting: { label: \"연결 중...\", color: \"bg-yellow-500\", pulse: true },\n  authenticating: { label: \"인증 중...\", color: \"bg-yellow-500\", pulse: true },\n  connected: { label: \"연결됨\", color: \"bg-emerald-500\", pulse: false },\n};\n\nexport function ConnectionStatus({ state }: { state: ConnectionState }) {\n  const config = STATUS_CONFIG[state];\n\n  return (\n    <div className=\"flex items-center gap-1.5 text-xs text-muted-foreground\">\n      <span className=\"relative flex h-2 w-2\">\n        {config.pulse && (\n          <span\n            className={`absolute inline-flex h-full w-full animate-ping rounded-full ${config.color} opacity-75`}\n          />\n        )}\n        <span className={`relative inline-flex h-2 w-2 rounded-full ${config.color}`} />\n      </span>\n      <span>{config.label}</span>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAAA;;AAIA,MAAM,gBAGF;IACF,cAAc;QAAE,OAAO;QAAS,OAAO;QAAc,OAAO;IAAM;IAClE,YAAY;QAAE,OAAO;QAAW,OAAO;QAAiB,OAAO;IAAK;IACpE,gBAAgB;QAAE,OAAO;QAAW,OAAO;QAAiB,OAAO;IAAK;IACxE,WAAW;QAAE,OAAO;QAAO,OAAO;QAAkB,OAAO;IAAM;AACnE;AAEO,SAAS,iBAAiB,KAAqC;QAArC,EAAE,KAAK,EAA8B,GAArC;IAC/B,MAAM,SAAS,aAAa,CAAC,MAAM;IAEnC,qBACE,+VAAC;QAAI,WAAU;;0BACb,+VAAC;gBAAK,WAAU;;oBACb,OAAO,KAAK,kBACX,+VAAC;wBACC,WAAW,AAAC,gEAA4E,OAAb,OAAO,KAAK,EAAC;;;;;;kCAG5F,+VAAC;wBAAK,WAAW,AAAC,6CAAyD,OAAb,OAAO,KAAK;;;;;;;;;;;;0BAE5E,+VAAC;0BAAM,OAAO,KAAK;;;;;;;;;;;;AAGzB;KAhBgB","debugId":null}},
    {"offset": {"line": 121, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/chat/markdown-renderer.tsx"],"sourcesContent":["\"use client\";\n\nimport { memo, useCallback, useEffect, useState } from \"react\";\nimport ReactMarkdown from \"react-markdown\";\nimport remarkGfm from \"remark-gfm\";\nimport rehypeHighlight from \"rehype-highlight\";\nimport {\n  Check, Copy, ExternalLink, Eye, Code2, Download,\n  FileText, FileAudio, FileVideo, File as FileIcon,\n  FileSpreadsheet, FileCode, FileArchive,\n} from \"lucide-react\";\nimport type { Components } from \"react-markdown\";\n\nfunction copyText(text: string) {\n  if (navigator.clipboard?.writeText) return navigator.clipboard.writeText(text);\n  const ta = document.createElement(\"textarea\");\n  ta.value = text;\n  ta.style.cssText = \"position:fixed;opacity:0\";\n  document.body.appendChild(ta);\n  ta.select();\n  document.execCommand(\"copy\");\n  document.body.removeChild(ta);\n  return Promise.resolve();\n}\n\nfunction isUrl(s: string) {\n  return /^https?:\\/\\/\\S+$/.test(s.trim());\n}\n\nfunction CopyableLink({ href, children }: { href: string; children: React.ReactNode }) {\n  const [copied, setCopied] = useState(false);\n  return (\n    <span className=\"inline-flex items-center gap-1 group/link\">\n      <a\n        href={href}\n        target=\"_blank\"\n        rel=\"noopener noreferrer\"\n        className=\"inline-flex items-center gap-0.5\"\n        onClick={(e) => {\n          e.preventDefault();\n          copyText(href).then(() => {\n            setCopied(true);\n            setTimeout(() => setCopied(false), 1500);\n          });\n        }}\n        title=\"클릭하면 복사 · 길게 누르면 열기\"\n      >\n        {children}\n        {copied\n          ? <Check size={11} className=\"text-emerald-400 inline\" />\n          : <Copy size={11} className=\"opacity-40 group-hover/link:opacity-100 inline\" />\n        }\n      </a>\n      <a\n        href={href}\n        target=\"_blank\"\n        rel=\"noopener noreferrer\"\n        className=\"opacity-40 hover:opacity-100\"\n        title=\"새 탭에서 열기\"\n      >\n        <ExternalLink size={11} />\n      </a>\n    </span>\n  );\n}\n\nfunction HtmlPreview({ code }: { code: string }) {\n  const [expanded, setExpanded] = useState(true);\n  const [blank, setBlank] = useState(false);\n\n  const metaEntries = Array.from(code.matchAll(/<meta\\s+name=[\"']showcase:([^\"']+)[\"']\\s+content=[\"']([^\"']*)[\"'][^>]*>/gi))\n    .map((m) => ({ key: m[1], value: m[2] }));\n  const iframeRef = useCallback((iframe: HTMLIFrameElement | null) => {\n    if (!iframe) return;\n    const doc = iframe.contentDocument;\n    if (!doc) return;\n    doc.open();\n    doc.write(code);\n    doc.close();\n    const resize = () => {\n      const h = doc.documentElement?.scrollHeight || doc.body?.scrollHeight || 300;\n      iframe.style.height = Math.min(h + 4, 600) + \"px\";\n\n      const text = (doc.body?.innerText || \"\").trim();\n      const hasVisual = !!doc.body?.querySelector(\"img,svg,video,canvas,table,input,button,textarea,select,iframe\");\n      setBlank(!text && !hasVisual);\n    };\n    iframe.onload = resize;\n    setTimeout(resize, 100);\n    setTimeout(resize, 500);\n  }, [code]);\n\n  return (\n    <div className=\"my-2 overflow-hidden rounded-lg border border-zinc-700\">\n      <div className=\"flex items-center justify-between bg-zinc-800 px-3 py-1.5 text-xs text-zinc-400\">\n        <span className=\"flex items-center gap-1.5\">\n          <Eye size={12} />\n          Preview\n        </span>\n        <button\n          onClick={() => setExpanded(e => !e)}\n          className=\"rounded px-1.5 py-0.5 hover:bg-zinc-700 hover:text-zinc-200 transition\"\n        >\n          {expanded ? \"접기\" : \"펼치기\"}\n        </button>\n      </div>\n      {expanded && (\n        <>\n          <iframe\n            ref={iframeRef}\n            sandbox=\"allow-same-origin\"\n            className=\"w-full border-0 bg-white\"\n            style={{ minHeight: 100, maxHeight: 600 }}\n          />\n          {blank && (\n            <div className=\"border-t border-zinc-700 bg-zinc-900 px-3 py-2 text-xs text-zinc-300\">\n              {metaEntries.length > 0 ? (\n                <div className=\"space-y-1\">\n                  <div className=\"text-zinc-400\">본문은 비어있지만, 아래 메타정보가 포함되어 있어요:</div>\n                  <div className=\"grid grid-cols-1 gap-1 sm:grid-cols-2\">\n                    {metaEntries.map((m) => (\n                      <div key={m.key} className=\"truncate rounded bg-zinc-800 px-2 py-1\">\n                        <span className=\"text-zinc-500\">{m.key}</span>\n                        <span className=\"mx-1 text-zinc-600\">:</span>\n                        <span className=\"text-zinc-200\">{m.value}</span>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              ) : (\n                <>\n                  표시할 본문이 없습니다. (meta/style 전용 코드일 수 있어요) · <span className=\"text-zinc-300\">Code</span> 탭에서 원문을 확인하세요.\n                </>\n              )}\n            </div>\n          )}\n        </>\n      )}\n    </div>\n  );\n}\n\nfunction CodeBlock({ className, children, rawChildren }: { className?: string; children: React.ReactNode; rawChildren?: React.ReactNode }) {\n  const [copied, setCopied] = useState(false);\n  const [showPreview, setShowPreview] = useState(true);\n  const rawLang = className?.replace(/language-/g, \"\").replace(/hljs/g, \"\").trim() || \"\";\n  const lang = rawLang.split(/\\s+/)[0] || \"\";\n  const code = extractText(rawChildren ?? children).replace(/\\n$/, \"\");\n  const isHtml = (lang === \"html\" || lang === \"xml\" || code.trimStart().startsWith(\"<!\") || code.trimStart().startsWith(\"<html\")) && code.includes(\"<\");\n\n  const handleCopy = useCallback(async () => {\n    try {\n      if (navigator.clipboard?.writeText) {\n        await navigator.clipboard.writeText(code);\n      } else {\n        const ta = document.createElement(\"textarea\");\n        ta.value = code;\n        ta.style.position = \"fixed\";\n        ta.style.opacity = \"0\";\n        document.body.appendChild(ta);\n        ta.select();\n        document.execCommand(\"copy\");\n        document.body.removeChild(ta);\n      }\n      setCopied(true);\n      setTimeout(() => setCopied(false), 2000);\n    } catch {}\n  }, [code]);\n\n  return (\n    <div className=\"group relative my-3\">\n      <div className=\"flex items-center justify-between rounded-t-lg bg-muted px-4 py-1.5 text-xs text-muted-foreground\">\n        <span>{lang}</span>\n        <button\n          onClick={handleCopy}\n          className=\"flex items-center gap-1 rounded px-2 py-0.5 transition hover:bg-muted hover:text-foreground\"\n        >\n          {copied ? (\n            <>\n              <Check size={12} /> Copied\n            </>\n          ) : (\n            <>\n              <Copy size={12} /> Copy\n            </>\n          )}\n        </button>\n      </div>\n      {(!isHtml || !showPreview) && (\n        <pre className=\"!mt-0 !rounded-t-none\">\n          <code className={className}>{children}</code>\n        </pre>\n      )}\n      {isHtml && (\n        <>\n          <div className=\"flex border-t border-zinc-700\">\n            <button\n              onClick={() => setShowPreview(false)}\n              className={`flex-1 flex items-center justify-center gap-1 px-3 py-1 text-xs transition ${!showPreview ? \"bg-zinc-700 text-zinc-200\" : \"bg-zinc-800 text-zinc-500 hover:text-zinc-300\"}`}\n            >\n              <Code2 size={11} /> Code\n            </button>\n            <button\n              onClick={() => setShowPreview(true)}\n              className={`flex-1 flex items-center justify-center gap-1 px-3 py-1 text-xs transition ${showPreview ? \"bg-zinc-700 text-zinc-200\" : \"bg-zinc-800 text-zinc-500 hover:text-zinc-300\"}`}\n            >\n              <Eye size={11} /> Preview\n            </button>\n          </div>\n          {showPreview && <HtmlPreview code={code} />}\n        </>\n      )}\n    </div>\n  );\n}\n\n/** Recursively extract text from React children (handles rehype-highlight spans) */\nfunction extractText(node: React.ReactNode): string {\n  if (typeof node === \"string\") return node;\n  if (typeof node === \"number\") return String(node);\n  if (!node) return \"\";\n  if (Array.isArray(node)) return node.map(extractText).join(\"\");\n  if (typeof node === \"object\" && \"props\" in node) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    return extractText((node as any).props?.children);\n  }\n  return \"\";\n}\n\nconst components: Partial<Components> = {\n  code({ className, children, ...props }) {\n    const isInline = !className && typeof children === \"string\" && !children.includes(\"\\n\");\n    if (isInline) {\n      const text = String(children).trim();\n      if (isUrl(text)) {\n        return <CopyableLink href={text}><code className={className} {...props}>{children}</code></CopyableLink>;\n      }\n      return (\n        <code className={className} {...props}>\n          {children}\n        </code>\n      );\n    }\n    return <CodeBlock className={className} rawChildren={children}>{children}</CodeBlock>;\n  },\n  a({ href, children }) {\n    if (href) {\n      return <CopyableLink href={href}>{children}</CopyableLink>;\n    }\n    return <a>{children}</a>;\n  },\n};\n\n// ---- Media file type detection ----\n\ntype MediaType = \"image\" | \"video\" | \"audio\" | \"pdf\" | \"code\" | \"text\" | \"spreadsheet\" | \"archive\" | \"other\";\n\nconst IMAGE_EXTS = new Set([\"png\", \"jpg\", \"jpeg\", \"gif\", \"webp\", \"svg\", \"ico\", \"bmp\", \"tiff\", \"tif\"]);\nconst VIDEO_EXTS = new Set([\"mp4\", \"webm\", \"mov\", \"avi\", \"mkv\"]);\nconst AUDIO_EXTS = new Set([\"mp3\", \"wav\", \"ogg\", \"flac\", \"aac\", \"m4a\", \"wma\"]);\nconst CODE_EXTS = new Set([\"js\", \"ts\", \"tsx\", \"jsx\", \"py\", \"rs\", \"go\", \"java\", \"c\", \"cpp\", \"h\", \"sh\", \"sql\", \"rb\", \"php\", \"swift\", \"kt\", \"css\", \"html\", \"xml\"]);\nconst SPREADSHEET_EXTS = new Set([\"csv\", \"xls\", \"xlsx\"]);\nconst ARCHIVE_EXTS = new Set([\"zip\", \"tar\", \"gz\", \"7z\", \"rar\"]);\n\nfunction getExtension(path: string): string {\n  const match = path.match(/\\.(\\w+)(?:\\?|$)/);\n  return match ? match[1].toLowerCase() : \"\";\n}\n\nfunction detectMediaType(path: string): MediaType {\n  const ext = getExtension(path);\n  if (IMAGE_EXTS.has(ext)) return \"image\";\n  if (VIDEO_EXTS.has(ext)) return \"video\";\n  if (AUDIO_EXTS.has(ext)) return \"audio\";\n  if (ext === \"pdf\") return \"pdf\";\n  if (CODE_EXTS.has(ext)) return \"code\";\n  if (SPREADSHEET_EXTS.has(ext)) return \"spreadsheet\";\n  if (ARCHIVE_EXTS.has(ext)) return \"archive\";\n  if ([\"txt\", \"md\", \"log\", \"json\", \"yaml\", \"yml\"].includes(ext)) return \"text\";\n  return \"other\";\n}\n\nfunction getFileName(path: string): string {\n  // Handle both URL-encoded API paths and raw paths\n  const decoded = decodeURIComponent(path);\n  const parts = decoded.split(\"/\");\n  const last = parts[parts.length - 1];\n  // Remove query params\n  return last.split(\"?\")[0] || \"file\";\n}\n\nfunction getMediaTypeIcon(type: MediaType) {\n  switch (type) {\n    case \"audio\": return FileAudio;\n    case \"video\": return FileVideo;\n    case \"pdf\": return FileText;\n    case \"code\": return FileCode;\n    case \"spreadsheet\": return FileSpreadsheet;\n    case \"archive\": return FileArchive;\n    case \"text\": return FileText;\n    default: return FileIcon;\n  }\n}\n\nfunction formatFileSize(bytes: number): string {\n  if (bytes < 1024) return `${bytes} B`;\n  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n  if (bytes < 1024 * 1024 * 1024) return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n  return `${(bytes / (1024 * 1024 * 1024)).toFixed(1)} GB`;\n}\n\n/** Extract original file path from MEDIA: URL for info API */\nfunction extractOriginalPath(url: string): string | null {\n  try {\n    const match = url.match(/[?&]path=([^&]+)/);\n    return match ? decodeURIComponent(match[1]) : null;\n  } catch {\n    return null;\n  }\n}\n\n/** Extract MEDIA: lines and return [cleanedContent, mediaEntries[]] */\ninterface MediaEntry {\n  url: string;\n  originalPath: string;\n  type: MediaType;\n  fileName: string;\n}\n\nfunction extractMediaLines(text: string): [string, MediaEntry[]] {\n  const entries: MediaEntry[] = [];\n  // Only match MEDIA: lines with actual file paths (starting with /) or URLs\n  const cleaned = text.replace(/^MEDIA:\\s*(.+)$/gm, (_match, path: string) => {\n    const trimmed = path.trim();\n    // Skip if it doesn't look like a path or URL\n    if (!trimmed.startsWith(\"/\") && !trimmed.startsWith(\"http://\") && !trimmed.startsWith(\"https://\") && !trimmed.startsWith(\"data:\")) {\n      return _match; // Leave as-is, not a real MEDIA marker\n    }\n    let url: string;\n    let originalPath: string;\n\n    if (trimmed.startsWith(\"http://\") || trimmed.startsWith(\"https://\") || trimmed.startsWith(\"data:\")) {\n      url = trimmed;\n      originalPath = trimmed;\n    } else {\n      url = `/api/media?path=${encodeURIComponent(trimmed)}`;\n      originalPath = trimmed;\n    }\n\n    const type = detectMediaType(trimmed);\n    const fileName = getFileName(trimmed);\n    entries.push({ url, originalPath, type, fileName });\n    return \"\";\n  });\n  return [cleaned, entries];\n}\n\n// ---- Media renderers ----\n\nfunction MediaImage({ src }: { src: string }) {\n  const [error, setError] = useState(false);\n  const [expanded, setExpanded] = useState(false);\n\n  if (error) {\n    return (\n      <div className=\"flex h-48 w-48 items-center justify-center rounded-lg border border-zinc-700 bg-zinc-800/50 text-xs text-zinc-500\">\n        ⚠️ 로드 실패\n      </div>\n    );\n  }\n\n  return (\n    <img\n      src={src}\n      alt=\"media\"\n      className={`rounded-lg border border-zinc-700 cursor-pointer transition-all ${expanded ? \"max-w-full\" : \"h-48 max-w-xs md:h-56 md:max-w-sm\"} object-contain`}\n      onClick={() => setExpanded(e => !e)}\n      onError={() => setError(true)}\n    />\n  );\n}\n\nfunction MediaVideo({ src }: { src: string }) {\n  return (\n    <video\n      src={src}\n      controls\n      className=\"h-48 md:h-56 rounded-lg border border-zinc-700\"\n      preload=\"metadata\"\n    />\n  );\n}\n\nfunction MediaAudio({ src, fileName }: { src: string; fileName: string }) {\n  return (\n    <div className=\"flex w-64 items-center gap-3 rounded-lg border border-zinc-700 bg-zinc-800/80 p-3\">\n      <FileAudio size={20} className=\"shrink-0 text-zinc-400\" />\n      <div className=\"min-w-0 flex-1\">\n        <div className=\"truncate text-sm text-zinc-200\">{fileName}</div>\n        <audio src={src} controls className=\"mt-1.5 w-full\" preload=\"metadata\" />\n      </div>\n    </div>\n  );\n}\n\nfunction MediaPdf({ src, fileName }: { src: string; fileName: string }) {\n  return (\n    <div className=\"w-72 overflow-hidden rounded-lg border border-zinc-700\">\n      <object\n        data={src}\n        type=\"application/pdf\"\n        className=\"h-48 md:h-56 w-full\"\n      >\n        <FileCard url={src} fileName={fileName} type=\"pdf\" />\n      </object>\n    </div>\n  );\n}\n\nfunction FileCard({ url, fileName, type }: { url: string; fileName: string; type: MediaType }) {\n  const [fileInfo, setFileInfo] = useState<{ size: number } | null>(null);\n  const Icon = getMediaTypeIcon(type);\n\n  useEffect(() => {\n    const originalPath = extractOriginalPath(url);\n    if (!originalPath) return;\n    fetch(`/api/media?path=${encodeURIComponent(originalPath)}&info=1`)\n      .then(r => r.ok ? r.json() : null)\n      .then(data => { if (data?.size) setFileInfo({ size: data.size }); })\n      .catch(() => {});\n  }, [url]);\n\n  return (\n    <div className=\"flex w-56 items-center gap-3 rounded-lg border border-zinc-700 bg-zinc-800/80 px-4 py-3\">\n      <div className=\"flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-zinc-700/60\">\n        <Icon size={20} className=\"text-zinc-300\" />\n      </div>\n      <div className=\"min-w-0 flex-1\">\n        <div className=\"truncate text-sm font-medium text-zinc-200\">{fileName}</div>\n        {fileInfo && (\n          <div className=\"text-xs text-zinc-500\">{formatFileSize(fileInfo.size)}</div>\n        )}\n      </div>\n      <a\n        href={url}\n        download={fileName}\n        className=\"flex h-8 w-8 shrink-0 items-center justify-center rounded-lg text-zinc-400 transition hover:bg-zinc-700 hover:text-zinc-200\"\n        title=\"다운로드\"\n      >\n        <Download size={16} />\n      </a>\n    </div>\n  );\n}\n\nfunction MediaRenderer({ entry }: { entry: MediaEntry }) {\n  switch (entry.type) {\n    case \"image\":\n      return <MediaImage src={entry.url} />;\n    case \"video\":\n      return <MediaVideo src={entry.url} />;\n    case \"audio\":\n      return <MediaAudio src={entry.url} fileName={entry.fileName} />;\n    case \"pdf\":\n      return <MediaPdf src={entry.url} fileName={entry.fileName} />;\n    default:\n      return <FileCard url={entry.url} fileName={entry.fileName} type={entry.type} />;\n  }\n}\n\nexport const MarkdownRenderer = memo(function MarkdownRenderer({\n  content,\n}: {\n  content: string;\n}) {\n  // Extract MEDIA: lines\n  const [withoutMedia, mediaEntries] = extractMediaLines(content);\n  // Collapse 3+ consecutive newlines to 2 (one blank line)\n  const cleaned = withoutMedia.replace(/\\n{3,}/g, \"\\n\\n\").trim();\n  return (\n    <div className=\"prose\">\n      {mediaEntries.length > 0 && (\n        <div className=\"flex gap-2 overflow-x-auto pb-2 scrollbar-thin\">\n          {mediaEntries.map((entry, i) => (\n            <div key={i} className=\"shrink-0\">\n              <MediaRenderer entry={entry} />\n            </div>\n          ))}\n        </div>\n      )}\n      {cleaned && (\n        <ReactMarkdown\n          remarkPlugins={[remarkGfm]}\n          rehypePlugins={[rehypeHighlight]}\n          components={components}\n        >\n          {cleaned}\n        </ReactMarkdown>\n      )}\n    </div>\n  );\n});\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1147, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/chat/subagent-card.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useRef, useState } from \"react\";\nimport { useGateway } from \"@/lib/gateway/hooks\";\nimport type { EventFrame } from \"@/lib/gateway/protocol\";\nimport {\n  Bot,\n  ChevronDown,\n  ChevronUp,\n  Loader2,\n  CheckCircle2,\n  Wrench,\n  Zap,\n} from \"lucide-react\";\n\ninterface SubagentStatus {\n  content: string;\n  toolName?: string;\n  phase: \"pending\" | \"running\" | \"done\";\n  tokenCount: number;\n  startedAt: number;\n  updatedAt: number;\n}\n\n/**\n * Inline card that shows realtime subagent progress inside an assistant bubble.\n * Subscribes to gateway agent events for the given sessionKey.\n */\nexport function SubagentCard({\n  sessionKey,\n  label,\n  task,\n}: {\n  sessionKey?: string;\n  label?: string;\n  task?: string;\n}) {\n  const { client } = useGateway();\n  const [status, setStatus] = useState<SubagentStatus>({\n    content: \"\",\n    phase: \"pending\",\n    tokenCount: 0,\n    startedAt: Date.now(),\n    updatedAt: Date.now(),\n  });\n  const [expanded, setExpanded] = useState(false);\n  const lastSeqRef = useRef(-1);\n\n  useEffect(() => {\n    if (!client || !sessionKey) return;\n\n    const unsub = client.onEvent((frame: EventFrame) => {\n      if (frame.event !== \"agent\") return;\n\n      // Dedup\n      if (frame.seq != null) {\n        if (frame.seq <= lastSeqRef.current) return;\n        lastSeqRef.current = frame.seq;\n      }\n\n      const raw = frame.payload as Record<string, unknown>;\n      const evKey = raw.sessionKey as string | undefined;\n      if (evKey !== sessionKey) return;\n\n      const stream = raw.stream as string | undefined;\n      const data = raw.data as Record<string, unknown> | undefined;\n\n      setStatus((prev) => {\n        const next = { ...prev, updatedAt: Date.now() };\n\n        if (stream === \"assistant\" && data?.delta) {\n          next.content += data.delta as string;\n          next.phase = \"running\";\n          next.toolName = undefined;\n          next.tokenCount += 1;\n        } else if (stream === \"tool-start\") {\n          next.toolName = (data?.name as string) || \"tool\";\n          next.phase = \"running\";\n        } else if (stream === \"tool-end\") {\n          next.toolName = undefined;\n        } else if (\n          stream === \"lifecycle\" &&\n          data?.phase === \"end\"\n        ) {\n          next.phase = \"done\";\n          next.toolName = undefined;\n        }\n\n        return next;\n      });\n    });\n\n    return unsub;\n  }, [client, sessionKey]);\n\n  const elapsed = Math.floor(\n    (status.updatedAt - status.startedAt) / 1000\n  );\n  const elapsedStr =\n    elapsed < 60\n      ? `${elapsed}s`\n      : `${Math.floor(elapsed / 60)}m ${elapsed % 60}s`;\n\n  const lastLines = status.content\n    .split(\"\\n\")\n    .filter(Boolean)\n    .slice(-4)\n    .join(\"\\n\");\n\n  const displayLabel = label || parseLabel(sessionKey || \"\");\n\n  return (\n    <div className=\"my-2 overflow-hidden rounded-lg border border-border/50 bg-muted/30\">\n      {/* Header */}\n      <button\n        onClick={() => setExpanded(!expanded)}\n        className=\"flex w-full items-center gap-2 px-3 py-2 text-left transition hover:bg-muted/50\"\n      >\n        {/* Status indicator */}\n        {status.phase === \"pending\" ? (\n          <Zap size={14} className=\"text-amber-400\" />\n        ) : status.phase === \"running\" ? (\n          <Loader2 size={14} className=\"animate-spin text-primary\" />\n        ) : (\n          <CheckCircle2 size={14} className=\"text-emerald-400\" />\n        )}\n\n        {/* Label */}\n        <span className=\"flex-1 truncate text-xs font-medium text-foreground\">\n          {displayLabel}\n        </span>\n\n        {/* Tool indicator */}\n        {status.toolName && (\n          <span className=\"flex items-center gap-1 text-[10px] text-muted-foreground\">\n            <Wrench size={10} />\n            {status.toolName}\n          </span>\n        )}\n\n        {/* Stats */}\n        <span className=\"text-[10px] text-muted-foreground\">{elapsedStr}</span>\n\n        {expanded ? (\n          <ChevronUp size={12} className=\"text-muted-foreground\" />\n        ) : (\n          <ChevronDown size={12} className=\"text-muted-foreground\" />\n        )}\n      </button>\n\n      {/* Preview (always show last line when collapsed) */}\n      {!expanded && lastLines && (\n        <div className=\"border-t border-border/30 px-3 py-1.5\">\n          <p className=\"truncate text-[11px] text-muted-foreground font-mono\">\n            {lastLines.split(\"\\n\").pop()}\n          </p>\n        </div>\n      )}\n\n      {/* Expanded content */}\n      {expanded && (\n        <div className=\"border-t border-border/30 px-3 py-2\">\n          {task && (\n            <div className=\"mb-2 text-[11px] text-muted-foreground\">\n              <span className=\"text-muted-foreground\">Task: </span>\n              {task.length > 200 ? task.slice(0, 200) + \"…\" : task}\n            </div>\n          )}\n          <pre className=\"max-h-48 overflow-y-auto overflow-x-hidden whitespace-pre-wrap break-all text-[11px] leading-relaxed text-muted-foreground font-mono\">\n            {status.content || (status.phase === \"pending\" ? \"대기 중...\" : \"처리 중...\")}\n          </pre>\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction parseLabel(sessionKey: string): string {\n  const parts = sessionKey.split(\":\");\n  if (parts.length >= 3) {\n    const agent = parts[1];\n    const type = parts[2];\n    if (type === \"subagent\") return `${agent} 서브에이전트`;\n    if (type === \"cron\") return `${agent} 크론`;\n    return `${agent}/${type}`;\n  }\n  return sessionKey;\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;;;AALA;;;;AA4BO,SAAS,aAAa,KAQ5B;QAR4B,EAC3B,UAAU,EACV,KAAK,EACL,IAAI,EAKL,GAR4B;;IAS3B,MAAM,EAAE,MAAM,EAAE,GAAG,IAAA,gJAAU;IAC7B,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,2UAAQ,EAAiB;QACnD,SAAS;QACT,OAAO;QACP,YAAY;QACZ,WAAW,KAAK,GAAG;QACnB,WAAW,KAAK,GAAG;IACrB;IACA,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,2UAAQ,EAAC;IACzC,MAAM,aAAa,IAAA,yUAAM,EAAC,CAAC;IAE3B,IAAA,4UAAS;kCAAC;YACR,IAAI,CAAC,UAAU,CAAC,YAAY;YAE5B,MAAM,QAAQ,OAAO,OAAO;gDAAC,CAAC;oBAC5B,IAAI,MAAM,KAAK,KAAK,SAAS;oBAE7B,QAAQ;oBACR,IAAI,MAAM,GAAG,IAAI,MAAM;wBACrB,IAAI,MAAM,GAAG,IAAI,WAAW,OAAO,EAAE;wBACrC,WAAW,OAAO,GAAG,MAAM,GAAG;oBAChC;oBAEA,MAAM,MAAM,MAAM,OAAO;oBACzB,MAAM,QAAQ,IAAI,UAAU;oBAC5B,IAAI,UAAU,YAAY;oBAE1B,MAAM,SAAS,IAAI,MAAM;oBACzB,MAAM,OAAO,IAAI,IAAI;oBAErB;wDAAU,CAAC;4BACT,MAAM,OAAO;gCAAE,GAAG,IAAI;gCAAE,WAAW,KAAK,GAAG;4BAAG;4BAE9C,IAAI,WAAW,gBAAe,iBAAA,2BAAA,KAAM,KAAK,GAAE;gCACzC,KAAK,OAAO,IAAI,KAAK,KAAK;gCAC1B,KAAK,KAAK,GAAG;gCACb,KAAK,QAAQ,GAAG;gCAChB,KAAK,UAAU,IAAI;4BACrB,OAAO,IAAI,WAAW,cAAc;gCAClC,KAAK,QAAQ,GAAG,CAAC,iBAAA,2BAAA,KAAM,IAAI,AAAU,KAAK;gCAC1C,KAAK,KAAK,GAAG;4BACf,OAAO,IAAI,WAAW,YAAY;gCAChC,KAAK,QAAQ,GAAG;4BAClB,OAAO,IACL,WAAW,eACX,CAAA,iBAAA,2BAAA,KAAM,KAAK,MAAK,OAChB;gCACA,KAAK,KAAK,GAAG;gCACb,KAAK,QAAQ,GAAG;4BAClB;4BAEA,OAAO;wBACT;;gBACF;;YAEA,OAAO;QACT;iCAAG;QAAC;QAAQ;KAAW;IAEvB,MAAM,UAAU,KAAK,KAAK,CACxB,CAAC,OAAO,SAAS,GAAG,OAAO,SAAS,IAAI;IAE1C,MAAM,aACJ,UAAU,KACN,AAAC,GAAU,OAAR,SAAQ,OACX,AAAC,GAA+B,OAA7B,KAAK,KAAK,CAAC,UAAU,KAAI,MAAiB,OAAb,UAAU,IAAG;IAEnD,MAAM,YAAY,OAAO,OAAO,CAC7B,KAAK,CAAC,MACN,MAAM,CAAC,SACP,KAAK,CAAC,CAAC,GACP,IAAI,CAAC;IAER,MAAM,eAAe,SAAS,WAAW,cAAc;IAEvD,qBACE,+VAAC;QAAI,WAAU;;0BAEb,+VAAC;gBACC,SAAS,IAAM,YAAY,CAAC;gBAC5B,WAAU;;oBAGT,OAAO,KAAK,KAAK,0BAChB,+VAAC,8RAAG;wBAAC,MAAM;wBAAI,WAAU;;;;;+BACvB,OAAO,KAAK,KAAK,0BACnB,+VAAC,mTAAO;wBAAC,MAAM;wBAAI,WAAU;;;;;6CAE7B,+VAAC,4TAAY;wBAAC,MAAM;wBAAI,WAAU;;;;;;kCAIpC,+VAAC;wBAAK,WAAU;kCACb;;;;;;oBAIF,OAAO,QAAQ,kBACd,+VAAC;wBAAK,WAAU;;0CACd,+VAAC,uSAAM;gCAAC,MAAM;;;;;;4BACb,OAAO,QAAQ;;;;;;;kCAKpB,+VAAC;wBAAK,WAAU;kCAAqC;;;;;;oBAEpD,yBACC,+VAAC,oTAAS;wBAAC,MAAM;wBAAI,WAAU;;;;;6CAE/B,+VAAC,0TAAW;wBAAC,MAAM;wBAAI,WAAU;;;;;;;;;;;;YAKpC,CAAC,YAAY,2BACZ,+VAAC;gBAAI,WAAU;0BACb,cAAA,+VAAC;oBAAE,WAAU;8BACV,UAAU,KAAK,CAAC,MAAM,GAAG;;;;;;;;;;;YAM/B,0BACC,+VAAC;gBAAI,WAAU;;oBACZ,sBACC,+VAAC;wBAAI,WAAU;;0CACb,+VAAC;gCAAK,WAAU;0CAAwB;;;;;;4BACvC,KAAK,MAAM,GAAG,MAAM,KAAK,KAAK,CAAC,GAAG,OAAO,MAAM;;;;;;;kCAGpD,+VAAC;wBAAI,WAAU;kCACZ,OAAO,OAAO,IAAI,CAAC,OAAO,KAAK,KAAK,YAAY,YAAY,SAAS;;;;;;;;;;;;;;;;;;AAMlF;GAnJgB;;QASK,gJAAU;;;KATf;AAqJhB,SAAS,WAAW,UAAkB;IACpC,MAAM,QAAQ,WAAW,KAAK,CAAC;IAC/B,IAAI,MAAM,MAAM,IAAI,GAAG;QACrB,MAAM,QAAQ,KAAK,CAAC,EAAE;QACtB,MAAM,OAAO,KAAK,CAAC,EAAE;QACrB,IAAI,SAAS,YAAY,OAAO,AAAC,GAAQ,OAAN,OAAM;QACzC,IAAI,SAAS,QAAQ,OAAO,AAAC,GAAQ,OAAN,OAAM;QACrC,OAAO,AAAC,GAAW,OAAT,OAAM,KAAQ,OAAL;IACrB;IACA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 1396, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/chat/tool-call-card.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useMemo } from \"react\";\nimport { ChevronDown, ChevronRight, Loader2, CheckCircle2, AlertCircle } from \"lucide-react\";\nimport type { ToolCall } from \"@/lib/gateway/protocol\";\nimport { SubagentCard } from \"./subagent-card\";\n\n/** Tools that spawn subagents */\nconst SPAWN_TOOLS = new Set([\"sessions_spawn\", \"subagents\"]);\n\nexport function ToolCallCard({ toolCall }: { toolCall: ToolCall }) {\n  const [expanded, setExpanded] = useState(false);\n\n  // Extract subagent info from sessions_spawn args/result\n  const spawnInfo = useMemo(() => {\n    if (!SPAWN_TOOLS.has(toolCall.name)) return null;\n    try {\n      const args = toolCall.args ? JSON.parse(toolCall.args) : {};\n      let result: Record<string, unknown> = {};\n      try { result = toolCall.result ? JSON.parse(toolCall.result) : {}; } catch {}\n      return {\n        sessionKey: (result.childSessionKey || result.sessionKey || result.key || undefined) as string | undefined,\n        label: (args.label || result.label || undefined) as string | undefined,\n        task: (args.task || args.message || undefined) as string | undefined,\n      };\n    } catch {\n      // Even if parsing fails, still show the card for spawn tools\n      return { sessionKey: undefined, label: undefined, task: undefined };\n    }\n  }, [toolCall.name, toolCall.args, toolCall.result]);\n\n  // If this is a spawn tool, render SubagentCard instead\n  if (spawnInfo) {\n    return (\n      <SubagentCard\n        sessionKey={spawnInfo.sessionKey}\n        label={spawnInfo.label}\n        task={spawnInfo.task}\n      />\n    );\n  }\n\n  const statusIcon =\n    toolCall.status === \"running\" ? (\n      <Loader2 size={14} className=\"animate-spin text-primary\" />\n    ) : toolCall.status === \"done\" ? (\n      <CheckCircle2 size={14} className=\"text-emerald-400\" />\n    ) : (\n      <AlertCircle size={14} className=\"text-destructive\" />\n    );\n\n  return (\n    <div className=\"my-1.5 rounded-lg border border-border bg-muted/50\">\n      <button\n        onClick={() => setExpanded(!expanded)}\n        className=\"flex w-full items-center gap-2 px-3 py-2 text-left text-sm transition hover:bg-muted\"\n      >\n        {expanded ? <ChevronDown size={14} /> : <ChevronRight size={14} />}\n        {statusIcon}\n        <span className=\"font-mono text-xs text-foreground\">{toolCall.name}</span>\n        {toolCall.status === \"running\" && (\n          <span className=\"ml-auto text-xs text-muted-foreground\">실행 중...</span>\n        )}\n      </button>\n\n      {expanded && (\n        <div className=\"border-t border-border px-3 py-2 text-xs\">\n          {toolCall.args && (\n            <div className=\"mb-2\">\n              <div className=\"mb-1 text-muted-foreground\">Arguments</div>\n              <pre className=\"max-h-40 overflow-y-auto overflow-x-hidden whitespace-pre-wrap break-all rounded bg-background p-2 text-muted-foreground\">\n                {formatJson(toolCall.args)}\n              </pre>\n            </div>\n          )}\n          {toolCall.result && (\n            <div>\n              <div className=\"mb-1 text-muted-foreground\">Result</div>\n              <pre className=\"max-h-40 overflow-y-auto overflow-x-hidden whitespace-pre-wrap break-all rounded bg-background p-2 text-muted-foreground\">\n                {formatJson(toolCall.result)}\n              </pre>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction formatJson(s: string): string {\n  try {\n    return JSON.stringify(JSON.parse(s), null, 2);\n  } catch {\n    return s;\n  }\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;;;AALA;;;;AAOA,+BAA+B,GAC/B,MAAM,cAAc,IAAI,IAAI;IAAC;IAAkB;CAAY;AAEpD,SAAS,aAAa,KAAoC;QAApC,EAAE,QAAQ,EAA0B,GAApC;;IAC3B,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,2UAAQ,EAAC;IAEzC,wDAAwD;IACxD,MAAM,YAAY,IAAA,0UAAO;2CAAC;YACxB,IAAI,CAAC,YAAY,GAAG,CAAC,SAAS,IAAI,GAAG,OAAO;YAC5C,IAAI;gBACF,MAAM,OAAO,SAAS,IAAI,GAAG,KAAK,KAAK,CAAC,SAAS,IAAI,IAAI,CAAC;gBAC1D,IAAI,SAAkC,CAAC;gBACvC,IAAI;oBAAE,SAAS,SAAS,MAAM,GAAG,KAAK,KAAK,CAAC,SAAS,MAAM,IAAI,CAAC;gBAAG,EAAE,UAAM,CAAC;gBAC5E,OAAO;oBACL,YAAa,OAAO,eAAe,IAAI,OAAO,UAAU,IAAI,OAAO,GAAG,IAAI;oBAC1E,OAAQ,KAAK,KAAK,IAAI,OAAO,KAAK,IAAI;oBACtC,MAAO,KAAK,IAAI,IAAI,KAAK,OAAO,IAAI;gBACtC;YACF,EAAE,UAAM;gBACN,6DAA6D;gBAC7D,OAAO;oBAAE,YAAY;oBAAW,OAAO;oBAAW,MAAM;gBAAU;YACpE;QACF;0CAAG;QAAC,SAAS,IAAI;QAAE,SAAS,IAAI;QAAE,SAAS,MAAM;KAAC;IAElD,uDAAuD;IACvD,IAAI,WAAW;QACb,qBACE,+VAAC,iKAAY;YACX,YAAY,UAAU,UAAU;YAChC,OAAO,UAAU,KAAK;YACtB,MAAM,UAAU,IAAI;;;;;;IAG1B;IAEA,MAAM,aACJ,SAAS,MAAM,KAAK,0BAClB,+VAAC,mTAAO;QAAC,MAAM;QAAI,WAAU;;;;;eAC3B,SAAS,MAAM,KAAK,uBACtB,+VAAC,4TAAY;QAAC,MAAM;QAAI,WAAU;;;;;6BAElC,+VAAC,0TAAW;QAAC,MAAM;QAAI,WAAU;;;;;;IAGrC,qBACE,+VAAC;QAAI,WAAU;;0BACb,+VAAC;gBACC,SAAS,IAAM,YAAY,CAAC;gBAC5B,WAAU;;oBAET,yBAAW,+VAAC,0TAAW;wBAAC,MAAM;;;;;6CAAS,+VAAC,6TAAY;wBAAC,MAAM;;;;;;oBAC3D;kCACD,+VAAC;wBAAK,WAAU;kCAAqC,SAAS,IAAI;;;;;;oBACjE,SAAS,MAAM,KAAK,2BACnB,+VAAC;wBAAK,WAAU;kCAAwC;;;;;;;;;;;;YAI3D,0BACC,+VAAC;gBAAI,WAAU;;oBACZ,SAAS,IAAI,kBACZ,+VAAC;wBAAI,WAAU;;0CACb,+VAAC;gCAAI,WAAU;0CAA6B;;;;;;0CAC5C,+VAAC;gCAAI,WAAU;0CACZ,WAAW,SAAS,IAAI;;;;;;;;;;;;oBAI9B,SAAS,MAAM,kBACd,+VAAC;;0CACC,+VAAC;gCAAI,WAAU;0CAA6B;;;;;;0CAC5C,+VAAC;gCAAI,WAAU;0CACZ,WAAW,SAAS,MAAM;;;;;;;;;;;;;;;;;;;;;;;;AAQ3C;GA7EgB;KAAA;AA+EhB,SAAS,WAAW,CAAS;IAC3B,IAAI;QACF,OAAO,KAAK,SAAS,CAAC,KAAK,KAAK,CAAC,IAAI,MAAM;IAC7C,EAAE,UAAM;QACN,OAAO;IACT;AACF","debugId":null}},
    {"offset": {"line": 1611, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/chat/message-list.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useRef } from \"react\";\nimport { useState as useStateCopy } from \"react\";\nimport { User, Bot, Clock, X, Copy, Check } from \"lucide-react\";\nimport { MarkdownRenderer } from \"./markdown-renderer\";\nimport { ToolCallCard } from \"./tool-call-card\";\nimport type { DisplayMessage, DisplayAttachment } from \"@/lib/gateway/hooks\";\n\n/** Strip task-memo HTML comments from display text */\nconst TASK_MEMO_STRIP_RE = /\\s*<!--\\s*task-memo:\\s*\\{[\\s\\S]*?\\}\\s*-->\\s*/g;\nfunction stripTaskMemo(text: string): string {\n  return text.replace(TASK_MEMO_STRIP_RE, \"\").trimEnd();\n}\n\nexport function MessageList({\n  messages,\n  loading,\n  streaming,\n  onCancelQueued,\n}: {\n  messages: DisplayMessage[];\n  loading: boolean;\n  streaming: boolean;\n  onCancelQueued?: (id: string) => void;\n}) {\n  const bottomRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    bottomRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages]);\n\n  if (loading) {\n    return (\n      <div className=\"flex flex-1 items-center justify-center text-muted-foreground\">\n        대화 기록 불러오는 중...\n      </div>\n    );\n  }\n\n  if (messages.length === 0) {\n    return (\n      <div className=\"flex flex-1 flex-col items-center justify-center gap-3 text-muted-foreground\">\n        <Bot size={48} strokeWidth={1.5} className=\"text-muted-foreground\" />\n        <p className=\"text-lg\">무엇을 도와드릴까요?</p>\n        <p className=\"text-sm text-muted-foreground\">메시지를 입력하여 대화를 시작하세요</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex-1 overflow-y-auto overflow-x-hidden px-3 py-3 md:px-4 md:py-4\" style={{ WebkitOverflowScrolling: \"touch\" }}>\n      <div className=\"mx-auto max-w-3xl space-y-3 md:space-y-4\">\n        {messages\n          .filter((msg) => msg.content || msg.toolCalls.length > 0 || msg.streaming)\n          .map((msg, idx, arr) => {\n            const prevRole = idx > 0 ? arr[idx - 1].role : null;\n            const showAvatar = msg.role !== \"assistant\" || prevRole !== \"assistant\";\n            return (\n              <MessageBubble key={msg.id} message={msg} showAvatar={showAvatar} onCancel={msg.queued ? onCancelQueued : undefined} />\n            );\n          })}\n        {streaming && !messages.some(m => m.streaming) && <ThinkingIndicator />}\n        <div ref={bottomRef} />\n      </div>\n    </div>\n  );\n}\n\nfunction ThinkingIndicator() {\n  return (\n    <div className=\"flex gap-3\">\n      <div className=\"flex h-8 w-8 shrink-0 items-center justify-center rounded-full bg-primary/10 text-primary\">\n        <Bot size={18} />\n      </div>\n      <div className=\"flex items-center gap-1.5 rounded-2xl bg-muted/60 px-4 py-3\">\n        <span className=\"h-2 w-2 animate-bounce rounded-full bg-muted-foreground\" style={{ animationDelay: \"0ms\" }} />\n        <span className=\"h-2 w-2 animate-bounce rounded-full bg-muted-foreground\" style={{ animationDelay: \"150ms\" }} />\n        <span className=\"h-2 w-2 animate-bounce rounded-full bg-muted-foreground\" style={{ animationDelay: \"300ms\" }} />\n      </div>\n    </div>\n  );\n}\n\nfunction copyToClipboard(text: string): Promise<void> {\n  // navigator.clipboard requires HTTPS or localhost\n  if (navigator.clipboard?.writeText) {\n    return navigator.clipboard.writeText(text);\n  }\n  // Fallback for non-HTTPS (e.g. Tailscale HTTP)\n  return new Promise((resolve, reject) => {\n    const ta = document.createElement(\"textarea\");\n    ta.value = text;\n    ta.style.position = \"fixed\";\n    ta.style.opacity = \"0\";\n    document.body.appendChild(ta);\n    ta.select();\n    try {\n      document.execCommand(\"copy\");\n      resolve();\n    } catch (err) {\n      reject(err);\n    } finally {\n      document.body.removeChild(ta);\n    }\n  });\n}\n\nfunction CopyButton({ text }: { text: string }) {\n  const [copied, setCopied] = useStateCopy(false);\n  const handleCopy = async (e: React.MouseEvent) => {\n    e.stopPropagation();\n    try {\n      await copyToClipboard(text);\n      setCopied(true);\n      setTimeout(() => setCopied(false), 1500);\n    } catch {}\n  };\n  return (\n    <button\n      onClick={handleCopy}\n      className=\"rounded p-1 text-muted-foreground opacity-60 sm:opacity-0 transition group-hover:opacity-100 hover:bg-white/10 hover:text-accent-foreground active:scale-90\"\n      title=\"복사\"\n    >\n      {copied ? <Check size={12} className=\"text-emerald-400\" /> : <Copy size={12} />}\n    </button>\n  );\n}\n\nfunction MessageBubble({ message, showAvatar = true, onCancel }: { message: DisplayMessage; showAvatar?: boolean; onCancel?: (id: string) => void }) {\n  const isUser = message.role === \"user\";\n  const isSystem = message.role === \"system\";\n  const isQueued = message.queued;\n\n  // System messages: centered, muted style\n  if (isSystem) {\n    return (\n      <div className=\"flex justify-center py-1\">\n        <div className=\"max-w-[90%] rounded-lg border border-border/50 bg-muted/30 px-4 py-2 text-center text-xs text-muted-foreground\">\n          <MarkdownRenderer content={message.content} />\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`group flex gap-3 ${isUser ? \"justify-end\" : \"\"}`}>\n      {/* Copy button for user messages (left of bubble) */}\n      {isUser && message.content && (\n        <div className=\"flex items-start pt-2\">\n          <CopyButton text={message.content} />\n        </div>\n      )}\n      {!isUser && (\n        showAvatar ? (\n          <div className=\"flex h-8 w-8 shrink-0 items-center justify-center rounded-full bg-primary/10 text-primary\">\n            <Bot size={18} />\n          </div>\n        ) : (\n          <div className=\"w-8 shrink-0\" />\n        )\n      )}\n\n      <div\n        className={`min-w-0 max-w-[90%] md:max-w-[85%] ${\n          isUser\n            ? `rounded-2xl rounded-br-md px-3.5 py-2 md:px-4 md:py-2.5 text-foreground ${isQueued ? \"bg-primary/15 border border-primary/20\" : \"bg-primary/15 border border-primary/10\"}`\n            : \"flex-1\"\n        }`}\n      >\n        {isUser ? (\n          <div>\n            {/* Attachment images */}\n            {message.attachments && message.attachments.length > 0 && (\n              <div className=\"mb-2 flex flex-wrap gap-2\">\n                {message.attachments.map((att, i) =>\n                  att.dataUrl && att.mimeType.startsWith(\"image/\") ? (\n                    <img\n                      key={i}\n                      src={att.dataUrl}\n                      alt={att.fileName}\n                      className=\"max-h-48 w-full md:max-w-full md:w-auto rounded-lg object-contain\"\n                    />\n                  ) : (\n                    <div key={i} className=\"rounded-lg bg-white/10 px-3 py-1.5 text-xs\">\n                      📎 {att.fileName}\n                    </div>\n                  )\n                )}\n              </div>\n            )}\n            {message.content && message.content !== \"(첨부 파일)\" && (\n              <p className={`whitespace-pre-wrap break-words text-sm ${isQueued ? \"opacity-70\" : \"\"}`}>{message.content}</p>\n            )}\n            {message.content && message.content === \"(첨부 파일)\" && !message.attachments?.length && (\n              <p className={`whitespace-pre-wrap break-words text-sm ${isQueued ? \"opacity-70\" : \"\"}`}>{message.content}</p>\n            )}\n            {isQueued && (\n              <div className=\"mt-1.5 flex items-center justify-end gap-2\">\n                <span className=\"flex items-center gap-1 text-[10px] text-primary/70\">\n                  <Clock size={10} />\n                  대기 중\n                </span>\n                {onCancel && (\n                  <button\n                    onClick={() => onCancel(message.id)}\n                    className=\"flex items-center gap-0.5 rounded-full bg-muted px-1.5 py-0.5 text-[10px] text-muted-foreground transition hover:bg-accent hover:text-foreground\"\n                  >\n                    <X size={10} />\n                    취소\n                  </button>\n                )}\n              </div>\n            )}\n          </div>\n        ) : (\n          <div>\n            {message.toolCalls.length > 0 && (\n              <div className=\"mb-2\">\n                {message.toolCalls.map((tc) => (\n                  <ToolCallCard key={tc.callId} toolCall={tc} />\n                ))}\n              </div>\n            )}\n            {/* Assistant image attachments */}\n            {message.attachments && message.attachments.length > 0 && (\n              <div className=\"mb-2 flex flex-wrap gap-2\">\n                {message.attachments.map((att, i) =>\n                  att.dataUrl && att.mimeType.startsWith(\"image/\") ? (\n                    <img\n                      key={i}\n                      src={att.dataUrl}\n                      alt={att.fileName}\n                      className=\"max-h-80 max-w-full md:max-w-md rounded-lg border border-zinc-700 object-contain\"\n                    />\n                  ) : null\n                )}\n              </div>\n            )}\n            {message.content && (() => {\n              const cleaned = stripTaskMemo(message.content);\n              return cleaned ? <MarkdownRenderer content={cleaned} /> : null;\n            })()}\n            {message.streaming && (\n              <span className=\"inline-block h-4 w-1.5 animate-pulse rounded-sm bg-primary\" />\n            )}\n            {!message.streaming && message.content && (\n              <div className=\"mt-1\">\n                <CopyButton text={stripTaskMemo(message.content)} />\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n\n      {isUser && (\n        <div className=\"flex h-8 w-8 shrink-0 items-center justify-center rounded-full bg-muted text-accent-foreground\">\n          <User size={18} />\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2145, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/ui/button.tsx"],"sourcesContent":["import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { Slot } from \"radix-ui\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60\",\n        outline:\n          \"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost:\n          \"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-9 px-4 py-2 has-[>svg]:px-3\",\n        xs: \"h-6 gap-1 rounded-md px-2 text-xs has-[>svg]:px-1.5 [&_svg:not([class*='size-'])]:size-3\",\n        sm: \"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5\",\n        lg: \"h-10 rounded-md px-6 has-[>svg]:px-4\",\n        icon: \"size-9\",\n        \"icon-xs\": \"size-6 rounded-md [&_svg:not([class*='size-'])]:size-3\",\n        \"icon-sm\": \"size-8\",\n        \"icon-lg\": \"size-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction Button({\n  className,\n  variant = \"default\",\n  size = \"default\",\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> &\n  VariantProps<typeof buttonVariants> & {\n    asChild?: boolean\n  }) {\n  const Comp = asChild ? Slot.Root : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"button\"\n      data-variant={variant}\n      data-size={size}\n      className={cn(buttonVariants({ variant, size, className }))}\n      {...props}\n    />\n  )\n}\n\nexport { Button, buttonVariants }\n"],"names":[],"mappings":";;;;;;;AACA;AACA;AAEA;;;;;AAEA,MAAM,iBAAiB,IAAA,qPAAG,EACxB,+bACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,aACE;YACF,SACE;YACF,WACE;YACF,OACE;YACF,MAAM;QACR;QACA,MAAM;YACJ,SAAS;YACT,IAAI;YACJ,IAAI;YACJ,IAAI;YACJ,MAAM;YACN,WAAW;YACX,WAAW;YACX,WAAW;QACb;IACF;IACA,iBAAiB;QACf,SAAS;QACT,MAAM;IACR;AACF;AAGF,SAAS,OAAO,KASb;QATa,EACd,SAAS,EACT,UAAU,SAAS,EACnB,OAAO,SAAS,EAChB,UAAU,KAAK,EACf,GAAG,OAIF,GATa;IAUd,MAAM,OAAO,UAAU,gVAAI,CAAC,IAAI,GAAG;IAEnC,qBACE,+VAAC;QACC,aAAU;QACV,gBAAc;QACd,aAAW;QACX,WAAW,IAAA,4HAAE,EAAC,eAAe;YAAE;YAAS;YAAM;QAAU;QACvD,GAAG,KAAK;;;;;;AAGf;KArBS","debugId":null}},
    {"offset": {"line": 2215, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/hooks/use-autosize-textarea.ts"],"sourcesContent":["import { useLayoutEffect, useRef } from \"react\"\n\ninterface UseAutosizeTextAreaProps {\n  ref: React.RefObject<HTMLTextAreaElement | null>\n  maxHeight?: number\n  borderWidth?: number\n  dependencies: React.DependencyList\n}\n\nexport function useAutosizeTextArea({\n  ref,\n  maxHeight = Number.MAX_SAFE_INTEGER,\n  borderWidth = 0,\n  dependencies,\n}: UseAutosizeTextAreaProps) {\n  const originalHeight = useRef<number | null>(null)\n\n  useLayoutEffect(() => {\n    if (!ref.current) return\n\n    const currentRef = ref.current\n    const borderAdjustment = borderWidth * 2\n\n    if (originalHeight.current === null) {\n      originalHeight.current = currentRef.scrollHeight - borderAdjustment\n    }\n\n    currentRef.style.removeProperty(\"height\")\n    const scrollHeight = currentRef.scrollHeight\n\n    // Make sure we don't go over maxHeight\n    const clampedToMax = Math.min(scrollHeight, maxHeight)\n    // Make sure we don't go less than the original height\n    const clampedToMin = Math.max(clampedToMax, originalHeight.current)\n\n    currentRef.style.height = `${clampedToMin + borderAdjustment}px`\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [maxHeight, ref, ...dependencies])\n}\n"],"names":[],"mappings":";;;;AAAA;;;AASO,SAAS,oBAAoB,KAKT;QALS,EAClC,GAAG,EACH,YAAY,OAAO,gBAAgB,EACnC,cAAc,CAAC,EACf,YAAY,EACa,GALS;;IAMlC,MAAM,iBAAiB,IAAA,yUAAM,EAAgB;IAE7C,IAAA,kVAAe;+CAAC;YACd,IAAI,CAAC,IAAI,OAAO,EAAE;YAElB,MAAM,aAAa,IAAI,OAAO;YAC9B,MAAM,mBAAmB,cAAc;YAEvC,IAAI,eAAe,OAAO,KAAK,MAAM;gBACnC,eAAe,OAAO,GAAG,WAAW,YAAY,GAAG;YACrD;YAEA,WAAW,KAAK,CAAC,cAAc,CAAC;YAChC,MAAM,eAAe,WAAW,YAAY;YAE5C,uCAAuC;YACvC,MAAM,eAAe,KAAK,GAAG,CAAC,cAAc;YAC5C,sDAAsD;YACtD,MAAM,eAAe,KAAK,GAAG,CAAC,cAAc,eAAe,OAAO;YAElE,WAAW,KAAK,CAAC,MAAM,GAAG,AAAC,GAAkC,OAAhC,eAAe,kBAAiB;QAC7D,uDAAuD;QACzD;8CAAG;QAAC;QAAW;WAAQ;KAAa;AACtC;GA7BgB","debugId":null}},
    {"offset": {"line": 2257, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/chat/file-attachments.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useRef, useCallback, useEffect } from \"react\";\nimport { Paperclip, X, FileText, Image as ImageIcon, File } from \"lucide-react\";\n\nexport interface ChatAttachment {\n  id: string;\n  file: File;\n  preview?: string; // data URL for images\n  type: \"image\" | \"file\";\n}\n\nfunction formatSize(bytes: number): string {\n  if (bytes < 1024) return `${bytes}B`;\n  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)}KB`;\n  return `${(bytes / (1024 * 1024)).toFixed(1)}MB`;\n}\n\nfunction fileToAttachment(file: File): Promise<ChatAttachment> {\n  return new Promise((resolve) => {\n    const id = `att-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`;\n    const isImage = file.type.startsWith(\"image/\");\n\n    if (isImage) {\n      const reader = new FileReader();\n      reader.onload = () => {\n        resolve({\n          id,\n          file,\n          preview: reader.result as string,\n          type: \"image\",\n        });\n      };\n      reader.readAsDataURL(file);\n    } else {\n      resolve({ id, file, type: \"file\" });\n    }\n  });\n}\n\n// ---- Attachment preview bar ----\n\nexport function AttachmentPreview({\n  attachments,\n  onRemove,\n}: {\n  attachments: ChatAttachment[];\n  onRemove: (id: string) => void;\n}) {\n  if (attachments.length === 0) return null;\n\n  return (\n    <div className=\"flex flex-wrap gap-2 px-4 py-2\">\n      {attachments.map((att) => (\n        <div\n          key={att.id}\n          className=\"group relative flex items-center gap-2 rounded-lg border border-border bg-muted p-2 text-xs text-foreground\"\n        >\n          {att.type === \"image\" && att.preview ? (\n            <img\n              src={att.preview}\n              alt={att.file.name}\n              className=\"h-10 w-10 md:h-12 md:w-12 rounded object-cover\"\n            />\n          ) : (\n            <div className=\"flex h-10 w-10 md:h-12 md:w-12 items-center justify-center rounded bg-muted\">\n              <FileText size={20} className=\"text-muted-foreground\" />\n            </div>\n          )}\n          <div className=\"min-w-0 max-w-[100px] md:max-w-[120px]\">\n            <div className=\"truncate font-medium\">{att.file.name}</div>\n            <div className=\"text-muted-foreground\">{formatSize(att.file.size)}</div>\n          </div>\n          <button\n            onClick={() => onRemove(att.id)}\n            className=\"absolute -right-1.5 -top-1.5 hidden rounded-full bg-muted p-0.5 text-foreground hover:bg-destructive group-hover:block\"\n          >\n            <X size={12} />\n          </button>\n        </div>\n      ))}\n    </div>\n  );\n}\n\n// ---- Attachment button ----\n\nexport function AttachButton({\n  onAttach,\n}: {\n  onAttach: (files: File[]) => void;\n}) {\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  // Detect mobile for camera capture attribute\n  const isTouchDevice = typeof window !== \"undefined\" && \"ontouchstart\" in window;\n\n  return (\n    <>\n      <button\n        onClick={() => inputRef.current?.click()}\n        className=\"flex h-11 w-11 shrink-0 items-center justify-center rounded-xl text-muted-foreground transition hover:bg-muted hover:text-foreground\"\n        title=\"파일 첨부\"\n      >\n        <Paperclip size={18} />\n      </button>\n      <input\n        ref={inputRef}\n        type=\"file\"\n        multiple\n        accept={isTouchDevice ? \"image/*,video/*,*/*\" : undefined}\n        className=\"hidden\"\n        onChange={(e) => {\n          if (e.target.files?.length) {\n            onAttach(Array.from(e.target.files));\n            e.target.value = \"\";\n          }\n        }}\n      />\n    </>\n  );\n}\n\n// ---- Drag & drop overlay ----\n\nexport function DropZone({\n  onDrop,\n  children,\n}: {\n  onDrop: (files: File[]) => void;\n  children: React.ReactNode;\n}) {\n  const [dragging, setDragging] = useState(false);\n  const dragCounter = useRef(0);\n\n  const handleDragEnter = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    dragCounter.current++;\n    if (e.dataTransfer?.types.includes(\"Files\")) {\n      setDragging(true);\n    }\n  }, []);\n\n  const handleDragLeave = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    dragCounter.current--;\n    if (dragCounter.current === 0) {\n      setDragging(false);\n    }\n  }, []);\n\n  const handleDragOver = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n  }, []);\n\n  const handleDrop = useCallback(\n    (e: React.DragEvent) => {\n      e.preventDefault();\n      e.stopPropagation();\n      setDragging(false);\n      dragCounter.current = 0;\n\n      if (e.dataTransfer?.files?.length) {\n        onDrop(Array.from(e.dataTransfer.files));\n      }\n    },\n    [onDrop]\n  );\n\n  return (\n    <div\n      className=\"relative flex-1 flex flex-col min-h-0\"\n      onDragEnter={handleDragEnter}\n      onDragLeave={handleDragLeave}\n      onDragOver={handleDragOver}\n      onDrop={handleDrop}\n    >\n      {children}\n      {dragging && (\n        <div className=\"absolute inset-0 z-50 flex items-center justify-center rounded-lg border-2 border-dashed border-primary bg-primary/10 backdrop-blur-sm\">\n          <div className=\"flex flex-col items-center gap-2 text-primary\">\n            <Paperclip size={32} />\n            <span className=\"text-sm font-medium\">파일을 여기에 놓으세요</span>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\n// ---- Hook: useFileAttachments ----\n\nexport function useFileAttachments() {\n  const [attachments, setAttachments] = useState<ChatAttachment[]>([]);\n\n  const addFiles = useCallback(async (files: File[]) => {\n    const newAtts = await Promise.all(files.map(fileToAttachment));\n    setAttachments((prev) => [...prev, ...newAtts]);\n  }, []);\n\n  const removeAttachment = useCallback((id: string) => {\n    setAttachments((prev) => prev.filter((a) => a.id !== id));\n  }, []);\n\n  const clearAttachments = useCallback(() => {\n    setAttachments([]);\n  }, []);\n\n  // Handle clipboard paste\n  const handlePaste = useCallback(\n    (e: ClipboardEvent) => {\n      const items = e.clipboardData?.items;\n      if (!items) return;\n\n      const files: File[] = [];\n      for (const item of items) {\n        if (item.kind === \"file\") {\n          const file = item.getAsFile();\n          if (file) files.push(file);\n        }\n      }\n      if (files.length > 0) {\n        e.preventDefault();\n        addFiles(files);\n      }\n    },\n    [addFiles]\n  );\n\n  return {\n    attachments,\n    addFiles,\n    removeAttachment,\n    clearAttachments,\n    handlePaste,\n  };\n}\n\n/**\n * Convert a ChatAttachment to a base64 data URL for sending via gateway.\n * The gateway chat.send accepts attachments as unknown[] — we send objects\n * with {name, mimeType, data} where data is a base64 data URL.\n */\nexport async function attachmentToPayload(\n  att: ChatAttachment\n): Promise<{ fileName: string; mimeType: string; content: string }> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = () => {\n      // Convert data URL to pure base64 (strip \"data:...;base64,\" prefix)\n      const dataUrl = reader.result as string;\n      const base64 = dataUrl.includes(\",\") ? dataUrl.split(\",\")[1] : dataUrl;\n      resolve({\n        fileName: att.file.name,\n        mimeType: att.file.type || \"application/octet-stream\",\n        content: base64,\n      });\n    };\n    reader.onerror = () => reject(new Error(\"Failed to read file\"));\n    reader.readAsDataURL(att.file);\n  });\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2622, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/lib/gateway/use-skills.ts"],"sourcesContent":["\"use client\";\n\nimport { useState, useCallback, useEffect } from \"react\";\nimport { useGateway } from \"./hooks\";\n\n// --- Types ---\n\nexport interface SkillRequirements {\n  bins: string[];\n  anyBins: string[];\n  env: string[];\n  config: string[];\n  os: string[];\n}\n\nexport interface SkillInstaller {\n  id: string;\n  kind: string; // \"brew\" | \"node\" | \"go\" | \"uv\" | \"download\"\n  label: string;\n  bins?: string[];\n  formula?: string;\n  package?: string;\n  os?: string[];\n}\n\nexport interface Skill {\n  name: string;\n  description: string;\n  source: string; // \"openclaw-bundled\" | \"managed\" | \"workspace\"\n  bundled: boolean;\n  filePath: string;\n  baseDir: string;\n  skillKey: string;\n  emoji?: string;\n  homepage?: string;\n  always: boolean;\n  disabled: boolean;\n  blockedByAllowlist: boolean;\n  eligible: boolean;\n  requirements: SkillRequirements;\n  missing: SkillRequirements;\n  configChecks: string[];\n  install: SkillInstaller[];\n  primaryEnv?: string;\n  hasApiKey?: boolean;\n}\n\n// --- Hook ---\n\nexport function useSkills() {\n  const { client, state } = useGateway();\n  const [skills, setSkills] = useState<Skill[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const fetchSkills = useCallback(async () => {\n    if (!client || state !== \"connected\") return;\n    setLoading(true);\n    setError(null);\n    try {\n      const res = await client.request<{ skills: Skill[] }>(\"skills.status\", {});\n      setSkills(res?.skills || []);\n    } catch (err) {\n      setError(String(err));\n    } finally {\n      setLoading(false);\n    }\n  }, [client, state]);\n\n  useEffect(() => {\n    fetchSkills();\n  }, [fetchSkills]);\n\n  const toggleSkill = useCallback(\n    async (skillKey: string, enabled: boolean) => {\n      if (!client || state !== \"connected\") return;\n      try {\n        await client.request(\"skills.update\", { skillKey, enabled });\n        // Optimistic update\n        setSkills((prev) =>\n          prev.map((s) =>\n            s.skillKey === skillKey ? { ...s, disabled: !enabled } : s\n          )\n        );\n      } catch (err) {\n        setError(String(err));\n        // Revert on error\n        await fetchSkills();\n      }\n    },\n    [client, state, fetchSkills]\n  );\n\n  const setApiKey = useCallback(\n    async (skillKey: string, apiKey: string) => {\n      if (!client || state !== \"connected\") return;\n      try {\n        await client.request(\"skills.update\", { skillKey, apiKey });\n        await fetchSkills();\n      } catch (err) {\n        setError(String(err));\n      }\n    },\n    [client, state, fetchSkills]\n  );\n\n  const installSkill = useCallback(\n    async (name: string, installId: string) => {\n      if (!client || state !== \"connected\") return;\n      try {\n        await client.request(\"skills.install\", {\n          name,\n          installId,\n          timeoutMs: 120_000,\n        });\n        await fetchSkills();\n      } catch (err) {\n        setError(String(err));\n      }\n    },\n    [client, state, fetchSkills]\n  );\n\n  return {\n    skills,\n    loading,\n    error,\n    refresh: fetchSkills,\n    toggleSkill,\n    setApiKey,\n    installSkill,\n  };\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;;AAHA;;;AAiDO,SAAS;;IACd,MAAM,EAAE,MAAM,EAAE,KAAK,EAAE,GAAG,IAAA,gJAAU;IACpC,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,2UAAQ,EAAU,EAAE;IAChD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,2UAAQ,EAAC;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,2UAAQ,EAAgB;IAElD,MAAM,cAAc,IAAA,8UAAW;8CAAC;YAC9B,IAAI,CAAC,UAAU,UAAU,aAAa;YACtC,WAAW;YACX,SAAS;YACT,IAAI;gBACF,MAAM,MAAM,MAAM,OAAO,OAAO,CAAsB,iBAAiB,CAAC;gBACxE,UAAU,CAAA,gBAAA,0BAAA,IAAK,MAAM,KAAI,EAAE;YAC7B,EAAE,OAAO,KAAK;gBACZ,SAAS,OAAO;YAClB,SAAU;gBACR,WAAW;YACb;QACF;6CAAG;QAAC;QAAQ;KAAM;IAElB,IAAA,4UAAS;+BAAC;YACR;QACF;8BAAG;QAAC;KAAY;IAEhB,MAAM,cAAc,IAAA,8UAAW;8CAC7B,OAAO,UAAkB;YACvB,IAAI,CAAC,UAAU,UAAU,aAAa;YACtC,IAAI;gBACF,MAAM,OAAO,OAAO,CAAC,iBAAiB;oBAAE;oBAAU;gBAAQ;gBAC1D,oBAAoB;gBACpB;0DAAU,CAAC,OACT,KAAK,GAAG;kEAAC,CAAC,IACR,EAAE,QAAQ,KAAK,WAAW;oCAAE,GAAG,CAAC;oCAAE,UAAU,CAAC;gCAAQ,IAAI;;;YAG/D,EAAE,OAAO,KAAK;gBACZ,SAAS,OAAO;gBAChB,kBAAkB;gBAClB,MAAM;YACR;QACF;6CACA;QAAC;QAAQ;QAAO;KAAY;IAG9B,MAAM,YAAY,IAAA,8UAAW;4CAC3B,OAAO,UAAkB;YACvB,IAAI,CAAC,UAAU,UAAU,aAAa;YACtC,IAAI;gBACF,MAAM,OAAO,OAAO,CAAC,iBAAiB;oBAAE;oBAAU;gBAAO;gBACzD,MAAM;YACR,EAAE,OAAO,KAAK;gBACZ,SAAS,OAAO;YAClB;QACF;2CACA;QAAC;QAAQ;QAAO;KAAY;IAG9B,MAAM,eAAe,IAAA,8UAAW;+CAC9B,OAAO,MAAc;YACnB,IAAI,CAAC,UAAU,UAAU,aAAa;YACtC,IAAI;gBACF,MAAM,OAAO,OAAO,CAAC,kBAAkB;oBACrC;oBACA;oBACA,WAAW;gBACb;gBACA,MAAM;YACR,EAAE,OAAO,KAAK;gBACZ,SAAS,OAAO;YAClB;QACF;8CACA;QAAC;QAAQ;QAAO;KAAY;IAG9B,OAAO;QACL;QACA;QACA;QACA,SAAS;QACT;QACA;QACA;IACF;AACF;GAnFgB;;QACY,gJAAU","debugId":null}},
    {"offset": {"line": 2750, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/chat/skill-picker.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect, useRef, useMemo } from \"react\";\nimport { Puzzle, ExternalLink, Terminal } from \"lucide-react\";\nimport { useSkills, type Skill } from \"@/lib/gateway/use-skills\";\n\n// Built-in slash commands\nexport interface BuiltinCommand {\n  name: string;\n  description: string;\n  emoji: string;\n  /** If true, execute immediately on select (don't append to input) */\n  immediate?: boolean;\n}\n\nexport const BUILTIN_COMMANDS: BuiltinCommand[] = [\n  { name: \"stop\", description: \"스트리밍 중단\", emoji: \"⏹️\", immediate: true },\n  { name: \"new\", description: \"새 세션 시작\", emoji: \"✨\", immediate: true },\n  { name: \"reset\", description: \"현재 세션 리셋\", emoji: \"🔄\", immediate: true },\n  { name: \"status\", description: \"세션 상태 확인 (토큰, 모델 등)\", emoji: \"📊\", immediate: true },\n  { name: \"reasoning\", description: \"추론 모드 토글\", emoji: \"🧠\", immediate: true },\n  { name: \"model\", description: \"모델 변경 (예: /model opus)\", emoji: \"🤖\" },\n  { name: \"help\", description: \"사용 가능한 커맨드 목록\", emoji: \"❓\", immediate: true },\n];\n\ninterface SkillPickerProps {\n  /** Current input text to detect \"/\" trigger */\n  inputText: string;\n  /** Called when a skill slash command is selected */\n  onSelect: (command: string) => void;\n  /** Called to dismiss */\n  onDismiss: () => void;\n  /** Whether picker should be visible */\n  visible: boolean;\n}\n\nexport function SkillPicker({ inputText, onSelect, onDismiss, visible }: SkillPickerProps) {\n  const { skills } = useSkills();\n  const [selectedIndex, setSelectedIndex] = useState(0);\n  const listRef = useRef<HTMLDivElement>(null);\n\n  // Only show eligible, non-disabled skills\n  const activeSkills = useMemo(\n    () => skills.filter((s) => s.eligible && !s.disabled),\n    [skills]\n  );\n\n  // Extract search query after \"/\"\n  const query = useMemo(() => {\n    if (!visible) return \"\";\n    const match = inputText.match(/^\\/(\\S*)$/);\n    return match ? match[1].toLowerCase() : \"\";\n  }, [inputText, visible]);\n\n  // Filter built-in commands\n  const filteredBuiltins = useMemo(() => {\n    if (!query) return BUILTIN_COMMANDS;\n    return BUILTIN_COMMANDS.filter(\n      (c) =>\n        c.name.toLowerCase().includes(query) ||\n        c.description.toLowerCase().includes(query)\n    );\n  }, [query]);\n\n  // Filter skills by query\n  const filtered = useMemo(() => {\n    if (!query) return activeSkills;\n    return activeSkills.filter(\n      (s) =>\n        s.name.toLowerCase().includes(query) ||\n        s.description.toLowerCase().includes(query)\n    );\n  }, [activeSkills, query]);\n\n  const totalCount = filteredBuiltins.length + filtered.length;\n\n  // Reset selection on filter change\n  useEffect(() => {\n    setSelectedIndex(0);\n  }, [filtered.length, query]);\n\n  // Scroll selected into view\n  useEffect(() => {\n    const el = listRef.current?.children[selectedIndex] as HTMLElement | undefined;\n    el?.scrollIntoView({ block: \"nearest\" });\n  }, [selectedIndex]);\n\n  if (!visible || totalCount === 0) return null;\n\n  return (\n    <div\n      className=\"absolute bottom-full left-0 right-0 mx-auto max-w-3xl px-4 pb-2 z-50\"\n      onMouseDown={(e) => e.preventDefault()} // Prevent input blur\n    >\n      <div className=\"rounded-xl border border-border bg-background shadow-2xl overflow-hidden\">\n        {/* Header */}\n        <div className=\"flex items-center gap-2 border-b border-border/50 px-3 py-2\">\n          <Terminal className=\"h-3.5 w-3.5 text-muted-foreground\" />\n          <span className=\"text-xs text-muted-foreground\">Commands & Skills</span>\n          <span className=\"text-[10px] text-muted-foreground\">\n            {totalCount} available\n          </span>\n        </div>\n\n        {/* List */}\n        <div ref={listRef} className=\"max-h-64 overflow-y-auto py-1\">\n          {/* Built-in commands */}\n          {filteredBuiltins.length > 0 && (\n            <>\n              {filteredBuiltins.map((cmd, i) => (\n                <button\n                  key={`cmd-${cmd.name}`}\n                  onClick={() => {\n                    if (cmd.immediate) {\n                      onSelect(`/${cmd.name}`);\n                    } else {\n                      onSelect(`/${cmd.name} `);\n                    }\n                  }}\n                  onMouseEnter={() => setSelectedIndex(i)}\n                  className={`flex w-full items-center gap-3 px-3 py-2 text-left transition-colors ${\n                    i === selectedIndex ? \"bg-muted\" : \"hover:bg-muted/50\"\n                  }`}\n                >\n                  <span className=\"text-base shrink-0\">{cmd.emoji}</span>\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-center gap-1.5\">\n                      <span className=\"text-sm font-medium text-foreground\">\n                        /{cmd.name}\n                      </span>\n                    </div>\n                    <p className=\"text-xs text-muted-foreground truncate\">{cmd.description}</p>\n                  </div>\n                </button>\n              ))}\n              {filtered.length > 0 && (\n                <div className=\"mx-3 my-1 border-t border-border/30\" />\n              )}\n            </>\n          )}\n\n          {/* Skills */}\n          {filtered.map((skill, i) => {\n            const idx = filteredBuiltins.length + i;\n            return (\n              <button\n                key={skill.skillKey}\n                onClick={() => onSelect(`/${skill.name} `)}\n                onMouseEnter={() => setSelectedIndex(idx)}\n                className={`flex w-full items-center gap-3 px-3 py-2 text-left transition-colors ${\n                  idx === selectedIndex ? \"bg-muted\" : \"hover:bg-muted/50\"\n                }`}\n              >\n                <span className=\"text-base shrink-0\">{skill.emoji || \"🔧\"}</span>\n                <div className=\"flex-1 min-w-0\">\n                  <div className=\"flex items-center gap-1.5\">\n                    <span className=\"text-sm font-medium text-foreground\">\n                      /{skill.name}\n                    </span>\n                    {skill.homepage && (\n                      <ExternalLink className=\"h-2.5 w-2.5 text-muted-foreground\" />\n                    )}\n                  </div>\n                  <p className=\"text-xs text-muted-foreground truncate\">{skill.description}</p>\n                </div>\n              </button>\n            );\n          })}\n        </div>\n\n        {/* Footer hint */}\n        <div className=\"border-t border-border/50 px-3 py-1.5\">\n          <span className=\"text-[10px] text-muted-foreground\">\n            ↑↓ 이동 · Enter 선택 · Esc 닫기\n          </span>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n/** Keyboard handler for the skill picker — call from ChatInput's onKeyDown */\nexport function useSkillPickerKeys(\n  visible: boolean,\n  filteredCount: number,\n  selectedIndex: number,\n  setSelectedIndex: (i: number | ((prev: number) => number)) => void,\n  onSelect: (index: number) => void,\n  onDismiss: () => void\n) {\n  return (e: React.KeyboardEvent) => {\n    if (!visible) return false;\n\n    if (e.key === \"ArrowUp\") {\n      e.preventDefault();\n      setSelectedIndex((prev) => (prev > 0 ? prev - 1 : filteredCount - 1));\n      return true;\n    }\n    if (e.key === \"ArrowDown\") {\n      e.preventDefault();\n      setSelectedIndex((prev) => (prev < filteredCount - 1 ? prev + 1 : 0));\n      return true;\n    }\n    if (e.key === \"Tab\" || e.key === \"Enter\") {\n      e.preventDefault();\n      onSelect(selectedIndex);\n      return true;\n    }\n    if (e.key === \"Escape\") {\n      e.preventDefault();\n      onDismiss();\n      return true;\n    }\n    return false;\n  };\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3139, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/chat/chat-input.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useRef, useCallback, useEffect, useMemo } from \"react\";\nimport { AnimatePresence, motion } from \"framer-motion\";\nimport { ArrowUp, Paperclip, Square, X } from \"lucide-react\";\n\nimport { cn } from \"@/lib/utils\";\nimport { Button } from \"@/components/ui/button\";\nimport { useAutosizeTextArea } from \"@/hooks/use-autosize-textarea\";\nimport {\n  AttachmentPreview,\n  type ChatAttachment,\n} from \"./file-attachments\";\nimport { SkillPicker, BUILTIN_COMMANDS } from \"./skill-picker\";\nimport { useSkills } from \"@/lib/gateway/use-skills\";\n\nexport function ChatInput({\n  onSend,\n  onAbort,\n  streaming,\n  disabled,\n  attachments = [],\n  onAttachFiles,\n  onRemoveAttachment,\n  panelId,\n  toolbar,\n  agentAvatar,\n  agentSlot: agentSlotProp,\n}: {\n  onSend: (text: string) => void;\n  onAbort: () => void;\n  streaming: boolean;\n  disabled: boolean;\n  attachments?: ChatAttachment[];\n  onAttachFiles?: (files: File[]) => void;\n  onRemoveAttachment?: (id: string) => void;\n  panelId?: string;\n  /** Slot rendered inside the input container, above the textarea row */\n  toolbar?: React.ReactNode;\n  /** Optional agent avatar badge */\n  agentAvatar?: { emoji: string; color: string };\n  /** Custom agent slot node (overrides agentAvatar) */\n  agentSlot?: React.ReactNode;\n}) {\n  const agentSlotFromAvatar = agentAvatar ? (\n    <div\n      className={cn(\n        \"flex size-7 shrink-0 items-center justify-center rounded-full text-sm\",\n        agentAvatar.color\n      )}\n      title=\"에이전트\"\n    >\n      {agentAvatar.emoji}\n    </div>\n  ) : null;\n  const agentSlot = agentSlotProp || agentSlotFromAvatar;\n  const storageKey = panelId ? `awf:draft:${panelId}` : null;\n  const [text, setText] = useState(() => {\n    if (storageKey && typeof window !== \"undefined\") {\n      return localStorage.getItem(storageKey) || \"\";\n    }\n    return \"\";\n  });\n  const [isDragging, setIsDragging] = useState(false);\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n  const composingRef = useRef(false);\n\n  // Auto-resize\n  useAutosizeTextArea({\n    ref: textareaRef,\n    maxHeight: 200,\n    borderWidth: 1,\n    dependencies: [text, attachments.length > 0],\n  });\n\n  // Skill picker state\n  const [skillPickerOpen, setSkillPickerOpen] = useState(false);\n  const [skillSelectedIndex, setSkillSelectedIndex] = useState(0);\n  const { skills } = useSkills();\n  const activeSkills = useMemo(\n    () => skills.filter((s) => s.eligible && !s.disabled),\n    [skills]\n  );\n  const skillQuery = useMemo(() => {\n    if (!skillPickerOpen) return \"\";\n    const match = text.match(/^\\/(\\S*)$/);\n    return match ? match[1].toLowerCase() : \"\";\n  }, [text, skillPickerOpen]);\n  const filteredBuiltins = useMemo(() => {\n    if (!skillQuery) return BUILTIN_COMMANDS;\n    return BUILTIN_COMMANDS.filter(\n      (c) =>\n        c.name.toLowerCase().includes(skillQuery) ||\n        c.description.toLowerCase().includes(skillQuery)\n    );\n  }, [skillQuery]);\n\n  const filteredSkills = useMemo(() => {\n    if (!skillQuery) return activeSkills;\n    return activeSkills.filter(\n      (s) =>\n        s.name.toLowerCase().includes(skillQuery) ||\n        s.description.toLowerCase().includes(skillQuery)\n    );\n  }, [activeSkills, skillQuery]);\n\n  const totalPickerItems = filteredBuiltins.length + filteredSkills.length;\n\n  useEffect(() => {\n    const shouldShow = text === \"/\" || (/^\\/\\S*$/.test(text) && !text.includes(\" \"));\n    setSkillPickerOpen(shouldShow);\n    if (shouldShow) setSkillSelectedIndex(0);\n  }, [text]);\n\n  // Persist draft\n  useEffect(() => {\n    if (!storageKey) return;\n    if (text) {\n      localStorage.setItem(storageKey, text);\n    } else {\n      localStorage.removeItem(storageKey);\n    }\n  }, [text, storageKey]);\n\n  const canSend = text.trim().length > 0 || attachments.length > 0;\n\n  const handleSend = useCallback(() => {\n    if (!canSend || disabled) return;\n    onSend(text.trim());\n    setText(\"\");\n    if (storageKey) localStorage.removeItem(storageKey);\n  }, [text, disabled, onSend, canSend, storageKey]);\n\n  const handleSkillSelect = useCallback((command: string) => {\n    setText(command);\n    setSkillPickerOpen(false);\n    textareaRef.current?.focus();\n  }, []);\n\n  const handleKeyDown = useCallback(\n    (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n      if (e.nativeEvent.isComposing || composingRef.current) return;\n\n      // Skill picker navigation (builtins + skills)\n      if (skillPickerOpen && totalPickerItems > 0) {\n        if (e.key === \"ArrowUp\") {\n          e.preventDefault();\n          setSkillSelectedIndex((prev) =>\n            prev > 0 ? prev - 1 : totalPickerItems - 1\n          );\n          return;\n        }\n        if (e.key === \"ArrowDown\") {\n          e.preventDefault();\n          setSkillSelectedIndex((prev) =>\n            prev < totalPickerItems - 1 ? prev + 1 : 0\n          );\n          return;\n        }\n        if (e.key === \"Tab\" || (e.key === \"Enter\" && !e.shiftKey)) {\n          e.preventDefault();\n          if (skillSelectedIndex < filteredBuiltins.length) {\n            // Built-in command\n            const cmd = filteredBuiltins[skillSelectedIndex];\n            if (cmd.immediate) {\n              handleSkillSelect(`/${cmd.name}`);\n              // Trigger send immediately for immediate commands\n              onSend(`/${cmd.name}`);\n              setText(\"\");\n              if (storageKey) localStorage.removeItem(storageKey);\n            } else {\n              handleSkillSelect(`/${cmd.name} `);\n            }\n          } else {\n            // Skill\n            const skill = filteredSkills[skillSelectedIndex - filteredBuiltins.length];\n            if (skill) handleSkillSelect(`/${skill.name} `);\n          }\n          return;\n        }\n        if (e.key === \"Escape\") {\n          e.preventDefault();\n          setSkillPickerOpen(false);\n          return;\n        }\n      }\n\n      if (e.key === \"Enter\" && !e.shiftKey) {\n        e.preventDefault();\n        handleSend();\n      }\n    },\n    [handleSend, skillPickerOpen, filteredSkills, filteredBuiltins, totalPickerItems, skillSelectedIndex, handleSkillSelect, onSend, storageKey]\n  );\n\n  // Paste files\n  const handlePaste = useCallback(\n    (e: React.ClipboardEvent) => {\n      if (!onAttachFiles) return;\n      const items = e.clipboardData?.items;\n      if (!items) return;\n      const files: File[] = [];\n      for (const item of items) {\n        if (item.kind === \"file\") {\n          const file = item.getAsFile();\n          if (file) files.push(file);\n        }\n      }\n      if (files.length > 0) {\n        e.preventDefault();\n        onAttachFiles(files);\n      }\n    },\n    [onAttachFiles]\n  );\n\n  // Drag & drop\n  const onDragOver = useCallback(\n    (e: React.DragEvent) => {\n      if (!onAttachFiles) return;\n      e.preventDefault();\n      setIsDragging(true);\n    },\n    [onAttachFiles]\n  );\n  const onDragLeave = useCallback(\n    (e: React.DragEvent) => {\n      e.preventDefault();\n      setIsDragging(false);\n    },\n    []\n  );\n  const onDrop = useCallback(\n    (e: React.DragEvent) => {\n      setIsDragging(false);\n      if (!onAttachFiles) return;\n      e.preventDefault();\n      if (e.dataTransfer.files.length) {\n        onAttachFiles(Array.from(e.dataTransfer.files));\n      }\n    },\n    [onAttachFiles]\n  );\n\n  // Focus on mount\n  useEffect(() => {\n    textareaRef.current?.focus();\n  }, []);\n\n  const showAttachments = onRemoveAttachment && attachments.length > 0;\n\n  return (\n    <div className=\"relative px-2 py-2 sm:px-3 sm:py-3 md:px-4 safe-bottom\">\n      {/* Skill picker */}\n      <SkillPicker\n        inputText={text}\n        onSelect={handleSkillSelect}\n        onDismiss={() => setSkillPickerOpen(false)}\n        visible={skillPickerOpen}\n      />\n\n      <div\n        className=\"mx-auto w-full max-w-3xl\"\n      >\n        <div\n          className=\"flex-1\"\n          onDragOver={onDragOver}\n          onDragLeave={onDragLeave}\n          onDrop={onDrop}\n        >\n        <div\n          className={cn(\n            \"relative flex w-full flex-col rounded-xl sm:rounded-2xl border border-input bg-background shadow-sm transition-[border-color,box-shadow]\",\n            \"focus-within:border-primary focus-within:ring-[3px] focus-within:ring-primary/40\"\n          )}\n        >\n          {/* Toolbar: controls */}\n          {toolbar && (\n            <div className=\"flex w-full min-w-0 items-center gap-1.5 px-2.5 pt-2 sm:px-3\">\n              {toolbar}\n            </div>\n          )}\n\n          {/* Attachment previews inside container */}\n          {showAttachments && (\n            <div className=\"overflow-x-auto px-2 pt-2 sm:px-3 sm:pt-3\">\n              <AttachmentPreview\n                attachments={attachments}\n                onRemove={onRemoveAttachment}\n              />\n            </div>\n          )}\n\n          {/* Textarea + inline actions row */}\n          <div className=\"flex items-end gap-1 p-1.5 sm:p-2\">\n            {/* Attach button */}\n            {onAttachFiles && (\n              <Button\n                type=\"button\"\n                variant=\"ghost\"\n                size=\"icon-sm\"\n                className=\"shrink-0 rounded-lg text-muted-foreground hover:text-foreground\"\n                aria-label=\"파일 첨부\"\n                onClick={() => {\n                  const input = document.createElement(\"input\");\n                  input.type = \"file\";\n                  input.multiple = true;\n                  input.onchange = () => {\n                    if (input.files) onAttachFiles(Array.from(input.files));\n                  };\n                  input.click();\n                }}\n              >\n                <Paperclip className=\"size-4\" />\n              </Button>\n            )}\n\n            {/* Textarea */}\n            <textarea\n              ref={textareaRef}\n              aria-label=\"메시지를 입력하세요\"\n              value={text}\n              onChange={(e) => setText(e.target.value)}\n              onKeyDown={handleKeyDown}\n              onPaste={handlePaste}\n              onCompositionStart={() => {\n                composingRef.current = true;\n              }}\n              onCompositionEnd={() => {\n                composingRef.current = false;\n              }}\n              placeholder=\"메시지를 입력하세요...\"\n              disabled={disabled}\n              rows={1}\n              className=\"min-w-0 flex-1 resize-none bg-transparent px-1 py-1.5 text-sm text-foreground placeholder:text-muted-foreground outline-none disabled:cursor-not-allowed disabled:opacity-50\"\n            />\n\n            {/* Send / Stop button */}\n            {streaming ? (\n              <Button\n                type=\"button\"\n                size=\"icon-sm\"\n                className=\"shrink-0 rounded-lg\"\n                aria-label=\"중단\"\n                onClick={onAbort}\n              >\n                <Square className=\"size-3 animate-pulse\" fill=\"currentColor\" />\n              </Button>\n            ) : (\n              <Button\n                type=\"button\"\n                size=\"icon-sm\"\n                className=\"shrink-0 rounded-lg transition-opacity\"\n                aria-label=\"전송\"\n                onClick={handleSend}\n                disabled={disabled || !canSend}\n              >\n                <ArrowUp className=\"size-4\" strokeWidth={2.5} />\n              </Button>\n            )}\n          </div>\n\n          {/* Drag overlay */}\n          <AnimatePresence>\n            {isDragging && (\n              <motion.div\n                className=\"pointer-events-none absolute inset-0 z-20 flex items-center justify-center gap-2 rounded-xl sm:rounded-2xl border-2 border-dashed border-primary/50 bg-primary/5 text-sm text-muted-foreground\"\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                exit={{ opacity: 0 }}\n                transition={{ duration: 0.15 }}\n              >\n                <Paperclip className=\"size-4\" />\n                <span>파일을 놓으면 첨부됩니다</span>\n              </motion.div>\n            )}\n          </AnimatePresence>\n        </div>\n\n        </div>\n      </div>\n      <p className=\"mt-1 text-center text-[10px] sm:text-[11px] text-muted-foreground/50\">\n        Shift+Enter로 줄바꿈 · 에이전트는 실수할 수 있습니다\n      </p>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3642, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/lib/gateway/session-utils.ts"],"sourcesContent":["/**\n * Session key parsing and grouping utilities\n */\n\nexport interface ParsedSessionKey {\n  agentId: string;\n  type: \"main\" | \"thread\" | \"cron\" | \"subagent\" | \"a2a\" | \"unknown\";\n  detail?: string;\n}\n\n/**\n * Parse a session key into agent ID and type.\n * Patterns:\n * - agent:{agentId}:main\n * - agent:{agentId}:main:thread:{id}\n * - agent:{agentId}:cron:{id}\n * - agent:{agentId}:subagent:{id}\n * - agent:{agentId}:agent:{targetAgent}:main\n */\nexport function parseSessionKey(key: string): ParsedSessionKey {\n  const parts = key.split(\":\");\n\n  if (parts[0] !== \"agent\" || parts.length < 3) {\n    return { agentId: \"unknown\", type: \"unknown\", detail: key };\n  }\n\n  const agentId = parts[1];\n\n  // agent:{id}:main:thread:{threadId}\n  if (parts[2] === \"main\" && parts[3] === \"thread\" && parts[4]) {\n    return { agentId, type: \"thread\", detail: parts[4] };\n  }\n\n  // agent:{id}:cron:{cronId}\n  if (parts[2] === \"cron\" && parts[3]) {\n    return { agentId, type: \"cron\", detail: parts[3] };\n  }\n\n  // agent:{id}:subagent:{subId}\n  if (parts[2] === \"subagent\" && parts[3]) {\n    return { agentId, type: \"subagent\", detail: parts[3] };\n  }\n\n  // agent:{id}:agent:{target}:main (A2A)\n  if (parts[2] === \"agent\" && parts[3] && parts[4] === \"main\") {\n    return { agentId, type: \"a2a\", detail: parts[3] };\n  }\n\n  // agent:{id}:main\n  if (parts[2] === \"main\") {\n    return { agentId, type: \"main\" };\n  }\n\n  return { agentId, type: \"unknown\", detail: key };\n}\n\nconst TYPE_LABELS: Record<string, string> = {\n  main: \"메인\",\n  thread: \"스레드\",\n  cron: \"크론\",\n  subagent: \"서브에이전트\",\n  a2a: \"A2A\",\n  unknown: \"\",\n};\n\n/**\n * Generate a human-friendly display name for a session\n */\nexport function sessionDisplayName(session: {\n  key: string;\n  label?: string | null;\n  displayName?: string | null;\n}): string {\n  if (session.label) return session.label;\n\n  const parsed = parseSessionKey(session.key);\n  const typeLabel = TYPE_LABELS[parsed.type] || \"\";\n\n  switch (parsed.type) {\n    case \"main\":\n      return `${parsed.agentId} ${typeLabel}`;\n    case \"thread\":\n      return `${parsed.agentId} ${typeLabel} #${parsed.detail}`;\n    case \"cron\":\n      return `${parsed.agentId} ${typeLabel} ${parsed.detail}`;\n    case \"subagent\":\n      return `${parsed.agentId} ${typeLabel} ${parsed.detail?.slice(0, 8)}`;\n    case \"a2a\":\n      return `${parsed.agentId} → ${parsed.detail}`;\n    default:\n      return session.displayName || session.key;\n  }\n}\n\nexport interface SessionGroup {\n  agentId: string;\n  sessions: GatewaySession[];\n}\n\nexport interface GatewaySession {\n  key: string;\n  kind?: string;\n  label?: string | null;\n  displayName?: string | null;\n  channel?: string | null;\n  updatedAt?: number;\n  totalTokens?: number;\n  model?: string;\n  modelProvider?: string;\n}\n\n/**\n * Group sessions by agent ID, sorted by most recent updatedAt within each group.\n * Groups are also sorted by most recent session.\n */\nexport function groupSessionsByAgent(sessions: GatewaySession[]): SessionGroup[] {\n  const map = new Map<string, GatewaySession[]>();\n\n  for (const s of sessions) {\n    const parsed = parseSessionKey(s.key);\n    const agent = parsed.agentId;\n    if (!map.has(agent)) map.set(agent, []);\n    map.get(agent)!.push(s);\n  }\n\n  // Sort sessions within each group by updatedAt desc\n  const groups: SessionGroup[] = [];\n  for (const [agentId, list] of map) {\n    list.sort((a, b) => (b.updatedAt || 0) - (a.updatedAt || 0));\n    groups.push({ agentId, sessions: list });\n  }\n\n  // Sort groups by most recent session\n  groups.sort((a, b) => {\n    const aTime = a.sessions[0]?.updatedAt || 0;\n    const bTime = b.sessions[0]?.updatedAt || 0;\n    return bTime - aTime;\n  });\n\n  return groups;\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3768, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/chat/session-switcher.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useRef, useEffect, useCallback, useMemo } from \"react\";\nimport { createPortal } from \"react-dom\";\nimport { useIsMobile } from \"@/lib/hooks/use-mobile\";\nimport {\n  MessageSquare,\n  Plus,\n  Search,\n  Pencil,\n  Trash2,\n  RotateCcw,\n  X,\n  Clock,\n  Bot,\n  Hash,\n  Timer,\n  GitBranch,\n  ArrowRight,\n  Check,\n  Command,\n} from \"lucide-react\";\nimport {\n  parseSessionKey,\n  sessionDisplayName,\n  type GatewaySession,\n} from \"@/lib/gateway/session-utils\";\nimport type { Session } from \"@/lib/gateway/protocol\";\n\n// ---- Type icon per session type ----\n\nconst TYPE_ICONS: Record<string, typeof Bot> = {\n  main: Bot,\n  thread: Hash,\n  cron: Timer,\n  subagent: GitBranch,\n  a2a: ArrowRight,\n};\n\nfunction SessionTypeIcon({ type, size = 14 }: { type: string; size?: number }) {\n  const Icon = TYPE_ICONS[type] || MessageSquare;\n  return <Icon size={size} className=\"shrink-0 text-muted-foreground\" />;\n}\n\n// ---- Relative time helper ----\n\nfunction relativeTime(ts?: number): string {\n  if (!ts) return \"\";\n  const diff = Date.now() - ts;\n  if (diff < 60_000) return \"방금\";\n  if (diff < 3600_000) return `${Math.floor(diff / 60_000)}분 전`;\n  if (diff < 86400_000) return `${Math.floor(diff / 3600_000)}시간 전`;\n  return `${Math.floor(diff / 86400_000)}일 전`;\n}\n\n// ---- Agent color helper (hash-based) ----\n\nconst AGENT_COLORS = [\n  \"bg-emerald-500/20 text-emerald-400 border-emerald-500/30\",\n  \"bg-blue-500/20 text-primary border-blue-500/30\",\n  \"bg-purple-500/20 text-purple-400 border-purple-500/30\",\n  \"bg-amber-500/20 text-amber-400 border-amber-500/30\",\n  \"bg-rose-500/20 text-rose-400 border-rose-500/30\",\n  \"bg-cyan-500/20 text-cyan-400 border-cyan-500/30\",\n  \"bg-pink-500/20 text-pink-400 border-pink-500/30\",\n  \"bg-lime-500/20 text-lime-400 border-lime-500/30\",\n];\n\nfunction agentColor(agentId: string): string {\n  let hash = 0;\n  for (let i = 0; i < agentId.length; i++) {\n    hash = (hash * 31 + agentId.charCodeAt(i)) | 0;\n  }\n  return AGENT_COLORS[Math.abs(hash) % AGENT_COLORS.length];\n}\n\nfunction AgentBadge({ agentId }: { agentId: string }) {\n  return (\n    <span\n      className={`inline-flex items-center rounded-md border px-1.5 py-0.5 text-[10px] font-medium leading-none ${agentColor(agentId)}`}\n    >\n      {agentId}\n    </span>\n  );\n}\n\n// ---- Props ----\n\nexport interface SessionSwitcherProps {\n  sessions: (Session | GatewaySession)[];\n  currentKey?: string;\n  onSelect: (key: string) => void;\n  onNew: () => void;\n  onRename?: (key: string, label: string) => Promise<void>;\n  onDelete?: (key: string) => Promise<void>;\n  onReset?: (key: string) => Promise<void>;\n  open?: boolean;\n  onOpenChange?: (open: boolean) => void;\n  /** Portal target — palette centers inside this element instead of viewport */\n  portalContainer?: HTMLElement | null;\n}\n\nexport function SessionSwitcher({\n  sessions,\n  currentKey,\n  onSelect,\n  onNew,\n  onRename,\n  onDelete,\n  onReset,\n  open: controlledOpen,\n  onOpenChange,\n  portalContainer,\n}: SessionSwitcherProps) {\n  const isMobile = useIsMobile();\n  const [internalOpen, setInternalOpen] = useState(false);\n  const isControlled = controlledOpen !== undefined;\n  const open = isControlled ? controlledOpen : internalOpen;\n  const setOpen = useCallback(\n    (v: boolean) => {\n      if (isControlled) {\n        onOpenChange?.(v);\n      } else {\n        setInternalOpen(v);\n      }\n    },\n    [isControlled, onOpenChange],\n  );\n\n  const [search, setSearch] = useState(\"\");\n  const [selectedIndex, setSelectedIndex] = useState(0);\n  const [editingKey, setEditingKey] = useState<string | null>(null);\n  const [editLabel, setEditLabel] = useState(\"\");\n  const [actionBusy, setActionBusy] = useState(false);\n  const [visibleCount, setVisibleCount] = useState(40);\n\n  const searchRef = useRef<HTMLInputElement>(null);\n  const listRef = useRef<HTMLDivElement>(null);\n  const isKeyboardNav = useRef(false);\n\n  // Convert to GatewaySession format\n  const gwSessions = useMemo((): GatewaySession[] => {\n    return sessions.map((s) => ({\n      key: s.key,\n      label:\n        \"label\" in s\n          ? (s as GatewaySession).label\n          : \"title\" in s\n            ? (s as Session).title\n            : null,\n      displayName:\n        \"displayName\" in s\n          ? (s as GatewaySession).displayName\n          : \"agentName\" in s\n            ? (s as Session).agentName\n            : null,\n      channel: \"channel\" in s ? (s as GatewaySession).channel : undefined,\n      updatedAt:\n        \"updatedAt\" in s\n          ? typeof s.updatedAt === \"number\"\n            ? s.updatedAt\n            : typeof s.updatedAt === \"string\"\n              ? new Date(s.updatedAt).getTime()\n              : undefined\n          : undefined,\n      totalTokens:\n        \"totalTokens\" in s ? (s as GatewaySession).totalTokens : undefined,\n      model: \"model\" in s ? (s as GatewaySession).model : undefined,\n    }));\n  }, [sessions]);\n\n  // Sort by updatedAt desc (flat list, no grouping)\n  const sorted = useMemo(() => {\n    return [...gwSessions].sort(\n      (a, b) => (b.updatedAt || 0) - (a.updatedAt || 0),\n    );\n  }, [gwSessions]);\n\n  // Filter\n  const filtered = useMemo(() => {\n    // Hide cron and subagent sessions from the list (unless explicitly searched)\n    const isSystemSearch = search.toLowerCase().includes(\"cron\") || search.toLowerCase().includes(\"subagent\");\n    const visible = sorted.filter((s) => {\n      const parsed = parseSessionKey(s.key);\n      if (!isSystemSearch && (parsed.type === \"cron\" || parsed.type === \"subagent\")) return false;\n      return true;\n    });\n    if (!search.trim()) return visible;\n    const q = search.toLowerCase();\n    return visible.filter((s) => {\n      const name = sessionDisplayName(s).toLowerCase();\n      const key = s.key.toLowerCase();\n      const parsed = parseSessionKey(s.key);\n      const agent = parsed.agentId.toLowerCase();\n      return name.includes(q) || key.includes(q) || agent.includes(q);\n    });\n  }, [sorted, search]);\n\n  const displayed = useMemo(() => filtered.slice(0, visibleCount), [filtered, visibleCount]);\n\n  // Reset selection when search changes\n  useEffect(() => {\n    setSelectedIndex(0);\n  }, [search]);\n\n  // Ensure selected row is rendered (keyboard nav)\n  useEffect(() => {\n    if (selectedIndex >= visibleCount - 1) {\n      setVisibleCount((v) => Math.min(filtered.length, v + 40));\n    }\n  }, [selectedIndex, visibleCount, filtered.length]);\n\n  // Focus search on open, reset on close\n  useEffect(() => {\n    if (open) {\n      setSearch(\"\");\n      setEditingKey(null);\n      setSelectedIndex(0);\n      setVisibleCount(40); // progressive render for performance\n      setTimeout(() => searchRef.current?.focus(), 16);\n      // warm up list after first paint\n      setTimeout(() => setVisibleCount(120), 60);\n    }\n  }, [open]);\n\n  // Global Escape key listener (works even when palette div has no focus)\n  useEffect(() => {\n    if (!open) return;\n    const handler = (e: KeyboardEvent) => {\n      if (e.key === \"Escape\") {\n        e.preventDefault();\n        e.stopPropagation();\n        setOpen(false);\n      }\n    };\n    document.addEventListener(\"keydown\", handler, true);\n    return () => document.removeEventListener(\"keydown\", handler, true);\n  }, [open, setOpen]);\n\n  // Scroll selected item into view (only on keyboard nav)\n  useEffect(() => {\n    if (!isKeyboardNav.current || !listRef.current) return;\n    const items = listRef.current.querySelectorAll(\"[data-session-item]\");\n    const target = items[selectedIndex] as HTMLElement | undefined;\n    target?.scrollIntoView({ block: \"nearest\" });\n    // Reset after scroll completes to avoid mouse-hover interference\n    requestAnimationFrame(() => {\n      isKeyboardNav.current = false;\n    });\n  }, [selectedIndex]);\n\n  // Keyboard navigation\n  const handleKeyDown = useCallback(\n    (e: React.KeyboardEvent) => {\n      if (editingKey) return; // let inline edit handle keys\n\n      // +1 for \"new conversation\" item at the end\n      const totalItems = filtered.length + 1;\n\n      switch (e.key) {\n        case \"ArrowDown\":\n          e.preventDefault();\n          isKeyboardNav.current = true;\n          setSelectedIndex((i) => (i + 1) % totalItems);\n          break;\n        case \"ArrowUp\":\n          e.preventDefault();\n          isKeyboardNav.current = true;\n          setSelectedIndex((i) => (i - 1 + totalItems) % totalItems);\n          break;\n        case \"Enter\":\n          e.preventDefault();\n          if (selectedIndex < filtered.length) {\n            onSelect(filtered[selectedIndex].key);\n            setOpen(false);\n          } else {\n            onNew();\n            setOpen(false);\n          }\n          break;\n        case \"Escape\":\n          e.preventDefault();\n          setOpen(false);\n          break;\n      }\n    },\n    [editingKey, filtered, selectedIndex, onSelect, onNew, setOpen],\n  );\n\n  // Actions\n  const handleRename = useCallback(\n    async (key: string) => {\n      if (!onRename || !editLabel.trim() || actionBusy) return;\n      setActionBusy(true);\n      try {\n        await onRename(key, editLabel.trim());\n      } finally {\n        setActionBusy(false);\n        setEditingKey(null);\n      }\n    },\n    [onRename, editLabel, actionBusy],\n  );\n\n  const handleDelete = useCallback(\n    async (key: string) => {\n      if (!onDelete || actionBusy) return;\n      if (!confirm(`세션을 삭제하시겠습니까?\\n${key}`)) return;\n      setActionBusy(true);\n      try {\n        await onDelete(key);\n      } finally {\n        setActionBusy(false);\n      }\n    },\n    [onDelete, actionBusy],\n  );\n\n  const handleReset = useCallback(\n    async (key: string) => {\n      if (!onReset || actionBusy) return;\n      if (\n        !confirm(`세션을 리셋하시겠습니까? 모든 메시지가 초기화됩니다.\\n${key}`)\n      )\n        return;\n      setActionBusy(true);\n      try {\n        await onReset(key);\n      } finally {\n        setActionBusy(false);\n      }\n    },\n    [onReset, actionBusy],\n  );\n\n  const current = gwSessions.find((s) => s.key === currentKey);\n  const currentParsed = currentKey ? parseSessionKey(currentKey) : null;\n\n  return (\n    <>\n      {/* Trigger — Option D: Minimal Dot + Inline */}\n      <button\n        onClick={() => setOpen(true)}\n        className=\"flex min-w-0 flex-1 items-center gap-2 rounded-lg px-2 py-1.5 text-sm transition hover:bg-muted\"\n      >\n        <span className=\"size-2 shrink-0 rounded-full bg-emerald-500\" />\n        <span className=\"min-w-0 flex-1 truncate text-left text-foreground\">\n          {current ? (\n            current.label ? (\n              <>\n                <strong className=\"font-semibold\">{currentParsed?.agentId || \"agent\"}</strong>\n                <span className=\"text-muted-foreground\"> / </span>\n                {current.label.replace(new RegExp(`^${currentParsed?.agentId || \"\"}/`), \"\")}\n              </>\n            ) : sessionDisplayName(current)\n          ) : currentParsed ? (\n            <>\n              <strong className=\"font-semibold\">{currentParsed.agentId}</strong>\n              {currentParsed.type === \"thread\" && (\n                <span className=\"text-muted-foreground\"> / 새 세션</span>\n              )}\n            </>\n          ) : \"세션 선택\"}\n        </span>\n      </button>\n\n      {/* Command palette modal — portal to panel container or body */}\n      {open && createPortal(\n        <div\n          className={`${portalContainer ? \"absolute\" : \"fixed\"} inset-0 z-[9999] flex ${isMobile ? \"items-end\" : \"items-start justify-center pt-[15vh]\"} animate-in fade-in duration-150`}\n          onKeyDown={handleKeyDown}\n        >\n          {/* Backdrop */}\n          <div\n            className=\"absolute inset-0 bg-black/60 backdrop-blur-sm\"\n            onClick={() => setOpen(false)}\n          />\n\n          {/* Palette */}\n          <div className={`relative w-full bg-card shadow-2xl shadow-black/50 animate-in duration-200 ${\n            isMobile\n              ? \"max-h-[85vh] rounded-t-2xl slide-in-from-bottom-4 fade-in safe-bottom\"\n              : \"max-w-lg rounded-xl border border-border slide-in-from-top-4 fade-in\"\n          }`}>\n            {/* Search input */}\n            <div className=\"flex items-center gap-3 border-b border-border/50 px-4 py-3\">\n              <Search size={16} className=\"shrink-0 text-muted-foreground\" />\n              <input\n                ref={searchRef}\n                type=\"text\"\n                value={search}\n                onChange={(e) => setSearch(e.target.value)}\n                placeholder=\"세션 검색... (이름, 에이전트, 키)\"\n                className=\"flex-1 bg-transparent text-sm text-foreground placeholder:text-muted-foreground outline-none\"\n              />\n              {search && (\n                <button\n                  onClick={() => setSearch(\"\")}\n                  className=\"text-muted-foreground hover:text-foreground\"\n                >\n                  <X size={14} />\n                </button>\n              )}\n              <kbd className=\"rounded border border-border bg-muted px-1.5 py-0.5 text-[10px] text-muted-foreground\">\n                ESC\n              </kbd>\n            </div>\n\n            {/* Session count */}\n            <div className=\"border-b border-border px-4 py-1.5 text-xs text-muted-foreground\">\n              {filtered.length}개 세션{\" \"}\n              {search && `(${gwSessions.length}개 중)`}\n            </div>\n\n            {/* Session list */}\n            <div\n              ref={listRef}\n              className={`${isMobile ? \"max-h-[60vh]\" : \"max-h-80\"} overflow-y-auto py-1`}\n              style={{ WebkitOverflowScrolling: \"touch\" }}\n              onScroll={(e) => {\n                const el = e.currentTarget;\n                if (el.scrollTop + el.clientHeight >= el.scrollHeight - 120) {\n                  setVisibleCount((v) => Math.min(filtered.length, v + 40));\n                }\n              }}\n            >\n              {filtered.length === 0 && (\n                <div className=\"px-4 py-6 text-center text-xs text-muted-foreground\">\n                  검색 결과 없음\n                </div>\n              )}\n\n              {displayed.map((session, index) => {\n                const parsed = parseSessionKey(session.key);\n                const isEditing = editingKey === session.key;\n                const isCurrent = currentKey === session.key;\n                const isSelected = selectedIndex === index;\n\n                return (\n                  <div\n                    key={session.key}\n                    data-session-item\n                    className={`group mx-1 flex items-center gap-3 rounded-lg px-3 py-2.5 min-h-[44px] transition-colors ${\n                      isSelected ? \"bg-muted/70\" : \"hover:bg-muted\"\n                    }`}\n                    onMouseMove={() => {\n                      if (!isKeyboardNav.current && selectedIndex !== index) setSelectedIndex(index);\n                    }}\n                  >\n                    {/* Click to select */}\n                    <button\n                      onClick={() => {\n                        if (!isEditing) {\n                          onSelect(session.key);\n                          setOpen(false);\n                        }\n                      }}\n                      className=\"flex flex-1 items-center gap-3 text-left min-w-0\"\n                    >\n                      <SessionTypeIcon type={parsed.type} />\n\n                      <div className=\"flex-1 min-w-0\">\n                        {isEditing ? (\n                          <input\n                            value={editLabel}\n                            onChange={(e) => setEditLabel(e.target.value)}\n                            onKeyDown={(e) => {\n                              e.stopPropagation();\n                              if (e.key === \"Enter\") handleRename(session.key);\n                              if (e.key === \"Escape\") setEditingKey(null);\n                            }}\n                            onClick={(e) => e.stopPropagation()}\n                            className=\"w-full rounded border border-border bg-muted px-2 py-1 text-sm text-foreground outline-none focus:border-ring\"\n                            autoFocus\n                          />\n                        ) : (\n                          <>\n                            <div className=\"flex items-center gap-2\">\n                              <span className=\"truncate text-sm text-foreground\">\n                                {sessionDisplayName(session)}\n                              </span>\n                              <AgentBadge agentId={parsed.agentId} />\n                            </div>\n                            <div className=\"mt-0.5 flex items-center gap-2 text-xs text-muted-foreground\">\n                              {session.channel && (\n                                <span>{session.channel}</span>\n                              )}\n                              {session.updatedAt && (\n                                <span className=\"flex items-center gap-0.5\">\n                                  <Clock size={10} />\n                                  {relativeTime(session.updatedAt)}\n                                </span>\n                              )}\n                              {session.totalTokens != null &&\n                                session.totalTokens > 0 && (\n                                  <span>\n                                    {(session.totalTokens / 1000).toFixed(0)}k\n                                    tok\n                                  </span>\n                                )}\n                            </div>\n                          </>\n                        )}\n                      </div>\n\n                      {isCurrent && !isEditing && (\n                        <Check\n                          size={14}\n                          className=\"shrink-0 text-emerald-400\"\n                        />\n                      )}\n                    </button>\n\n                    {/* Action buttons - show on hover or when selected */}\n                    {!isEditing && (\n                      <div\n                        className={`shrink-0 items-center gap-0.5 ${\n                          isSelected ? \"flex\" : \"hidden group-hover:flex\"\n                        }`}\n                      >\n                        {onRename && (\n                          <button\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              setEditLabel(\n                                session.label || sessionDisplayName(session),\n                              );\n                              setEditingKey(session.key);\n                            }}\n                            className=\"rounded p-1 text-muted-foreground hover:bg-accent hover:text-foreground\"\n                            title=\"이름 변경\"\n                          >\n                            <Pencil size={12} />\n                          </button>\n                        )}\n                        {onReset && (\n                          <button\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              handleReset(session.key);\n                            }}\n                            className=\"rounded p-1 text-muted-foreground hover:bg-accent hover:text-foreground\"\n                            title=\"리셋\"\n                          >\n                            <RotateCcw size={12} />\n                          </button>\n                        )}\n                        {onDelete && (\n                          <button\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              handleDelete(session.key);\n                            }}\n                            className=\"rounded p-1 text-muted-foreground hover:bg-red-900/50 hover:text-destructive\"\n                            title=\"삭제\"\n                          >\n                            <Trash2 size={12} />\n                          </button>\n                        )}\n                      </div>\n                    )}\n\n                    {/* Edit confirm/cancel */}\n                    {isEditing && (\n                      <div className=\"flex shrink-0 items-center gap-0.5\">\n                        <button\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            handleRename(session.key);\n                          }}\n                          disabled={actionBusy}\n                          className=\"rounded p-1 text-emerald-400 hover:bg-accent\"\n                          title=\"저장\"\n                        >\n                          <Check size={12} />\n                        </button>\n                        <button\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            setEditingKey(null);\n                          }}\n                          className=\"rounded p-1 text-muted-foreground hover:bg-accent\"\n                          title=\"취소\"\n                        >\n                          <X size={12} />\n                        </button>\n                      </div>\n                    )}\n                  </div>\n                );\n              })}\n\n              {/* New conversation item */}\n              <div\n                data-session-item\n                className={`mx-1 flex cursor-pointer items-center gap-3 rounded-lg px-3 py-2.5 transition-colors ${\n                  selectedIndex === filtered.length\n                    ? \"bg-muted/70\"\n                    : \"hover:bg-muted\"\n                }`}\n                onMouseMove={() => {\n                  if (!isKeyboardNav.current && selectedIndex !== filtered.length) setSelectedIndex(filtered.length);\n                }}\n                onClick={() => {\n                  onNew();\n                  setOpen(false);\n                }}\n              >\n                <Plus size={14} className=\"text-primary\" />\n                <span className=\"text-sm text-primary\">새 대화 시작</span>\n                <kbd className=\"ml-auto rounded border border-border bg-muted px-1.5 py-0.5 text-[10px] text-muted-foreground\">\n                  ↵\n                </kbd>\n              </div>\n            </div>\n\n            {/* Footer hint (desktop only) */}\n            {!isMobile && (\n              <div className=\"flex items-center gap-3 border-t border-border px-4 py-2 text-[10px] text-muted-foreground\">\n                <span className=\"flex items-center gap-1\">\n                  <kbd className=\"rounded border border-border px-1\">↑↓</kbd>\n                  이동\n                </span>\n                <span className=\"flex items-center gap-1\">\n                  <kbd className=\"rounded border border-border px-1\">↵</kbd>\n                  선택\n                </span>\n                <span className=\"flex items-center gap-1\">\n                  <kbd className=\"rounded border border-border px-1\">R</kbd>\n                  이름변경\n                </span>\n                <span className=\"flex items-center gap-1\">\n                  <kbd className=\"rounded border border-border px-1\">esc</kbd>\n                  닫기\n                </span>\n              </div>\n            )}\n          </div>\n        </div>,\n        portalContainer || document.body\n      )}\n    </>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 4715, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/chat/task-memo.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useCallback, useEffect, useRef, memo } from \"react\";\nimport { ChevronDown, ChevronRight, Plus, X, Pencil, Check } from \"lucide-react\";\n\nexport interface TaskItem {\n  id: string;\n  text: string;\n  status: \"pending\" | \"in-progress\" | \"done\";\n}\n\nexport interface TaskMemoData {\n  items: TaskItem[];\n  updatedAt: number;\n}\n\nconst STATUS_ICONS: Record<TaskItem[\"status\"], string> = {\n  pending: \"⬜\",\n  \"in-progress\": \"🔄\",\n  done: \"✅\",\n};\n\nconst STATUS_CYCLE: TaskItem[\"status\"][] = [\"pending\", \"in-progress\", \"done\"];\n\n// --- localStorage helpers ---\n\nfunction storageKey(sessionKey: string) {\n  return `awf:task-memo:${sessionKey}`;\n}\n\nfunction loadMemo(sessionKey: string): TaskMemoData {\n  if (typeof window === \"undefined\") return { items: [], updatedAt: 0 };\n  try {\n    const raw = localStorage.getItem(storageKey(sessionKey));\n    if (!raw) return { items: [], updatedAt: 0 };\n    return JSON.parse(raw);\n  } catch {\n    return { items: [], updatedAt: 0 };\n  }\n}\n\nfunction saveMemo(sessionKey: string, data: TaskMemoData) {\n  if (typeof window === \"undefined\") return;\n  localStorage.setItem(storageKey(sessionKey), JSON.stringify(data));\n}\n\n// --- Parse task-memo from assistant messages ---\n\nconst TASK_MEMO_RE = /<!--\\s*task-memo:\\s*(\\{[\\s\\S]*?\\})\\s*-->/;\n\nfunction extractText(msg: Record<string, unknown>): string {\n  const content = msg.content;\n  if (typeof content === \"string\") return content;\n  if (Array.isArray(content)) {\n    return (content as Array<{ type?: string; text?: string }>)\n      .filter((c) => c.type === \"text\" && typeof c.text === \"string\")\n      .map((c) => c.text!)\n      .join(\"\\n\");\n  }\n  if (typeof msg.text === \"string\") return msg.text;\n  return \"\";\n}\n\nfunction parseItemEntry(item: string | TaskItem, idx: number): TaskItem {\n  if (typeof item === \"string\") {\n    const status = item.startsWith(\"✅\")\n      ? \"done\"\n      : item.startsWith(\"🔄\")\n        ? \"in-progress\"\n        : \"pending\";\n    const cleanText = item.replace(/^[✅🔄⬜]\\s*/, \"\");\n    return { id: `auto-${idx}`, text: cleanText, status };\n  }\n  return { id: item.id || `auto-${idx}`, text: item.text, status: item.status || \"pending\" };\n}\n\nexport function parseTaskMemoFromMessages(messages: Array<Record<string, unknown>>): TaskItem[] | null {\n  // Scan from latest to earliest, return first match\n  for (let i = messages.length - 1; i >= 0; i--) {\n    const msg = messages[i];\n    if (msg.role !== \"assistant\") continue;\n\n    const text = extractText(msg);\n    const match = text.match(TASK_MEMO_RE);\n    if (match) {\n      try {\n        const parsed = JSON.parse(match[1]);\n        if (Array.isArray(parsed.items)) {\n          return parsed.items.map(parseItemEntry);\n        }\n      } catch {\n        // ignore parse errors\n      }\n    }\n  }\n  return null;\n}\n\n// --- Component ---\n\ninterface TaskMemoProps {\n  sessionKey: string;\n  messages: Array<Record<string, unknown>>;\n}\n\nexport const TaskMemo = memo(function TaskMemo({ sessionKey, messages }: TaskMemoProps) {\n  const [memo, setMemo] = useState<TaskMemoData>(() => loadMemo(sessionKey));\n  const [collapsed, setCollapsed] = useState(() => {\n    if (typeof window === \"undefined\") return false;\n    return localStorage.getItem(\"awf:task-memo:collapsed\") === \"true\";\n  });\n  const [editingId, setEditingId] = useState<string | null>(null);\n  const [editText, setEditText] = useState(\"\");\n  const [addingNew, setAddingNew] = useState(false);\n  const [newText, setNewText] = useState(\"\");\n  const inputRef = useRef<HTMLInputElement>(null);\n  const lastAutoUpdateRef = useRef<number>(0);\n\n  // Reload memo when session changes\n  useEffect(() => {\n    setMemo(loadMemo(sessionKey));\n  }, [sessionKey]);\n\n  // Auto-update from assistant messages\n  // Derive a lightweight fingerprint so the effect fires on content changes\n  const msgFingerprint = messages.length > 0\n    ? `${messages.length}:${extractText(messages[messages.length - 1]).length}`\n    : \"0:0\";\n\n  useEffect(() => {\n    const autoItems = parseTaskMemoFromMessages(messages);\n    if (!autoItems) return;\n    const now = Date.now();\n    if (now - lastAutoUpdateRef.current < 300) return;\n    lastAutoUpdateRef.current = now;\n\n    const newMemo: TaskMemoData = {\n      items: autoItems,\n      updatedAt: now,\n    };\n    setMemo(newMemo);\n    saveMemo(sessionKey, newMemo);\n  }, [messages, sessionKey, msgFingerprint]);\n\n  const updateMemo = useCallback(\n    (updater: (prev: TaskMemoData) => TaskMemoData) => {\n      setMemo((prev) => {\n        const next = updater(prev);\n        next.updatedAt = Date.now();\n        saveMemo(sessionKey, next);\n        return next;\n      });\n    },\n    [sessionKey]\n  );\n\n  const toggleCollapsed = () => {\n    const next = !collapsed;\n    setCollapsed(next);\n    localStorage.setItem(\"awf:task-memo:collapsed\", String(next));\n  };\n\n  const cycleStatus = (id: string) => {\n    updateMemo((prev) => ({\n      ...prev,\n      items: prev.items.map((item) => {\n        if (item.id !== id) return item;\n        const idx = STATUS_CYCLE.indexOf(item.status);\n        return { ...item, status: STATUS_CYCLE[(idx + 1) % STATUS_CYCLE.length] };\n      }),\n    }));\n  };\n\n  const removeItem = (id: string) => {\n    updateMemo((prev) => ({\n      ...prev,\n      items: prev.items.filter((item) => item.id !== id),\n    }));\n  };\n\n  const startEdit = (item: TaskItem) => {\n    setEditingId(item.id);\n    setEditText(item.text);\n  };\n\n  const commitEdit = () => {\n    if (!editingId) return;\n    const text = editText.trim();\n    if (text) {\n      updateMemo((prev) => ({\n        ...prev,\n        items: prev.items.map((item) =>\n          item.id === editingId ? { ...item, text } : item\n        ),\n      }));\n    }\n    setEditingId(null);\n    setEditText(\"\");\n  };\n\n  const addItem = () => {\n    const text = newText.trim();\n    if (!text) {\n      setAddingNew(false);\n      return;\n    }\n    updateMemo((prev) => ({\n      ...prev,\n      items: [\n        ...prev.items,\n        { id: `manual-${Date.now()}`, text, status: \"pending\" as const },\n      ],\n    }));\n    setNewText(\"\");\n    setAddingNew(false);\n  };\n\n  useEffect(() => {\n    if (addingNew && inputRef.current) inputRef.current.focus();\n  }, [addingNew]);\n\n  const hasItems = memo.items.length > 0;\n\n  // Don't render anything if no items and collapsed\n  if (!hasItems && collapsed) return null;\n\n  return (\n    <div className=\"border-b border-border/60 bg-background/40\">\n      {/* Header */}\n      <button\n        className=\"flex w-full items-center gap-1.5 px-3 py-1 text-[11px] font-medium text-muted-foreground hover:text-muted-foreground transition-colors\"\n        onClick={toggleCollapsed}\n      >\n        {collapsed ? <ChevronRight size={12} /> : <ChevronDown size={12} />}\n        <span>Tasks</span>\n        {hasItems && (\n          <span className=\"text-muted-foreground\">\n            ({memo.items.filter((i) => i.status === \"done\").length}/{memo.items.length})\n          </span>\n        )}\n        {!collapsed && (\n          <span\n            role=\"button\"\n            tabIndex={0}\n            className=\"ml-auto rounded p-0.5 text-muted-foreground hover:text-muted-foreground hover:bg-muted cursor-pointer\"\n            onClick={(e) => {\n              e.stopPropagation();\n              setAddingNew(true);\n              setCollapsed(false);\n            }}\n            title=\"Add task\"\n          >\n            <Plus size={12} />\n          </span>\n        )}\n      </button>\n\n      {/* Items */}\n      {!collapsed && (\n        <div className=\"px-3 pb-1.5 space-y-0.5\">\n          {memo.items.map((item) => (\n            <div\n              key={item.id}\n              className=\"group flex items-center gap-1.5 rounded px-1 py-0.5 text-[11px] hover:bg-muted/50\"\n            >\n              <button\n                className=\"shrink-0 cursor-pointer\"\n                onClick={() => cycleStatus(item.id)}\n                title=\"Toggle status\"\n              >\n                {STATUS_ICONS[item.status]}\n              </button>\n\n              {editingId === item.id ? (\n                <input\n                  className=\"flex-1 bg-transparent text-foreground outline-none border-b border-border text-[11px]\"\n                  value={editText}\n                  onChange={(e) => setEditText(e.target.value)}\n                  onBlur={commitEdit}\n                  onKeyDown={(e) => {\n                    if (e.key === \"Enter\") commitEdit();\n                    if (e.key === \"Escape\") {\n                      setEditingId(null);\n                      setEditText(\"\");\n                    }\n                  }}\n                  autoFocus\n                />\n              ) : (\n                <span\n                  className={`flex-1 cursor-default ${\n                    item.status === \"done\" ? \"text-muted-foreground line-through\" : \"text-muted-foreground\"\n                  }`}\n                  onDoubleClick={() => startEdit(item)}\n                >\n                  {item.text}\n                </span>\n              )}\n\n              <div className=\"hidden group-hover:flex items-center gap-0.5\">\n                <button\n                  className=\"rounded p-0.5 text-muted-foreground hover:text-muted-foreground\"\n                  onClick={() => startEdit(item)}\n                  title=\"Edit\"\n                >\n                  <Pencil size={10} />\n                </button>\n                <button\n                  className=\"rounded p-0.5 text-muted-foreground hover:text-destructive\"\n                  onClick={() => removeItem(item.id)}\n                  title=\"Remove\"\n                >\n                  <X size={10} />\n                </button>\n              </div>\n            </div>\n          ))}\n\n          {/* Add new item */}\n          {addingNew && (\n            <div className=\"flex items-center gap-1.5 px-1 py-0.5\">\n              <span className=\"shrink-0\">⬜</span>\n              <input\n                ref={inputRef}\n                className=\"flex-1 bg-transparent text-foreground outline-none border-b border-border text-[11px] placeholder-muted-foreground\"\n                placeholder=\"New task...\"\n                value={newText}\n                onChange={(e) => setNewText(e.target.value)}\n                onBlur={addItem}\n                onKeyDown={(e) => {\n                  if (e.key === \"Enter\") addItem();\n                  if (e.key === \"Escape\") {\n                    setAddingNew(false);\n                    setNewText(\"\");\n                  }\n                }}\n              />\n            </div>\n          )}\n\n          {!hasItems && !addingNew && (\n            <div className=\"px-1 py-0.5 text-[10px] text-muted-foreground italic\">\n              No tasks yet. Click + to add.\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n});\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 5178, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/chat/chat-header.tsx"],"sourcesContent":["\"use client\";\n\nimport { useMemo, useRef, useEffect, useState, useCallback } from \"react\";\nimport {\n  MessageSquare, Plus, X, Pin, Clock, Zap,\n  MessageCircle, Bot, Settings, ChevronDown,\n} from \"lucide-react\";\nimport { parseSessionKey } from \"@/lib/gateway/session-utils\";\nimport type { Agent, Session } from \"@/lib/gateway/protocol\";\nimport { cn } from \"@/lib/utils\";\n\n// --- Types ---\n\ninterface SessionEntry extends Partial<Session> {\n  [key: string]: unknown;\n}\n\ninterface ChatHeaderProps {\n  sessionKey?: string;\n  agents: Agent[];\n  sessions: SessionEntry[];\n  messages: Array<Record<string, unknown>>;\n  onSelectSession?: (key: string) => void;\n  onNewSession?: () => void;\n  onDeleteSession?: (key: string) => void;\n  onRenameSession?: (key: string, label: string) => void;\n  onOpenSessionManager?: () => void;\n}\n\n// --- Constants ---\n\nconst IDLE_THRESHOLD_MS = 24 * 60 * 60 * 1000; // 24 hours\n\nconst TYPE_ICONS: Record<string, React.ReactNode> = {\n  main: <Pin size={10} className=\"text-amber-400\" />,\n  thread: <MessageCircle size={10} className=\"text-blue-400\" />,\n  subagent: <Bot size={10} className=\"text-purple-400\" />,\n  cron: <Settings size={10} className=\"text-zinc-500\" />,\n  a2a: <Zap size={10} className=\"text-green-400\" />,\n};\n\n// --- Helpers ---\n\n/** Derive a short display label for a session tab — conversation content only. */\nfunction sessionTabLabel(session: SessionEntry): string {\n  // 1. User-set or auto-generated label\n  if (session.label && typeof session.label === \"string\") {\n    const label = session.label as string;\n    const slashIdx = label.indexOf(\"/\");\n    const clean = slashIdx > 0 && slashIdx < 16 ? label.slice(slashIdx + 1) : label;\n    return clean.length > 28 ? `${clean.slice(0, 26)}…` : clean;\n  }\n\n  // 3. Title\n  if (session.title && typeof session.title === \"string\") {\n    const t = session.title as string;\n    return t.length > 28 ? `${t.slice(0, 26)}…` : t;\n  }\n\n  // 4. Last message snippet\n  if (session.lastMessage && typeof session.lastMessage === \"string\") {\n    const msg = (session.lastMessage as string).replace(/\\s+/g, \" \").trim();\n    if (msg && !msg.startsWith(\"/\")) {\n      return msg.length > 28 ? `${msg.slice(0, 26)}…` : msg;\n    }\n  }\n\n  // 5. Fallback by type\n  const parsed = parseSessionKey(session.key || \"\");\n  if (parsed.type === \"main\") return \"메인\";\n  if (parsed.type === \"thread\") return `스레드 #${(parsed.detail || \"\").slice(0, 6)}`;\n  if (parsed.type === \"subagent\") return `서브 #${(parsed.detail || \"\").slice(0, 6)}`;\n  if (parsed.type === \"cron\") return `크론 ${parsed.detail || \"\"}`;\n  return parsed.type;\n}\n\n/** Format token count */\nfunction formatTokens(n?: number): string | null {\n  if (!n || n === 0) return null;\n  if (n >= 1_000_000) return `${(n / 1_000_000).toFixed(1)}M`;\n  if (n >= 1_000) return `${(n / 1_000).toFixed(1)}k`;\n  return String(n);\n}\n\n/** Format relative time */\nfunction relativeTime(ts?: number): string | null {\n  if (!ts) return null;\n  const diff = Date.now() - ts;\n  if (diff < 60_000) return \"방금\";\n  if (diff < 3600_000) return `${Math.floor(diff / 60_000)}분`;\n  if (diff < 86400_000) return `${Math.floor(diff / 3600_000)}시간`;\n  return `${Math.floor(diff / 86400_000)}일`;\n}\n\n/** Topic from current session messages */\nfunction deriveTopic(\n  session: SessionEntry | undefined,\n  messages: Array<Record<string, unknown>>\n): string | null {\n  if (session?.label && typeof session.label === \"string\") {\n    const label = session.label as string;\n    const slashIdx = label.indexOf(\"/\");\n    if (slashIdx > 0 && slashIdx < 16) return label.slice(slashIdx + 1);\n    return label;\n  }\n  if (session?.title) return session.title;\n  const firstUser = messages.find(\n    (m) => (m.role === \"user\" || m.sender === \"user\") && typeof m.body === \"string\" && (m.body as string).trim()\n  );\n  if (firstUser) {\n    const text = (firstUser.body as string).replace(/\\s+/g, \" \").trim();\n    if (text.startsWith(\"/\")) return null;\n    return text.length > 60 ? `${text.slice(0, 57)}…` : text;\n  }\n  return null;\n}\n\n// --- Main Component ---\n\nexport function ChatHeader({\n  sessionKey,\n  agents,\n  sessions,\n  messages,\n  onSelectSession,\n  onNewSession,\n  onDeleteSession,\n  onRenameSession,\n  onOpenSessionManager,\n}: ChatHeaderProps) {\n  const [confirmDeleteKey, setConfirmDeleteKey] = useState<string | null>(null);\n  const [editingKey, setEditingKey] = useState<string | null>(null);\n  const [editLabel, setEditLabel] = useState(\"\");\n  const [showIdle, setShowIdle] = useState(false);\n\n  if (!sessionKey) return null;\n\n  const parsed = parseSessionKey(sessionKey);\n  const agent = agents.find((a) => a.id === parsed.agentId);\n  const agentName = agent?.name || parsed.agentId;\n  const session = sessions.find((s) => s.key === sessionKey);\n\n  // Filter sessions for this agent (main + threads only in tabs)\n  const allAgentSessions = useMemo(() => {\n    return sessions\n      .filter((s) => {\n        if (!s.key) return false;\n        const p = parseSessionKey(s.key as string);\n        return p.agentId === parsed.agentId && (p.type === \"main\" || p.type === \"thread\");\n      })\n      .sort((a, b) => {\n        // Main always first\n        const aType = parseSessionKey((a.key || \"\") as string).type;\n        const bType = parseSessionKey((b.key || \"\") as string).type;\n        if (aType === \"main\" && bType !== \"main\") return -1;\n        if (bType === \"main\" && aType !== \"main\") return 1;\n        return ((b as any).updatedAt || 0) - ((a as any).updatedAt || 0);\n      });\n  }, [sessions, parsed.agentId]);\n\n  // Split into active and idle\n  const now = Date.now();\n  const { activeSessions, idleSessions } = useMemo(() => {\n    const active: SessionEntry[] = [];\n    const idle: SessionEntry[] = [];\n    for (const s of allAgentSessions) {\n      const updatedAt = (s as any).updatedAt as number | undefined;\n      const p = parseSessionKey((s.key || \"\") as string);\n      // Main is always active\n      if (p.type === \"main\" || !updatedAt || now - updatedAt < IDLE_THRESHOLD_MS) {\n        active.push(s);\n      } else {\n        idle.push(s);\n      }\n    }\n    return { activeSessions: active, idleSessions: idle };\n  }, [allAgentSessions, now]);\n\n  const sessionType = parsed.type === \"main\" ? \"Main\" : parsed.type === \"thread\" ? \"Thread\" : parsed.type === \"subagent\" ? \"Sub-agent\" : parsed.type === \"cron\" ? \"Cron\" : parsed.type === \"a2a\" ? \"A2A\" : \"\";\n\n  const topic = useMemo(() => deriveTopic(session, messages), [session, messages]);\n\n  // Auto-scroll active tab\n  const tabsRef = useRef<HTMLDivElement>(null);\n  useEffect(() => {\n    if (!tabsRef.current) return;\n    const active = tabsRef.current.querySelector(\"[data-active='true']\");\n    if (active) active.scrollIntoView({ behavior: \"smooth\", block: \"nearest\", inline: \"center\" });\n  }, [sessionKey]);\n\n  // Commit inline rename\n  const commitRename = useCallback(() => {\n    if (editingKey && editLabel.trim() && onRenameSession) {\n      onRenameSession(editingKey, editLabel.trim());\n    }\n    setEditingKey(null);\n    setEditLabel(\"\");\n  }, [editingKey, editLabel, onRenameSession]);\n\n  // Render a single session tab\n  const renderTab = (s: SessionEntry, isIdle = false) => {\n    const key = s.key as string;\n    const isActive = key === sessionKey;\n    const label = sessionTabLabel(s);\n    const p = parseSessionKey(key);\n    const isMain = p.type === \"main\";\n    const isConfirming = confirmDeleteKey === key;\n    const isEditing = editingKey === key;\n    const tokens = formatTokens((s as any).totalTokens);\n    const time = relativeTime((s as any).updatedAt);\n    const icon = TYPE_ICONS[p.type] || TYPE_ICONS.thread;\n\n    if (isConfirming) {\n      return (\n        <div key={key} className=\"flex items-center gap-1 rounded-md bg-red-900/40 border border-red-700/50 px-2 py-1 flex-shrink-0\">\n          <span className=\"text-[10px] text-red-300 mr-1\">삭제?</span>\n          <button onClick={() => { onDeleteSession?.(key); setConfirmDeleteKey(null); }}\n            className=\"rounded px-1.5 py-0.5 text-[10px] bg-red-600/80 text-white hover:bg-red-600\">확인</button>\n          <button onClick={() => setConfirmDeleteKey(null)}\n            className=\"rounded px-1.5 py-0.5 text-[10px] bg-zinc-700 text-zinc-300 hover:bg-zinc-600\">취소</button>\n        </div>\n      );\n    }\n\n    if (isEditing) {\n      return (\n        <div key={key} className=\"flex items-center gap-1 flex-shrink-0\">\n          <input\n            autoFocus\n            value={editLabel}\n            onChange={(e) => setEditLabel(e.target.value)}\n            onKeyDown={(e) => {\n              if (e.key === \"Enter\") commitRename();\n              if (e.key === \"Escape\") { setEditingKey(null); setEditLabel(\"\"); }\n            }}\n            onBlur={commitRename}\n            className=\"w-[140px] rounded-md border border-zinc-600 bg-zinc-800 px-2 py-1 text-[11px] text-zinc-200 outline-none focus:border-amber-500\"\n          />\n        </div>\n      );\n    }\n\n    return (\n      <div key={key} className=\"group relative flex-shrink-0\">\n        <button\n          data-active={isActive}\n          onClick={() => onSelectSession?.(key)}\n          onDoubleClick={() => {\n            if (!isMain) {\n              setEditingKey(key);\n              setEditLabel(label);\n            }\n          }}\n          className={cn(\n            \"flex items-center gap-1.5 rounded-md px-2.5 py-1.5 text-[11px] font-medium transition-all max-w-[220px]\",\n            isIdle && \"opacity-50\",\n            isActive\n              ? \"bg-amber-600/80 text-white shadow-sm\"\n              : \"bg-zinc-800/70 text-zinc-400 hover:bg-zinc-700 hover:text-zinc-200\"\n          )}\n          title={`${label}${tokens ? ` · ${tokens} tokens` : \"\"}${time ? ` · ${time} 전` : \"\"}`}\n        >\n          {/* Type icon */}\n          <span className=\"flex-shrink-0\">{icon}</span>\n\n          {/* Label */}\n          <span className=\"truncate\">{label}</span>\n\n          {/* Token or time badge */}\n          {(tokens || time) && (\n            <span className={cn(\n              \"flex-shrink-0 text-[9px] ml-0.5\",\n              isActive ? \"text-white/60\" : \"text-zinc-600\"\n            )}>\n              {tokens || time}\n            </span>\n          )}\n\n          {/* Close button (not for main, visible on hover) */}\n          {!isMain && (\n            <span\n              role=\"button\"\n              onClick={(e) => { e.stopPropagation(); setConfirmDeleteKey(key); }}\n              className={cn(\n                \"flex-shrink-0 rounded p-0.5 opacity-0 group-hover:opacity-100 transition-opacity\",\n                isActive\n                  ? \"hover:bg-amber-700/80 text-white/70 hover:text-white\"\n                  : \"hover:bg-zinc-600 text-zinc-500 hover:text-zinc-200\"\n              )}\n            >\n              <X size={10} />\n            </span>\n          )}\n        </button>\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"flex-shrink-0 border-b border-zinc-700/50 bg-zinc-900/90\">\n      {/* Agent name row */}\n      <div className=\"flex items-center gap-3 px-5 pt-3.5 pb-2\">\n        <Bot size={22} className=\"text-amber-500 flex-shrink-0\" />\n        <span className=\"text-lg font-extrabold text-white truncate tracking-tight leading-tight\">\n          {agentName}\n        </span>\n        <span className=\"rounded-md bg-zinc-800 px-2 py-0.5 text-[10px] font-medium text-zinc-500 uppercase tracking-wide\">\n          {sessionType}\n        </span>\n        {onOpenSessionManager && (\n          <button\n            onClick={onOpenSessionManager}\n            className=\"ml-auto rounded-md p-1.5 text-zinc-600 hover:bg-zinc-800 hover:text-zinc-300 transition\"\n            title=\"세션 관리\"\n          >\n            <Settings size={14} />\n          </button>\n        )}\n      </div>\n\n      {/* Topic */}\n      {topic && (\n        <div className=\"flex items-center gap-2 px-5 pb-2 pl-[54px]\">\n          <MessageSquare size={12} className=\"text-zinc-600 flex-shrink-0\" />\n          <span className=\"text-[13px] text-zinc-400 truncate\">{topic}</span>\n        </div>\n      )}\n\n      {/* Session tabs */}\n      {activeSessions.length > 0 && (\n        <div ref={tabsRef} className=\"flex items-center gap-1 overflow-x-auto px-4 pb-2.5 scrollbar-none\">\n          {/* Active sessions */}\n          {activeSessions.map((s) => renderTab(s))}\n\n          {/* Idle sessions toggle */}\n          {idleSessions.length > 0 && (\n            <button\n              onClick={() => setShowIdle(!showIdle)}\n              className=\"flex-shrink-0 flex items-center gap-1 rounded-md bg-zinc-800/40 px-2 py-1.5 text-[10px] text-zinc-600 hover:bg-zinc-700 hover:text-zinc-400 transition\"\n              title={`${idleSessions.length}개 비활성 세션`}\n            >\n              <Clock size={10} />\n              <span>+{idleSessions.length}</span>\n              <ChevronDown size={10} className={cn(\"transition-transform\", showIdle && \"rotate-180\")} />\n            </button>\n          )}\n\n          {/* Idle sessions (expanded) */}\n          {showIdle && idleSessions.map((s) => renderTab(s, true))}\n\n          {/* New session button */}\n          {onNewSession && (\n            <button\n              onClick={onNewSession}\n              className=\"flex-shrink-0 flex items-center justify-center rounded-md bg-zinc-800/40 px-2 py-1.5 text-zinc-600 hover:bg-zinc-700 hover:text-zinc-300 transition\"\n              title=\"새 세션\"\n            >\n              <Plus size={13} />\n            </button>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 5712, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/lib/shortcuts.ts"],"sourcesContent":["// --- Shortcut types ---\n\nexport type ShortcutDef = {\n  id: string;\n  /** Default key combo (display string) */\n  keys: string;\n  description: string;\n  scope?: \"global\" | \"panel\";\n};\n\n// --- Default shortcuts ---\n\nexport const DEFAULT_SHORTCUTS: ShortcutDef[] = [\n  { id: \"help\", keys: \"Cmd+/\", description: \"단축키 도움말 열기\", scope: \"global\" },\n  { id: \"add-panel\", keys: \"Cmd+\\\\\", description: \"패널 추가\", scope: \"global\" },\n  { id: \"focus-left\", keys: \"Ctrl+H\", description: \"왼쪽 패널 포커스\", scope: \"global\" },\n  { id: \"focus-right\", keys: \"Ctrl+L\", description: \"오른쪽 패널 포커스\", scope: \"global\" },\n  { id: \"swap-panels\", keys: \"Cmd+Ctrl+Shift+S\", description: \"패널 위치 스왑\", scope: \"global\" },\n  { id: \"close-panel\", keys: \"Ctrl+X\", description: \"현재 패널 닫기\", scope: \"global\" },\n  { id: \"reopen-panel\", keys: \"Ctrl+Shift+X\", description: \"닫은 패널 다시 열기\", scope: \"global\" },\n  { id: \"new-session\", keys: \"Ctrl+N\", description: \"현재 패널 새 세션\", scope: \"panel\" },\n  { id: \"session-switcher\", keys: \"Cmd+K\", description: \"세션 스위처 열기\", scope: \"panel\" },\n  { id: \"focus-panel-1\", keys: \"Ctrl+1\", description: \"패널 1 포커스\", scope: \"global\" },\n  { id: \"focus-panel-2\", keys: \"Ctrl+2\", description: \"패널 2 포커스\", scope: \"global\" },\n  { id: \"focus-panel-3\", keys: \"Ctrl+3\", description: \"패널 3 포커스\", scope: \"global\" },\n  { id: \"focus-panel-4\", keys: \"Ctrl+4\", description: \"패널 4 포커스\", scope: \"global\" },\n  { id: \"focus-panel-5\", keys: \"Ctrl+5\", description: \"패널 5 포커스\", scope: \"global\" },\n];\n\n// Re-export for backward compat\nexport const SHORTCUTS = DEFAULT_SHORTCUTS;\n\n// --- Storage ---\n\nconst STORAGE_KEY = \"awf:custom-shortcuts\";\n\nexport type CustomBindings = Record<string, string>; // id → keys\n\nexport function loadCustomBindings(): CustomBindings {\n  if (typeof window === \"undefined\") return {};\n  try {\n    const raw = localStorage.getItem(STORAGE_KEY);\n    return raw ? JSON.parse(raw) : {};\n  } catch {\n    return {};\n  }\n}\n\nexport function saveCustomBindings(bindings: CustomBindings) {\n  if (typeof window === \"undefined\") return;\n  localStorage.setItem(STORAGE_KEY, JSON.stringify(bindings));\n}\n\n/** Get effective shortcuts (defaults + user overrides merged) */\nexport function getEffectiveShortcuts(): ShortcutDef[] {\n  const custom = loadCustomBindings();\n  return DEFAULT_SHORTCUTS.map((s) => ({\n    ...s,\n    keys: custom[s.id] || s.keys,\n  }));\n}\n\n// --- Key matching ---\n\n/**\n * Parse a display key string like \"Cmd+Shift+K\" into a normalized set.\n * Supports: Cmd, Ctrl, Shift, Opt/Alt, plus a main key.\n */\nexport function parseKeys(keys: string): { meta: boolean; ctrl: boolean; shift: boolean; alt: boolean; key: string } {\n  const parts = keys.split(\"+\").map((p) => p.trim().toLowerCase());\n  return {\n    meta: parts.includes(\"cmd\") || parts.includes(\"meta\"),\n    ctrl: parts.includes(\"ctrl\") || parts.includes(\"control\"),\n    shift: parts.includes(\"shift\"),\n    alt: parts.includes(\"opt\") || parts.includes(\"alt\") || parts.includes(\"option\"),\n    key: parts.filter((p) => ![\"cmd\", \"meta\", \"ctrl\", \"control\", \"shift\", \"opt\", \"alt\", \"option\"].includes(p))[0] || \"\",\n  };\n}\n\n/** Check if a KeyboardEvent matches a key combo string */\nexport function matchesShortcut(e: KeyboardEvent, keys: string): boolean {\n  const combo = parseKeys(keys);\n\n  if (combo.meta !== e.metaKey) return false;\n  if (combo.ctrl !== e.ctrlKey) return false;\n  if (combo.shift !== e.shiftKey) return false;\n  if (combo.alt !== e.altKey) return false;\n\n  // Normalize the event key\n  const eventKey = e.key.toLowerCase();\n  const eventCode = e.code.toLowerCase();\n\n  // Match by key name or code\n  const target = combo.key.toLowerCase();\n  if (!target) return false;\n\n  // Special key mappings\n  const keyMap: Record<string, string[]> = {\n    \"/\": [\"/\", \"?\", \"slash\"],\n    \"?\": [\"/\", \"?\"],\n    \"\\\\\": [\"\\\\\", \"backslash\"],\n    \"-\": [\"-\", \"minus\"],\n    \"=\": [\"=\", \"equal\"],\n    \"[\": [\"[\", \"bracketleft\"],\n    \"]\": [\"]\", \"bracketright\"],\n  };\n\n  if (keyMap[target]) {\n    return keyMap[target].some((k) => eventKey === k || eventCode === `key${k}` || eventCode === k);\n  }\n\n  // Letter keys\n  if (target.length === 1 && target >= \"a\" && target <= \"z\") {\n    return eventCode === `key${target}` || eventKey === target;\n  }\n\n  // Number keys\n  if (target.length === 1 && target >= \"0\" && target <= \"9\") {\n    return eventKey === target || eventCode === `digit${target}`;\n  }\n\n  return eventKey === target;\n}\n\n/** Find a shortcut by id and check if event matches it */\nexport function matchesShortcutId(e: KeyboardEvent, id: string): boolean {\n  const shortcuts = getEffectiveShortcuts();\n  const shortcut = shortcuts.find((s) => s.id === id);\n  if (!shortcut) return false;\n  return matchesShortcut(e, shortcut.keys);\n}\n\n/** Convert a KeyboardEvent to a display string for recording custom shortcuts */\nexport function eventToKeyString(e: KeyboardEvent): string | null {\n  const parts: string[] = [];\n  if (e.metaKey) parts.push(\"Cmd\");\n  if (e.ctrlKey) parts.push(\"Ctrl\");\n  if (e.shiftKey) parts.push(\"Shift\");\n  if (e.altKey) parts.push(\"Opt\");\n\n  // Ignore modifier-only presses\n  if ([\"Meta\", \"Control\", \"Shift\", \"Alt\"].includes(e.key)) return null;\n\n  // Normalize key display\n  let key = e.key;\n  if (key.length === 1) key = key.toUpperCase();\n  else if (key === \"Escape\") key = \"Esc\";\n  else if (key === \"Backspace\") key = \"Backspace\";\n  else if (key === \"Enter\") key = \"Enter\";\n\n  parts.push(key);\n  return parts.join(\"+\");\n}\n\nexport function isShortcutHelp(e: KeyboardEvent) {\n  return matchesShortcutId(e, \"help\");\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 5960, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/lib/agent-avatars.ts"],"sourcesContent":["/** Deterministic agent avatar — no hardcoded agent names */\n\nconst COLORS = [\n  \"bg-violet-500/20 text-violet-400\",\n  \"bg-blue-500/20 text-blue-400\",\n  \"bg-green-500/20 text-green-400\",\n  \"bg-yellow-500/20 text-yellow-400\",\n  \"bg-emerald-500/20 text-emerald-400\",\n  \"bg-pink-500/20 text-pink-400\",\n  \"bg-cyan-500/20 text-cyan-400\",\n  \"bg-orange-500/20 text-orange-400\",\n  \"bg-slate-500/20 text-slate-400\",\n  \"bg-red-500/20 text-red-400\",\n  \"bg-teal-500/20 text-teal-400\",\n  \"bg-indigo-500/20 text-indigo-400\",\n  \"bg-purple-500/20 text-purple-400\",\n  \"bg-rose-500/20 text-rose-400\",\n  \"bg-amber-500/20 text-amber-400\",\n  \"bg-lime-500/20 text-lime-400\",\n];\n\nconst DEFAULT_AVATAR = { emoji: \"🤖\", color: \"bg-primary/20 text-primary\" };\n\nfunction hashCode(s: string): number {\n  let h = 0;\n  for (let i = 0; i < s.length; i++) {\n    h = (Math.imul(31, h) + s.charCodeAt(i)) | 0;\n  }\n  return Math.abs(h);\n}\n\nconst cache = new Map<string, { emoji: string; color: string }>();\n\nexport function getAgentAvatar(agentId?: string) {\n  if (!agentId) return DEFAULT_AVATAR;\n\n  const key = agentId.toLowerCase();\n  const cached = cache.get(key);\n  if (cached) return cached;\n\n  const h = hashCode(key);\n  const initials = key.slice(0, 2).toUpperCase();\n  const result = { emoji: initials, color: COLORS[h % COLORS.length] };\n  cache.set(key, result);\n  return result;\n}\n"],"names":[],"mappings":"AAAA,0DAA0D;;;;AAE1D,MAAM,SAAS;IACb;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAED,MAAM,iBAAiB;IAAE,OAAO;IAAM,OAAO;AAA6B;AAE1E,SAAS,SAAS,CAAS;IACzB,IAAI,IAAI;IACR,IAAK,IAAI,IAAI,GAAG,IAAI,EAAE,MAAM,EAAE,IAAK;QACjC,IAAI,AAAC,KAAK,IAAI,CAAC,IAAI,KAAK,EAAE,UAAU,CAAC,KAAM;IAC7C;IACA,OAAO,KAAK,GAAG,CAAC;AAClB;AAEA,MAAM,QAAQ,IAAI;AAEX,SAAS,eAAe,OAAgB;IAC7C,IAAI,CAAC,SAAS,OAAO;IAErB,MAAM,MAAM,QAAQ,WAAW;IAC/B,MAAM,SAAS,MAAM,GAAG,CAAC;IACzB,IAAI,QAAQ,OAAO;IAEnB,MAAM,IAAI,SAAS;IACnB,MAAM,WAAW,IAAI,KAAK,CAAC,GAAG,GAAG,WAAW;IAC5C,MAAM,SAAS;QAAE,OAAO;QAAU,OAAO,MAAM,CAAC,IAAI,OAAO,MAAM,CAAC;IAAC;IACnE,MAAM,GAAG,CAAC,KAAK;IACf,OAAO;AACT","debugId":null}},
    {"offset": {"line": 6015, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/settings/agent-manager.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect, useCallback } from \"react\";\nimport { Bot, Plus, Pencil, Trash2, Save, X, ChevronRight } from \"lucide-react\";\nimport { useGateway, useAgents } from \"@/lib/gateway/hooks\";\nimport type { Agent } from \"@/lib/gateway/protocol\";\nimport { getAgentAvatar } from \"@/lib/agent-avatars\";\nimport { cn } from \"@/lib/utils\";\n\n// --- Agent form fields ---\ninterface AgentFormData {\n  id: string;\n  name: string;\n  model: string;\n  description: string;\n  systemPrompt: string;\n}\n\nconst EMPTY_FORM: AgentFormData = { id: \"\", name: \"\", model: \"\", description: \"\", systemPrompt: \"\" };\n\n// --- New Session Picker (agent selection → callback) ---\n\nexport function NewSessionPicker({\n  open,\n  onClose,\n  onSelect,\n  onManageAgents,\n}: {\n  open: boolean;\n  onClose: () => void;\n  onSelect: (agentId: string) => void;\n  onManageAgents: () => void;\n}) {\n  const { agents, refresh } = useAgents();\n\n  useEffect(() => {\n    if (open) refresh();\n  }, [open, refresh]);\n\n  useEffect(() => {\n    if (!open) return;\n    const handler = (e: KeyboardEvent) => {\n      if (e.key === \"Escape\") onClose();\n    };\n    document.addEventListener(\"keydown\", handler);\n    return () => document.removeEventListener(\"keydown\", handler);\n  }, [open, onClose]);\n\n  if (!open) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-[150]\" role=\"dialog\" aria-modal=\"true\">\n      <div className=\"absolute inset-0 bg-black/60\" onClick={onClose} />\n      <div className=\"absolute left-1/2 top-1/2 w-[min(92vw,480px)] -translate-x-1/2 -translate-y-1/2 rounded-xl border border-zinc-700 bg-zinc-900 shadow-2xl\">\n        <div className=\"flex items-center justify-between border-b border-zinc-800 px-4 py-3\">\n          <h3 className=\"text-sm font-semibold text-zinc-100\">새 세션 — 에이전트 선택</h3>\n          <button onClick={onClose} className=\"rounded px-2 py-1 text-xs text-zinc-400 hover:bg-zinc-800 hover:text-zinc-200\">ESC</button>\n        </div>\n        <div className=\"max-h-[60vh] overflow-y-auto p-2\">\n          {agents.map((agent) => {\n            const av = getAgentAvatar(agent.id);\n            return (\n              <button\n                key={agent.id}\n                onClick={() => { onSelect(agent.id); onClose(); }}\n                className=\"flex w-full items-center gap-3 rounded-lg px-3 py-3 text-left transition hover:bg-zinc-800\"\n              >\n                <div className={cn(\"flex size-9 shrink-0 items-center justify-center rounded-full text-base\", av.color)}>\n                  {av.emoji}\n                </div>\n                <div className=\"flex-1 min-w-0\">\n                  <div className=\"text-sm font-semibold text-zinc-100 truncate\">{agent.name || agent.id}</div>\n                  {agent.description && (\n                    <div className=\"text-xs text-zinc-500 truncate\">{agent.description}</div>\n                  )}\n                  {agent.model && (\n                    <div className=\"text-[10px] text-zinc-600 truncate\">{agent.model}</div>\n                  )}\n                </div>\n                <ChevronRight size={14} className=\"text-zinc-600\" />\n              </button>\n            );\n          })}\n\n          {agents.length === 0 && (\n            <div className=\"py-8 text-center text-sm text-zinc-500\">에이전트가 없습니다</div>\n          )}\n        </div>\n        <div className=\"border-t border-zinc-800 px-3 py-2\">\n          <button\n            onClick={() => { onClose(); onManageAgents(); }}\n            className=\"flex w-full items-center justify-center gap-1.5 rounded-md bg-zinc-800 py-2 text-xs text-zinc-400 hover:bg-zinc-700 hover:text-zinc-200\"\n          >\n            <Bot size={12} />\n            에이전트 관리\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// --- Agent Manager (CRUD) ---\n\nexport function AgentManager({\n  open,\n  onClose,\n}: {\n  open: boolean;\n  onClose: () => void;\n}) {\n  const { client, state } = useGateway();\n  const { agents, refresh } = useAgents();\n  const isConnected = state === \"connected\";\n\n  const [editingAgent, setEditingAgent] = useState<AgentFormData | null>(null);\n  const [isNew, setIsNew] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [confirmDeleteId, setConfirmDeleteId] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (open) {\n      refresh();\n      setEditingAgent(null);\n      setIsNew(false);\n      setConfirmDeleteId(null);\n    }\n  }, [open, refresh]);\n\n  useEffect(() => {\n    if (!open) return;\n    const handler = (e: KeyboardEvent) => {\n      if (e.key === \"Escape\") {\n        if (editingAgent) { setEditingAgent(null); setIsNew(false); }\n        else onClose();\n      }\n    };\n    document.addEventListener(\"keydown\", handler);\n    return () => document.removeEventListener(\"keydown\", handler);\n  }, [open, editingAgent, onClose]);\n\n  const startCreate = () => {\n    setEditingAgent({ ...EMPTY_FORM });\n    setIsNew(true);\n  };\n\n  const startEdit = (agent: Agent) => {\n    setEditingAgent({\n      id: agent.id,\n      name: agent.name || \"\",\n      model: agent.model || \"\",\n      description: agent.description || \"\",\n      systemPrompt: agent.systemPrompt || \"\",\n    });\n    setIsNew(false);\n  };\n\n  const saveAgent = useCallback(async () => {\n    if (!client || !isConnected || !editingAgent) return;\n    if (!editingAgent.id.trim() || !editingAgent.name.trim()) return;\n\n    setLoading(true);\n    try {\n      // Get current config\n      const config = await client.request<{ config: Record<string, unknown> }>(\"config.get\");\n      const currentAgents = ((config?.config as any)?.agents?.list || {}) as Record<string, unknown>;\n\n      // Build agent config entry\n      const agentEntry: Record<string, unknown> = {};\n      if (editingAgent.name) agentEntry.name = editingAgent.name;\n      if (editingAgent.model) agentEntry.model = editingAgent.model;\n      if (editingAgent.description) agentEntry.description = editingAgent.description;\n      if (editingAgent.systemPrompt) agentEntry.systemPrompt = editingAgent.systemPrompt;\n\n      // Merge with existing (preserve fields we don't edit like workspace, heartbeat, etc.)\n      const existing = (currentAgents[editingAgent.id] || {}) as Record<string, unknown>;\n      const merged = { ...existing, ...agentEntry };\n\n      // Patch config\n      await client.request(\"config.patch\", {\n        patch: {\n          agents: {\n            list: {\n              [editingAgent.id]: merged,\n            },\n          },\n        },\n      });\n\n      await refresh();\n      setEditingAgent(null);\n      setIsNew(false);\n    } catch (err) {\n      console.error(\"[AWF] save agent error:\", err);\n    } finally {\n      setLoading(false);\n    }\n  }, [client, isConnected, editingAgent, refresh]);\n\n  const deleteAgent = useCallback(async (id: string) => {\n    if (!client || !isConnected) return;\n    setLoading(true);\n    try {\n      // Get current config, remove agent\n      const config = await client.request<{ config: Record<string, unknown> }>(\"config.get\");\n      const currentAgents = { ...((config?.config as any)?.agents?.list || {}) } as Record<string, unknown>;\n      delete currentAgents[id];\n\n      await client.request(\"config.apply\", {\n        config: {\n          ...((config?.config) || {}),\n          agents: {\n            ...((config?.config as any)?.agents || {}),\n            list: currentAgents,\n          },\n        },\n      });\n\n      await refresh();\n      setConfirmDeleteId(null);\n    } catch (err) {\n      console.error(\"[AWF] delete agent error:\", err);\n    } finally {\n      setLoading(false);\n    }\n  }, [client, isConnected, refresh]);\n\n  if (!open) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-[160]\" role=\"dialog\" aria-modal=\"true\">\n      <div className=\"absolute inset-0 bg-black/60\" onClick={onClose} />\n      <div className=\"absolute left-1/2 top-1/2 w-[min(92vw,600px)] -translate-x-1/2 -translate-y-1/2 rounded-xl border border-zinc-700 bg-zinc-900 shadow-2xl\">\n        <div className=\"flex items-center justify-between border-b border-zinc-800 px-4 py-3\">\n          <h3 className=\"text-sm font-semibold text-zinc-100\">\n            {editingAgent ? (isNew ? \"에이전트 생성\" : \"에이전트 수정\") : \"에이전트 관리\"}\n          </h3>\n          <button onClick={() => { if (editingAgent) { setEditingAgent(null); setIsNew(false); } else onClose(); }}\n            className=\"rounded px-2 py-1 text-xs text-zinc-400 hover:bg-zinc-800 hover:text-zinc-200\">\n            {editingAgent ? \"뒤로\" : \"ESC\"}\n          </button>\n        </div>\n\n        {editingAgent ? (\n          /* --- Edit / Create form --- */\n          <div className=\"space-y-3 p-4\">\n            <div>\n              <label className=\"mb-1 block text-[11px] font-medium text-zinc-500\">ID</label>\n              <input\n                value={editingAgent.id}\n                onChange={(e) => setEditingAgent({ ...editingAgent, id: e.target.value.toLowerCase().replace(/[^a-z0-9_-]/g, \"\") })}\n                disabled={!isNew}\n                placeholder=\"my-agent\"\n                className=\"w-full rounded-md border border-zinc-700 bg-zinc-800 px-3 py-2 text-sm text-zinc-200 outline-none focus:border-zinc-600 disabled:opacity-50\"\n              />\n            </div>\n            <div>\n              <label className=\"mb-1 block text-[11px] font-medium text-zinc-500\">이름</label>\n              <input\n                value={editingAgent.name}\n                onChange={(e) => setEditingAgent({ ...editingAgent, name: e.target.value })}\n                placeholder=\"My Agent\"\n                className=\"w-full rounded-md border border-zinc-700 bg-zinc-800 px-3 py-2 text-sm text-zinc-200 outline-none focus:border-zinc-600\"\n              />\n            </div>\n            <div>\n              <label className=\"mb-1 block text-[11px] font-medium text-zinc-500\">모델 (선택)</label>\n              <input\n                value={editingAgent.model}\n                onChange={(e) => setEditingAgent({ ...editingAgent, model: e.target.value })}\n                placeholder=\"anthropic/claude-sonnet-4-20250514\"\n                className=\"w-full rounded-md border border-zinc-700 bg-zinc-800 px-3 py-2 text-sm text-zinc-200 outline-none focus:border-zinc-600\"\n              />\n            </div>\n            <div>\n              <label className=\"mb-1 block text-[11px] font-medium text-zinc-500\">설명 (선택)</label>\n              <input\n                value={editingAgent.description}\n                onChange={(e) => setEditingAgent({ ...editingAgent, description: e.target.value })}\n                placeholder=\"이 에이전트의 역할 설명\"\n                className=\"w-full rounded-md border border-zinc-700 bg-zinc-800 px-3 py-2 text-sm text-zinc-200 outline-none focus:border-zinc-600\"\n              />\n            </div>\n            <div>\n              <label className=\"mb-1 block text-[11px] font-medium text-zinc-500\">시스템 프롬프트 (선택)</label>\n              <textarea\n                value={editingAgent.systemPrompt}\n                onChange={(e) => setEditingAgent({ ...editingAgent, systemPrompt: e.target.value })}\n                placeholder=\"에이전트의 성격과 역할을 정의하세요...\"\n                rows={4}\n                className=\"w-full rounded-md border border-zinc-700 bg-zinc-800 px-3 py-2 text-sm text-zinc-200 outline-none focus:border-zinc-600 resize-y\"\n              />\n            </div>\n            <button\n              onClick={saveAgent}\n              disabled={loading || !editingAgent.id.trim() || !editingAgent.name.trim()}\n              className=\"flex w-full items-center justify-center gap-1.5 rounded-md bg-amber-600/80 py-2 text-sm font-medium text-white hover:bg-amber-600 disabled:opacity-40\"\n            >\n              <Save size={14} />\n              {isNew ? \"생성\" : \"저장\"}\n            </button>\n          </div>\n        ) : (\n          /* --- Agent list --- */\n          <>\n            <div className=\"max-h-[55vh] overflow-y-auto p-2\">\n              {agents.map((agent) => {\n                const av = getAgentAvatar(agent.id);\n                const isDeleting = confirmDeleteId === agent.id;\n\n                return (\n                  <div key={agent.id} className=\"flex items-center gap-3 rounded-lg px-3 py-2.5 hover:bg-zinc-800/50\">\n                    <div className={cn(\"flex size-8 shrink-0 items-center justify-center rounded-full text-sm\", av.color)}>\n                      {av.emoji}\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"text-sm font-medium text-zinc-200 truncate\">{agent.name || agent.id}</div>\n                      <div className=\"text-[10px] text-zinc-600 truncate\">{agent.id} · {agent.model || \"default\"}</div>\n                    </div>\n                    <div className=\"flex items-center gap-1\">\n                      <button\n                        onClick={() => startEdit(agent)}\n                        className=\"rounded p-1.5 text-zinc-500 hover:bg-zinc-800 hover:text-zinc-300\"\n                        title=\"수정\"\n                      >\n                        <Pencil size={13} />\n                      </button>\n                      {isDeleting ? (\n                        <div className=\"flex gap-1\">\n                          <button\n                            onClick={() => deleteAgent(agent.id)}\n                            disabled={loading}\n                            className=\"rounded px-2 py-1 text-[10px] bg-red-600/80 text-white hover:bg-red-600\"\n                          >\n                            확인\n                          </button>\n                          <button\n                            onClick={() => setConfirmDeleteId(null)}\n                            className=\"rounded px-2 py-1 text-[10px] bg-zinc-800 text-zinc-400 hover:bg-zinc-700\"\n                          >\n                            취소\n                          </button>\n                        </div>\n                      ) : (\n                        <button\n                          onClick={() => setConfirmDeleteId(agent.id)}\n                          className=\"rounded p-1.5 text-zinc-600 hover:bg-zinc-800 hover:text-red-400\"\n                          title=\"삭제\"\n                        >\n                          <Trash2 size={13} />\n                        </button>\n                      )}\n                    </div>\n                  </div>\n                );\n              })}\n\n              {agents.length === 0 && (\n                <div className=\"py-8 text-center text-sm text-zinc-500\">등록된 에이전트가 없습니다</div>\n              )}\n            </div>\n            <div className=\"border-t border-zinc-800 px-3 py-2\">\n              <button\n                onClick={startCreate}\n                className=\"flex w-full items-center justify-center gap-1.5 rounded-md bg-zinc-800 py-2 text-xs text-zinc-400 hover:bg-zinc-700 hover:text-zinc-200\"\n              >\n                <Plus size={12} />\n                새 에이전트 생성\n              </button>\n            </div>\n          </>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 6807, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/chat/session-manager-panel.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useMemo, useCallback } from \"react\";\nimport {\n  Bot, Pin, MessageCircle, Settings, Zap, Clock,\n  Trash2, RotateCcw, X, ChevronDown, ChevronRight,\n} from \"lucide-react\";\nimport { parseSessionKey, type GatewaySession } from \"@/lib/gateway/session-utils\";\nimport type { Agent } from \"@/lib/gateway/protocol\";\nimport { getAgentAvatar } from \"@/lib/agent-avatars\";\nimport { cn } from \"@/lib/utils\";\n\ninterface SessionManagerPanelProps {\n  open: boolean;\n  onClose: () => void;\n  agents: Agent[];\n  sessions: GatewaySession[];\n  currentSessionKey?: string;\n  onSelectSession: (key: string) => void;\n  onDeleteSession: (key: string) => Promise<void>;\n  onResetSession: (key: string) => Promise<void>;\n}\n\nconst TYPE_ICONS: Record<string, React.ReactNode> = {\n  main: <Pin size={12} className=\"text-amber-400\" />,\n  thread: <MessageCircle size={12} className=\"text-blue-400\" />,\n  subagent: <Bot size={12} className=\"text-purple-400\" />,\n  cron: <Settings size={12} className=\"text-zinc-500\" />,\n  a2a: <Zap size={12} className=\"text-green-400\" />,\n  unknown: <MessageCircle size={12} className=\"text-zinc-600\" />,\n};\n\nconst TYPE_LABELS: Record<string, string> = {\n  main: \"메인\",\n  thread: \"스레드\",\n  subagent: \"서브에이전트\",\n  cron: \"크론\",\n  a2a: \"A2A\",\n  unknown: \"기타\",\n};\n\nfunction formatTokens(n?: number): string | null {\n  if (!n || n === 0) return null;\n  if (n >= 1_000_000) return `${(n / 1_000_000).toFixed(1)}M`;\n  if (n >= 1_000) return `${(n / 1_000).toFixed(1)}k`;\n  return String(n);\n}\n\nfunction relativeTime(ts?: number): string {\n  if (!ts) return \"—\";\n  const diff = Date.now() - ts;\n  if (diff < 60_000) return \"방금\";\n  if (diff < 3600_000) return `${Math.floor(diff / 60_000)}분 전`;\n  if (diff < 86400_000) return `${Math.floor(diff / 3600_000)}시간 전`;\n  return `${Math.floor(diff / 86400_000)}일 전`;\n}\n\ninterface AgentGroup {\n  agentId: string;\n  agent?: Agent;\n  sessions: (GatewaySession & { parsed: ReturnType<typeof parseSessionKey> })[];\n}\n\nexport function SessionManagerPanel({\n  open,\n  onClose,\n  agents,\n  sessions,\n  currentSessionKey,\n  onSelectSession,\n  onDeleteSession,\n  onResetSession,\n}: SessionManagerPanelProps) {\n  const [expandedAgents, setExpandedAgents] = useState<Set<string>>(new Set());\n  const [confirmAction, setConfirmAction] = useState<{ key: string; action: \"delete\" | \"reset\" } | null>(null);\n  const [loading, setLoading] = useState(false);\n\n  // Group sessions by agent\n  const groups = useMemo(() => {\n    const map = new Map<string, AgentGroup>();\n    for (const s of sessions) {\n      const parsed = parseSessionKey(s.key);\n      const agentId = parsed.agentId;\n      if (!map.has(agentId)) {\n        map.set(agentId, {\n          agentId,\n          agent: agents.find((a) => a.id === agentId),\n          sessions: [],\n        });\n      }\n      map.get(agentId)!.sessions.push({ ...s, parsed });\n    }\n\n    // Sort sessions within each group: main first, then by updatedAt\n    for (const group of map.values()) {\n      group.sessions.sort((a, b) => {\n        if (a.parsed.type === \"main\" && b.parsed.type !== \"main\") return -1;\n        if (b.parsed.type === \"main\" && a.parsed.type !== \"main\") return 1;\n        return (b.updatedAt || 0) - (a.updatedAt || 0);\n      });\n    }\n\n    // Sort groups by most recent session\n    return Array.from(map.values()).sort((a, b) => {\n      const aTime = a.sessions[0]?.updatedAt || 0;\n      const bTime = b.sessions[0]?.updatedAt || 0;\n      return bTime - aTime;\n    });\n  }, [sessions, agents]);\n\n  // Auto-expand current agent\n  const currentParsed = currentSessionKey ? parseSessionKey(currentSessionKey) : null;\n  const effectiveExpanded = useMemo(() => {\n    const set = new Set(expandedAgents);\n    if (currentParsed) set.add(currentParsed.agentId);\n    return set;\n  }, [expandedAgents, currentParsed]);\n\n  const toggleAgent = useCallback((agentId: string) => {\n    setExpandedAgents((prev) => {\n      const next = new Set(prev);\n      if (next.has(agentId)) next.delete(agentId);\n      else next.add(agentId);\n      return next;\n    });\n  }, []);\n\n  const handleAction = useCallback(async () => {\n    if (!confirmAction) return;\n    setLoading(true);\n    try {\n      if (confirmAction.action === \"delete\") await onDeleteSession(confirmAction.key);\n      else await onResetSession(confirmAction.key);\n    } finally {\n      setLoading(false);\n      setConfirmAction(null);\n    }\n  }, [confirmAction, onDeleteSession, onResetSession]);\n\n  const bulkDeleteIdle = useCallback(async (agentId: string) => {\n    const group = groups.find((g) => g.agentId === agentId);\n    if (!group) return;\n    const now = Date.now();\n    const idleSessions = group.sessions.filter(\n      (s) => s.parsed.type !== \"main\" && s.updatedAt && now - s.updatedAt > 24 * 60 * 60 * 1000\n    );\n    setLoading(true);\n    try {\n      for (const s of idleSessions) {\n        await onDeleteSession(s.key);\n      }\n    } finally {\n      setLoading(false);\n    }\n  }, [groups, onDeleteSession]);\n\n  if (!open) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-[170]\" role=\"dialog\" aria-modal=\"true\">\n      <div className=\"absolute inset-0 bg-black/60\" onClick={onClose} />\n      <div className=\"absolute right-0 top-0 bottom-0 w-[min(92vw,420px)] border-l border-zinc-700 bg-zinc-900 shadow-2xl flex flex-col\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between border-b border-zinc-800 px-4 py-3\">\n          <h3 className=\"text-sm font-semibold text-zinc-100\">세션 관리</h3>\n          <button onClick={onClose} className=\"rounded px-2 py-1 text-xs text-zinc-400 hover:bg-zinc-800 hover:text-zinc-200\">\n            <X size={16} />\n          </button>\n        </div>\n\n        {/* Stats */}\n        <div className=\"flex items-center gap-4 border-b border-zinc-800 px-4 py-2 text-[11px] text-zinc-500\">\n          <span>{groups.length}개 에이전트</span>\n          <span>{sessions.length}개 세션</span>\n        </div>\n\n        {/* Agent groups */}\n        <div className=\"flex-1 overflow-y-auto\">\n          {groups.map((group) => {\n            const isExpanded = effectiveExpanded.has(group.agentId);\n            const av = getAgentAvatar(group.agentId);\n            const totalTokens = group.sessions.reduce((sum, s) => sum + (s.totalTokens || 0), 0);\n            const idleCount = group.sessions.filter(\n              (s) => s.parsed.type !== \"main\" && s.updatedAt && Date.now() - s.updatedAt > 24 * 60 * 60 * 1000\n            ).length;\n\n            return (\n              <div key={group.agentId} className=\"border-b border-zinc-800/50\">\n                {/* Agent header */}\n                <button\n                  onClick={() => toggleAgent(group.agentId)}\n                  className=\"flex w-full items-center gap-2.5 px-4 py-2.5 hover:bg-zinc-800/30 transition\"\n                >\n                  {isExpanded ? <ChevronDown size={12} className=\"text-zinc-500\" /> : <ChevronRight size={12} className=\"text-zinc-500\" />}\n                  <div className={cn(\"flex size-6 shrink-0 items-center justify-center rounded-full text-xs\", av.color)}>\n                    {av.emoji}\n                  </div>\n                  <span className=\"text-sm font-medium text-zinc-200 flex-1 text-left truncate\">\n                    {group.agent?.name || group.agentId}\n                  </span>\n                  <span className=\"text-[10px] text-zinc-600\">\n                    {group.sessions.length}개{formatTokens(totalTokens) ? ` · ${formatTokens(totalTokens)}` : \"\"}\n                  </span>\n                </button>\n\n                {/* Sessions list */}\n                {isExpanded && (\n                  <div className=\"pb-1\">\n                    {group.sessions.map((s) => {\n                      const isCurrent = s.key === currentSessionKey;\n                      const isMain = s.parsed.type === \"main\";\n                      const isConfirming = confirmAction?.key === s.key;\n                      const label = s.label || (isMain ? \"메인 세션\" : `${TYPE_LABELS[s.parsed.type] || \"세션\"} #${(s.parsed.detail || \"\").slice(0, 8)}`);\n                      const tokens = formatTokens(s.totalTokens);\n                      const time = relativeTime(s.updatedAt);\n\n                      return (\n                        <div\n                          key={s.key}\n                          className={cn(\n                            \"flex items-center gap-2 px-4 pl-10 py-2 hover:bg-zinc-800/30 transition group\",\n                            isCurrent && \"bg-zinc-800/50\"\n                          )}\n                        >\n                          {/* Type icon */}\n                          <span className=\"flex-shrink-0\">{TYPE_ICONS[s.parsed.type] || TYPE_ICONS.unknown}</span>\n\n                          {/* Label + meta */}\n                          <button\n                            onClick={() => { onSelectSession(s.key); onClose(); }}\n                            className=\"flex-1 min-w-0 text-left\"\n                          >\n                            <div className={cn(\"text-[12px] truncate\", isCurrent ? \"text-amber-400 font-medium\" : \"text-zinc-300\")}>\n                              {label}\n                            </div>\n                            <div className=\"flex items-center gap-2 text-[10px] text-zinc-600\">\n                              {tokens && <span>{tokens} tok</span>}\n                              <span>{time}</span>\n                              {s.model && <span className=\"truncate max-w-[100px]\">{s.model.split(\"/\").pop()}</span>}\n                            </div>\n                          </button>\n\n                          {/* Actions */}\n                          {isConfirming ? (\n                            <div className=\"flex items-center gap-1\">\n                              <button\n                                onClick={handleAction}\n                                disabled={loading}\n                                className=\"rounded px-1.5 py-0.5 text-[10px] bg-red-600/80 text-white hover:bg-red-600\"\n                              >\n                                확인\n                              </button>\n                              <button\n                                onClick={() => setConfirmAction(null)}\n                                className=\"rounded px-1.5 py-0.5 text-[10px] bg-zinc-700 text-zinc-300 hover:bg-zinc-600\"\n                              >\n                                취소\n                              </button>\n                            </div>\n                          ) : (\n                            <div className=\"flex items-center gap-0.5 opacity-0 group-hover:opacity-100 transition-opacity\">\n                              <button\n                                onClick={() => setConfirmAction({ key: s.key, action: \"reset\" })}\n                                className=\"rounded p-1 text-zinc-600 hover:bg-zinc-800 hover:text-zinc-300\"\n                                title=\"리셋\"\n                              >\n                                <RotateCcw size={11} />\n                              </button>\n                              {!isMain && (\n                                <button\n                                  onClick={() => setConfirmAction({ key: s.key, action: \"delete\" })}\n                                  className=\"rounded p-1 text-zinc-600 hover:bg-zinc-800 hover:text-red-400\"\n                                  title=\"삭제\"\n                                >\n                                  <Trash2 size={11} />\n                                </button>\n                              )}\n                            </div>\n                          )}\n                        </div>\n                      );\n                    })}\n\n                    {/* Bulk cleanup */}\n                    {idleCount > 0 && (\n                      <button\n                        onClick={() => bulkDeleteIdle(group.agentId)}\n                        disabled={loading}\n                        className=\"mx-4 mb-2 mt-1 flex w-[calc(100%-2rem)] items-center justify-center gap-1.5 rounded-md bg-zinc-800/50 py-1.5 text-[10px] text-zinc-500 hover:bg-zinc-800 hover:text-zinc-300 transition\"\n                      >\n                        <Clock size={10} />\n                        비활성 세션 {idleCount}개 정리\n                      </button>\n                    )}\n                  </div>\n                )}\n              </div>\n            );\n          })}\n\n          {groups.length === 0 && (\n            <div className=\"py-12 text-center text-sm text-zinc-500\">세션 없음</div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 7394, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/chat/chat-panel.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useCallback, useEffect, useRef } from \"react\";\nimport { useGateway, useChat, useAgents, useSessions } from \"@/lib/gateway/hooks\";\nimport { MessageList } from \"./message-list\";\nimport { ChatInput } from \"./chat-input\";\nimport { AvatarAgentSelector } from \"./avatar-agent-selector\";\nimport { AgentSelector } from \"./agent-selector\";\nimport { SessionSwitcher } from \"./session-switcher\";\nimport { DropZone, useFileAttachments, attachmentToPayload } from \"./file-attachments\";\nimport { parseSessionKey, sessionDisplayName, type GatewaySession } from \"@/lib/gateway/session-utils\";\nimport { TaskMemo } from \"./task-memo\";\nimport { SessionSettings } from \"@/components/settings/session-settings\";\nimport { ChatHeader } from \"./chat-header\";\nimport { matchesShortcutId } from \"@/lib/shortcuts\";\nimport { NewSessionPicker, AgentManager } from \"@/components/settings/agent-manager\";\nimport { SessionManagerPanel } from \"./session-manager-panel\";\n\nexport interface ChatPanelProps {\n  /** Panel id for focus management */\n  panelId: string;\n  /** Whether this panel is the active/focused one */\n  isActive: boolean;\n  /** Called when this panel gains focus */\n  onFocus: () => void;\n  /** Show header controls (agent selector, session switcher) */\n  showHeader?: boolean;\n}\n\nexport function ChatPanel({ panelId, isActive, onFocus, showHeader = true }: ChatPanelProps) {\n  const { client, state, mainSessionKey } = useGateway();\n\n  const storagePrefix = `awf:panel:${panelId}:`;\n\n  const [sessionKey, setSessionKeyRaw] = useState<string | undefined>(undefined);\n  const [agentId, setAgentId] = useState<string>(process.env.NEXT_PUBLIC_DEFAULT_AGENT || \"default\");\n\n  // Load persisted panel state on mount (client only)\n  useEffect(() => {\n    if (typeof window === \"undefined\") return;\n    const savedSession = localStorage.getItem(`${storagePrefix}sessionKey`) || undefined;\n    const savedAgent = localStorage.getItem(`${storagePrefix}agentId`) || process.env.NEXT_PUBLIC_DEFAULT_AGENT || \"default\";\n    setSessionKeyRaw(savedSession);\n    setAgentId(savedAgent);\n  }, [storagePrefix]);\n\n  const setSessionKey = useCallback((key: string | undefined) => {\n    setSessionKeyRaw(key);\n    if (typeof window !== \"undefined\") {\n      if (key) localStorage.setItem(`${storagePrefix}sessionKey`, key);\n      else localStorage.removeItem(`${storagePrefix}sessionKey`);\n    }\n  }, [storagePrefix]);\n\n  const effectiveSessionKey =\n    sessionKey || (agentId ? `agent:${agentId}:main` : mainSessionKey) || undefined;\n\n  const { messages, streaming, loading, sendMessage, addUserMessage, cancelQueued, abort } = useChat(effectiveSessionKey);\n  const { agents } = useAgents();\n  const { sessions, loading: sessionsLoading, refresh: refreshSessions } = useSessions();\n\n  const { attachments, addFiles, removeAttachment, clearAttachments } = useFileAttachments();\n\n  const [sessionSwitcherOpen, setSessionSwitcherOpen] = useState(false);\n  const [newSessionPickerOpen, setNewSessionPickerOpen] = useState(false);\n  const [agentManagerOpen, setAgentManagerOpen] = useState(false);\n  const [sessionManagerOpen, setSessionManagerOpen] = useState(false);\n  const panelRef = useRef<HTMLDivElement>(null);\n\n  // Shortcuts (active panel only)\n  useEffect(() => {\n    function handleKeyDown(e: KeyboardEvent) {\n      if (!isActive) return;\n      if (matchesShortcutId(e, \"session-switcher\")) {\n        e.preventDefault();\n        setSessionSwitcherOpen((prev) => !prev);\n      }\n      if (matchesShortcutId(e, \"new-session\")) {\n        e.preventDefault();\n        setNewSessionPickerOpen(true);\n      }\n    }\n    document.addEventListener(\"keydown\", handleKeyDown);\n    return () => document.removeEventListener(\"keydown\", handleKeyDown);\n  }, [isActive, agentId, setSessionKey, refreshSessions]);\n\n  // Restore focus to this panel's textarea\n  const refocusPanel = useCallback(() => {\n    setTimeout(() => {\n      const textarea = panelRef.current?.querySelector(\"textarea\");\n      textarea?.focus();\n    }, 50);\n  }, []);\n\n  // Focus textarea when panel becomes active\n  useEffect(() => {\n    if (isActive) refocusPanel();\n  }, [isActive, refocusPanel]);\n\n  const isConnected = state === \"connected\";\n\n  const makeDefaultThreadLabel = useCallback((agent: string) => {\n    const now = new Date();\n    const mm = String(now.getMonth() + 1).padStart(2, \"0\");\n    const dd = String(now.getDate()).padStart(2, \"0\");\n    const hh = String(now.getHours()).padStart(2, \"0\");\n    const min = String(now.getMinutes()).padStart(2, \"0\");\n    return `${agent}/작업-${mm}${dd}-${hh}${min}`;\n  }, []);\n\n  const summarizeLabelFromText = useCallback((text: string, agent: string) => {\n    const clean = text\n      .replace(/^\\/(new|reset|status|help|reasoning|model\\s+\\S+|think\\S*|verbose\\S*)\\b/gi, \"\")\n      .replace(/\\s+/g, \" \")\n      .trim();\n    if (!clean) return makeDefaultThreadLabel(agent);\n    const snippet = clean.length > 40 ? `${clean.slice(0, 38)}…` : clean;\n    return `${agent}/${snippet}`;\n  }, [makeDefaultThreadLabel]);\n\n  async function maybeAutoLabelSession(key: string | undefined, text: string) {\n    if (!client || !isConnected || !key) return;\n    const parsed = parseSessionKey(key);\n    // Only auto-label main and thread sessions\n    if (parsed.type !== \"thread\" && parsed.type !== \"main\") return;\n\n    const session = (sessions as GatewaySession[]).find((s) => s.key === key);\n    const currentLabel = (session?.label || \"\").trim();\n    const isAutoOrEmpty =\n      !currentLabel ||\n      /스레드\\s*#|thread\\s*#|^thread[:\\s-]|작업-\\d{4}/i.test(currentLabel);\n\n    if (!isAutoOrEmpty) return;\n\n    // Skip slash commands\n    const clean = text.replace(/^\\/(new|reset|status|help|reasoning|model\\s+\\S+|think\\S*|verbose\\S*)\\b/gi, \"\").trim();\n    if (!clean) return;\n\n    try {\n      const label = summarizeLabelFromText(clean, parsed.agentId);\n      await client.request(\"sessions.patch\", { key, label });\n      refreshSessions();\n    } catch (err) {\n      console.error(\"[AWF] auto-label session failed:\", err);\n    }\n  }\n\n  const handleSend = useCallback(\n    async (text: string) => {\n      const trimmed = text.trim().toLowerCase();\n\n      // /stop — abort streaming\n      if (trimmed === \"/stop\" || trimmed === \"stop\" || trimmed === \"esc\" || trimmed === \"abort\") {\n        abort();\n        return;\n      }\n\n      // /new, /reset — send to gateway, then refresh sessions\n      if (trimmed === \"/new\" || trimmed === \"/reset\" || trimmed.startsWith(\"/new \") || trimmed.startsWith(\"/reset \")) {\n        sendMessage(text);\n        refreshSessions();\n        return;\n      }\n\n      // /status, /reasoning, /model, /help — pass to gateway as chat.send\n      if (trimmed === \"/status\" || trimmed === \"/reasoning\" || trimmed === \"/help\" ||\n          trimmed.startsWith(\"/model \") || trimmed === \"/model\") {\n        sendMessage(text);\n        // Force quick metadata refresh for header badge (model/tokens)\n        setTimeout(() => refreshSessions(), 400);\n        setTimeout(() => refreshSessions(), 1200);\n        return;\n      }\n\n      if (attachments.length > 0) {\n        await maybeAutoLabelSession(effectiveSessionKey, text);\n        const payloads = await Promise.all(attachments.map(attachmentToPayload));\n        const userMsg = text || \"\";\n        const displayAtts = attachments.map((att) => ({\n          fileName: att.file.name,\n          mimeType: att.file.type || \"application/octet-stream\",\n          dataUrl: att.preview || undefined,\n        }));\n        addUserMessage(userMsg || \"(첨부 파일)\", displayAtts);\n        if (client && isConnected) {\n          try {\n            await client.request(\"chat.send\", {\n              message: userMsg,\n              idempotencyKey: `awf-${Date.now()}-${Math.random().toString(36).slice(2)}`,\n              sessionKey: effectiveSessionKey,\n              attachments: payloads,\n            });\n          } catch (err) {\n            console.error(\"[AWF] chat.send with attachments error:\", err);\n          }\n        }\n        clearAttachments();\n      } else {\n        await maybeAutoLabelSession(effectiveSessionKey, text);\n        sendMessage(text);\n      }\n    },\n    [attachments, client, isConnected, effectiveSessionKey, clearAttachments, sendMessage, addUserMessage, abort, refreshSessions, sessions, summarizeLabelFromText]\n  );\n\n  const handleAgentChange = (id: string | undefined) => {\n    const newId = id || process.env.NEXT_PUBLIC_DEFAULT_AGENT || \"default\";\n    setAgentId(newId);\n    if (typeof window !== \"undefined\") {\n      localStorage.setItem(`${storagePrefix}agentId`, newId);\n    }\n    setSessionKey(undefined);\n  };\n\n    const handleNewSession = () => {\n    setNewSessionPickerOpen(true);\n  };\n\n  const createSessionForAgent = async (selectedAgentId: string) => {\n    const threadId = Date.now().toString(36) + Math.random().toString(36).slice(2, 6);\n    const newKey = `agent:${selectedAgentId}:main:thread:${threadId}`;\n\n    // Switch agent context if different\n    if (selectedAgentId !== agentId) {\n      setAgentId(selectedAgentId);\n      if (typeof window !== \"undefined\") {\n        localStorage.setItem(`${storagePrefix}agentId`, selectedAgentId);\n      }\n    }\n\n    setSessionKey(newKey);\n\n    // Pre-label the thread\n    if (client && isConnected) {\n      try {\n        await client.request(\"sessions.patch\", {\n          key: newKey,\n          label: makeDefaultThreadLabel(selectedAgentId),\n        });\n      } catch {\n        // ignore; auto-labeled on first message\n      }\n    }\n\n    refreshSessions();\n    refocusPanel();\n  };\n\n  const handleRename = useCallback(\n    async (key: string, label: string) => {\n      if (!client || !isConnected) return;\n      try {\n        await client.request(\"sessions.patch\", { key, label });\n        await refreshSessions();\n      } catch (err) {\n        console.error(\"[AWF] sessions.patch error:\", err);\n      } finally {\n        refocusPanel();\n      }\n    },\n    [client, isConnected, refreshSessions, refocusPanel]\n  );\n\n  const handleDelete = useCallback(\n    async (key: string) => {\n      if (!client || !isConnected) return;\n      try {\n        await client.request(\"sessions.delete\", { key });\n        if (sessionKey === key) setSessionKey(undefined);\n        await refreshSessions();\n      } catch (err) {\n        console.error(\"[AWF] sessions.delete error:\", err);\n      } finally {\n        refocusPanel();\n      }\n    },\n    [client, isConnected, sessionKey, setSessionKey, refreshSessions, refocusPanel]\n  );\n\n  const handleReset = useCallback(\n    async (key: string) => {\n      if (!client || !isConnected) return;\n      try {\n        await client.request(\"sessions.reset\", { key });\n        await refreshSessions();\n      } catch (err) {\n        console.error(\"[AWF] sessions.reset error:\", err);\n      } finally {\n        refocusPanel();\n      }\n    },\n    [client, isConnected, refreshSessions, refocusPanel]\n  );\n\n  // Derive agent from session key\n  const parsedSession = effectiveSessionKey ? parseSessionKey(effectiveSessionKey) : null;\n  const currentAgentId = parsedSession?.agentId || agentId;\n\n  // Find current session metadata\n  const currentSession = (sessions as GatewaySession[]).find(\n    (s) => s.key === effectiveSessionKey || s.key === sessionKey\n  );\n  const tokenCount = currentSession?.totalTokens;\n  const tokenStr = tokenCount != null && tokenCount > 0\n    ? tokenCount >= 1_000_000\n      ? `${(tokenCount / 1_000_000).toFixed(1)}M`\n      : tokenCount >= 1_000\n        ? `${(tokenCount / 1_000).toFixed(0)}k`\n        : `${tokenCount}`\n    : null;\n\n  return (\n    <div\n      ref={panelRef}\n      className=\"relative flex h-full flex-col bg-background\"\n      onClick={onFocus}\n    >\n      {/* Chat Header — agent name + topic */}\n      {showHeader && effectiveSessionKey && (\n        <ChatHeader\n          sessionKey={effectiveSessionKey}\n          agents={agents}\n          sessions={sessions as unknown as Array<Record<string, unknown>>}\n          messages={messages as unknown as Array<Record<string, unknown>>}\n          onSelectSession={setSessionKey}\n          onNewSession={handleNewSession}\n          onDeleteSession={(key) => handleDelete(key)}\n          onRenameSession={(key, label) => handleRename(key, label)}\n          onOpenSessionManager={() => setSessionManagerOpen(true)}\n        />\n      )}\n\n      {/* Task Memo */}\n      {effectiveSessionKey && (\n        <TaskMemo key={effectiveSessionKey} sessionKey={effectiveSessionKey} messages={messages as unknown as Array<Record<string, unknown>>} />\n      )}\n\n      {/* Messages */}\n      <DropZone onDrop={addFiles}>\n        <MessageList messages={messages} loading={loading} streaming={streaming} onCancelQueued={cancelQueued} />\n      </DropZone>\n\n      {/* Input with integrated toolbar */}\n      <ChatInput\n        onSend={handleSend}\n        onAbort={abort}\n        streaming={streaming}\n        disabled={!isConnected}\n        attachments={attachments}\n        onAttachFiles={addFiles}\n        onRemoveAttachment={removeAttachment}\n        panelId={panelId}\n        toolbar={showHeader ? (\n          <>\n            <SessionSwitcher\n              sessions={sessions as GatewaySession[]}\n              currentKey={sessionKey}\n              onSelect={setSessionKey}\n              onNew={handleNewSession}\n              onRename={handleRename}\n              onDelete={handleDelete}\n              onReset={handleReset}\n              open={sessionSwitcherOpen}\n              onOpenChange={setSessionSwitcherOpen}\n              portalContainer={panelRef.current}\n            />\n            <div className=\"ml-auto flex items-center gap-2\">\n              {currentSession?.model && (\n                <span className=\"text-[10px] text-muted-foreground\" title={currentSession.model}>\n                  {currentSession.model.split(\"/\").pop()}\n                </span>\n              )}\n              {tokenStr && (\n                <span className=\"text-[10px] text-muted-foreground\">{tokenStr} tokens</span>\n              )}\n            </div>\n          </>\n        ) : undefined}\n      />\n\n      {/* New Session Picker */}\n      <NewSessionPicker\n        open={newSessionPickerOpen}\n        onClose={() => setNewSessionPickerOpen(false)}\n        onSelect={createSessionForAgent}\n        onManageAgents={() => setAgentManagerOpen(true)}\n      />\n\n      {/* Agent Manager */}\n      <AgentManager\n        open={agentManagerOpen}\n        onClose={() => setAgentManagerOpen(false)}\n      />\n\n      {/* Session Manager Panel */}\n      <SessionManagerPanel\n        open={sessionManagerOpen}\n        onClose={() => setSessionManagerOpen(false)}\n        agents={agents}\n        sessions={sessions as any}\n        currentSessionKey={effectiveSessionKey}\n        onSelectSession={(key) => { setSessionKey(key); setSessionManagerOpen(false); }}\n        onDeleteSession={async (key) => { await handleDelete(key); }}\n        onResetSession={async (key) => { await handleReset(key); }}\n      />\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 7909, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/chat/split-view.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useCallback, useRef, useEffect } from \"react\";\nimport { ChatPanel } from \"./chat-panel\";\nimport { useIsMobile } from \"@/lib/hooks/use-mobile\";\nimport { ChevronLeft, ChevronRight, X } from \"lucide-react\";\nimport { matchesShortcutId } from \"@/lib/shortcuts\";\n\nfunction uid() {\n  return Math.random().toString(36).slice(2, 8);\n}\n\n// --- Types ---\n\ninterface PanelState {\n  id: string;\n  /** Flex-basis width in fractions (not percentages). All panels sum to 1. */\n  width: number;\n}\n\ninterface SplitState {\n  panels: PanelState[];\n  activePanelId: string;\n}\n\n// --- Storage helpers ---\n\nconst STORAGE_KEY = \"awf:split-panels\";\n\nfunction loadState(): SplitState | null {\n  if (typeof window === \"undefined\") return null;\n  try {\n    const raw = localStorage.getItem(STORAGE_KEY);\n    if (!raw) return null;\n    const parsed = JSON.parse(raw) as SplitState;\n    if (parsed.panels?.length >= 1) return parsed;\n  } catch {}\n  return null;\n}\n\nfunction saveState(state: SplitState) {\n  if (typeof window === \"undefined\") return;\n  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));\n}\n\nfunction defaultState(): SplitState {\n  // Must be deterministic for SSR/client hydration match\n  const id = \"panel-1\";\n  return { panels: [{ id, width: 1 }], activePanelId: id };\n}\n\n// --- Helpers ---\n\nfunction equalWidths(count: number): number {\n  return 1 / count;\n}\n\nconst MIN_PANEL_PX = 200;\n\n// --- Component ---\n\nexport interface SplitViewProps {\n  /** Number of panels requested. Controlled from parent via addPanel/removePanel. */\n  panelCount?: number;\n  /** Called by parent to imperatively add a panel */\n  onAddPanel?: () => void;\n}\n\nexport function SplitView() {\n  const [state, setState] = useState<SplitState>(defaultState);\n  const [hydrated, setHydrated] = useState(false);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const dragRef = useRef<{ index: number; startX: number; startWidths: number[] } | null>(null);\n  const closedPanelsRef = useRef<PanelState[]>([]);\n  const isMobile = useIsMobile();\n\n  // Restore from localStorage after hydration\n  useEffect(() => {\n    const saved = loadState();\n    if (saved) setState(saved);\n    setHydrated(true);\n  }, []);\n\n  // Persist on change (debounced to avoid thrashing on rapid switches)\n  useEffect(() => {\n    if (!hydrated) return;\n    const timer = setTimeout(() => saveState(state), 200);\n    return () => clearTimeout(timer);\n  }, [state, hydrated]);\n\n  // --- Panel management ---\n\n  const addPanel = useCallback(() => {\n    setState((prev) => {\n      const newId = uid();\n      const count = prev.panels.length + 1;\n      const w = equalWidths(count);\n      const panels = [...prev.panels.map((p) => ({ ...p, width: w })), { id: newId, width: w }];\n      return { panels, activePanelId: newId };\n    });\n  }, []);\n\n  const removePanel = useCallback((id: string) => {\n    setState((prev) => {\n      if (prev.panels.length <= 1) return prev;\n      const removed = prev.panels.find((p) => p.id === id);\n      if (removed) closedPanelsRef.current.push(removed);\n      const remaining = prev.panels.filter((p) => p.id !== id);\n      const w = equalWidths(remaining.length);\n      const panels = remaining.map((p) => ({ ...p, width: w }));\n      const activePanelId =\n        prev.activePanelId === id ? panels[0].id : prev.activePanelId;\n      return { panels, activePanelId };\n    });\n  }, []);\n\n  const reopenLastClosedPanel = useCallback(() => {\n    setState((prev) => {\n      const last = closedPanelsRef.current.pop();\n      if (!last) return prev;\n      const count = prev.panels.length + 1;\n      const w = equalWidths(count);\n      const panels = [...prev.panels.map((p) => ({ ...p, width: w })), { ...last, width: w }];\n      return { panels, activePanelId: last.id };\n    });\n  }, []);\n\n  const setActive = useCallback((id: string) => {\n    setState((prev) => (prev.activePanelId === id ? prev : { ...prev, activePanelId: id }));\n  }, []);\n\n  /** Navigate focus to prev (-1) or next (+1) panel */\n  const navPanel = useCallback((dir: -1 | 1) => {\n    setState((prev) => {\n      const len = prev.panels.length;\n      if (len <= 1) return prev;\n      const idx = prev.panels.findIndex((p) => p.id === prev.activePanelId);\n      const next = (idx + dir + len) % len; // wrap around\n      if (next === idx) return prev;\n      return { ...prev, activePanelId: prev.panels[next].id };\n    });\n  }, []);\n\n  /** Move a panel's position left/right */\n  const movePanel = useCallback((id: string, dir: -1 | 1) => {\n    setState((prev) => {\n      const idx = prev.panels.findIndex((p) => p.id === id);\n      const next = idx + dir;\n      if (idx < 0 || next < 0 || next >= prev.panels.length) return prev;\n      const panels = [...prev.panels];\n      [panels[idx], panels[next]] = [panels[next], panels[idx]];\n      return { ...prev, panels };\n    });\n  }, []);\n\n  /** Move currently focused panel */\n  const moveActivePanel = useCallback((dir: -1 | 1) => {\n    setState((prev) => {\n      const idx = prev.panels.findIndex((p) => p.id === prev.activePanelId);\n      const next = idx + dir;\n      if (idx < 0 || next < 0 || next >= prev.panels.length) return prev;\n      const panels = [...prev.panels];\n      [panels[idx], panels[next]] = [panels[next], panels[idx]];\n      return { ...prev, panels };\n    });\n  }, []);\n\n  // Expose functions globally so chat-view can call them\n  useEffect(() => {\n    (window as any).__awfSplitAddPanel = addPanel;\n    (window as any).__awfSplitNavPanel = navPanel;\n    (window as any).__awfSplitCloseActivePanel = () => removePanel(state.activePanelId);\n    (window as any).__awfSplitReopenLastPanel = reopenLastClosedPanel;\n    (window as any).__awfSplitFocusPanel = (index: number) => {\n      setState((prev) => {\n        if (index < 0 || index >= prev.panels.length) return prev;\n        return { ...prev, activePanelId: prev.panels[index].id };\n      });\n    };\n    return () => {\n      delete (window as any).__awfSplitAddPanel;\n      delete (window as any).__awfSplitNavPanel;\n      delete (window as any).__awfSplitCloseActivePanel;\n      delete (window as any).__awfSplitReopenLastPanel;\n      delete (window as any).__awfSplitFocusPanel;\n    };\n  });\n\n  // Customizable shortcuts — resolved via matchesShortcutId\n  useEffect(() => {\n    const handler = (e: KeyboardEvent) => {\n      if (matchesShortcutId(e, \"focus-left\")) {\n        e.preventDefault(); e.stopPropagation();\n        if (!e.repeat) navPanel(-1);\n      } else if (matchesShortcutId(e, \"focus-right\")) {\n        e.preventDefault(); e.stopPropagation();\n        if (!e.repeat) navPanel(1);\n      } else if (matchesShortcutId(e, \"swap-panels\")) {\n        e.preventDefault(); e.stopPropagation();\n        // Swap active panel with the next one (wraps around)\n        setState((prev) => {\n          if (prev.panels.length < 2) return prev;\n          const idx = prev.panels.findIndex((p) => p.id === prev.activePanelId);\n          const next = (idx + 1) % prev.panels.length;\n          const panels = [...prev.panels];\n          [panels[idx], panels[next]] = [panels[next], panels[idx]];\n          return { ...prev, panels };\n        });\n      } else if (matchesShortcutId(e, \"close-panel\")) {\n        e.preventDefault(); e.stopPropagation();\n        removePanel(state.activePanelId);\n      } else if (matchesShortcutId(e, \"reopen-panel\")) {\n        e.preventDefault(); e.stopPropagation();\n        reopenLastClosedPanel();\n      }\n    };\n    window.addEventListener(\"keydown\", handler);\n    return () => window.removeEventListener(\"keydown\", handler);\n  }, [navPanel, removePanel, reopenLastClosedPanel, state.activePanelId]);\n\n  // --- Resize ---\n\n  const handleMouseDown = useCallback((index: number, e: React.MouseEvent) => {\n    e.preventDefault();\n    dragRef.current = {\n      index,\n      startX: e.clientX,\n      startWidths: state.panels.map((p) => p.width),\n    };\n    document.body.style.cursor = \"col-resize\";\n    document.body.style.userSelect = \"none\";\n  }, [state.panels]);\n\n  useEffect(() => {\n    const handleMouseMove = (e: MouseEvent) => {\n      const drag = dragRef.current;\n      if (!drag || !containerRef.current) return;\n      const containerWidth = containerRef.current.getBoundingClientRect().width;\n      const dx = e.clientX - drag.startX;\n      const dFrac = dx / containerWidth;\n\n      const minFrac = MIN_PANEL_PX / containerWidth;\n      const widths = [...drag.startWidths];\n      const i = drag.index;\n\n      let newLeft = widths[i] + dFrac;\n      let newRight = widths[i + 1] - dFrac;\n\n      if (newLeft < minFrac) {\n        newLeft = minFrac;\n        newRight = widths[i] + widths[i + 1] - minFrac;\n      }\n      if (newRight < minFrac) {\n        newRight = minFrac;\n        newLeft = widths[i] + widths[i + 1] - minFrac;\n      }\n\n      widths[i] = newLeft;\n      widths[i + 1] = newRight;\n\n      setState((prev) => ({\n        ...prev,\n        panels: prev.panels.map((p, idx) => ({ ...p, width: widths[idx] ?? p.width })),\n      }));\n    };\n\n    const handleMouseUp = () => {\n      if (dragRef.current) {\n        dragRef.current = null;\n        document.body.style.cursor = \"\";\n        document.body.style.userSelect = \"\";\n      }\n    };\n\n    document.addEventListener(\"mousemove\", handleMouseMove);\n    document.addEventListener(\"mouseup\", handleMouseUp);\n    return () => {\n      document.removeEventListener(\"mousemove\", handleMouseMove);\n      document.removeEventListener(\"mouseup\", handleMouseUp);\n    };\n  }, []);\n\n  // --- Render ---\n\n  const { panels, activePanelId } = state;\n\n  // Mobile: show only the active panel\n  const visiblePanels = isMobile\n    ? panels.filter((p) => p.id === activePanelId)\n    : panels;\n\n  return (\n    <div ref={containerRef} className=\"flex h-full\">\n      {visiblePanels.map((panel, i) => (\n        <div key={panel.id} className={`flex h-full min-w-0 ${!isMobile ? \"px-1 first:pl-2 last:pr-2\" : \"\"}`} style={{ flex: isMobile ? \"1 0 0%\" : `${panel.width} 0 0%` }}>\n          {/* Panel */}\n          <div\n            className={`relative h-full min-w-0 flex-1 overflow-hidden ${\n              !isMobile ? \"rounded-lg transition-all duration-300\" : \"\"\n            }`}\n            style={!isMobile ? (\n              panel.id === activePanelId\n                ? {\n                    border: \"2px solid rgba(255, 107, 53, 0.5)\",\n                    boxShadow: \"0 0 10px rgba(255, 107, 53, 0.2), 0 0 25px rgba(255, 107, 53, 0.08), inset 0 0 10px rgba(255, 107, 53, 0.03)\",\n                  }\n                : {\n                    border: \"1px solid rgba(34, 34, 34, 0.8)\",\n                    boxShadow: \"none\",\n                  }\n            ) : undefined}\n            onClick={() => setActive(panel.id)}\n            onFocusCapture={() => setActive(panel.id)}\n          >\n            {/* Panel controls (desktop only, multi-panel) */}\n            {!isMobile && panels.length > 1 && (\n              <div className=\"absolute right-2 top-2 z-30 flex items-center gap-0.5 rounded-md border border-border bg-background/80 p-0.5 backdrop-blur\">\n                <button\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    movePanel(panel.id, -1);\n                  }}\n                  disabled={i === 0}\n                  className=\"rounded p-0.5 text-muted-foreground transition enabled:hover:bg-muted enabled:hover:text-foreground disabled:opacity-30\"\n                  title=\"패널 왼쪽으로 이동\"\n                >\n                  <ChevronLeft size={13} />\n                </button>\n                <button\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    movePanel(panel.id, 1);\n                  }}\n                  disabled={i === panels.length - 1}\n                  className=\"rounded p-0.5 text-muted-foreground transition enabled:hover:bg-muted enabled:hover:text-foreground disabled:opacity-30\"\n                  title=\"패널 오른쪽으로 이동\"\n                >\n                  <ChevronRight size={13} />\n                </button>\n                <button\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    removePanel(panel.id);\n                  }}\n                  className=\"rounded p-0.5 text-muted-foreground transition hover:bg-muted hover:text-foreground\"\n                  title=\"패널 닫기\"\n                >\n                  <X size={13} />\n                </button>\n              </div>\n            )}\n            <ChatPanel\n              panelId={panel.id}\n              isActive={panel.id === activePanelId}\n              onFocus={() => setActive(panel.id)}\n              showHeader={true}\n            />\n          </div>\n\n          {/* Resize handle between panels (desktop only) */}\n          {!isMobile && i < visiblePanels.length - 1 && (\n            <div\n              onMouseDown={(e) => handleMouseDown(i, e)}\n              className=\"group relative z-10 flex w-1 shrink-0 cursor-col-resize items-center justify-center bg-muted transition-colors hover:bg-primary\"\n            >\n              <div className=\"absolute inset-y-0 -left-1 -right-1\" />\n            </div>\n          )}\n        </div>\n      ))}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 8482, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/chat/shortcut-help-dialog.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect, useCallback } from \"react\";\nimport {\n  getEffectiveShortcuts,\n  loadCustomBindings,\n  saveCustomBindings,\n  eventToKeyString,\n  type ShortcutDef,\n  type CustomBindings,\n} from \"@/lib/shortcuts\";\nimport { Pencil, RotateCcw } from \"lucide-react\";\n\nexport function ShortcutHelpDialog({ open, onClose }: { open: boolean; onClose: () => void }) {\n  const [shortcuts, setShortcuts] = useState<ShortcutDef[]>([]);\n  const [customBindings, setCustomBindings] = useState<CustomBindings>({});\n  const [editingId, setEditingId] = useState<string | null>(null);\n  const [recording, setRecording] = useState(false);\n\n  // Load on open\n  useEffect(() => {\n    if (open) {\n      setShortcuts(getEffectiveShortcuts());\n      setCustomBindings(loadCustomBindings());\n      setEditingId(null);\n      setRecording(false);\n    }\n  }, [open]);\n\n  // Record key combo when editing\n  useEffect(() => {\n    if (!recording || !editingId) return;\n\n    const handler = (e: KeyboardEvent) => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      const keyStr = eventToKeyString(e);\n      if (!keyStr) return; // modifier-only press\n\n      // Save the new binding\n      const updated = { ...customBindings, [editingId]: keyStr };\n      setCustomBindings(updated);\n      saveCustomBindings(updated);\n      setShortcuts(getEffectiveShortcuts());\n      setEditingId(null);\n      setRecording(false);\n    };\n\n    // Use capture to intercept before other handlers\n    document.addEventListener(\"keydown\", handler, true);\n    return () => document.removeEventListener(\"keydown\", handler, true);\n  }, [recording, editingId, customBindings]);\n\n  const startEditing = useCallback((id: string) => {\n    setEditingId(id);\n    setRecording(true);\n  }, []);\n\n  const resetBinding = useCallback((id: string) => {\n    const updated = { ...customBindings };\n    delete updated[id];\n    setCustomBindings(updated);\n    saveCustomBindings(updated);\n    setShortcuts(getEffectiveShortcuts());\n    setEditingId(null);\n    setRecording(false);\n  }, [customBindings]);\n\n  const resetAll = useCallback(() => {\n    setCustomBindings({});\n    saveCustomBindings({});\n    setShortcuts(getEffectiveShortcuts());\n    setEditingId(null);\n    setRecording(false);\n  }, []);\n\n  if (!open) return null;\n\n  const hasCustom = Object.keys(customBindings).length > 0;\n\n  return (\n    <div className=\"fixed inset-0 z-[200]\" role=\"dialog\" aria-modal=\"true\">\n      <div className=\"absolute inset-0 bg-black/60\" onClick={onClose} />\n      <div className=\"absolute left-1/2 top-1/2 w-[min(92vw,640px)] -translate-x-1/2 -translate-y-1/2 rounded-xl border border-zinc-700 bg-zinc-900 shadow-2xl\">\n        <div className=\"flex items-center justify-between border-b border-zinc-800 px-4 py-3\">\n          <h3 className=\"text-sm font-semibold text-zinc-100\">Keyboard Shortcuts</h3>\n          <div className=\"flex items-center gap-2\">\n            {hasCustom && (\n              <button\n                onClick={resetAll}\n                className=\"flex items-center gap-1 rounded px-2 py-1 text-[10px] text-zinc-500 hover:bg-zinc-800 hover:text-zinc-300\"\n                title=\"모든 단축키 초기화\"\n              >\n                <RotateCcw size={10} />\n                전체 초기화\n              </button>\n            )}\n            <button onClick={onClose} className=\"rounded px-2 py-1 text-xs text-zinc-400 hover:bg-zinc-800 hover:text-zinc-200\">ESC</button>\n          </div>\n        </div>\n        <div className=\"max-h-[65vh] overflow-y-auto p-3\">\n          <p className=\"mb-3 text-[11px] text-zinc-500\">\n            단축키를 변경하려면 ✏️ 아이콘을 클릭 후 원하는 키 조합을 누르세요.\n          </p>\n          {shortcuts.map((s) => {\n            const isEditing = editingId === s.id && recording;\n            const isCustom = !!customBindings[s.id];\n\n            return (\n              <div key={s.id} className=\"flex items-center justify-between rounded-md px-2 py-2 hover:bg-zinc-800/50\">\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-sm text-zinc-200\">{s.description}</span>\n                  {isCustom && (\n                    <button\n                      onClick={() => resetBinding(s.id)}\n                      className=\"rounded p-0.5 text-zinc-600 hover:text-zinc-400\"\n                      title=\"기본값으로 복원\"\n                    >\n                      <RotateCcw size={10} />\n                    </button>\n                  )}\n                </div>\n                <div className=\"flex items-center gap-1.5\">\n                  {isEditing ? (\n                    <kbd className=\"animate-pulse rounded border border-amber-600 bg-amber-900/30 px-2 py-0.5 text-xs text-amber-300\">\n                      키 입력 대기중…\n                    </kbd>\n                  ) : (\n                    <kbd className={`rounded border px-2 py-0.5 text-xs ${\n                      isCustom\n                        ? \"border-amber-700 bg-amber-900/20 text-amber-300\"\n                        : \"border-zinc-700 bg-zinc-800 text-zinc-300\"\n                    }`}>\n                      {s.keys}\n                    </kbd>\n                  )}\n                  <button\n                    onClick={() => startEditing(s.id)}\n                    className=\"rounded p-1 text-zinc-600 hover:bg-zinc-800 hover:text-zinc-300\"\n                    title=\"단축키 변경\"\n                  >\n                    <Pencil size={11} />\n                  </button>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 8779, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/chat/chat-view.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { useGateway } from \"@/lib/gateway/hooks\";\nimport { useIsMobile } from \"@/lib/hooks/use-mobile\";\nimport { ConnectionStatus } from \"./connection-status\";\nimport { SplitView } from \"./split-view\";\nimport { ShortcutHelpDialog } from \"./shortcut-help-dialog\";\nimport { isShortcutHelp } from \"@/lib/shortcuts\";\nimport { Plus, Keyboard } from \"lucide-react\";\n\nexport function ChatView() {\n  const { state } = useGateway();\n  const isMobile = useIsMobile();\n  const [shortcutOpen, setShortcutOpen] = useState(false);\n  const [mounted, setMounted] = useState(false);\n\n  useEffect(() => {\n    setMounted(true);\n  }, []);\n\n  useEffect(() => {\n    function handleKeyDown(e: KeyboardEvent) {\n      if (isShortcutHelp(e)) {\n        e.preventDefault();\n        setShortcutOpen((v) => !v);\n        return;\n      }\n      if (e.key === \"Escape\") setShortcutOpen(false);\n\n      if ((e.metaKey || e.ctrlKey) && e.key === \"\\\\\") {\n        e.preventDefault();\n        (window as any).__awfSplitAddPanel?.();\n      }\n    }\n    document.addEventListener(\"keydown\", handleKeyDown);\n    return () => document.removeEventListener(\"keydown\", handleKeyDown);\n  }, []);\n\n  if (!mounted) return <div className=\"h-dvh bg-background\" />;\n\n  return (\n    <div className=\"flex h-dvh flex-col bg-background overflow-x-hidden max-w-[100vw]\">\n      <header className=\"relative z-20 flex items-center justify-between border-b border-border bg-background/80 px-3 py-2 md:px-4 md:py-2.5 backdrop-blur-sm\">\n        <div className=\"flex items-center gap-2 md:gap-3\">\n          <div className=\"flex items-center gap-2\">\n            <img src=\"/logo.svg\" alt=\"intelli-claw\" className=\"h-5 w-5 md:h-6 md:w-6\" />\n            <span className=\"text-sm font-semibold text-foreground\">intelli-claw</span>\n          </div>\n        </div>\n\n        <div className=\"flex items-center gap-2 md:gap-3\">\n          <ConnectionStatus state={state} />\n          <button\n            onClick={() => setShortcutOpen(true)}\n            className=\"flex items-center gap-1.5 rounded-lg px-2.5 py-1.5 text-xs font-medium text-muted-foreground transition hover:bg-muted hover:text-foreground\"\n            title=\"단축키 (Cmd+/)\"\n          >\n            <Keyboard size={14} />\n            <span className=\"hidden sm:inline\">단축키</span>\n          </button>\n          {!isMobile && (\n            <button\n              onClick={() => (window as any).__awfSplitAddPanel?.()}\n              className=\"flex items-center gap-1.5 rounded-lg px-2.5 py-1.5 text-xs font-medium text-muted-foreground transition hover:bg-muted hover:text-foreground\"\n              title=\"패널 추가 (Cmd+\\\\)\"\n            >\n              <Plus size={14} />\n              <span className=\"hidden sm:inline\">패널 추가</span>\n            </button>\n          )}\n        </div>\n      </header>\n\n      <div className=\"flex-1 overflow-hidden\">\n        <SplitView />\n      </div>\n\n      <ShortcutHelpDialog open={shortcutOpen} onClose={() => setShortcutOpen(false)} />\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;;AATA;;;;;;;;;AAWO,SAAS;;IACd,MAAM,EAAE,KAAK,EAAE,GAAG,IAAA,gJAAU;IAC5B,MAAM,WAAW,IAAA,sJAAW;IAC5B,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,2UAAQ,EAAC;IACjD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,2UAAQ,EAAC;IAEvC,IAAA,4UAAS;8BAAC;YACR,WAAW;QACb;6BAAG,EAAE;IAEL,IAAA,4UAAS;8BAAC;YACR,SAAS,cAAc,CAAgB;gBACrC,IAAI,IAAA,4IAAc,EAAC,IAAI;oBACrB,EAAE,cAAc;oBAChB;4DAAgB,CAAC,IAAM,CAAC;;oBACxB;gBACF;gBACA,IAAI,EAAE,GAAG,KAAK,UAAU,gBAAgB;gBAExC,IAAI,CAAC,EAAE,OAAO,IAAI,EAAE,OAAO,KAAK,EAAE,GAAG,KAAK,MAAM;wBAE9C,qBAAA;oBADA,EAAE,cAAc;qBAChB,sBAAA,CAAA,QAAC,QAAe,kBAAkB,cAAlC,0CAAA,yBAAA;gBACF;YACF;YACA,SAAS,gBAAgB,CAAC,WAAW;YACrC;sCAAO,IAAM,SAAS,mBAAmB,CAAC,WAAW;;QACvD;6BAAG,EAAE;IAEL,IAAI,CAAC,SAAS,qBAAO,+VAAC;QAAI,WAAU;;;;;;IAEpC,qBACE,+VAAC;QAAI,WAAU;;0BACb,+VAAC;gBAAO,WAAU;;kCAChB,+VAAC;wBAAI,WAAU;kCACb,cAAA,+VAAC;4BAAI,WAAU;;8CACb,+VAAC;oCAAI,KAAI;oCAAY,KAAI;oCAAe,WAAU;;;;;;8CAClD,+VAAC;oCAAK,WAAU;8CAAwC;;;;;;;;;;;;;;;;;kCAI5D,+VAAC;wBAAI,WAAU;;0CACb,+VAAC,yKAAgB;gCAAC,OAAO;;;;;;0CACzB,+VAAC;gCACC,SAAS,IAAM,gBAAgB;gCAC/B,WAAU;gCACV,OAAM;;kDAEN,+VAAC,6SAAQ;wCAAC,MAAM;;;;;;kDAChB,+VAAC;wCAAK,WAAU;kDAAmB;;;;;;;;;;;;4BAEpC,CAAC,0BACA,+VAAC;gCACC,SAAS;wCAAM,qBAAA;4CAAA,sBAAA,CAAA,QAAC,QAAe,kBAAkB,cAAlC,0CAAA,yBAAA;;gCACf,WAAU;gCACV,OAAM;;kDAEN,+VAAC,iSAAI;wCAAC,MAAM;;;;;;kDACZ,+VAAC;wCAAK,WAAU;kDAAmB;;;;;;;;;;;;;;;;;;;;;;;;0BAM3C,+VAAC;gBAAI,WAAU;0BACb,cAAA,+VAAC,2JAAS;;;;;;;;;;0BAGZ,+VAAC,iLAAkB;gBAAC,MAAM;gBAAc,SAAS,IAAM,gBAAgB;;;;;;;;;;;;AAG7E;GAtEgB;;QACI,gJAAU;QACX,sJAAW;;;KAFd","debugId":null}}]
}