{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/lib/hooks/use-mobile.ts"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from \"react\";\n\nconst MOBILE_BREAKPOINT = 768;\n\nexport function useIsMobile(): boolean {\n  const [isMobile, setIsMobile] = useState(false);\n\n  useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`);\n    const handler = (e: MediaQueryListEvent | MediaQueryList) => setIsMobile(e.matches);\n    handler(mql);\n    mql.addEventListener(\"change\", handler);\n    return () => mql.removeEventListener(\"change\", handler);\n  }, []);\n\n  return isMobile;\n}\n"],"names":[],"mappings":";;;;AAEA;AAFA;;AAIA,MAAM,oBAAoB;AAEnB,SAAS;IACd,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,mXAAQ,EAAC;IAEzC,IAAA,oXAAS,EAAC;QACR,MAAM,MAAM,OAAO,UAAU,CAAC,CAAC,YAAY,EAAE,oBAAoB,EAAE,GAAG,CAAC;QACvE,MAAM,UAAU,CAAC,IAA4C,YAAY,EAAE,OAAO;QAClF,QAAQ;QACR,IAAI,gBAAgB,CAAC,UAAU;QAC/B,OAAO,IAAM,IAAI,mBAAmB,CAAC,UAAU;IACjD,GAAG,EAAE;IAEL,OAAO;AACT","debugId":null}},
    {"offset": {"line": 27, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/chat/connection-status.tsx"],"sourcesContent":["\"use client\";\n\nimport type { ConnectionState } from \"@/lib/gateway/client\";\n\nconst STATUS_CONFIG: Record<\n  ConnectionState,\n  { label: string; color: string; pulse: boolean }\n> = {\n  disconnected: { label: \"연결 끊김\", color: \"bg-red-500\", pulse: false },\n  connecting: { label: \"연결 중...\", color: \"bg-yellow-500\", pulse: true },\n  authenticating: { label: \"인증 중...\", color: \"bg-yellow-500\", pulse: true },\n  connected: { label: \"연결됨\", color: \"bg-emerald-500\", pulse: false },\n};\n\nexport function ConnectionStatus({ state }: { state: ConnectionState }) {\n  const config = STATUS_CONFIG[state];\n\n  return (\n    <div className=\"flex items-center gap-1.5 text-xs text-muted-foreground\">\n      <span className=\"relative flex h-2 w-2\">\n        {config.pulse && (\n          <span\n            className={`absolute inline-flex h-full w-full animate-ping rounded-full ${config.color} opacity-75`}\n          />\n        )}\n        <span className={`relative inline-flex h-2 w-2 rounded-full ${config.color}`} />\n      </span>\n      <span>{config.label}</span>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAAA;;AAIA,MAAM,gBAGF;IACF,cAAc;QAAE,OAAO;QAAS,OAAO;QAAc,OAAO;IAAM;IAClE,YAAY;QAAE,OAAO;QAAW,OAAO;QAAiB,OAAO;IAAK;IACpE,gBAAgB;QAAE,OAAO;QAAW,OAAO;QAAiB,OAAO;IAAK;IACxE,WAAW;QAAE,OAAO;QAAO,OAAO;QAAkB,OAAO;IAAM;AACnE;AAEO,SAAS,iBAAiB,EAAE,KAAK,EAA8B;IACpE,MAAM,SAAS,aAAa,CAAC,MAAM;IAEnC,qBACE,gZAAC;QAAI,WAAU;;0BACb,gZAAC;gBAAK,WAAU;;oBACb,OAAO,KAAK,kBACX,gZAAC;wBACC,WAAW,CAAC,6DAA6D,EAAE,OAAO,KAAK,CAAC,WAAW,CAAC;;;;;;kCAGxG,gZAAC;wBAAK,WAAW,CAAC,0CAA0C,EAAE,OAAO,KAAK,EAAE;;;;;;;;;;;;0BAE9E,gZAAC;0BAAM,OAAO,KAAK;;;;;;;;;;;;AAGzB","debugId":null}},
    {"offset": {"line": 165, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/chat/markdown-renderer.tsx"],"sourcesContent":["\"use client\";\n\nimport { memo, useCallback, useEffect, useState } from \"react\";\nimport ReactMarkdown from \"react-markdown\";\nimport remarkGfm from \"remark-gfm\";\nimport rehypeHighlight from \"rehype-highlight\";\nimport {\n  Check, Copy, ExternalLink, Eye, Code2, Download,\n  FileText, FileAudio, FileVideo, File as FileIcon,\n  FileSpreadsheet, FileCode, FileArchive,\n} from \"lucide-react\";\nimport type { Components } from \"react-markdown\";\n\nfunction copyText(text: string) {\n  if (navigator.clipboard?.writeText) return navigator.clipboard.writeText(text);\n  const ta = document.createElement(\"textarea\");\n  ta.value = text;\n  ta.style.cssText = \"position:fixed;opacity:0\";\n  document.body.appendChild(ta);\n  ta.select();\n  document.execCommand(\"copy\");\n  document.body.removeChild(ta);\n  return Promise.resolve();\n}\n\nfunction isUrl(s: string) {\n  return /^https?:\\/\\/\\S+$/.test(s.trim());\n}\n\nfunction CopyableLink({ href, children }: { href: string; children: React.ReactNode }) {\n  const [copied, setCopied] = useState(false);\n  return (\n    <span className=\"inline-flex items-center gap-1 group/link\">\n      <a\n        href={href}\n        target=\"_blank\"\n        rel=\"noopener noreferrer\"\n        className=\"inline-flex items-center gap-0.5\"\n        onClick={(e) => {\n          e.preventDefault();\n          copyText(href).then(() => {\n            setCopied(true);\n            setTimeout(() => setCopied(false), 1500);\n          });\n        }}\n        title=\"클릭하면 복사 · 길게 누르면 열기\"\n      >\n        {children}\n        {copied\n          ? <Check size={11} className=\"text-emerald-400 inline\" />\n          : <Copy size={11} className=\"opacity-40 group-hover/link:opacity-100 inline\" />\n        }\n      </a>\n      <a\n        href={href}\n        target=\"_blank\"\n        rel=\"noopener noreferrer\"\n        className=\"opacity-40 hover:opacity-100\"\n        title=\"새 탭에서 열기\"\n      >\n        <ExternalLink size={11} />\n      </a>\n    </span>\n  );\n}\n\nfunction HtmlPreview({ code }: { code: string }) {\n  const [expanded, setExpanded] = useState(true);\n  const [blank, setBlank] = useState(false);\n\n  const metaEntries = Array.from(code.matchAll(/<meta\\s+name=[\"']showcase:([^\"']+)[\"']\\s+content=[\"']([^\"']*)[\"'][^>]*>/gi))\n    .map((m) => ({ key: m[1], value: m[2] }));\n  const iframeRef = useCallback((iframe: HTMLIFrameElement | null) => {\n    if (!iframe) return;\n    const doc = iframe.contentDocument;\n    if (!doc) return;\n    doc.open();\n    doc.write(code);\n    doc.close();\n    const resize = () => {\n      const h = doc.documentElement?.scrollHeight || doc.body?.scrollHeight || 300;\n      iframe.style.height = Math.min(h + 4, 600) + \"px\";\n\n      const text = (doc.body?.innerText || \"\").trim();\n      const hasVisual = !!doc.body?.querySelector(\"img,svg,video,canvas,table,input,button,textarea,select,iframe\");\n      setBlank(!text && !hasVisual);\n    };\n    iframe.onload = resize;\n    setTimeout(resize, 100);\n    setTimeout(resize, 500);\n  }, [code]);\n\n  return (\n    <div className=\"my-2 overflow-hidden rounded-lg border border-zinc-700\">\n      <div className=\"flex items-center justify-between bg-zinc-800 px-3 py-1.5 text-xs text-zinc-400\">\n        <span className=\"flex items-center gap-1.5\">\n          <Eye size={12} />\n          Preview\n        </span>\n        <button\n          onClick={() => setExpanded(e => !e)}\n          className=\"rounded px-1.5 py-0.5 hover:bg-zinc-700 hover:text-zinc-200 transition\"\n        >\n          {expanded ? \"접기\" : \"펼치기\"}\n        </button>\n      </div>\n      {expanded && (\n        <>\n          <iframe\n            ref={iframeRef}\n            sandbox=\"allow-same-origin\"\n            className=\"w-full border-0 bg-white\"\n            style={{ minHeight: 100, maxHeight: 600 }}\n          />\n          {blank && (\n            <div className=\"border-t border-zinc-700 bg-zinc-900 px-3 py-2 text-xs text-zinc-300\">\n              {metaEntries.length > 0 ? (\n                <div className=\"space-y-1\">\n                  <div className=\"text-zinc-400\">본문은 비어있지만, 아래 메타정보가 포함되어 있어요:</div>\n                  <div className=\"grid grid-cols-1 gap-1 sm:grid-cols-2\">\n                    {metaEntries.map((m) => (\n                      <div key={m.key} className=\"truncate rounded bg-zinc-800 px-2 py-1\">\n                        <span className=\"text-zinc-500\">{m.key}</span>\n                        <span className=\"mx-1 text-zinc-600\">:</span>\n                        <span className=\"text-zinc-200\">{m.value}</span>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              ) : (\n                <>\n                  표시할 본문이 없습니다. (meta/style 전용 코드일 수 있어요) · <span className=\"text-zinc-300\">Code</span> 탭에서 원문을 확인하세요.\n                </>\n              )}\n            </div>\n          )}\n        </>\n      )}\n    </div>\n  );\n}\n\nfunction CodeBlock({ className, children, rawChildren }: { className?: string; children: React.ReactNode; rawChildren?: React.ReactNode }) {\n  const [copied, setCopied] = useState(false);\n  const [showPreview, setShowPreview] = useState(true);\n  const rawLang = className?.replace(/language-/g, \"\").replace(/hljs/g, \"\").trim() || \"\";\n  const lang = rawLang.split(/\\s+/)[0] || \"\";\n  const code = extractText(rawChildren ?? children).replace(/\\n$/, \"\");\n  const isHtml = (lang === \"html\" || lang === \"xml\" || code.trimStart().startsWith(\"<!\") || code.trimStart().startsWith(\"<html\")) && code.includes(\"<\");\n\n  const handleCopy = useCallback(async () => {\n    try {\n      if (navigator.clipboard?.writeText) {\n        await navigator.clipboard.writeText(code);\n      } else {\n        const ta = document.createElement(\"textarea\");\n        ta.value = code;\n        ta.style.position = \"fixed\";\n        ta.style.opacity = \"0\";\n        document.body.appendChild(ta);\n        ta.select();\n        document.execCommand(\"copy\");\n        document.body.removeChild(ta);\n      }\n      setCopied(true);\n      setTimeout(() => setCopied(false), 2000);\n    } catch {}\n  }, [code]);\n\n  return (\n    <div className=\"group relative my-3\">\n      <div className=\"flex items-center justify-between rounded-t-lg bg-muted px-4 py-1.5 text-xs text-muted-foreground\">\n        <span>{lang}</span>\n        <button\n          onClick={handleCopy}\n          className=\"flex items-center gap-1 rounded px-2 py-0.5 transition hover:bg-muted hover:text-foreground\"\n        >\n          {copied ? (\n            <>\n              <Check size={12} /> Copied\n            </>\n          ) : (\n            <>\n              <Copy size={12} /> Copy\n            </>\n          )}\n        </button>\n      </div>\n      {(!isHtml || !showPreview) && (\n        <pre className=\"!mt-0 !rounded-t-none\">\n          <code className={className}>{children}</code>\n        </pre>\n      )}\n      {isHtml && (\n        <>\n          <div className=\"flex border-t border-zinc-700\">\n            <button\n              onClick={() => setShowPreview(false)}\n              className={`flex-1 flex items-center justify-center gap-1 px-3 py-1 text-xs transition ${!showPreview ? \"bg-zinc-700 text-zinc-200\" : \"bg-zinc-800 text-zinc-500 hover:text-zinc-300\"}`}\n            >\n              <Code2 size={11} /> Code\n            </button>\n            <button\n              onClick={() => setShowPreview(true)}\n              className={`flex-1 flex items-center justify-center gap-1 px-3 py-1 text-xs transition ${showPreview ? \"bg-zinc-700 text-zinc-200\" : \"bg-zinc-800 text-zinc-500 hover:text-zinc-300\"}`}\n            >\n              <Eye size={11} /> Preview\n            </button>\n          </div>\n          {showPreview && <HtmlPreview code={code} />}\n        </>\n      )}\n    </div>\n  );\n}\n\n/** Recursively extract text from React children (handles rehype-highlight spans) */\nfunction extractText(node: React.ReactNode): string {\n  if (typeof node === \"string\") return node;\n  if (typeof node === \"number\") return String(node);\n  if (!node) return \"\";\n  if (Array.isArray(node)) return node.map(extractText).join(\"\");\n  if (typeof node === \"object\" && \"props\" in node) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    return extractText((node as any).props?.children);\n  }\n  return \"\";\n}\n\nconst components: Partial<Components> = {\n  code({ className, children, ...props }) {\n    const isInline = !className && typeof children === \"string\" && !children.includes(\"\\n\");\n    if (isInline) {\n      const text = String(children).trim();\n      if (isUrl(text)) {\n        return <CopyableLink href={text}><code className={className} {...props}>{children}</code></CopyableLink>;\n      }\n      return (\n        <code className={className} {...props}>\n          {children}\n        </code>\n      );\n    }\n    return <CodeBlock className={className} rawChildren={children}>{children}</CodeBlock>;\n  },\n  a({ href, children }) {\n    if (href) {\n      return <CopyableLink href={href}>{children}</CopyableLink>;\n    }\n    return <a>{children}</a>;\n  },\n};\n\n// ---- Media file type detection ----\n\ntype MediaType = \"image\" | \"video\" | \"audio\" | \"pdf\" | \"code\" | \"text\" | \"spreadsheet\" | \"archive\" | \"other\";\n\nconst IMAGE_EXTS = new Set([\"png\", \"jpg\", \"jpeg\", \"gif\", \"webp\", \"svg\", \"ico\", \"bmp\", \"tiff\", \"tif\"]);\nconst VIDEO_EXTS = new Set([\"mp4\", \"webm\", \"mov\", \"avi\", \"mkv\"]);\nconst AUDIO_EXTS = new Set([\"mp3\", \"wav\", \"ogg\", \"flac\", \"aac\", \"m4a\", \"wma\"]);\nconst CODE_EXTS = new Set([\"js\", \"ts\", \"tsx\", \"jsx\", \"py\", \"rs\", \"go\", \"java\", \"c\", \"cpp\", \"h\", \"sh\", \"sql\", \"rb\", \"php\", \"swift\", \"kt\", \"css\", \"html\", \"xml\"]);\nconst SPREADSHEET_EXTS = new Set([\"csv\", \"xls\", \"xlsx\"]);\nconst ARCHIVE_EXTS = new Set([\"zip\", \"tar\", \"gz\", \"7z\", \"rar\"]);\n\nfunction getExtension(path: string): string {\n  const match = path.match(/\\.(\\w+)(?:\\?|$)/);\n  return match ? match[1].toLowerCase() : \"\";\n}\n\nfunction detectMediaType(path: string): MediaType {\n  const ext = getExtension(path);\n  if (IMAGE_EXTS.has(ext)) return \"image\";\n  if (VIDEO_EXTS.has(ext)) return \"video\";\n  if (AUDIO_EXTS.has(ext)) return \"audio\";\n  if (ext === \"pdf\") return \"pdf\";\n  if (CODE_EXTS.has(ext)) return \"code\";\n  if (SPREADSHEET_EXTS.has(ext)) return \"spreadsheet\";\n  if (ARCHIVE_EXTS.has(ext)) return \"archive\";\n  if ([\"txt\", \"md\", \"log\", \"json\", \"yaml\", \"yml\"].includes(ext)) return \"text\";\n  return \"other\";\n}\n\nfunction getFileName(path: string): string {\n  // Handle both URL-encoded API paths and raw paths\n  const decoded = decodeURIComponent(path);\n  const parts = decoded.split(\"/\");\n  const last = parts[parts.length - 1];\n  // Remove query params\n  return last.split(\"?\")[0] || \"file\";\n}\n\nfunction getMediaTypeIcon(type: MediaType) {\n  switch (type) {\n    case \"audio\": return FileAudio;\n    case \"video\": return FileVideo;\n    case \"pdf\": return FileText;\n    case \"code\": return FileCode;\n    case \"spreadsheet\": return FileSpreadsheet;\n    case \"archive\": return FileArchive;\n    case \"text\": return FileText;\n    default: return FileIcon;\n  }\n}\n\nfunction formatFileSize(bytes: number): string {\n  if (bytes < 1024) return `${bytes} B`;\n  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n  if (bytes < 1024 * 1024 * 1024) return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n  return `${(bytes / (1024 * 1024 * 1024)).toFixed(1)} GB`;\n}\n\n/** Extract original file path from MEDIA: URL for info API */\nfunction extractOriginalPath(url: string): string | null {\n  try {\n    const match = url.match(/[?&]path=([^&]+)/);\n    return match ? decodeURIComponent(match[1]) : null;\n  } catch {\n    return null;\n  }\n}\n\n/** Extract MEDIA: lines and return [cleanedContent, mediaEntries[]] */\ninterface MediaEntry {\n  url: string;\n  originalPath: string;\n  type: MediaType;\n  fileName: string;\n}\n\nfunction extractMediaLines(text: string): [string, MediaEntry[]] {\n  const entries: MediaEntry[] = [];\n  // Only match MEDIA: lines with actual file paths (starting with /) or URLs\n  const cleaned = text.replace(/^MEDIA:\\s*(.+)$/gm, (_match, path: string) => {\n    const trimmed = path.trim();\n    // Skip if it doesn't look like a path or URL\n    if (!trimmed.startsWith(\"/\") && !trimmed.startsWith(\"http://\") && !trimmed.startsWith(\"https://\") && !trimmed.startsWith(\"data:\")) {\n      return _match; // Leave as-is, not a real MEDIA marker\n    }\n    let url: string;\n    let originalPath: string;\n\n    if (trimmed.startsWith(\"http://\") || trimmed.startsWith(\"https://\") || trimmed.startsWith(\"data:\")) {\n      url = trimmed;\n      originalPath = trimmed;\n    } else {\n      url = `/api/media?path=${encodeURIComponent(trimmed)}`;\n      originalPath = trimmed;\n    }\n\n    const type = detectMediaType(trimmed);\n    const fileName = getFileName(trimmed);\n    entries.push({ url, originalPath, type, fileName });\n    return \"\";\n  });\n  return [cleaned, entries];\n}\n\n// ---- Media renderers ----\n\nfunction MediaImage({ src }: { src: string }) {\n  const [error, setError] = useState(false);\n  const [expanded, setExpanded] = useState(false);\n\n  if (error) {\n    return (\n      <div className=\"flex h-48 w-48 items-center justify-center rounded-lg border border-zinc-700 bg-zinc-800/50 text-xs text-zinc-500\">\n        ⚠️ 로드 실패\n      </div>\n    );\n  }\n\n  return (\n    <img\n      src={src}\n      alt=\"media\"\n      className={`rounded-lg border border-zinc-700 cursor-pointer transition-all ${expanded ? \"max-w-full\" : \"h-48 max-w-xs md:h-56 md:max-w-sm\"} object-contain`}\n      onClick={() => setExpanded(e => !e)}\n      onError={() => setError(true)}\n    />\n  );\n}\n\nfunction MediaVideo({ src }: { src: string }) {\n  return (\n    <video\n      src={src}\n      controls\n      className=\"h-48 md:h-56 rounded-lg border border-zinc-700\"\n      preload=\"metadata\"\n    />\n  );\n}\n\nfunction MediaAudio({ src, fileName }: { src: string; fileName: string }) {\n  return (\n    <div className=\"flex w-64 items-center gap-3 rounded-lg border border-zinc-700 bg-zinc-800/80 p-3\">\n      <FileAudio size={20} className=\"shrink-0 text-zinc-400\" />\n      <div className=\"min-w-0 flex-1\">\n        <div className=\"truncate text-sm text-zinc-200\">{fileName}</div>\n        <audio src={src} controls className=\"mt-1.5 w-full\" preload=\"metadata\" />\n      </div>\n    </div>\n  );\n}\n\nfunction MediaPdf({ src, fileName }: { src: string; fileName: string }) {\n  return (\n    <div className=\"w-72 overflow-hidden rounded-lg border border-zinc-700\">\n      <object\n        data={src}\n        type=\"application/pdf\"\n        className=\"h-48 md:h-56 w-full\"\n      >\n        <FileCard url={src} fileName={fileName} type=\"pdf\" />\n      </object>\n    </div>\n  );\n}\n\nfunction FileCard({ url, fileName, type }: { url: string; fileName: string; type: MediaType }) {\n  const [fileInfo, setFileInfo] = useState<{ size: number } | null>(null);\n  const Icon = getMediaTypeIcon(type);\n\n  useEffect(() => {\n    const originalPath = extractOriginalPath(url);\n    if (!originalPath) return;\n    fetch(`/api/media?path=${encodeURIComponent(originalPath)}&info=1`)\n      .then(r => r.ok ? r.json() : null)\n      .then(data => { if (data?.size) setFileInfo({ size: data.size }); })\n      .catch(() => {});\n  }, [url]);\n\n  return (\n    <div className=\"flex w-56 items-center gap-3 rounded-lg border border-zinc-700 bg-zinc-800/80 px-4 py-3\">\n      <div className=\"flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-zinc-700/60\">\n        <Icon size={20} className=\"text-zinc-300\" />\n      </div>\n      <div className=\"min-w-0 flex-1\">\n        <div className=\"truncate text-sm font-medium text-zinc-200\">{fileName}</div>\n        {fileInfo && (\n          <div className=\"text-xs text-zinc-500\">{formatFileSize(fileInfo.size)}</div>\n        )}\n      </div>\n      <a\n        href={url}\n        download={fileName}\n        className=\"flex h-8 w-8 shrink-0 items-center justify-center rounded-lg text-zinc-400 transition hover:bg-zinc-700 hover:text-zinc-200\"\n        title=\"다운로드\"\n      >\n        <Download size={16} />\n      </a>\n    </div>\n  );\n}\n\nfunction MediaRenderer({ entry }: { entry: MediaEntry }) {\n  switch (entry.type) {\n    case \"image\":\n      return <MediaImage src={entry.url} />;\n    case \"video\":\n      return <MediaVideo src={entry.url} />;\n    case \"audio\":\n      return <MediaAudio src={entry.url} fileName={entry.fileName} />;\n    case \"pdf\":\n      return <MediaPdf src={entry.url} fileName={entry.fileName} />;\n    default:\n      return <FileCard url={entry.url} fileName={entry.fileName} type={entry.type} />;\n  }\n}\n\nexport const MarkdownRenderer = memo(function MarkdownRenderer({\n  content,\n}: {\n  content: string;\n}) {\n  // Extract MEDIA: lines\n  const [withoutMedia, mediaEntries] = extractMediaLines(content);\n  // Collapse 3+ consecutive newlines to 2 (one blank line)\n  const cleaned = withoutMedia.replace(/\\n{3,}/g, \"\\n\\n\").trim();\n  return (\n    <div className=\"prose\">\n      {mediaEntries.length > 0 && (\n        <div className=\"flex gap-2 overflow-x-auto pb-2 scrollbar-thin\">\n          {mediaEntries.map((entry, i) => (\n            <div key={i} className=\"shrink-0\">\n              <MediaRenderer entry={entry} />\n            </div>\n          ))}\n        </div>\n      )}\n      {cleaned && (\n        <ReactMarkdown\n          remarkPlugins={[remarkGfm]}\n          rehypePlugins={[rehypeHighlight]}\n          components={components}\n        >\n          {cleaned}\n        </ReactMarkdown>\n      )}\n    </div>\n  );\n});\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1123, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/chat/subagent-card.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useRef, useState } from \"react\";\nimport { useGateway } from \"@/lib/gateway/hooks\";\nimport type { EventFrame } from \"@/lib/gateway/protocol\";\nimport {\n  Bot,\n  ChevronDown,\n  ChevronUp,\n  Loader2,\n  CheckCircle2,\n  Wrench,\n  Zap,\n} from \"lucide-react\";\n\ninterface SubagentStatus {\n  content: string;\n  toolName?: string;\n  phase: \"pending\" | \"running\" | \"done\";\n  tokenCount: number;\n  startedAt: number;\n  updatedAt: number;\n}\n\n/**\n * Inline card that shows realtime subagent progress inside an assistant bubble.\n * Subscribes to gateway agent events for the given sessionKey.\n */\nexport function SubagentCard({\n  sessionKey,\n  label,\n  task,\n}: {\n  sessionKey?: string;\n  label?: string;\n  task?: string;\n}) {\n  const { client } = useGateway();\n  const [status, setStatus] = useState<SubagentStatus>({\n    content: \"\",\n    phase: \"pending\",\n    tokenCount: 0,\n    startedAt: Date.now(),\n    updatedAt: Date.now(),\n  });\n  const [expanded, setExpanded] = useState(false);\n  const lastSeqRef = useRef(-1);\n\n  useEffect(() => {\n    if (!client || !sessionKey) return;\n\n    const unsub = client.onEvent((frame: EventFrame) => {\n      if (frame.event !== \"agent\") return;\n\n      // Dedup\n      if (frame.seq != null) {\n        if (frame.seq <= lastSeqRef.current) return;\n        lastSeqRef.current = frame.seq;\n      }\n\n      const raw = frame.payload as Record<string, unknown>;\n      const evKey = raw.sessionKey as string | undefined;\n      if (evKey !== sessionKey) return;\n\n      const stream = raw.stream as string | undefined;\n      const data = raw.data as Record<string, unknown> | undefined;\n\n      setStatus((prev) => {\n        const next = { ...prev, updatedAt: Date.now() };\n\n        if (stream === \"assistant\" && data?.delta) {\n          next.content += data.delta as string;\n          next.phase = \"running\";\n          next.toolName = undefined;\n          next.tokenCount += 1;\n        } else if (stream === \"tool-start\") {\n          next.toolName = (data?.name as string) || \"tool\";\n          next.phase = \"running\";\n        } else if (stream === \"tool-end\") {\n          next.toolName = undefined;\n        } else if (\n          stream === \"lifecycle\" &&\n          data?.phase === \"end\"\n        ) {\n          next.phase = \"done\";\n          next.toolName = undefined;\n        }\n\n        return next;\n      });\n    });\n\n    return unsub;\n  }, [client, sessionKey]);\n\n  const elapsed = Math.floor(\n    (status.updatedAt - status.startedAt) / 1000\n  );\n  const elapsedStr =\n    elapsed < 60\n      ? `${elapsed}s`\n      : `${Math.floor(elapsed / 60)}m ${elapsed % 60}s`;\n\n  const lastLines = status.content\n    .split(\"\\n\")\n    .filter(Boolean)\n    .slice(-4)\n    .join(\"\\n\");\n\n  const displayLabel = label || parseLabel(sessionKey || \"\");\n\n  return (\n    <div className=\"my-2 overflow-hidden rounded-lg border border-border/50 bg-muted/30\">\n      {/* Header */}\n      <button\n        onClick={() => setExpanded(!expanded)}\n        className=\"flex w-full items-center gap-2 px-3 py-2 text-left transition hover:bg-muted/50\"\n      >\n        {/* Status indicator */}\n        {status.phase === \"pending\" ? (\n          <Zap size={14} className=\"text-amber-400\" />\n        ) : status.phase === \"running\" ? (\n          <Loader2 size={14} className=\"animate-spin text-primary\" />\n        ) : (\n          <CheckCircle2 size={14} className=\"text-emerald-400\" />\n        )}\n\n        {/* Label */}\n        <span className=\"flex-1 truncate text-xs font-medium text-foreground\">\n          {displayLabel}\n        </span>\n\n        {/* Tool indicator */}\n        {status.toolName && (\n          <span className=\"flex items-center gap-1 text-[10px] text-muted-foreground\">\n            <Wrench size={10} />\n            {status.toolName}\n          </span>\n        )}\n\n        {/* Stats */}\n        <span className=\"text-[10px] text-muted-foreground\">{elapsedStr}</span>\n\n        {expanded ? (\n          <ChevronUp size={12} className=\"text-muted-foreground\" />\n        ) : (\n          <ChevronDown size={12} className=\"text-muted-foreground\" />\n        )}\n      </button>\n\n      {/* Preview (always show last line when collapsed) */}\n      {!expanded && lastLines && (\n        <div className=\"border-t border-border/30 px-3 py-1.5\">\n          <p className=\"truncate text-[11px] text-muted-foreground font-mono\">\n            {lastLines.split(\"\\n\").pop()}\n          </p>\n        </div>\n      )}\n\n      {/* Expanded content */}\n      {expanded && (\n        <div className=\"border-t border-border/30 px-3 py-2\">\n          {task && (\n            <div className=\"mb-2 text-[11px] text-muted-foreground\">\n              <span className=\"text-muted-foreground\">Task: </span>\n              {task.length > 200 ? task.slice(0, 200) + \"…\" : task}\n            </div>\n          )}\n          <pre className=\"max-h-48 overflow-y-auto overflow-x-hidden whitespace-pre-wrap break-all text-[11px] leading-relaxed text-muted-foreground font-mono\">\n            {status.content || (status.phase === \"pending\" ? \"대기 중...\" : \"처리 중...\")}\n          </pre>\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction parseLabel(sessionKey: string): string {\n  const parts = sessionKey.split(\":\");\n  if (parts.length >= 3) {\n    const agent = parts[1];\n    const type = parts[2];\n    if (type === \"subagent\") return `${agent} 서브에이전트`;\n    if (type === \"cron\") return `${agent} 크론`;\n    return `${agent}/${type}`;\n  }\n  return sessionKey;\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1352, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/chat/tool-call-card.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useMemo } from \"react\";\nimport { ChevronDown, ChevronRight, Loader2, CheckCircle2, AlertCircle } from \"lucide-react\";\nimport type { ToolCall } from \"@/lib/gateway/protocol\";\nimport { SubagentCard } from \"./subagent-card\";\n\n/** Tools that spawn subagents */\nconst SPAWN_TOOLS = new Set([\"sessions_spawn\", \"subagents\"]);\n\nexport function ToolCallCard({ toolCall }: { toolCall: ToolCall }) {\n  const [expanded, setExpanded] = useState(false);\n\n  // Extract subagent info from sessions_spawn args/result\n  const spawnInfo = useMemo(() => {\n    if (!SPAWN_TOOLS.has(toolCall.name)) return null;\n    try {\n      const args = toolCall.args ? JSON.parse(toolCall.args) : {};\n      let result: Record<string, unknown> = {};\n      try { result = toolCall.result ? JSON.parse(toolCall.result) : {}; } catch {}\n      return {\n        sessionKey: (result.childSessionKey || result.sessionKey || result.key || undefined) as string | undefined,\n        label: (args.label || result.label || undefined) as string | undefined,\n        task: (args.task || args.message || undefined) as string | undefined,\n      };\n    } catch {\n      // Even if parsing fails, still show the card for spawn tools\n      return { sessionKey: undefined, label: undefined, task: undefined };\n    }\n  }, [toolCall.name, toolCall.args, toolCall.result]);\n\n  // If this is a spawn tool, render SubagentCard instead\n  if (spawnInfo) {\n    return (\n      <SubagentCard\n        sessionKey={spawnInfo.sessionKey}\n        label={spawnInfo.label}\n        task={spawnInfo.task}\n      />\n    );\n  }\n\n  const statusIcon =\n    toolCall.status === \"running\" ? (\n      <Loader2 size={14} className=\"animate-spin text-primary\" />\n    ) : toolCall.status === \"done\" ? (\n      <CheckCircle2 size={14} className=\"text-emerald-400\" />\n    ) : (\n      <AlertCircle size={14} className=\"text-destructive\" />\n    );\n\n  return (\n    <div className=\"my-1.5 rounded-lg border border-border bg-muted/50\">\n      <button\n        onClick={() => setExpanded(!expanded)}\n        className=\"flex w-full items-center gap-2 px-3 py-2 text-left text-sm transition hover:bg-muted\"\n      >\n        {expanded ? <ChevronDown size={14} /> : <ChevronRight size={14} />}\n        {statusIcon}\n        <span className=\"font-mono text-xs text-foreground\">{toolCall.name}</span>\n        {toolCall.status === \"running\" && (\n          <span className=\"ml-auto text-xs text-muted-foreground\">실행 중...</span>\n        )}\n      </button>\n\n      {expanded && (\n        <div className=\"border-t border-border px-3 py-2 text-xs\">\n          {toolCall.args && (\n            <div className=\"mb-2\">\n              <div className=\"mb-1 text-muted-foreground\">Arguments</div>\n              <pre className=\"max-h-40 overflow-y-auto overflow-x-hidden whitespace-pre-wrap break-all rounded bg-background p-2 text-muted-foreground\">\n                {formatJson(toolCall.args)}\n              </pre>\n            </div>\n          )}\n          {toolCall.result && (\n            <div>\n              <div className=\"mb-1 text-muted-foreground\">Result</div>\n              <pre className=\"max-h-40 overflow-y-auto overflow-x-hidden whitespace-pre-wrap break-all rounded bg-background p-2 text-muted-foreground\">\n                {formatJson(toolCall.result)}\n              </pre>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction formatJson(s: string): string {\n  try {\n    return JSON.stringify(JSON.parse(s), null, 2);\n  } catch {\n    return s;\n  }\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;AALA;;;;;AAOA,+BAA+B,GAC/B,MAAM,cAAc,IAAI,IAAI;IAAC;IAAkB;CAAY;AAEpD,SAAS,aAAa,EAAE,QAAQ,EAA0B;IAC/D,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,mXAAQ,EAAC;IAEzC,wDAAwD;IACxD,MAAM,YAAY,IAAA,kXAAO,EAAC;QACxB,IAAI,CAAC,YAAY,GAAG,CAAC,SAAS,IAAI,GAAG,OAAO;QAC5C,IAAI;YACF,MAAM,OAAO,SAAS,IAAI,GAAG,KAAK,KAAK,CAAC,SAAS,IAAI,IAAI,CAAC;YAC1D,IAAI,SAAkC,CAAC;YACvC,IAAI;gBAAE,SAAS,SAAS,MAAM,GAAG,KAAK,KAAK,CAAC,SAAS,MAAM,IAAI,CAAC;YAAG,EAAE,OAAM,CAAC;YAC5E,OAAO;gBACL,YAAa,OAAO,eAAe,IAAI,OAAO,UAAU,IAAI,OAAO,GAAG,IAAI;gBAC1E,OAAQ,KAAK,KAAK,IAAI,OAAO,KAAK,IAAI;gBACtC,MAAO,KAAK,IAAI,IAAI,KAAK,OAAO,IAAI;YACtC;QACF,EAAE,OAAM;YACN,6DAA6D;YAC7D,OAAO;gBAAE,YAAY;gBAAW,OAAO;gBAAW,MAAM;YAAU;QACpE;IACF,GAAG;QAAC,SAAS,IAAI;QAAE,SAAS,IAAI;QAAE,SAAS,MAAM;KAAC;IAElD,uDAAuD;IACvD,IAAI,WAAW;QACb,qBACE,gZAAC,8JAAY;YACX,YAAY,UAAU,UAAU;YAChC,OAAO,UAAU,KAAK;YACtB,MAAM,UAAU,IAAI;;;;;;IAG1B;IAEA,MAAM,aACJ,SAAS,MAAM,KAAK,0BAClB,gZAAC,gTAAO;QAAC,MAAM;QAAI,WAAU;;;;;eAC3B,SAAS,MAAM,KAAK,uBACtB,gZAAC,yTAAY;QAAC,MAAM;QAAI,WAAU;;;;;6BAElC,gZAAC,uTAAW;QAAC,MAAM;QAAI,WAAU;;;;;;IAGrC,qBACE,gZAAC;QAAI,WAAU;;0BACb,gZAAC;gBACC,SAAS,IAAM,YAAY,CAAC;gBAC5B,WAAU;;oBAET,yBAAW,gZAAC,uTAAW;wBAAC,MAAM;;;;;6CAAS,gZAAC,0TAAY;wBAAC,MAAM;;;;;;oBAC3D;kCACD,gZAAC;wBAAK,WAAU;kCAAqC,SAAS,IAAI;;;;;;oBACjE,SAAS,MAAM,KAAK,2BACnB,gZAAC;wBAAK,WAAU;kCAAwC;;;;;;;;;;;;YAI3D,0BACC,gZAAC;gBAAI,WAAU;;oBACZ,SAAS,IAAI,kBACZ,gZAAC;wBAAI,WAAU;;0CACb,gZAAC;gCAAI,WAAU;0CAA6B;;;;;;0CAC5C,gZAAC;gCAAI,WAAU;0CACZ,WAAW,SAAS,IAAI;;;;;;;;;;;;oBAI9B,SAAS,MAAM,kBACd,gZAAC;;0CACC,gZAAC;gCAAI,WAAU;0CAA6B;;;;;;0CAC5C,gZAAC;gCAAI,WAAU;0CACZ,WAAW,SAAS,MAAM;;;;;;;;;;;;;;;;;;;;;;;;AAQ3C;AAEA,SAAS,WAAW,CAAS;IAC3B,IAAI;QACF,OAAO,KAAK,SAAS,CAAC,KAAK,KAAK,CAAC,IAAI,MAAM;IAC7C,EAAE,OAAM;QACN,OAAO;IACT;AACF","debugId":null}},
    {"offset": {"line": 1555, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/chat/message-list.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useRef } from \"react\";\nimport { useState as useStateCopy } from \"react\";\nimport { User, Bot, Clock, X, Copy, Check } from \"lucide-react\";\nimport { MarkdownRenderer } from \"./markdown-renderer\";\nimport { ToolCallCard } from \"./tool-call-card\";\nimport type { DisplayMessage, DisplayAttachment } from \"@/lib/gateway/hooks\";\n\n/** Strip task-memo HTML comments from display text */\nconst TASK_MEMO_STRIP_RE = /\\s*<!--\\s*task-memo:\\s*\\{[\\s\\S]*?\\}\\s*-->\\s*/g;\nfunction stripTaskMemo(text: string): string {\n  return text.replace(TASK_MEMO_STRIP_RE, \"\").trimEnd();\n}\n\nexport function MessageList({\n  messages,\n  loading,\n  streaming,\n  onCancelQueued,\n}: {\n  messages: DisplayMessage[];\n  loading: boolean;\n  streaming: boolean;\n  onCancelQueued?: (id: string) => void;\n}) {\n  const bottomRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    bottomRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages]);\n\n  if (loading) {\n    return (\n      <div className=\"flex flex-1 items-center justify-center text-muted-foreground\">\n        대화 기록 불러오는 중...\n      </div>\n    );\n  }\n\n  if (messages.length === 0) {\n    return (\n      <div className=\"flex flex-1 flex-col items-center justify-center gap-3 text-muted-foreground\">\n        <Bot size={48} strokeWidth={1.5} className=\"text-muted-foreground\" />\n        <p className=\"text-lg\">무엇을 도와드릴까요?</p>\n        <p className=\"text-sm text-muted-foreground\">메시지를 입력하여 대화를 시작하세요</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex-1 overflow-y-auto overflow-x-hidden px-3 py-3 md:px-4 md:py-4\" style={{ WebkitOverflowScrolling: \"touch\" }}>\n      <div className=\"mx-auto max-w-3xl space-y-3 md:space-y-4\">\n        {messages\n          .filter((msg) => msg.content || msg.toolCalls.length > 0 || msg.streaming)\n          .map((msg, idx, arr) => {\n            const prevRole = idx > 0 ? arr[idx - 1].role : null;\n            const showAvatar = msg.role !== \"assistant\" || prevRole !== \"assistant\";\n            return (\n              <MessageBubble key={msg.id} message={msg} showAvatar={showAvatar} onCancel={msg.queued ? onCancelQueued : undefined} />\n            );\n          })}\n        {streaming && !messages.some(m => m.streaming) && <ThinkingIndicator />}\n        <div ref={bottomRef} />\n      </div>\n    </div>\n  );\n}\n\nfunction ThinkingIndicator() {\n  return (\n    <div className=\"flex gap-3\">\n      <div className=\"flex h-8 w-8 shrink-0 items-center justify-center rounded-full bg-primary/10 text-primary\">\n        <Bot size={18} />\n      </div>\n      <div className=\"flex items-center gap-1.5 rounded-2xl bg-muted/60 px-4 py-3\">\n        <span className=\"h-2 w-2 animate-bounce rounded-full bg-muted-foreground\" style={{ animationDelay: \"0ms\" }} />\n        <span className=\"h-2 w-2 animate-bounce rounded-full bg-muted-foreground\" style={{ animationDelay: \"150ms\" }} />\n        <span className=\"h-2 w-2 animate-bounce rounded-full bg-muted-foreground\" style={{ animationDelay: \"300ms\" }} />\n      </div>\n    </div>\n  );\n}\n\nfunction copyToClipboard(text: string): Promise<void> {\n  // navigator.clipboard requires HTTPS or localhost\n  if (navigator.clipboard?.writeText) {\n    return navigator.clipboard.writeText(text);\n  }\n  // Fallback for non-HTTPS (e.g. Tailscale HTTP)\n  return new Promise((resolve, reject) => {\n    const ta = document.createElement(\"textarea\");\n    ta.value = text;\n    ta.style.position = \"fixed\";\n    ta.style.opacity = \"0\";\n    document.body.appendChild(ta);\n    ta.select();\n    try {\n      document.execCommand(\"copy\");\n      resolve();\n    } catch (err) {\n      reject(err);\n    } finally {\n      document.body.removeChild(ta);\n    }\n  });\n}\n\nfunction CopyButton({ text }: { text: string }) {\n  const [copied, setCopied] = useStateCopy(false);\n  const handleCopy = async (e: React.MouseEvent) => {\n    e.stopPropagation();\n    try {\n      await copyToClipboard(text);\n      setCopied(true);\n      setTimeout(() => setCopied(false), 1500);\n    } catch {}\n  };\n  return (\n    <button\n      onClick={handleCopy}\n      className=\"rounded p-1 text-muted-foreground opacity-60 sm:opacity-0 transition group-hover:opacity-100 hover:bg-white/10 hover:text-accent-foreground active:scale-90\"\n      title=\"복사\"\n    >\n      {copied ? <Check size={12} className=\"text-emerald-400\" /> : <Copy size={12} />}\n    </button>\n  );\n}\n\nfunction MessageBubble({ message, showAvatar = true, onCancel }: { message: DisplayMessage; showAvatar?: boolean; onCancel?: (id: string) => void }) {\n  const isUser = message.role === \"user\";\n  const isSystem = message.role === \"system\";\n  const isQueued = message.queued;\n\n  // System messages: centered, muted style\n  if (isSystem) {\n    return (\n      <div className=\"flex justify-center py-1\">\n        <div className=\"max-w-[90%] rounded-lg border border-border/50 bg-muted/30 px-4 py-2 text-center text-xs text-muted-foreground\">\n          <MarkdownRenderer content={message.content} />\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`group flex gap-3 ${isUser ? \"justify-end\" : \"\"}`}>\n      {/* Copy button for user messages (left of bubble) */}\n      {isUser && message.content && (\n        <div className=\"flex items-start pt-2\">\n          <CopyButton text={message.content} />\n        </div>\n      )}\n      {!isUser && (\n        showAvatar ? (\n          <div className=\"flex h-8 w-8 shrink-0 items-center justify-center rounded-full bg-primary/10 text-primary\">\n            <Bot size={18} />\n          </div>\n        ) : (\n          <div className=\"w-8 shrink-0\" />\n        )\n      )}\n\n      <div\n        className={`min-w-0 max-w-[90%] md:max-w-[85%] ${\n          isUser\n            ? `rounded-2xl rounded-br-md px-3.5 py-2 md:px-4 md:py-2.5 text-foreground ${isQueued ? \"bg-primary/15 border border-primary/20\" : \"bg-primary/15 border border-primary/10\"}`\n            : \"flex-1\"\n        }`}\n      >\n        {isUser ? (\n          <div>\n            {/* Attachment images */}\n            {message.attachments && message.attachments.length > 0 && (\n              <div className=\"mb-2 flex flex-wrap gap-2\">\n                {message.attachments.map((att, i) =>\n                  att.dataUrl && att.mimeType.startsWith(\"image/\") ? (\n                    <img\n                      key={i}\n                      src={att.dataUrl}\n                      alt={att.fileName}\n                      className=\"max-h-48 w-full md:max-w-full md:w-auto rounded-lg object-contain\"\n                    />\n                  ) : (\n                    <div key={i} className=\"rounded-lg bg-white/10 px-3 py-1.5 text-xs\">\n                      📎 {att.fileName}\n                    </div>\n                  )\n                )}\n              </div>\n            )}\n            {message.content && message.content !== \"(첨부 파일)\" && (\n              <p className={`whitespace-pre-wrap break-words text-sm ${isQueued ? \"opacity-70\" : \"\"}`}>{message.content}</p>\n            )}\n            {message.content && message.content === \"(첨부 파일)\" && !message.attachments?.length && (\n              <p className={`whitespace-pre-wrap break-words text-sm ${isQueued ? \"opacity-70\" : \"\"}`}>{message.content}</p>\n            )}\n            {isQueued && (\n              <div className=\"mt-1.5 flex items-center justify-end gap-2\">\n                <span className=\"flex items-center gap-1 text-[10px] text-primary/70\">\n                  <Clock size={10} />\n                  대기 중\n                </span>\n                {onCancel && (\n                  <button\n                    onClick={() => onCancel(message.id)}\n                    className=\"flex items-center gap-0.5 rounded-full bg-muted px-1.5 py-0.5 text-[10px] text-muted-foreground transition hover:bg-accent hover:text-foreground\"\n                  >\n                    <X size={10} />\n                    취소\n                  </button>\n                )}\n              </div>\n            )}\n          </div>\n        ) : (\n          <div>\n            {message.toolCalls.length > 0 && (\n              <div className=\"mb-2\">\n                {message.toolCalls.map((tc) => (\n                  <ToolCallCard key={tc.callId} toolCall={tc} />\n                ))}\n              </div>\n            )}\n            {/* Assistant image attachments */}\n            {message.attachments && message.attachments.length > 0 && (\n              <div className=\"mb-2 flex flex-wrap gap-2\">\n                {message.attachments.map((att, i) =>\n                  att.dataUrl && att.mimeType.startsWith(\"image/\") ? (\n                    <img\n                      key={i}\n                      src={att.dataUrl}\n                      alt={att.fileName}\n                      className=\"max-h-80 max-w-full md:max-w-md rounded-lg border border-zinc-700 object-contain\"\n                    />\n                  ) : null\n                )}\n              </div>\n            )}\n            {message.content && (() => {\n              const cleaned = stripTaskMemo(message.content);\n              return cleaned ? <MarkdownRenderer content={cleaned} /> : null;\n            })()}\n            {message.streaming && (\n              <span className=\"inline-block h-4 w-1.5 animate-pulse rounded-sm bg-primary\" />\n            )}\n            {!message.streaming && message.content && (\n              <div className=\"mt-1\">\n                <CopyButton text={stripTaskMemo(message.content)} />\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n\n      {isUser && (\n        <div className=\"flex h-8 w-8 shrink-0 items-center justify-center rounded-full bg-muted text-accent-foreground\">\n          <User size={18} />\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2060, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/ui/button.tsx"],"sourcesContent":["import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { Slot } from \"radix-ui\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60\",\n        outline:\n          \"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost:\n          \"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-9 px-4 py-2 has-[>svg]:px-3\",\n        xs: \"h-6 gap-1 rounded-md px-2 text-xs has-[>svg]:px-1.5 [&_svg:not([class*='size-'])]:size-3\",\n        sm: \"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5\",\n        lg: \"h-10 rounded-md px-6 has-[>svg]:px-4\",\n        icon: \"size-9\",\n        \"icon-xs\": \"size-6 rounded-md [&_svg:not([class*='size-'])]:size-3\",\n        \"icon-sm\": \"size-8\",\n        \"icon-lg\": \"size-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction Button({\n  className,\n  variant = \"default\",\n  size = \"default\",\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> &\n  VariantProps<typeof buttonVariants> & {\n    asChild?: boolean\n  }) {\n  const Comp = asChild ? Slot.Root : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"button\"\n      data-variant={variant}\n      data-size={size}\n      className={cn(buttonVariants({ variant, size, className }))}\n      {...props}\n    />\n  )\n}\n\nexport { Button, buttonVariants }\n"],"names":[],"mappings":";;;;;;;AACA;AACA;AAEA;;;;;AAEA,MAAM,iBAAiB,IAAA,kPAAG,EACxB,+bACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,aACE;YACF,SACE;YACF,WACE;YACF,OACE;YACF,MAAM;QACR;QACA,MAAM;YACJ,SAAS;YACT,IAAI;YACJ,IAAI;YACJ,IAAI;YACJ,MAAM;YACN,WAAW;YACX,WAAW;YACX,WAAW;QACb;IACF;IACA,iBAAiB;QACf,SAAS;QACT,MAAM;IACR;AACF;AAGF,SAAS,OAAO,EACd,SAAS,EACT,UAAU,SAAS,EACnB,OAAO,SAAS,EAChB,UAAU,KAAK,EACf,GAAG,OAIF;IACD,MAAM,OAAO,UAAU,6UAAI,CAAC,IAAI,GAAG;IAEnC,qBACE,gZAAC;QACC,aAAU;QACV,gBAAc;QACd,aAAW;QACX,WAAW,IAAA,yHAAE,EAAC,eAAe;YAAE;YAAS;YAAM;QAAU;QACvD,GAAG,KAAK;;;;;;AAGf","debugId":null}},
    {"offset": {"line": 2123, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/hooks/use-autosize-textarea.ts"],"sourcesContent":["import { useLayoutEffect, useRef } from \"react\"\n\ninterface UseAutosizeTextAreaProps {\n  ref: React.RefObject<HTMLTextAreaElement | null>\n  maxHeight?: number\n  borderWidth?: number\n  dependencies: React.DependencyList\n}\n\nexport function useAutosizeTextArea({\n  ref,\n  maxHeight = Number.MAX_SAFE_INTEGER,\n  borderWidth = 0,\n  dependencies,\n}: UseAutosizeTextAreaProps) {\n  const originalHeight = useRef<number | null>(null)\n\n  useLayoutEffect(() => {\n    if (!ref.current) return\n\n    const currentRef = ref.current\n    const borderAdjustment = borderWidth * 2\n\n    if (originalHeight.current === null) {\n      originalHeight.current = currentRef.scrollHeight - borderAdjustment\n    }\n\n    currentRef.style.removeProperty(\"height\")\n    const scrollHeight = currentRef.scrollHeight\n\n    // Make sure we don't go over maxHeight\n    const clampedToMax = Math.min(scrollHeight, maxHeight)\n    // Make sure we don't go less than the original height\n    const clampedToMin = Math.max(clampedToMax, originalHeight.current)\n\n    currentRef.style.height = `${clampedToMin + borderAdjustment}px`\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [maxHeight, ref, ...dependencies])\n}\n"],"names":[],"mappings":";;;;AAAA;;AASO,SAAS,oBAAoB,EAClC,GAAG,EACH,YAAY,OAAO,gBAAgB,EACnC,cAAc,CAAC,EACf,YAAY,EACa;IACzB,MAAM,iBAAiB,IAAA,iXAAM,EAAgB;IAE7C,IAAA,0XAAe,EAAC;QACd,IAAI,CAAC,IAAI,OAAO,EAAE;QAElB,MAAM,aAAa,IAAI,OAAO;QAC9B,MAAM,mBAAmB,cAAc;QAEvC,IAAI,eAAe,OAAO,KAAK,MAAM;YACnC,eAAe,OAAO,GAAG,WAAW,YAAY,GAAG;QACrD;QAEA,WAAW,KAAK,CAAC,cAAc,CAAC;QAChC,MAAM,eAAe,WAAW,YAAY;QAE5C,uCAAuC;QACvC,MAAM,eAAe,KAAK,GAAG,CAAC,cAAc;QAC5C,sDAAsD;QACtD,MAAM,eAAe,KAAK,GAAG,CAAC,cAAc,eAAe,OAAO;QAElE,WAAW,KAAK,CAAC,MAAM,GAAG,GAAG,eAAe,iBAAiB,EAAE,CAAC;IAChE,uDAAuD;IACzD,GAAG;QAAC;QAAW;WAAQ;KAAa;AACtC","debugId":null}},
    {"offset": {"line": 2156, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/chat/file-attachments.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useRef, useCallback, useEffect } from \"react\";\nimport { Paperclip, X, FileText, Image as ImageIcon, File } from \"lucide-react\";\n\nexport interface ChatAttachment {\n  id: string;\n  file: File;\n  preview?: string; // data URL for images\n  type: \"image\" | \"file\";\n}\n\nfunction formatSize(bytes: number): string {\n  if (bytes < 1024) return `${bytes}B`;\n  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)}KB`;\n  return `${(bytes / (1024 * 1024)).toFixed(1)}MB`;\n}\n\nfunction fileToAttachment(file: File): Promise<ChatAttachment> {\n  return new Promise((resolve) => {\n    const id = `att-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`;\n    const isImage = file.type.startsWith(\"image/\");\n\n    if (isImage) {\n      const reader = new FileReader();\n      reader.onload = () => {\n        resolve({\n          id,\n          file,\n          preview: reader.result as string,\n          type: \"image\",\n        });\n      };\n      reader.readAsDataURL(file);\n    } else {\n      resolve({ id, file, type: \"file\" });\n    }\n  });\n}\n\n// ---- Attachment preview bar ----\n\nexport function AttachmentPreview({\n  attachments,\n  onRemove,\n}: {\n  attachments: ChatAttachment[];\n  onRemove: (id: string) => void;\n}) {\n  if (attachments.length === 0) return null;\n\n  return (\n    <div className=\"flex flex-wrap gap-2 px-4 py-2\">\n      {attachments.map((att) => (\n        <div\n          key={att.id}\n          className=\"group relative flex items-center gap-2 rounded-lg border border-border bg-muted p-2 text-xs text-foreground\"\n        >\n          {att.type === \"image\" && att.preview ? (\n            <img\n              src={att.preview}\n              alt={att.file.name}\n              className=\"h-10 w-10 md:h-12 md:w-12 rounded object-cover\"\n            />\n          ) : (\n            <div className=\"flex h-10 w-10 md:h-12 md:w-12 items-center justify-center rounded bg-muted\">\n              <FileText size={20} className=\"text-muted-foreground\" />\n            </div>\n          )}\n          <div className=\"min-w-0 max-w-[100px] md:max-w-[120px]\">\n            <div className=\"truncate font-medium\">{att.file.name}</div>\n            <div className=\"text-muted-foreground\">{formatSize(att.file.size)}</div>\n          </div>\n          <button\n            onClick={() => onRemove(att.id)}\n            className=\"absolute -right-1.5 -top-1.5 hidden rounded-full bg-muted p-0.5 text-foreground hover:bg-destructive group-hover:block\"\n          >\n            <X size={12} />\n          </button>\n        </div>\n      ))}\n    </div>\n  );\n}\n\n// ---- Attachment button ----\n\nexport function AttachButton({\n  onAttach,\n}: {\n  onAttach: (files: File[]) => void;\n}) {\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  // Detect mobile for camera capture attribute\n  const isTouchDevice = typeof window !== \"undefined\" && \"ontouchstart\" in window;\n\n  return (\n    <>\n      <button\n        onClick={() => inputRef.current?.click()}\n        className=\"flex h-11 w-11 shrink-0 items-center justify-center rounded-xl text-muted-foreground transition hover:bg-muted hover:text-foreground\"\n        title=\"파일 첨부\"\n      >\n        <Paperclip size={18} />\n      </button>\n      <input\n        ref={inputRef}\n        type=\"file\"\n        multiple\n        accept={isTouchDevice ? \"image/*,video/*,*/*\" : undefined}\n        className=\"hidden\"\n        onChange={(e) => {\n          if (e.target.files?.length) {\n            onAttach(Array.from(e.target.files));\n            e.target.value = \"\";\n          }\n        }}\n      />\n    </>\n  );\n}\n\n// ---- Drag & drop overlay ----\n\nexport function DropZone({\n  onDrop,\n  children,\n}: {\n  onDrop: (files: File[]) => void;\n  children: React.ReactNode;\n}) {\n  const [dragging, setDragging] = useState(false);\n  const dragCounter = useRef(0);\n\n  const handleDragEnter = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    dragCounter.current++;\n    if (e.dataTransfer?.types.includes(\"Files\")) {\n      setDragging(true);\n    }\n  }, []);\n\n  const handleDragLeave = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    dragCounter.current--;\n    if (dragCounter.current === 0) {\n      setDragging(false);\n    }\n  }, []);\n\n  const handleDragOver = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n  }, []);\n\n  const handleDrop = useCallback(\n    (e: React.DragEvent) => {\n      e.preventDefault();\n      e.stopPropagation();\n      setDragging(false);\n      dragCounter.current = 0;\n\n      if (e.dataTransfer?.files?.length) {\n        onDrop(Array.from(e.dataTransfer.files));\n      }\n    },\n    [onDrop]\n  );\n\n  return (\n    <div\n      className=\"relative flex-1 flex flex-col min-h-0\"\n      onDragEnter={handleDragEnter}\n      onDragLeave={handleDragLeave}\n      onDragOver={handleDragOver}\n      onDrop={handleDrop}\n    >\n      {children}\n      {dragging && (\n        <div className=\"absolute inset-0 z-50 flex items-center justify-center rounded-lg border-2 border-dashed border-primary bg-primary/10 backdrop-blur-sm\">\n          <div className=\"flex flex-col items-center gap-2 text-primary\">\n            <Paperclip size={32} />\n            <span className=\"text-sm font-medium\">파일을 여기에 놓으세요</span>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\n// ---- Hook: useFileAttachments ----\n\nexport function useFileAttachments() {\n  const [attachments, setAttachments] = useState<ChatAttachment[]>([]);\n\n  const addFiles = useCallback(async (files: File[]) => {\n    const newAtts = await Promise.all(files.map(fileToAttachment));\n    setAttachments((prev) => [...prev, ...newAtts]);\n  }, []);\n\n  const removeAttachment = useCallback((id: string) => {\n    setAttachments((prev) => prev.filter((a) => a.id !== id));\n  }, []);\n\n  const clearAttachments = useCallback(() => {\n    setAttachments([]);\n  }, []);\n\n  // Handle clipboard paste\n  const handlePaste = useCallback(\n    (e: ClipboardEvent) => {\n      const items = e.clipboardData?.items;\n      if (!items) return;\n\n      const files: File[] = [];\n      for (const item of items) {\n        if (item.kind === \"file\") {\n          const file = item.getAsFile();\n          if (file) files.push(file);\n        }\n      }\n      if (files.length > 0) {\n        e.preventDefault();\n        addFiles(files);\n      }\n    },\n    [addFiles]\n  );\n\n  return {\n    attachments,\n    addFiles,\n    removeAttachment,\n    clearAttachments,\n    handlePaste,\n  };\n}\n\n/**\n * Convert a ChatAttachment to a base64 data URL for sending via gateway.\n * The gateway chat.send accepts attachments as unknown[] — we send objects\n * with {name, mimeType, data} where data is a base64 data URL.\n */\nexport async function attachmentToPayload(\n  att: ChatAttachment\n): Promise<{ fileName: string; mimeType: string; content: string }> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = () => {\n      // Convert data URL to pure base64 (strip \"data:...;base64,\" prefix)\n      const dataUrl = reader.result as string;\n      const base64 = dataUrl.includes(\",\") ? dataUrl.split(\",\")[1] : dataUrl;\n      resolve({\n        fileName: att.file.name,\n        mimeType: att.file.type || \"application/octet-stream\",\n        content: base64,\n      });\n    };\n    reader.onerror = () => reject(new Error(\"Failed to read file\"));\n    reader.readAsDataURL(att.file);\n  });\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2472, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/lib/gateway/use-skills.ts"],"sourcesContent":["\"use client\";\n\nimport { useState, useCallback, useEffect } from \"react\";\nimport { useGateway } from \"./hooks\";\n\n// --- Types ---\n\nexport interface SkillRequirements {\n  bins: string[];\n  anyBins: string[];\n  env: string[];\n  config: string[];\n  os: string[];\n}\n\nexport interface SkillInstaller {\n  id: string;\n  kind: string; // \"brew\" | \"node\" | \"go\" | \"uv\" | \"download\"\n  label: string;\n  bins?: string[];\n  formula?: string;\n  package?: string;\n  os?: string[];\n}\n\nexport interface Skill {\n  name: string;\n  description: string;\n  source: string; // \"openclaw-bundled\" | \"managed\" | \"workspace\"\n  bundled: boolean;\n  filePath: string;\n  baseDir: string;\n  skillKey: string;\n  emoji?: string;\n  homepage?: string;\n  always: boolean;\n  disabled: boolean;\n  blockedByAllowlist: boolean;\n  eligible: boolean;\n  requirements: SkillRequirements;\n  missing: SkillRequirements;\n  configChecks: string[];\n  install: SkillInstaller[];\n  primaryEnv?: string;\n  hasApiKey?: boolean;\n}\n\n// --- Hook ---\n\nexport function useSkills() {\n  const { client, state } = useGateway();\n  const [skills, setSkills] = useState<Skill[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const fetchSkills = useCallback(async () => {\n    if (!client || state !== \"connected\") return;\n    setLoading(true);\n    setError(null);\n    try {\n      const res = await client.request<{ skills: Skill[] }>(\"skills.status\", {});\n      setSkills(res?.skills || []);\n    } catch (err) {\n      setError(String(err));\n    } finally {\n      setLoading(false);\n    }\n  }, [client, state]);\n\n  useEffect(() => {\n    fetchSkills();\n  }, [fetchSkills]);\n\n  const toggleSkill = useCallback(\n    async (skillKey: string, enabled: boolean) => {\n      if (!client || state !== \"connected\") return;\n      try {\n        await client.request(\"skills.update\", { skillKey, enabled });\n        // Optimistic update\n        setSkills((prev) =>\n          prev.map((s) =>\n            s.skillKey === skillKey ? { ...s, disabled: !enabled } : s\n          )\n        );\n      } catch (err) {\n        setError(String(err));\n        // Revert on error\n        await fetchSkills();\n      }\n    },\n    [client, state, fetchSkills]\n  );\n\n  const setApiKey = useCallback(\n    async (skillKey: string, apiKey: string) => {\n      if (!client || state !== \"connected\") return;\n      try {\n        await client.request(\"skills.update\", { skillKey, apiKey });\n        await fetchSkills();\n      } catch (err) {\n        setError(String(err));\n      }\n    },\n    [client, state, fetchSkills]\n  );\n\n  const installSkill = useCallback(\n    async (name: string, installId: string) => {\n      if (!client || state !== \"connected\") return;\n      try {\n        await client.request(\"skills.install\", {\n          name,\n          installId,\n          timeoutMs: 120_000,\n        });\n        await fetchSkills();\n      } catch (err) {\n        setError(String(err));\n      }\n    },\n    [client, state, fetchSkills]\n  );\n\n  return {\n    skills,\n    loading,\n    error,\n    refresh: fetchSkills,\n    toggleSkill,\n    setApiKey,\n    installSkill,\n  };\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;AAHA;;;AAiDO,SAAS;IACd,MAAM,EAAE,MAAM,EAAE,KAAK,EAAE,GAAG,IAAA,6IAAU;IACpC,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,mXAAQ,EAAU,EAAE;IAChD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,mXAAQ,EAAC;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,mXAAQ,EAAgB;IAElD,MAAM,cAAc,IAAA,sXAAW,EAAC;QAC9B,IAAI,CAAC,UAAU,UAAU,aAAa;QACtC,WAAW;QACX,SAAS;QACT,IAAI;YACF,MAAM,MAAM,MAAM,OAAO,OAAO,CAAsB,iBAAiB,CAAC;YACxE,UAAU,KAAK,UAAU,EAAE;QAC7B,EAAE,OAAO,KAAK;YACZ,SAAS,OAAO;QAClB,SAAU;YACR,WAAW;QACb;IACF,GAAG;QAAC;QAAQ;KAAM;IAElB,IAAA,oXAAS,EAAC;QACR;IACF,GAAG;QAAC;KAAY;IAEhB,MAAM,cAAc,IAAA,sXAAW,EAC7B,OAAO,UAAkB;QACvB,IAAI,CAAC,UAAU,UAAU,aAAa;QACtC,IAAI;YACF,MAAM,OAAO,OAAO,CAAC,iBAAiB;gBAAE;gBAAU;YAAQ;YAC1D,oBAAoB;YACpB,UAAU,CAAC,OACT,KAAK,GAAG,CAAC,CAAC,IACR,EAAE,QAAQ,KAAK,WAAW;wBAAE,GAAG,CAAC;wBAAE,UAAU,CAAC;oBAAQ,IAAI;QAG/D,EAAE,OAAO,KAAK;YACZ,SAAS,OAAO;YAChB,kBAAkB;YAClB,MAAM;QACR;IACF,GACA;QAAC;QAAQ;QAAO;KAAY;IAG9B,MAAM,YAAY,IAAA,sXAAW,EAC3B,OAAO,UAAkB;QACvB,IAAI,CAAC,UAAU,UAAU,aAAa;QACtC,IAAI;YACF,MAAM,OAAO,OAAO,CAAC,iBAAiB;gBAAE;gBAAU;YAAO;YACzD,MAAM;QACR,EAAE,OAAO,KAAK;YACZ,SAAS,OAAO;QAClB;IACF,GACA;QAAC;QAAQ;QAAO;KAAY;IAG9B,MAAM,eAAe,IAAA,sXAAW,EAC9B,OAAO,MAAc;QACnB,IAAI,CAAC,UAAU,UAAU,aAAa;QACtC,IAAI;YACF,MAAM,OAAO,OAAO,CAAC,kBAAkB;gBACrC;gBACA;gBACA,WAAW;YACb;YACA,MAAM;QACR,EAAE,OAAO,KAAK;YACZ,SAAS,OAAO;QAClB;IACF,GACA;QAAC;QAAQ;QAAO;KAAY;IAG9B,OAAO;QACL;QACA;QACA;QACA,SAAS;QACT;QACA;QACA;IACF;AACF","debugId":null}},
    {"offset": {"line": 2576, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/chat/skill-picker.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect, useRef, useMemo } from \"react\";\nimport { Puzzle, ExternalLink, Terminal } from \"lucide-react\";\nimport { useSkills, type Skill } from \"@/lib/gateway/use-skills\";\n\n// Built-in slash commands\nexport interface BuiltinCommand {\n  name: string;\n  description: string;\n  emoji: string;\n  /** If true, execute immediately on select (don't append to input) */\n  immediate?: boolean;\n}\n\nexport const BUILTIN_COMMANDS: BuiltinCommand[] = [\n  { name: \"stop\", description: \"스트리밍 중단\", emoji: \"⏹️\", immediate: true },\n  { name: \"new\", description: \"새 세션 시작\", emoji: \"✨\", immediate: true },\n  { name: \"reset\", description: \"현재 세션 리셋\", emoji: \"🔄\", immediate: true },\n  { name: \"status\", description: \"세션 상태 확인 (토큰, 모델 등)\", emoji: \"📊\", immediate: true },\n  { name: \"reasoning\", description: \"추론 모드 토글\", emoji: \"🧠\", immediate: true },\n  { name: \"model\", description: \"모델 변경 (예: /model opus)\", emoji: \"🤖\" },\n  { name: \"help\", description: \"사용 가능한 커맨드 목록\", emoji: \"❓\", immediate: true },\n];\n\ninterface SkillPickerProps {\n  /** Current input text to detect \"/\" trigger */\n  inputText: string;\n  /** Called when a skill slash command is selected */\n  onSelect: (command: string) => void;\n  /** Called to dismiss */\n  onDismiss: () => void;\n  /** Whether picker should be visible */\n  visible: boolean;\n}\n\nexport function SkillPicker({ inputText, onSelect, onDismiss, visible }: SkillPickerProps) {\n  const { skills } = useSkills();\n  const [selectedIndex, setSelectedIndex] = useState(0);\n  const listRef = useRef<HTMLDivElement>(null);\n\n  // Only show eligible, non-disabled skills\n  const activeSkills = useMemo(\n    () => skills.filter((s) => s.eligible && !s.disabled),\n    [skills]\n  );\n\n  // Extract search query after \"/\"\n  const query = useMemo(() => {\n    if (!visible) return \"\";\n    const match = inputText.match(/^\\/(\\S*)$/);\n    return match ? match[1].toLowerCase() : \"\";\n  }, [inputText, visible]);\n\n  // Filter built-in commands\n  const filteredBuiltins = useMemo(() => {\n    if (!query) return BUILTIN_COMMANDS;\n    return BUILTIN_COMMANDS.filter(\n      (c) =>\n        c.name.toLowerCase().includes(query) ||\n        c.description.toLowerCase().includes(query)\n    );\n  }, [query]);\n\n  // Filter skills by query\n  const filtered = useMemo(() => {\n    if (!query) return activeSkills;\n    return activeSkills.filter(\n      (s) =>\n        s.name.toLowerCase().includes(query) ||\n        s.description.toLowerCase().includes(query)\n    );\n  }, [activeSkills, query]);\n\n  const totalCount = filteredBuiltins.length + filtered.length;\n\n  // Reset selection on filter change\n  useEffect(() => {\n    setSelectedIndex(0);\n  }, [filtered.length, query]);\n\n  // Scroll selected into view\n  useEffect(() => {\n    const el = listRef.current?.children[selectedIndex] as HTMLElement | undefined;\n    el?.scrollIntoView({ block: \"nearest\" });\n  }, [selectedIndex]);\n\n  if (!visible || totalCount === 0) return null;\n\n  return (\n    <div\n      className=\"absolute bottom-full left-0 right-0 mx-auto max-w-3xl px-4 pb-2 z-50\"\n      onMouseDown={(e) => e.preventDefault()} // Prevent input blur\n    >\n      <div className=\"rounded-xl border border-border bg-background shadow-2xl overflow-hidden\">\n        {/* Header */}\n        <div className=\"flex items-center gap-2 border-b border-border/50 px-3 py-2\">\n          <Terminal className=\"h-3.5 w-3.5 text-muted-foreground\" />\n          <span className=\"text-xs text-muted-foreground\">Commands & Skills</span>\n          <span className=\"text-[10px] text-muted-foreground\">\n            {totalCount} available\n          </span>\n        </div>\n\n        {/* List */}\n        <div ref={listRef} className=\"max-h-64 overflow-y-auto py-1\">\n          {/* Built-in commands */}\n          {filteredBuiltins.length > 0 && (\n            <>\n              {filteredBuiltins.map((cmd, i) => (\n                <button\n                  key={`cmd-${cmd.name}`}\n                  onClick={() => {\n                    if (cmd.immediate) {\n                      onSelect(`/${cmd.name}`);\n                    } else {\n                      onSelect(`/${cmd.name} `);\n                    }\n                  }}\n                  onMouseEnter={() => setSelectedIndex(i)}\n                  className={`flex w-full items-center gap-3 px-3 py-2 text-left transition-colors ${\n                    i === selectedIndex ? \"bg-muted\" : \"hover:bg-muted/50\"\n                  }`}\n                >\n                  <span className=\"text-base shrink-0\">{cmd.emoji}</span>\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-center gap-1.5\">\n                      <span className=\"text-sm font-medium text-foreground\">\n                        /{cmd.name}\n                      </span>\n                    </div>\n                    <p className=\"text-xs text-muted-foreground truncate\">{cmd.description}</p>\n                  </div>\n                </button>\n              ))}\n              {filtered.length > 0 && (\n                <div className=\"mx-3 my-1 border-t border-border/30\" />\n              )}\n            </>\n          )}\n\n          {/* Skills */}\n          {filtered.map((skill, i) => {\n            const idx = filteredBuiltins.length + i;\n            return (\n              <button\n                key={skill.skillKey}\n                onClick={() => onSelect(`/${skill.name} `)}\n                onMouseEnter={() => setSelectedIndex(idx)}\n                className={`flex w-full items-center gap-3 px-3 py-2 text-left transition-colors ${\n                  idx === selectedIndex ? \"bg-muted\" : \"hover:bg-muted/50\"\n                }`}\n              >\n                <span className=\"text-base shrink-0\">{skill.emoji || \"🔧\"}</span>\n                <div className=\"flex-1 min-w-0\">\n                  <div className=\"flex items-center gap-1.5\">\n                    <span className=\"text-sm font-medium text-foreground\">\n                      /{skill.name}\n                    </span>\n                    {skill.homepage && (\n                      <ExternalLink className=\"h-2.5 w-2.5 text-muted-foreground\" />\n                    )}\n                  </div>\n                  <p className=\"text-xs text-muted-foreground truncate\">{skill.description}</p>\n                </div>\n              </button>\n            );\n          })}\n        </div>\n\n        {/* Footer hint */}\n        <div className=\"border-t border-border/50 px-3 py-1.5\">\n          <span className=\"text-[10px] text-muted-foreground\">\n            ↑↓ 이동 · Enter 선택 · Esc 닫기\n          </span>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n/** Keyboard handler for the skill picker — call from ChatInput's onKeyDown */\nexport function useSkillPickerKeys(\n  visible: boolean,\n  filteredCount: number,\n  selectedIndex: number,\n  setSelectedIndex: (i: number | ((prev: number) => number)) => void,\n  onSelect: (index: number) => void,\n  onDismiss: () => void\n) {\n  return (e: React.KeyboardEvent) => {\n    if (!visible) return false;\n\n    if (e.key === \"ArrowUp\") {\n      e.preventDefault();\n      setSelectedIndex((prev) => (prev > 0 ? prev - 1 : filteredCount - 1));\n      return true;\n    }\n    if (e.key === \"ArrowDown\") {\n      e.preventDefault();\n      setSelectedIndex((prev) => (prev < filteredCount - 1 ? prev + 1 : 0));\n      return true;\n    }\n    if (e.key === \"Tab\" || e.key === \"Enter\") {\n      e.preventDefault();\n      onSelect(selectedIndex);\n      return true;\n    }\n    if (e.key === \"Escape\") {\n      e.preventDefault();\n      onDismiss();\n      return true;\n    }\n    return false;\n  };\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2932, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/chat/chat-input.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useRef, useCallback, useEffect, useMemo } from \"react\";\nimport { AnimatePresence, motion } from \"framer-motion\";\nimport { ArrowUp, Paperclip, Square, X } from \"lucide-react\";\n\nimport { cn } from \"@/lib/utils\";\nimport { Button } from \"@/components/ui/button\";\nimport { useAutosizeTextArea } from \"@/hooks/use-autosize-textarea\";\nimport {\n  AttachmentPreview,\n  type ChatAttachment,\n} from \"./file-attachments\";\nimport { SkillPicker, BUILTIN_COMMANDS } from \"./skill-picker\";\nimport { useSkills } from \"@/lib/gateway/use-skills\";\n\nexport function ChatInput({\n  onSend,\n  onAbort,\n  streaming,\n  disabled,\n  attachments = [],\n  onAttachFiles,\n  onRemoveAttachment,\n  panelId,\n  toolbar,\n  agentAvatar,\n  agentSlot: agentSlotProp,\n}: {\n  onSend: (text: string) => void;\n  onAbort: () => void;\n  streaming: boolean;\n  disabled: boolean;\n  attachments?: ChatAttachment[];\n  onAttachFiles?: (files: File[]) => void;\n  onRemoveAttachment?: (id: string) => void;\n  panelId?: string;\n  /** Slot rendered inside the input container, above the textarea row */\n  toolbar?: React.ReactNode;\n  /** Optional agent avatar badge */\n  agentAvatar?: { emoji: string; color: string };\n  /** Custom agent slot node (overrides agentAvatar) */\n  agentSlot?: React.ReactNode;\n}) {\n  const agentSlotFromAvatar = agentAvatar ? (\n    <div\n      className={cn(\n        \"flex size-7 shrink-0 items-center justify-center rounded-full text-sm\",\n        agentAvatar.color\n      )}\n      title=\"에이전트\"\n    >\n      {agentAvatar.emoji}\n    </div>\n  ) : null;\n  const agentSlot = agentSlotProp || agentSlotFromAvatar;\n  const storageKey = panelId ? `awf:draft:${panelId}` : null;\n  const [text, setText] = useState(() => {\n    if (storageKey && typeof window !== \"undefined\") {\n      return localStorage.getItem(storageKey) || \"\";\n    }\n    return \"\";\n  });\n  const [isDragging, setIsDragging] = useState(false);\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n  const composingRef = useRef(false);\n\n  // Auto-resize\n  useAutosizeTextArea({\n    ref: textareaRef,\n    maxHeight: 200,\n    borderWidth: 1,\n    dependencies: [text, attachments.length > 0],\n  });\n\n  // Skill picker state\n  const [skillPickerOpen, setSkillPickerOpen] = useState(false);\n  const [skillSelectedIndex, setSkillSelectedIndex] = useState(0);\n  const { skills } = useSkills();\n  const activeSkills = useMemo(\n    () => skills.filter((s) => s.eligible && !s.disabled),\n    [skills]\n  );\n  const skillQuery = useMemo(() => {\n    if (!skillPickerOpen) return \"\";\n    const match = text.match(/^\\/(\\S*)$/);\n    return match ? match[1].toLowerCase() : \"\";\n  }, [text, skillPickerOpen]);\n  const filteredBuiltins = useMemo(() => {\n    if (!skillQuery) return BUILTIN_COMMANDS;\n    return BUILTIN_COMMANDS.filter(\n      (c) =>\n        c.name.toLowerCase().includes(skillQuery) ||\n        c.description.toLowerCase().includes(skillQuery)\n    );\n  }, [skillQuery]);\n\n  const filteredSkills = useMemo(() => {\n    if (!skillQuery) return activeSkills;\n    return activeSkills.filter(\n      (s) =>\n        s.name.toLowerCase().includes(skillQuery) ||\n        s.description.toLowerCase().includes(skillQuery)\n    );\n  }, [activeSkills, skillQuery]);\n\n  const totalPickerItems = filteredBuiltins.length + filteredSkills.length;\n\n  useEffect(() => {\n    const shouldShow = text === \"/\" || (/^\\/\\S*$/.test(text) && !text.includes(\" \"));\n    setSkillPickerOpen(shouldShow);\n    if (shouldShow) setSkillSelectedIndex(0);\n  }, [text]);\n\n  // Persist draft\n  useEffect(() => {\n    if (!storageKey) return;\n    if (text) {\n      localStorage.setItem(storageKey, text);\n    } else {\n      localStorage.removeItem(storageKey);\n    }\n  }, [text, storageKey]);\n\n  const canSend = text.trim().length > 0 || attachments.length > 0;\n\n  const handleSend = useCallback(() => {\n    if (!canSend || disabled) return;\n    onSend(text.trim());\n    setText(\"\");\n    if (storageKey) localStorage.removeItem(storageKey);\n  }, [text, disabled, onSend, canSend, storageKey]);\n\n  const handleSkillSelect = useCallback((command: string) => {\n    setText(command);\n    setSkillPickerOpen(false);\n    textareaRef.current?.focus();\n  }, []);\n\n  const handleKeyDown = useCallback(\n    (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n      if (e.nativeEvent.isComposing || composingRef.current) return;\n\n      // Skill picker navigation (builtins + skills)\n      if (skillPickerOpen && totalPickerItems > 0) {\n        if (e.key === \"ArrowUp\") {\n          e.preventDefault();\n          setSkillSelectedIndex((prev) =>\n            prev > 0 ? prev - 1 : totalPickerItems - 1\n          );\n          return;\n        }\n        if (e.key === \"ArrowDown\") {\n          e.preventDefault();\n          setSkillSelectedIndex((prev) =>\n            prev < totalPickerItems - 1 ? prev + 1 : 0\n          );\n          return;\n        }\n        if (e.key === \"Tab\" || (e.key === \"Enter\" && !e.shiftKey)) {\n          e.preventDefault();\n          if (skillSelectedIndex < filteredBuiltins.length) {\n            // Built-in command\n            const cmd = filteredBuiltins[skillSelectedIndex];\n            if (cmd.immediate) {\n              handleSkillSelect(`/${cmd.name}`);\n              // Trigger send immediately for immediate commands\n              onSend(`/${cmd.name}`);\n              setText(\"\");\n              if (storageKey) localStorage.removeItem(storageKey);\n            } else {\n              handleSkillSelect(`/${cmd.name} `);\n            }\n          } else {\n            // Skill\n            const skill = filteredSkills[skillSelectedIndex - filteredBuiltins.length];\n            if (skill) handleSkillSelect(`/${skill.name} `);\n          }\n          return;\n        }\n        if (e.key === \"Escape\") {\n          e.preventDefault();\n          setSkillPickerOpen(false);\n          return;\n        }\n      }\n\n      if (e.key === \"Enter\" && !e.shiftKey) {\n        e.preventDefault();\n        handleSend();\n      }\n    },\n    [handleSend, skillPickerOpen, filteredSkills, filteredBuiltins, totalPickerItems, skillSelectedIndex, handleSkillSelect, onSend, storageKey]\n  );\n\n  // Paste files\n  const handlePaste = useCallback(\n    (e: React.ClipboardEvent) => {\n      if (!onAttachFiles) return;\n      const items = e.clipboardData?.items;\n      if (!items) return;\n      const files: File[] = [];\n      for (const item of items) {\n        if (item.kind === \"file\") {\n          const file = item.getAsFile();\n          if (file) files.push(file);\n        }\n      }\n      if (files.length > 0) {\n        e.preventDefault();\n        onAttachFiles(files);\n      }\n    },\n    [onAttachFiles]\n  );\n\n  // Drag & drop\n  const onDragOver = useCallback(\n    (e: React.DragEvent) => {\n      if (!onAttachFiles) return;\n      e.preventDefault();\n      setIsDragging(true);\n    },\n    [onAttachFiles]\n  );\n  const onDragLeave = useCallback(\n    (e: React.DragEvent) => {\n      e.preventDefault();\n      setIsDragging(false);\n    },\n    []\n  );\n  const onDrop = useCallback(\n    (e: React.DragEvent) => {\n      setIsDragging(false);\n      if (!onAttachFiles) return;\n      e.preventDefault();\n      if (e.dataTransfer.files.length) {\n        onAttachFiles(Array.from(e.dataTransfer.files));\n      }\n    },\n    [onAttachFiles]\n  );\n\n  // Focus on mount\n  useEffect(() => {\n    textareaRef.current?.focus();\n  }, []);\n\n  const showAttachments = onRemoveAttachment && attachments.length > 0;\n\n  return (\n    <div className=\"relative px-2 py-2 sm:px-3 sm:py-3 md:px-4 safe-bottom\">\n      {/* Skill picker */}\n      <SkillPicker\n        inputText={text}\n        onSelect={handleSkillSelect}\n        onDismiss={() => setSkillPickerOpen(false)}\n        visible={skillPickerOpen}\n      />\n\n      <div\n        className=\"mx-auto w-full max-w-3xl\"\n      >\n        <div\n          className=\"flex-1\"\n          onDragOver={onDragOver}\n          onDragLeave={onDragLeave}\n          onDrop={onDrop}\n        >\n        <div\n          className={cn(\n            \"relative flex w-full flex-col rounded-xl sm:rounded-2xl border border-input bg-background shadow-sm transition-[border-color,box-shadow]\",\n            \"focus-within:border-primary focus-within:ring-[3px] focus-within:ring-primary/40\"\n          )}\n        >\n          {/* Toolbar: controls */}\n          {toolbar && (\n            <div className=\"flex w-full min-w-0 items-center gap-1.5 px-2.5 pt-2 sm:px-3\">\n              {toolbar}\n            </div>\n          )}\n\n          {/* Attachment previews inside container */}\n          {showAttachments && (\n            <div className=\"overflow-x-auto px-2 pt-2 sm:px-3 sm:pt-3\">\n              <AttachmentPreview\n                attachments={attachments}\n                onRemove={onRemoveAttachment}\n              />\n            </div>\n          )}\n\n          {/* Textarea + inline actions row */}\n          <div className=\"flex items-end gap-1 p-1.5 sm:p-2\">\n            {/* Attach button */}\n            {onAttachFiles && (\n              <Button\n                type=\"button\"\n                variant=\"ghost\"\n                size=\"icon-sm\"\n                className=\"shrink-0 rounded-lg text-muted-foreground hover:text-foreground\"\n                aria-label=\"파일 첨부\"\n                onClick={() => {\n                  const input = document.createElement(\"input\");\n                  input.type = \"file\";\n                  input.multiple = true;\n                  input.onchange = () => {\n                    if (input.files) onAttachFiles(Array.from(input.files));\n                  };\n                  input.click();\n                }}\n              >\n                <Paperclip className=\"size-4\" />\n              </Button>\n            )}\n\n            {/* Textarea */}\n            <textarea\n              ref={textareaRef}\n              aria-label=\"메시지를 입력하세요\"\n              value={text}\n              onChange={(e) => setText(e.target.value)}\n              onKeyDown={handleKeyDown}\n              onPaste={handlePaste}\n              onCompositionStart={() => {\n                composingRef.current = true;\n              }}\n              onCompositionEnd={() => {\n                composingRef.current = false;\n              }}\n              placeholder=\"메시지를 입력하세요...\"\n              disabled={disabled}\n              rows={1}\n              className=\"min-w-0 flex-1 resize-none bg-transparent px-1 py-1.5 text-sm text-foreground placeholder:text-muted-foreground outline-none disabled:cursor-not-allowed disabled:opacity-50\"\n            />\n\n            {/* Send / Stop button */}\n            {streaming ? (\n              <Button\n                type=\"button\"\n                size=\"icon-sm\"\n                className=\"shrink-0 rounded-lg\"\n                aria-label=\"중단\"\n                onClick={onAbort}\n              >\n                <Square className=\"size-3 animate-pulse\" fill=\"currentColor\" />\n              </Button>\n            ) : (\n              <Button\n                type=\"button\"\n                size=\"icon-sm\"\n                className=\"shrink-0 rounded-lg transition-opacity\"\n                aria-label=\"전송\"\n                onClick={handleSend}\n                disabled={disabled || !canSend}\n              >\n                <ArrowUp className=\"size-4\" strokeWidth={2.5} />\n              </Button>\n            )}\n          </div>\n\n          {/* Drag overlay */}\n          <AnimatePresence>\n            {isDragging && (\n              <motion.div\n                className=\"pointer-events-none absolute inset-0 z-20 flex items-center justify-center gap-2 rounded-xl sm:rounded-2xl border-2 border-dashed border-primary/50 bg-primary/5 text-sm text-muted-foreground\"\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                exit={{ opacity: 0 }}\n                transition={{ duration: 0.15 }}\n              >\n                <Paperclip className=\"size-4\" />\n                <span>파일을 놓으면 첨부됩니다</span>\n              </motion.div>\n            )}\n          </AnimatePresence>\n        </div>\n\n        </div>\n      </div>\n      <p className=\"mt-1 text-center text-[10px] sm:text-[11px] text-muted-foreground/50\">\n        Shift+Enter로 줄바꿈 · 에이전트는 실수할 수 있습니다\n      </p>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3376, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/lib/agent-avatars.ts"],"sourcesContent":["// Example agent avatar config — customize for your setup\n/** Agent avatar map — emoji or initials for each known agent */\n\nconst AGENT_AVATARS: Record<string, { emoji: string; color: string }> = {\n  karajan: { emoji: \"🎼\", color: \"bg-violet-500/20 text-violet-400\" },\n  brxce: { emoji: \"🧩\", color: \"bg-blue-500/20 text-blue-400\" },\n  roomfit: { emoji: \"🏋️\", color: \"bg-green-500/20 text-green-400\" },\n  iponoff: { emoji: \"💡\", color: \"bg-yellow-500/20 text-yellow-400\" },\n  finanz: { emoji: \"💰\", color: \"bg-emerald-500/20 text-emerald-400\" },\n  obsidian: { emoji: \"📝\", color: \"bg-purple-500/20 text-purple-400\" },\n  brand: { emoji: \"🎨\", color: \"bg-pink-500/20 text-pink-400\" },\n  funnel: { emoji: \"📊\", color: \"bg-cyan-500/20 text-cyan-400\" },\n  creator: { emoji: \"✍️\", color: \"bg-orange-500/20 text-orange-400\" },\n  intelli: { emoji: \"🏢\", color: \"bg-slate-500/20 text-slate-400\" },\n  newscash: { emoji: \"📰\", color: \"bg-red-500/20 text-red-400\" },\n  lab: { emoji: \"🧪\", color: \"bg-teal-500/20 text-teal-400\" },\n  kidsmind: { emoji: \"🎹\", color: \"bg-indigo-500/20 text-indigo-400\" },\n};\n\nconst DEFAULT_AVATAR = { emoji: \"🤖\", color: \"bg-primary/20 text-primary\" };\n\nexport function getAgentAvatar(agentId?: string) {\n  if (!agentId) return DEFAULT_AVATAR;\n  return AGENT_AVATARS[agentId.toLowerCase()] || DEFAULT_AVATAR;\n}\n"],"names":[],"mappings":"AAAA,yDAAyD;AACzD,8DAA8D;;;;AAE9D,MAAM,gBAAkE;IACtE,SAAS;QAAE,OAAO;QAAM,OAAO;IAAmC;IAClE,OAAO;QAAE,OAAO;QAAM,OAAO;IAA+B;IAC5D,SAAS;QAAE,OAAO;QAAO,OAAO;IAAiC;IACjE,SAAS;QAAE,OAAO;QAAM,OAAO;IAAmC;IAClE,QAAQ;QAAE,OAAO;QAAM,OAAO;IAAqC;IACnE,UAAU;QAAE,OAAO;QAAM,OAAO;IAAmC;IACnE,OAAO;QAAE,OAAO;QAAM,OAAO;IAA+B;IAC5D,QAAQ;QAAE,OAAO;QAAM,OAAO;IAA+B;IAC7D,SAAS;QAAE,OAAO;QAAM,OAAO;IAAmC;IAClE,SAAS;QAAE,OAAO;QAAM,OAAO;IAAiC;IAChE,UAAU;QAAE,OAAO;QAAM,OAAO;IAA6B;IAC7D,KAAK;QAAE,OAAO;QAAM,OAAO;IAA+B;IAC1D,UAAU;QAAE,OAAO;QAAM,OAAO;IAAmC;AACrE;AAEA,MAAM,iBAAiB;IAAE,OAAO;IAAM,OAAO;AAA6B;AAEnE,SAAS,eAAe,OAAgB;IAC7C,IAAI,CAAC,SAAS,OAAO;IACrB,OAAO,aAAa,CAAC,QAAQ,WAAW,GAAG,IAAI;AACjD","debugId":null}},
    {"offset": {"line": 3447, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/chat/avatar-agent-selector.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useRef, useEffect } from \"react\";\nimport { Check } from \"lucide-react\";\nimport type { Agent } from \"@/lib/gateway/protocol\";\nimport { getAgentAvatar } from \"@/lib/agent-avatars\";\nimport { cn } from \"@/lib/utils\";\n\nexport function AvatarAgentSelector({\n  agents,\n  selectedId,\n  onSelect,\n}: {\n  agents: Agent[];\n  selectedId?: string;\n  onSelect: (id: string | undefined) => void;\n}) {\n  const [open, setOpen] = useState(false);\n  const ref = useRef<HTMLDivElement>(null);\n  const avatar = getAgentAvatar(selectedId);\n\n  useEffect(() => {\n    function handleClick(e: MouseEvent) {\n      if (ref.current && !ref.current.contains(e.target as Node)) {\n        setOpen(false);\n      }\n    }\n    document.addEventListener(\"mousedown\", handleClick);\n    return () => document.removeEventListener(\"mousedown\", handleClick);\n  }, []);\n\n  return (\n    <div ref={ref} className=\"relative\">\n      <button\n        type=\"button\"\n        onClick={() => setOpen(!open)}\n        className={cn(\n          \"flex size-14 shrink-0 items-center justify-center rounded-full text-2xl transition-all hover:scale-110 hover:ring-2 hover:ring-ring/30\",\n          avatar.color\n        )}\n        title={selectedId ? `${selectedId} · 클릭하여 변경` : \"에이전트 선택\"}\n      >\n        {avatar.emoji}\n      </button>\n\n      {open && (\n        <div className=\"absolute bottom-full left-0 z-50 mb-2 w-52 rounded-xl border border-border bg-popover py-1 shadow-xl\">\n          {agents.map((agent) => {\n            const av = getAgentAvatar(agent.id);\n            return (\n              <button\n                key={agent.id}\n                onClick={() => {\n                  onSelect(agent.id);\n                  setOpen(false);\n                }}\n                className=\"flex w-full items-center gap-2.5 px-3 py-2 text-left text-sm text-foreground transition hover:bg-accent\"\n              >\n                <div\n                  className={cn(\n                    \"flex size-6 shrink-0 items-center justify-center rounded-full text-xs\",\n                    av.color\n                  )}\n                >\n                  {av.emoji}\n                </div>\n                <span className=\"flex-1 truncate\">{agent.name}</span>\n                {selectedId === agent.id && (\n                  <Check size={14} className=\"shrink-0 text-primary\" />\n                )}\n              </button>\n            );\n          })}\n\n          {agents.length === 0 && (\n            <div className=\"px-3 py-2 text-xs text-muted-foreground\">\n              에이전트 없음\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAEA;AACA;AANA;;;;;;AAQO,SAAS,oBAAoB,EAClC,MAAM,EACN,UAAU,EACV,QAAQ,EAKT;IACC,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,mXAAQ,EAAC;IACjC,MAAM,MAAM,IAAA,iXAAM,EAAiB;IACnC,MAAM,SAAS,IAAA,gJAAc,EAAC;IAE9B,IAAA,oXAAS,EAAC;QACR,SAAS,YAAY,CAAa;YAChC,IAAI,IAAI,OAAO,IAAI,CAAC,IAAI,OAAO,CAAC,QAAQ,CAAC,EAAE,MAAM,GAAW;gBAC1D,QAAQ;YACV;QACF;QACA,SAAS,gBAAgB,CAAC,aAAa;QACvC,OAAO,IAAM,SAAS,mBAAmB,CAAC,aAAa;IACzD,GAAG,EAAE;IAEL,qBACE,gZAAC;QAAI,KAAK;QAAK,WAAU;;0BACvB,gZAAC;gBACC,MAAK;gBACL,SAAS,IAAM,QAAQ,CAAC;gBACxB,WAAW,IAAA,yHAAE,EACX,0IACA,OAAO,KAAK;gBAEd,OAAO,aAAa,GAAG,WAAW,UAAU,CAAC,GAAG;0BAE/C,OAAO,KAAK;;;;;;YAGd,sBACC,gZAAC;gBAAI,WAAU;;oBACZ,OAAO,GAAG,CAAC,CAAC;wBACX,MAAM,KAAK,IAAA,gJAAc,EAAC,MAAM,EAAE;wBAClC,qBACE,gZAAC;4BAEC,SAAS;gCACP,SAAS,MAAM,EAAE;gCACjB,QAAQ;4BACV;4BACA,WAAU;;8CAEV,gZAAC;oCACC,WAAW,IAAA,yHAAE,EACX,yEACA,GAAG,KAAK;8CAGT,GAAG,KAAK;;;;;;8CAEX,gZAAC;oCAAK,WAAU;8CAAmB,MAAM,IAAI;;;;;;gCAC5C,eAAe,MAAM,EAAE,kBACtB,gZAAC,iSAAK;oCAAC,MAAM;oCAAI,WAAU;;;;;;;2BAjBxB,MAAM,EAAE;;;;;oBAqBnB;oBAEC,OAAO,MAAM,KAAK,mBACjB,gZAAC;wBAAI,WAAU;kCAA0C;;;;;;;;;;;;;;;;;;AAQrE","debugId":null}},
    {"offset": {"line": 3558, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/lib/gateway/session-utils.ts"],"sourcesContent":["/**\n * Session key parsing and grouping utilities\n */\n\nexport interface ParsedSessionKey {\n  agentId: string;\n  type: \"main\" | \"thread\" | \"cron\" | \"subagent\" | \"a2a\" | \"unknown\";\n  detail?: string;\n}\n\n/**\n * Parse a session key into agent ID and type.\n * Patterns:\n * - agent:{agentId}:main\n * - agent:{agentId}:main:thread:{id}\n * - agent:{agentId}:cron:{id}\n * - agent:{agentId}:subagent:{id}\n * - agent:{agentId}:agent:{targetAgent}:main\n */\nexport function parseSessionKey(key: string): ParsedSessionKey {\n  const parts = key.split(\":\");\n\n  if (parts[0] !== \"agent\" || parts.length < 3) {\n    return { agentId: \"unknown\", type: \"unknown\", detail: key };\n  }\n\n  const agentId = parts[1];\n\n  // agent:{id}:main:thread:{threadId}\n  if (parts[2] === \"main\" && parts[3] === \"thread\" && parts[4]) {\n    return { agentId, type: \"thread\", detail: parts[4] };\n  }\n\n  // agent:{id}:cron:{cronId}\n  if (parts[2] === \"cron\" && parts[3]) {\n    return { agentId, type: \"cron\", detail: parts[3] };\n  }\n\n  // agent:{id}:subagent:{subId}\n  if (parts[2] === \"subagent\" && parts[3]) {\n    return { agentId, type: \"subagent\", detail: parts[3] };\n  }\n\n  // agent:{id}:agent:{target}:main (A2A)\n  if (parts[2] === \"agent\" && parts[3] && parts[4] === \"main\") {\n    return { agentId, type: \"a2a\", detail: parts[3] };\n  }\n\n  // agent:{id}:main\n  if (parts[2] === \"main\") {\n    return { agentId, type: \"main\" };\n  }\n\n  return { agentId, type: \"unknown\", detail: key };\n}\n\nconst TYPE_LABELS: Record<string, string> = {\n  main: \"메인\",\n  thread: \"스레드\",\n  cron: \"크론\",\n  subagent: \"서브에이전트\",\n  a2a: \"A2A\",\n  unknown: \"\",\n};\n\n/**\n * Generate a human-friendly display name for a session\n */\nexport function sessionDisplayName(session: {\n  key: string;\n  label?: string | null;\n  displayName?: string | null;\n}): string {\n  if (session.label) return session.label;\n\n  const parsed = parseSessionKey(session.key);\n  const typeLabel = TYPE_LABELS[parsed.type] || \"\";\n\n  switch (parsed.type) {\n    case \"main\":\n      return `${parsed.agentId} ${typeLabel}`;\n    case \"thread\":\n      return `${parsed.agentId} ${typeLabel} #${parsed.detail}`;\n    case \"cron\":\n      return `${parsed.agentId} ${typeLabel} ${parsed.detail}`;\n    case \"subagent\":\n      return `${parsed.agentId} ${typeLabel} ${parsed.detail?.slice(0, 8)}`;\n    case \"a2a\":\n      return `${parsed.agentId} → ${parsed.detail}`;\n    default:\n      return session.displayName || session.key;\n  }\n}\n\nexport interface SessionGroup {\n  agentId: string;\n  sessions: GatewaySession[];\n}\n\nexport interface GatewaySession {\n  key: string;\n  kind?: string;\n  label?: string | null;\n  displayName?: string | null;\n  channel?: string | null;\n  updatedAt?: number;\n  totalTokens?: number;\n  model?: string;\n  modelProvider?: string;\n}\n\n/**\n * Group sessions by agent ID, sorted by most recent updatedAt within each group.\n * Groups are also sorted by most recent session.\n */\nexport function groupSessionsByAgent(sessions: GatewaySession[]): SessionGroup[] {\n  const map = new Map<string, GatewaySession[]>();\n\n  for (const s of sessions) {\n    const parsed = parseSessionKey(s.key);\n    const agent = parsed.agentId;\n    if (!map.has(agent)) map.set(agent, []);\n    map.get(agent)!.push(s);\n  }\n\n  // Sort sessions within each group by updatedAt desc\n  const groups: SessionGroup[] = [];\n  for (const [agentId, list] of map) {\n    list.sort((a, b) => (b.updatedAt || 0) - (a.updatedAt || 0));\n    groups.push({ agentId, sessions: list });\n  }\n\n  // Sort groups by most recent session\n  groups.sort((a, b) => {\n    const aTime = a.sessions[0]?.updatedAt || 0;\n    const bTime = b.sessions[0]?.updatedAt || 0;\n    return bTime - aTime;\n  });\n\n  return groups;\n}\n"],"names":[],"mappings":"AAAA;;CAEC;;;;;;;;AAiBM,SAAS,gBAAgB,GAAW;IACzC,MAAM,QAAQ,IAAI,KAAK,CAAC;IAExB,IAAI,KAAK,CAAC,EAAE,KAAK,WAAW,MAAM,MAAM,GAAG,GAAG;QAC5C,OAAO;YAAE,SAAS;YAAW,MAAM;YAAW,QAAQ;QAAI;IAC5D;IAEA,MAAM,UAAU,KAAK,CAAC,EAAE;IAExB,oCAAoC;IACpC,IAAI,KAAK,CAAC,EAAE,KAAK,UAAU,KAAK,CAAC,EAAE,KAAK,YAAY,KAAK,CAAC,EAAE,EAAE;QAC5D,OAAO;YAAE;YAAS,MAAM;YAAU,QAAQ,KAAK,CAAC,EAAE;QAAC;IACrD;IAEA,2BAA2B;IAC3B,IAAI,KAAK,CAAC,EAAE,KAAK,UAAU,KAAK,CAAC,EAAE,EAAE;QACnC,OAAO;YAAE;YAAS,MAAM;YAAQ,QAAQ,KAAK,CAAC,EAAE;QAAC;IACnD;IAEA,8BAA8B;IAC9B,IAAI,KAAK,CAAC,EAAE,KAAK,cAAc,KAAK,CAAC,EAAE,EAAE;QACvC,OAAO;YAAE;YAAS,MAAM;YAAY,QAAQ,KAAK,CAAC,EAAE;QAAC;IACvD;IAEA,uCAAuC;IACvC,IAAI,KAAK,CAAC,EAAE,KAAK,WAAW,KAAK,CAAC,EAAE,IAAI,KAAK,CAAC,EAAE,KAAK,QAAQ;QAC3D,OAAO;YAAE;YAAS,MAAM;YAAO,QAAQ,KAAK,CAAC,EAAE;QAAC;IAClD;IAEA,kBAAkB;IAClB,IAAI,KAAK,CAAC,EAAE,KAAK,QAAQ;QACvB,OAAO;YAAE;YAAS,MAAM;QAAO;IACjC;IAEA,OAAO;QAAE;QAAS,MAAM;QAAW,QAAQ;IAAI;AACjD;AAEA,MAAM,cAAsC;IAC1C,MAAM;IACN,QAAQ;IACR,MAAM;IACN,UAAU;IACV,KAAK;IACL,SAAS;AACX;AAKO,SAAS,mBAAmB,OAIlC;IACC,IAAI,QAAQ,KAAK,EAAE,OAAO,QAAQ,KAAK;IAEvC,MAAM,SAAS,gBAAgB,QAAQ,GAAG;IAC1C,MAAM,YAAY,WAAW,CAAC,OAAO,IAAI,CAAC,IAAI;IAE9C,OAAQ,OAAO,IAAI;QACjB,KAAK;YACH,OAAO,GAAG,OAAO,OAAO,CAAC,CAAC,EAAE,WAAW;QACzC,KAAK;YACH,OAAO,GAAG,OAAO,OAAO,CAAC,CAAC,EAAE,UAAU,EAAE,EAAE,OAAO,MAAM,EAAE;QAC3D,KAAK;YACH,OAAO,GAAG,OAAO,OAAO,CAAC,CAAC,EAAE,UAAU,CAAC,EAAE,OAAO,MAAM,EAAE;QAC1D,KAAK;YACH,OAAO,GAAG,OAAO,OAAO,CAAC,CAAC,EAAE,UAAU,CAAC,EAAE,OAAO,MAAM,EAAE,MAAM,GAAG,IAAI;QACvE,KAAK;YACH,OAAO,GAAG,OAAO,OAAO,CAAC,GAAG,EAAE,OAAO,MAAM,EAAE;QAC/C;YACE,OAAO,QAAQ,WAAW,IAAI,QAAQ,GAAG;IAC7C;AACF;AAuBO,SAAS,qBAAqB,QAA0B;IAC7D,MAAM,MAAM,IAAI;IAEhB,KAAK,MAAM,KAAK,SAAU;QACxB,MAAM,SAAS,gBAAgB,EAAE,GAAG;QACpC,MAAM,QAAQ,OAAO,OAAO;QAC5B,IAAI,CAAC,IAAI,GAAG,CAAC,QAAQ,IAAI,GAAG,CAAC,OAAO,EAAE;QACtC,IAAI,GAAG,CAAC,OAAQ,IAAI,CAAC;IACvB;IAEA,oDAAoD;IACpD,MAAM,SAAyB,EAAE;IACjC,KAAK,MAAM,CAAC,SAAS,KAAK,IAAI,IAAK;QACjC,KAAK,IAAI,CAAC,CAAC,GAAG,IAAM,CAAC,EAAE,SAAS,IAAI,CAAC,IAAI,CAAC,EAAE,SAAS,IAAI,CAAC;QAC1D,OAAO,IAAI,CAAC;YAAE;YAAS,UAAU;QAAK;IACxC;IAEA,qCAAqC;IACrC,OAAO,IAAI,CAAC,CAAC,GAAG;QACd,MAAM,QAAQ,EAAE,QAAQ,CAAC,EAAE,EAAE,aAAa;QAC1C,MAAM,QAAQ,EAAE,QAAQ,CAAC,EAAE,EAAE,aAAa;QAC1C,OAAO,QAAQ;IACjB;IAEA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 3679, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/chat/session-switcher.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useRef, useEffect, useCallback, useMemo } from \"react\";\nimport { createPortal } from \"react-dom\";\nimport { useIsMobile } from \"@/lib/hooks/use-mobile\";\nimport {\n  MessageSquare,\n  Plus,\n  Search,\n  Pencil,\n  Trash2,\n  RotateCcw,\n  X,\n  Clock,\n  Bot,\n  Hash,\n  Timer,\n  GitBranch,\n  ArrowRight,\n  Check,\n  Command,\n} from \"lucide-react\";\nimport {\n  parseSessionKey,\n  sessionDisplayName,\n  type GatewaySession,\n} from \"@/lib/gateway/session-utils\";\nimport type { Session } from \"@/lib/gateway/protocol\";\n\n// ---- Type icon per session type ----\n\nconst TYPE_ICONS: Record<string, typeof Bot> = {\n  main: Bot,\n  thread: Hash,\n  cron: Timer,\n  subagent: GitBranch,\n  a2a: ArrowRight,\n};\n\nfunction SessionTypeIcon({ type, size = 14 }: { type: string; size?: number }) {\n  const Icon = TYPE_ICONS[type] || MessageSquare;\n  return <Icon size={size} className=\"shrink-0 text-muted-foreground\" />;\n}\n\n// ---- Relative time helper ----\n\nfunction relativeTime(ts?: number): string {\n  if (!ts) return \"\";\n  const diff = Date.now() - ts;\n  if (diff < 60_000) return \"방금\";\n  if (diff < 3600_000) return `${Math.floor(diff / 60_000)}분 전`;\n  if (diff < 86400_000) return `${Math.floor(diff / 3600_000)}시간 전`;\n  return `${Math.floor(diff / 86400_000)}일 전`;\n}\n\n// ---- Agent color helper (hash-based) ----\n\nconst AGENT_COLORS = [\n  \"bg-emerald-500/20 text-emerald-400 border-emerald-500/30\",\n  \"bg-blue-500/20 text-primary border-blue-500/30\",\n  \"bg-purple-500/20 text-purple-400 border-purple-500/30\",\n  \"bg-amber-500/20 text-amber-400 border-amber-500/30\",\n  \"bg-rose-500/20 text-rose-400 border-rose-500/30\",\n  \"bg-cyan-500/20 text-cyan-400 border-cyan-500/30\",\n  \"bg-pink-500/20 text-pink-400 border-pink-500/30\",\n  \"bg-lime-500/20 text-lime-400 border-lime-500/30\",\n];\n\nfunction agentColor(agentId: string): string {\n  let hash = 0;\n  for (let i = 0; i < agentId.length; i++) {\n    hash = (hash * 31 + agentId.charCodeAt(i)) | 0;\n  }\n  return AGENT_COLORS[Math.abs(hash) % AGENT_COLORS.length];\n}\n\nfunction AgentBadge({ agentId }: { agentId: string }) {\n  return (\n    <span\n      className={`inline-flex items-center rounded-md border px-1.5 py-0.5 text-[10px] font-medium leading-none ${agentColor(agentId)}`}\n    >\n      {agentId}\n    </span>\n  );\n}\n\n// ---- Props ----\n\nexport interface SessionSwitcherProps {\n  sessions: (Session | GatewaySession)[];\n  currentKey?: string;\n  onSelect: (key: string) => void;\n  onNew: () => void;\n  onRename?: (key: string, label: string) => Promise<void>;\n  onDelete?: (key: string) => Promise<void>;\n  onReset?: (key: string) => Promise<void>;\n  open?: boolean;\n  onOpenChange?: (open: boolean) => void;\n  /** Portal target — palette centers inside this element instead of viewport */\n  portalContainer?: HTMLElement | null;\n}\n\nexport function SessionSwitcher({\n  sessions,\n  currentKey,\n  onSelect,\n  onNew,\n  onRename,\n  onDelete,\n  onReset,\n  open: controlledOpen,\n  onOpenChange,\n  portalContainer,\n}: SessionSwitcherProps) {\n  const isMobile = useIsMobile();\n  const [internalOpen, setInternalOpen] = useState(false);\n  const isControlled = controlledOpen !== undefined;\n  const open = isControlled ? controlledOpen : internalOpen;\n  const setOpen = useCallback(\n    (v: boolean) => {\n      if (isControlled) {\n        onOpenChange?.(v);\n      } else {\n        setInternalOpen(v);\n      }\n    },\n    [isControlled, onOpenChange],\n  );\n\n  const [search, setSearch] = useState(\"\");\n  const [selectedIndex, setSelectedIndex] = useState(0);\n  const [editingKey, setEditingKey] = useState<string | null>(null);\n  const [editLabel, setEditLabel] = useState(\"\");\n  const [actionBusy, setActionBusy] = useState(false);\n  const [visibleCount, setVisibleCount] = useState(40);\n\n  const searchRef = useRef<HTMLInputElement>(null);\n  const listRef = useRef<HTMLDivElement>(null);\n  const isKeyboardNav = useRef(false);\n\n  // Convert to GatewaySession format\n  const gwSessions = useMemo((): GatewaySession[] => {\n    return sessions.map((s) => ({\n      key: s.key,\n      label:\n        \"label\" in s\n          ? (s as GatewaySession).label\n          : \"title\" in s\n            ? (s as Session).title\n            : null,\n      displayName:\n        \"displayName\" in s\n          ? (s as GatewaySession).displayName\n          : \"agentName\" in s\n            ? (s as Session).agentName\n            : null,\n      channel: \"channel\" in s ? (s as GatewaySession).channel : undefined,\n      updatedAt:\n        \"updatedAt\" in s\n          ? typeof s.updatedAt === \"number\"\n            ? s.updatedAt\n            : typeof s.updatedAt === \"string\"\n              ? new Date(s.updatedAt).getTime()\n              : undefined\n          : undefined,\n      totalTokens:\n        \"totalTokens\" in s ? (s as GatewaySession).totalTokens : undefined,\n      model: \"model\" in s ? (s as GatewaySession).model : undefined,\n    }));\n  }, [sessions]);\n\n  // Sort by updatedAt desc (flat list, no grouping)\n  const sorted = useMemo(() => {\n    return [...gwSessions].sort(\n      (a, b) => (b.updatedAt || 0) - (a.updatedAt || 0),\n    );\n  }, [gwSessions]);\n\n  // Filter\n  const filtered = useMemo(() => {\n    // Hide cron and subagent sessions from the list (unless explicitly searched)\n    const isSystemSearch = search.toLowerCase().includes(\"cron\") || search.toLowerCase().includes(\"subagent\");\n    const visible = sorted.filter((s) => {\n      const parsed = parseSessionKey(s.key);\n      if (!isSystemSearch && (parsed.type === \"cron\" || parsed.type === \"subagent\")) return false;\n      return true;\n    });\n    if (!search.trim()) return visible;\n    const q = search.toLowerCase();\n    return visible.filter((s) => {\n      const name = sessionDisplayName(s).toLowerCase();\n      const key = s.key.toLowerCase();\n      const parsed = parseSessionKey(s.key);\n      const agent = parsed.agentId.toLowerCase();\n      return name.includes(q) || key.includes(q) || agent.includes(q);\n    });\n  }, [sorted, search]);\n\n  const displayed = useMemo(() => filtered.slice(0, visibleCount), [filtered, visibleCount]);\n\n  // Reset selection when search changes\n  useEffect(() => {\n    setSelectedIndex(0);\n  }, [search]);\n\n  // Ensure selected row is rendered (keyboard nav)\n  useEffect(() => {\n    if (selectedIndex >= visibleCount - 1) {\n      setVisibleCount((v) => Math.min(filtered.length, v + 40));\n    }\n  }, [selectedIndex, visibleCount, filtered.length]);\n\n  // Focus search on open, reset on close\n  useEffect(() => {\n    if (open) {\n      setSearch(\"\");\n      setEditingKey(null);\n      setSelectedIndex(0);\n      setVisibleCount(40); // progressive render for performance\n      setTimeout(() => searchRef.current?.focus(), 16);\n      // warm up list after first paint\n      setTimeout(() => setVisibleCount(120), 60);\n    }\n  }, [open]);\n\n  // Global Escape key listener (works even when palette div has no focus)\n  useEffect(() => {\n    if (!open) return;\n    const handler = (e: KeyboardEvent) => {\n      if (e.key === \"Escape\") {\n        e.preventDefault();\n        e.stopPropagation();\n        setOpen(false);\n      }\n    };\n    document.addEventListener(\"keydown\", handler, true);\n    return () => document.removeEventListener(\"keydown\", handler, true);\n  }, [open, setOpen]);\n\n  // Scroll selected item into view (only on keyboard nav)\n  useEffect(() => {\n    if (!isKeyboardNav.current || !listRef.current) return;\n    const items = listRef.current.querySelectorAll(\"[data-session-item]\");\n    const target = items[selectedIndex] as HTMLElement | undefined;\n    target?.scrollIntoView({ block: \"nearest\" });\n    // Reset after scroll completes to avoid mouse-hover interference\n    requestAnimationFrame(() => {\n      isKeyboardNav.current = false;\n    });\n  }, [selectedIndex]);\n\n  // Keyboard navigation\n  const handleKeyDown = useCallback(\n    (e: React.KeyboardEvent) => {\n      if (editingKey) return; // let inline edit handle keys\n\n      // +1 for \"new conversation\" item at the end\n      const totalItems = filtered.length + 1;\n\n      switch (e.key) {\n        case \"ArrowDown\":\n          e.preventDefault();\n          isKeyboardNav.current = true;\n          setSelectedIndex((i) => (i + 1) % totalItems);\n          break;\n        case \"ArrowUp\":\n          e.preventDefault();\n          isKeyboardNav.current = true;\n          setSelectedIndex((i) => (i - 1 + totalItems) % totalItems);\n          break;\n        case \"Enter\":\n          e.preventDefault();\n          if (selectedIndex < filtered.length) {\n            onSelect(filtered[selectedIndex].key);\n            setOpen(false);\n          } else {\n            onNew();\n            setOpen(false);\n          }\n          break;\n        case \"Escape\":\n          e.preventDefault();\n          setOpen(false);\n          break;\n      }\n    },\n    [editingKey, filtered, selectedIndex, onSelect, onNew, setOpen],\n  );\n\n  // Actions\n  const handleRename = useCallback(\n    async (key: string) => {\n      if (!onRename || !editLabel.trim() || actionBusy) return;\n      setActionBusy(true);\n      try {\n        await onRename(key, editLabel.trim());\n      } finally {\n        setActionBusy(false);\n        setEditingKey(null);\n      }\n    },\n    [onRename, editLabel, actionBusy],\n  );\n\n  const handleDelete = useCallback(\n    async (key: string) => {\n      if (!onDelete || actionBusy) return;\n      if (!confirm(`세션을 삭제하시겠습니까?\\n${key}`)) return;\n      setActionBusy(true);\n      try {\n        await onDelete(key);\n      } finally {\n        setActionBusy(false);\n      }\n    },\n    [onDelete, actionBusy],\n  );\n\n  const handleReset = useCallback(\n    async (key: string) => {\n      if (!onReset || actionBusy) return;\n      if (\n        !confirm(`세션을 리셋하시겠습니까? 모든 메시지가 초기화됩니다.\\n${key}`)\n      )\n        return;\n      setActionBusy(true);\n      try {\n        await onReset(key);\n      } finally {\n        setActionBusy(false);\n      }\n    },\n    [onReset, actionBusy],\n  );\n\n  const current = gwSessions.find((s) => s.key === currentKey);\n  const currentParsed = currentKey ? parseSessionKey(currentKey) : null;\n\n  return (\n    <>\n      {/* Trigger — Option D: Minimal Dot + Inline */}\n      <button\n        onClick={() => setOpen(true)}\n        className=\"flex min-w-0 flex-1 items-center gap-2 rounded-lg px-2 py-1.5 text-sm transition hover:bg-muted\"\n      >\n        <span className=\"size-2 shrink-0 rounded-full bg-emerald-500\" />\n        <span className=\"min-w-0 flex-1 truncate text-left text-foreground\">\n          {current ? (\n            current.label ? (\n              <>\n                <strong className=\"font-semibold\">{currentParsed?.agentId || \"agent\"}</strong>\n                <span className=\"text-muted-foreground\"> / </span>\n                {current.label.replace(new RegExp(`^${currentParsed?.agentId || \"\"}/`), \"\")}\n              </>\n            ) : sessionDisplayName(current)\n          ) : currentParsed ? (\n            <>\n              <strong className=\"font-semibold\">{currentParsed.agentId}</strong>\n              {currentParsed.type === \"thread\" && (\n                <span className=\"text-muted-foreground\"> / 새 세션</span>\n              )}\n            </>\n          ) : \"세션 선택\"}\n        </span>\n      </button>\n\n      {/* Command palette modal — portal to panel container or body */}\n      {open && createPortal(\n        <div\n          className={`${portalContainer ? \"absolute\" : \"fixed\"} inset-0 z-[9999] flex ${isMobile ? \"items-end\" : \"items-start justify-center pt-[15vh]\"} animate-in fade-in duration-150`}\n          onKeyDown={handleKeyDown}\n        >\n          {/* Backdrop */}\n          <div\n            className=\"absolute inset-0 bg-black/60 backdrop-blur-sm\"\n            onClick={() => setOpen(false)}\n          />\n\n          {/* Palette */}\n          <div className={`relative w-full bg-card shadow-2xl shadow-black/50 animate-in duration-200 ${\n            isMobile\n              ? \"max-h-[85vh] rounded-t-2xl slide-in-from-bottom-4 fade-in safe-bottom\"\n              : \"max-w-lg rounded-xl border border-border slide-in-from-top-4 fade-in\"\n          }`}>\n            {/* Search input */}\n            <div className=\"flex items-center gap-3 border-b border-border/50 px-4 py-3\">\n              <Search size={16} className=\"shrink-0 text-muted-foreground\" />\n              <input\n                ref={searchRef}\n                type=\"text\"\n                value={search}\n                onChange={(e) => setSearch(e.target.value)}\n                placeholder=\"세션 검색... (이름, 에이전트, 키)\"\n                className=\"flex-1 bg-transparent text-sm text-foreground placeholder:text-muted-foreground outline-none\"\n              />\n              {search && (\n                <button\n                  onClick={() => setSearch(\"\")}\n                  className=\"text-muted-foreground hover:text-foreground\"\n                >\n                  <X size={14} />\n                </button>\n              )}\n              <kbd className=\"rounded border border-border bg-muted px-1.5 py-0.5 text-[10px] text-muted-foreground\">\n                ESC\n              </kbd>\n            </div>\n\n            {/* Session count */}\n            <div className=\"border-b border-border px-4 py-1.5 text-xs text-muted-foreground\">\n              {filtered.length}개 세션{\" \"}\n              {search && `(${gwSessions.length}개 중)`}\n            </div>\n\n            {/* Session list */}\n            <div\n              ref={listRef}\n              className={`${isMobile ? \"max-h-[60vh]\" : \"max-h-80\"} overflow-y-auto py-1`}\n              style={{ WebkitOverflowScrolling: \"touch\" }}\n              onScroll={(e) => {\n                const el = e.currentTarget;\n                if (el.scrollTop + el.clientHeight >= el.scrollHeight - 120) {\n                  setVisibleCount((v) => Math.min(filtered.length, v + 40));\n                }\n              }}\n            >\n              {filtered.length === 0 && (\n                <div className=\"px-4 py-6 text-center text-xs text-muted-foreground\">\n                  검색 결과 없음\n                </div>\n              )}\n\n              {displayed.map((session, index) => {\n                const parsed = parseSessionKey(session.key);\n                const isEditing = editingKey === session.key;\n                const isCurrent = currentKey === session.key;\n                const isSelected = selectedIndex === index;\n\n                return (\n                  <div\n                    key={session.key}\n                    data-session-item\n                    className={`group mx-1 flex items-center gap-3 rounded-lg px-3 py-2.5 min-h-[44px] transition-colors ${\n                      isSelected ? \"bg-muted/70\" : \"hover:bg-muted\"\n                    }`}\n                    onMouseMove={() => {\n                      if (!isKeyboardNav.current && selectedIndex !== index) setSelectedIndex(index);\n                    }}\n                  >\n                    {/* Click to select */}\n                    <button\n                      onClick={() => {\n                        if (!isEditing) {\n                          onSelect(session.key);\n                          setOpen(false);\n                        }\n                      }}\n                      className=\"flex flex-1 items-center gap-3 text-left min-w-0\"\n                    >\n                      <SessionTypeIcon type={parsed.type} />\n\n                      <div className=\"flex-1 min-w-0\">\n                        {isEditing ? (\n                          <input\n                            value={editLabel}\n                            onChange={(e) => setEditLabel(e.target.value)}\n                            onKeyDown={(e) => {\n                              e.stopPropagation();\n                              if (e.key === \"Enter\") handleRename(session.key);\n                              if (e.key === \"Escape\") setEditingKey(null);\n                            }}\n                            onClick={(e) => e.stopPropagation()}\n                            className=\"w-full rounded border border-border bg-muted px-2 py-1 text-sm text-foreground outline-none focus:border-ring\"\n                            autoFocus\n                          />\n                        ) : (\n                          <>\n                            <div className=\"flex items-center gap-2\">\n                              <span className=\"truncate text-sm text-foreground\">\n                                {sessionDisplayName(session)}\n                              </span>\n                              <AgentBadge agentId={parsed.agentId} />\n                            </div>\n                            <div className=\"mt-0.5 flex items-center gap-2 text-xs text-muted-foreground\">\n                              {session.channel && (\n                                <span>{session.channel}</span>\n                              )}\n                              {session.updatedAt && (\n                                <span className=\"flex items-center gap-0.5\">\n                                  <Clock size={10} />\n                                  {relativeTime(session.updatedAt)}\n                                </span>\n                              )}\n                              {session.totalTokens != null &&\n                                session.totalTokens > 0 && (\n                                  <span>\n                                    {(session.totalTokens / 1000).toFixed(0)}k\n                                    tok\n                                  </span>\n                                )}\n                            </div>\n                          </>\n                        )}\n                      </div>\n\n                      {isCurrent && !isEditing && (\n                        <Check\n                          size={14}\n                          className=\"shrink-0 text-emerald-400\"\n                        />\n                      )}\n                    </button>\n\n                    {/* Action buttons - show on hover or when selected */}\n                    {!isEditing && (\n                      <div\n                        className={`shrink-0 items-center gap-0.5 ${\n                          isSelected ? \"flex\" : \"hidden group-hover:flex\"\n                        }`}\n                      >\n                        {onRename && (\n                          <button\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              setEditLabel(\n                                session.label || sessionDisplayName(session),\n                              );\n                              setEditingKey(session.key);\n                            }}\n                            className=\"rounded p-1 text-muted-foreground hover:bg-accent hover:text-foreground\"\n                            title=\"이름 변경\"\n                          >\n                            <Pencil size={12} />\n                          </button>\n                        )}\n                        {onReset && (\n                          <button\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              handleReset(session.key);\n                            }}\n                            className=\"rounded p-1 text-muted-foreground hover:bg-accent hover:text-foreground\"\n                            title=\"리셋\"\n                          >\n                            <RotateCcw size={12} />\n                          </button>\n                        )}\n                        {onDelete && (\n                          <button\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              handleDelete(session.key);\n                            }}\n                            className=\"rounded p-1 text-muted-foreground hover:bg-red-900/50 hover:text-destructive\"\n                            title=\"삭제\"\n                          >\n                            <Trash2 size={12} />\n                          </button>\n                        )}\n                      </div>\n                    )}\n\n                    {/* Edit confirm/cancel */}\n                    {isEditing && (\n                      <div className=\"flex shrink-0 items-center gap-0.5\">\n                        <button\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            handleRename(session.key);\n                          }}\n                          disabled={actionBusy}\n                          className=\"rounded p-1 text-emerald-400 hover:bg-accent\"\n                          title=\"저장\"\n                        >\n                          <Check size={12} />\n                        </button>\n                        <button\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            setEditingKey(null);\n                          }}\n                          className=\"rounded p-1 text-muted-foreground hover:bg-accent\"\n                          title=\"취소\"\n                        >\n                          <X size={12} />\n                        </button>\n                      </div>\n                    )}\n                  </div>\n                );\n              })}\n\n              {/* New conversation item */}\n              <div\n                data-session-item\n                className={`mx-1 flex cursor-pointer items-center gap-3 rounded-lg px-3 py-2.5 transition-colors ${\n                  selectedIndex === filtered.length\n                    ? \"bg-muted/70\"\n                    : \"hover:bg-muted\"\n                }`}\n                onMouseMove={() => {\n                  if (!isKeyboardNav.current && selectedIndex !== filtered.length) setSelectedIndex(filtered.length);\n                }}\n                onClick={() => {\n                  onNew();\n                  setOpen(false);\n                }}\n              >\n                <Plus size={14} className=\"text-primary\" />\n                <span className=\"text-sm text-primary\">새 대화 시작</span>\n                <kbd className=\"ml-auto rounded border border-border bg-muted px-1.5 py-0.5 text-[10px] text-muted-foreground\">\n                  ↵\n                </kbd>\n              </div>\n            </div>\n\n            {/* Footer hint (desktop only) */}\n            {!isMobile && (\n              <div className=\"flex items-center gap-3 border-t border-border px-4 py-2 text-[10px] text-muted-foreground\">\n                <span className=\"flex items-center gap-1\">\n                  <kbd className=\"rounded border border-border px-1\">↑↓</kbd>\n                  이동\n                </span>\n                <span className=\"flex items-center gap-1\">\n                  <kbd className=\"rounded border border-border px-1\">↵</kbd>\n                  선택\n                </span>\n                <span className=\"flex items-center gap-1\">\n                  <kbd className=\"rounded border border-border px-1\">R</kbd>\n                  이름변경\n                </span>\n                <span className=\"flex items-center gap-1\">\n                  <kbd className=\"rounded border border-border px-1\">esc</kbd>\n                  닫기\n                </span>\n              </div>\n            )}\n          </div>\n        </div>,\n        portalContainer || document.body\n      )}\n    </>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 4551, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/chat/task-memo.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useCallback, useEffect, useRef, memo } from \"react\";\nimport { ChevronDown, ChevronRight, Plus, X, Pencil, Check } from \"lucide-react\";\n\nexport interface TaskItem {\n  id: string;\n  text: string;\n  status: \"pending\" | \"in-progress\" | \"done\";\n}\n\nexport interface TaskMemoData {\n  items: TaskItem[];\n  updatedAt: number;\n}\n\nconst STATUS_ICONS: Record<TaskItem[\"status\"], string> = {\n  pending: \"⬜\",\n  \"in-progress\": \"🔄\",\n  done: \"✅\",\n};\n\nconst STATUS_CYCLE: TaskItem[\"status\"][] = [\"pending\", \"in-progress\", \"done\"];\n\n// --- localStorage helpers ---\n\nfunction storageKey(sessionKey: string) {\n  return `awf:task-memo:${sessionKey}`;\n}\n\nfunction loadMemo(sessionKey: string): TaskMemoData {\n  if (typeof window === \"undefined\") return { items: [], updatedAt: 0 };\n  try {\n    const raw = localStorage.getItem(storageKey(sessionKey));\n    if (!raw) return { items: [], updatedAt: 0 };\n    return JSON.parse(raw);\n  } catch {\n    return { items: [], updatedAt: 0 };\n  }\n}\n\nfunction saveMemo(sessionKey: string, data: TaskMemoData) {\n  if (typeof window === \"undefined\") return;\n  localStorage.setItem(storageKey(sessionKey), JSON.stringify(data));\n}\n\n// --- Parse task-memo from assistant messages ---\n\nconst TASK_MEMO_RE = /<!--\\s*task-memo:\\s*(\\{[\\s\\S]*?\\})\\s*-->/;\n\nfunction extractText(msg: Record<string, unknown>): string {\n  const content = msg.content;\n  if (typeof content === \"string\") return content;\n  if (Array.isArray(content)) {\n    return (content as Array<{ type?: string; text?: string }>)\n      .filter((c) => c.type === \"text\" && typeof c.text === \"string\")\n      .map((c) => c.text!)\n      .join(\"\\n\");\n  }\n  if (typeof msg.text === \"string\") return msg.text;\n  return \"\";\n}\n\nfunction parseItemEntry(item: string | TaskItem, idx: number): TaskItem {\n  if (typeof item === \"string\") {\n    const status = item.startsWith(\"✅\")\n      ? \"done\"\n      : item.startsWith(\"🔄\")\n        ? \"in-progress\"\n        : \"pending\";\n    const cleanText = item.replace(/^[✅🔄⬜]\\s*/, \"\");\n    return { id: `auto-${idx}`, text: cleanText, status };\n  }\n  return { id: item.id || `auto-${idx}`, text: item.text, status: item.status || \"pending\" };\n}\n\nexport function parseTaskMemoFromMessages(messages: Array<Record<string, unknown>>): TaskItem[] | null {\n  // Scan from latest to earliest, return first match\n  for (let i = messages.length - 1; i >= 0; i--) {\n    const msg = messages[i];\n    if (msg.role !== \"assistant\") continue;\n\n    const text = extractText(msg);\n    const match = text.match(TASK_MEMO_RE);\n    if (match) {\n      try {\n        const parsed = JSON.parse(match[1]);\n        if (Array.isArray(parsed.items)) {\n          return parsed.items.map(parseItemEntry);\n        }\n      } catch {\n        // ignore parse errors\n      }\n    }\n  }\n  return null;\n}\n\n// --- Component ---\n\ninterface TaskMemoProps {\n  sessionKey: string;\n  messages: Array<Record<string, unknown>>;\n}\n\nexport const TaskMemo = memo(function TaskMemo({ sessionKey, messages }: TaskMemoProps) {\n  const [memo, setMemo] = useState<TaskMemoData>(() => loadMemo(sessionKey));\n  const [collapsed, setCollapsed] = useState(() => {\n    if (typeof window === \"undefined\") return false;\n    return localStorage.getItem(\"awf:task-memo:collapsed\") === \"true\";\n  });\n  const [editingId, setEditingId] = useState<string | null>(null);\n  const [editText, setEditText] = useState(\"\");\n  const [addingNew, setAddingNew] = useState(false);\n  const [newText, setNewText] = useState(\"\");\n  const inputRef = useRef<HTMLInputElement>(null);\n  const lastAutoUpdateRef = useRef<number>(0);\n\n  // Reload memo when session changes\n  useEffect(() => {\n    setMemo(loadMemo(sessionKey));\n  }, [sessionKey]);\n\n  // Auto-update from assistant messages\n  // Derive a lightweight fingerprint so the effect fires on content changes\n  const msgFingerprint = messages.length > 0\n    ? `${messages.length}:${extractText(messages[messages.length - 1]).length}`\n    : \"0:0\";\n\n  useEffect(() => {\n    const autoItems = parseTaskMemoFromMessages(messages);\n    if (!autoItems) return;\n    const now = Date.now();\n    if (now - lastAutoUpdateRef.current < 300) return;\n    lastAutoUpdateRef.current = now;\n\n    const newMemo: TaskMemoData = {\n      items: autoItems,\n      updatedAt: now,\n    };\n    setMemo(newMemo);\n    saveMemo(sessionKey, newMemo);\n  }, [messages, sessionKey, msgFingerprint]);\n\n  const updateMemo = useCallback(\n    (updater: (prev: TaskMemoData) => TaskMemoData) => {\n      setMemo((prev) => {\n        const next = updater(prev);\n        next.updatedAt = Date.now();\n        saveMemo(sessionKey, next);\n        return next;\n      });\n    },\n    [sessionKey]\n  );\n\n  const toggleCollapsed = () => {\n    const next = !collapsed;\n    setCollapsed(next);\n    localStorage.setItem(\"awf:task-memo:collapsed\", String(next));\n  };\n\n  const cycleStatus = (id: string) => {\n    updateMemo((prev) => ({\n      ...prev,\n      items: prev.items.map((item) => {\n        if (item.id !== id) return item;\n        const idx = STATUS_CYCLE.indexOf(item.status);\n        return { ...item, status: STATUS_CYCLE[(idx + 1) % STATUS_CYCLE.length] };\n      }),\n    }));\n  };\n\n  const removeItem = (id: string) => {\n    updateMemo((prev) => ({\n      ...prev,\n      items: prev.items.filter((item) => item.id !== id),\n    }));\n  };\n\n  const startEdit = (item: TaskItem) => {\n    setEditingId(item.id);\n    setEditText(item.text);\n  };\n\n  const commitEdit = () => {\n    if (!editingId) return;\n    const text = editText.trim();\n    if (text) {\n      updateMemo((prev) => ({\n        ...prev,\n        items: prev.items.map((item) =>\n          item.id === editingId ? { ...item, text } : item\n        ),\n      }));\n    }\n    setEditingId(null);\n    setEditText(\"\");\n  };\n\n  const addItem = () => {\n    const text = newText.trim();\n    if (!text) {\n      setAddingNew(false);\n      return;\n    }\n    updateMemo((prev) => ({\n      ...prev,\n      items: [\n        ...prev.items,\n        { id: `manual-${Date.now()}`, text, status: \"pending\" as const },\n      ],\n    }));\n    setNewText(\"\");\n    setAddingNew(false);\n  };\n\n  useEffect(() => {\n    if (addingNew && inputRef.current) inputRef.current.focus();\n  }, [addingNew]);\n\n  const hasItems = memo.items.length > 0;\n\n  // Don't render anything if no items and collapsed\n  if (!hasItems && collapsed) return null;\n\n  return (\n    <div className=\"border-b border-border/60 bg-background/40\">\n      {/* Header */}\n      <button\n        className=\"flex w-full items-center gap-1.5 px-3 py-1 text-[11px] font-medium text-muted-foreground hover:text-muted-foreground transition-colors\"\n        onClick={toggleCollapsed}\n      >\n        {collapsed ? <ChevronRight size={12} /> : <ChevronDown size={12} />}\n        <span>Tasks</span>\n        {hasItems && (\n          <span className=\"text-muted-foreground\">\n            ({memo.items.filter((i) => i.status === \"done\").length}/{memo.items.length})\n          </span>\n        )}\n        {!collapsed && (\n          <span\n            role=\"button\"\n            tabIndex={0}\n            className=\"ml-auto rounded p-0.5 text-muted-foreground hover:text-muted-foreground hover:bg-muted cursor-pointer\"\n            onClick={(e) => {\n              e.stopPropagation();\n              setAddingNew(true);\n              setCollapsed(false);\n            }}\n            title=\"Add task\"\n          >\n            <Plus size={12} />\n          </span>\n        )}\n      </button>\n\n      {/* Items */}\n      {!collapsed && (\n        <div className=\"px-3 pb-1.5 space-y-0.5\">\n          {memo.items.map((item) => (\n            <div\n              key={item.id}\n              className=\"group flex items-center gap-1.5 rounded px-1 py-0.5 text-[11px] hover:bg-muted/50\"\n            >\n              <button\n                className=\"shrink-0 cursor-pointer\"\n                onClick={() => cycleStatus(item.id)}\n                title=\"Toggle status\"\n              >\n                {STATUS_ICONS[item.status]}\n              </button>\n\n              {editingId === item.id ? (\n                <input\n                  className=\"flex-1 bg-transparent text-foreground outline-none border-b border-border text-[11px]\"\n                  value={editText}\n                  onChange={(e) => setEditText(e.target.value)}\n                  onBlur={commitEdit}\n                  onKeyDown={(e) => {\n                    if (e.key === \"Enter\") commitEdit();\n                    if (e.key === \"Escape\") {\n                      setEditingId(null);\n                      setEditText(\"\");\n                    }\n                  }}\n                  autoFocus\n                />\n              ) : (\n                <span\n                  className={`flex-1 cursor-default ${\n                    item.status === \"done\" ? \"text-muted-foreground line-through\" : \"text-muted-foreground\"\n                  }`}\n                  onDoubleClick={() => startEdit(item)}\n                >\n                  {item.text}\n                </span>\n              )}\n\n              <div className=\"hidden group-hover:flex items-center gap-0.5\">\n                <button\n                  className=\"rounded p-0.5 text-muted-foreground hover:text-muted-foreground\"\n                  onClick={() => startEdit(item)}\n                  title=\"Edit\"\n                >\n                  <Pencil size={10} />\n                </button>\n                <button\n                  className=\"rounded p-0.5 text-muted-foreground hover:text-destructive\"\n                  onClick={() => removeItem(item.id)}\n                  title=\"Remove\"\n                >\n                  <X size={10} />\n                </button>\n              </div>\n            </div>\n          ))}\n\n          {/* Add new item */}\n          {addingNew && (\n            <div className=\"flex items-center gap-1.5 px-1 py-0.5\">\n              <span className=\"shrink-0\">⬜</span>\n              <input\n                ref={inputRef}\n                className=\"flex-1 bg-transparent text-foreground outline-none border-b border-border text-[11px] placeholder-muted-foreground\"\n                placeholder=\"New task...\"\n                value={newText}\n                onChange={(e) => setNewText(e.target.value)}\n                onBlur={addItem}\n                onKeyDown={(e) => {\n                  if (e.key === \"Enter\") addItem();\n                  if (e.key === \"Escape\") {\n                    setAddingNew(false);\n                    setNewText(\"\");\n                  }\n                }}\n              />\n            </div>\n          )}\n\n          {!hasItems && !addingNew && (\n            <div className=\"px-1 py-0.5 text-[10px] text-muted-foreground italic\">\n              No tasks yet. Click + to add.\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n});\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAHA;;;;AAgBA,MAAM,eAAmD;IACvD,SAAS;IACT,eAAe;IACf,MAAM;AACR;AAEA,MAAM,eAAqC;IAAC;IAAW;IAAe;CAAO;AAE7E,+BAA+B;AAE/B,SAAS,WAAW,UAAkB;IACpC,OAAO,CAAC,cAAc,EAAE,YAAY;AACtC;AAEA,SAAS,SAAS,UAAkB;IAClC,wCAAmC,OAAO;QAAE,OAAO,EAAE;QAAE,WAAW;IAAE;;;AAQtE;AAEA,SAAS,SAAS,UAAkB,EAAE,IAAkB;IACtD,wCAAmC;;;AAErC;AAEA,kDAAkD;AAElD,MAAM,eAAe;AAErB,SAAS,YAAY,GAA4B;IAC/C,MAAM,UAAU,IAAI,OAAO;IAC3B,IAAI,OAAO,YAAY,UAAU,OAAO;IACxC,IAAI,MAAM,OAAO,CAAC,UAAU;QAC1B,OAAO,AAAC,QACL,MAAM,CAAC,CAAC,IAAM,EAAE,IAAI,KAAK,UAAU,OAAO,EAAE,IAAI,KAAK,UACrD,GAAG,CAAC,CAAC,IAAM,EAAE,IAAI,EACjB,IAAI,CAAC;IACV;IACA,IAAI,OAAO,IAAI,IAAI,KAAK,UAAU,OAAO,IAAI,IAAI;IACjD,OAAO;AACT;AAEA,SAAS,eAAe,IAAuB,EAAE,GAAW;IAC1D,IAAI,OAAO,SAAS,UAAU;QAC5B,MAAM,SAAS,KAAK,UAAU,CAAC,OAC3B,SACA,KAAK,UAAU,CAAC,QACd,gBACA;QACN,MAAM,YAAY,KAAK,OAAO,CAAC,cAAc;QAC7C,OAAO;YAAE,IAAI,CAAC,KAAK,EAAE,KAAK;YAAE,MAAM;YAAW;QAAO;IACtD;IACA,OAAO;QAAE,IAAI,KAAK,EAAE,IAAI,CAAC,KAAK,EAAE,KAAK;QAAE,MAAM,KAAK,IAAI;QAAE,QAAQ,KAAK,MAAM,IAAI;IAAU;AAC3F;AAEO,SAAS,0BAA0B,QAAwC;IAChF,mDAAmD;IACnD,IAAK,IAAI,IAAI,SAAS,MAAM,GAAG,GAAG,KAAK,GAAG,IAAK;QAC7C,MAAM,MAAM,QAAQ,CAAC,EAAE;QACvB,IAAI,IAAI,IAAI,KAAK,aAAa;QAE9B,MAAM,OAAO,YAAY;QACzB,MAAM,QAAQ,KAAK,KAAK,CAAC;QACzB,IAAI,OAAO;YACT,IAAI;gBACF,MAAM,SAAS,KAAK,KAAK,CAAC,KAAK,CAAC,EAAE;gBAClC,IAAI,MAAM,OAAO,CAAC,OAAO,KAAK,GAAG;oBAC/B,OAAO,OAAO,KAAK,CAAC,GAAG,CAAC;gBAC1B;YACF,EAAE,OAAM;YACN,sBAAsB;YACxB;QACF;IACF;IACA,OAAO;AACT;AASO,MAAM,yBAAW,IAAA,+WAAI,EAAC,SAAS,SAAS,EAAE,UAAU,EAAE,QAAQ,EAAiB;IACpF,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,mXAAQ,EAAe,IAAM,SAAS;IAC9D,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,mXAAQ,EAAC;QACzC,wCAAmC,OAAO;;;IAE5C;IACA,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,mXAAQ,EAAgB;IAC1D,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,mXAAQ,EAAC;IACzC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,mXAAQ,EAAC;IAC3C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,mXAAQ,EAAC;IACvC,MAAM,WAAW,IAAA,iXAAM,EAAmB;IAC1C,MAAM,oBAAoB,IAAA,iXAAM,EAAS;IAEzC,mCAAmC;IACnC,IAAA,oXAAS,EAAC;QACR,QAAQ,SAAS;IACnB,GAAG;QAAC;KAAW;IAEf,sCAAsC;IACtC,0EAA0E;IAC1E,MAAM,iBAAiB,SAAS,MAAM,GAAG,IACrC,GAAG,SAAS,MAAM,CAAC,CAAC,EAAE,YAAY,QAAQ,CAAC,SAAS,MAAM,GAAG,EAAE,EAAE,MAAM,EAAE,GACzE;IAEJ,IAAA,oXAAS,EAAC;QACR,MAAM,YAAY,0BAA0B;QAC5C,IAAI,CAAC,WAAW;QAChB,MAAM,MAAM,KAAK,GAAG;QACpB,IAAI,MAAM,kBAAkB,OAAO,GAAG,KAAK;QAC3C,kBAAkB,OAAO,GAAG;QAE5B,MAAM,UAAwB;YAC5B,OAAO;YACP,WAAW;QACb;QACA,QAAQ;QACR,SAAS,YAAY;IACvB,GAAG;QAAC;QAAU;QAAY;KAAe;IAEzC,MAAM,aAAa,IAAA,sXAAW,EAC5B,CAAC;QACC,QAAQ,CAAC;YACP,MAAM,OAAO,QAAQ;YACrB,KAAK,SAAS,GAAG,KAAK,GAAG;YACzB,SAAS,YAAY;YACrB,OAAO;QACT;IACF,GACA;QAAC;KAAW;IAGd,MAAM,kBAAkB;QACtB,MAAM,OAAO,CAAC;QACd,aAAa;QACb,aAAa,OAAO,CAAC,2BAA2B,OAAO;IACzD;IAEA,MAAM,cAAc,CAAC;QACnB,WAAW,CAAC,OAAS,CAAC;gBACpB,GAAG,IAAI;gBACP,OAAO,KAAK,KAAK,CAAC,GAAG,CAAC,CAAC;oBACrB,IAAI,KAAK,EAAE,KAAK,IAAI,OAAO;oBAC3B,MAAM,MAAM,aAAa,OAAO,CAAC,KAAK,MAAM;oBAC5C,OAAO;wBAAE,GAAG,IAAI;wBAAE,QAAQ,YAAY,CAAC,CAAC,MAAM,CAAC,IAAI,aAAa,MAAM,CAAC;oBAAC;gBAC1E;YACF,CAAC;IACH;IAEA,MAAM,aAAa,CAAC;QAClB,WAAW,CAAC,OAAS,CAAC;gBACpB,GAAG,IAAI;gBACP,OAAO,KAAK,KAAK,CAAC,MAAM,CAAC,CAAC,OAAS,KAAK,EAAE,KAAK;YACjD,CAAC;IACH;IAEA,MAAM,YAAY,CAAC;QACjB,aAAa,KAAK,EAAE;QACpB,YAAY,KAAK,IAAI;IACvB;IAEA,MAAM,aAAa;QACjB,IAAI,CAAC,WAAW;QAChB,MAAM,OAAO,SAAS,IAAI;QAC1B,IAAI,MAAM;YACR,WAAW,CAAC,OAAS,CAAC;oBACpB,GAAG,IAAI;oBACP,OAAO,KAAK,KAAK,CAAC,GAAG,CAAC,CAAC,OACrB,KAAK,EAAE,KAAK,YAAY;4BAAE,GAAG,IAAI;4BAAE;wBAAK,IAAI;gBAEhD,CAAC;QACH;QACA,aAAa;QACb,YAAY;IACd;IAEA,MAAM,UAAU;QACd,MAAM,OAAO,QAAQ,IAAI;QACzB,IAAI,CAAC,MAAM;YACT,aAAa;YACb;QACF;QACA,WAAW,CAAC,OAAS,CAAC;gBACpB,GAAG,IAAI;gBACP,OAAO;uBACF,KAAK,KAAK;oBACb;wBAAE,IAAI,CAAC,OAAO,EAAE,KAAK,GAAG,IAAI;wBAAE;wBAAM,QAAQ;oBAAmB;iBAChE;YACH,CAAC;QACD,WAAW;QACX,aAAa;IACf;IAEA,IAAA,oXAAS,EAAC;QACR,IAAI,aAAa,SAAS,OAAO,EAAE,SAAS,OAAO,CAAC,KAAK;IAC3D,GAAG;QAAC;KAAU;IAEd,MAAM,WAAW,KAAK,KAAK,CAAC,MAAM,GAAG;IAErC,kDAAkD;IAClD,IAAI,CAAC,YAAY,WAAW,OAAO;IAEnC,qBACE,gZAAC;QAAI,WAAU;;0BAEb,gZAAC;gBACC,WAAU;gBACV,SAAS;;oBAER,0BAAY,gZAAC,0TAAY;wBAAC,MAAM;;;;;6CAAS,gZAAC,uTAAW;wBAAC,MAAM;;;;;;kCAC7D,gZAAC;kCAAK;;;;;;oBACL,0BACC,gZAAC;wBAAK,WAAU;;4BAAwB;4BACpC,KAAK,KAAK,CAAC,MAAM,CAAC,CAAC,IAAM,EAAE,MAAM,KAAK,QAAQ,MAAM;4BAAC;4BAAE,KAAK,KAAK,CAAC,MAAM;4BAAC;;;;;;;oBAG9E,CAAC,2BACA,gZAAC;wBACC,MAAK;wBACL,UAAU;wBACV,WAAU;wBACV,SAAS,CAAC;4BACR,EAAE,eAAe;4BACjB,aAAa;4BACb,aAAa;wBACf;wBACA,OAAM;kCAEN,cAAA,gZAAC,8RAAI;4BAAC,MAAM;;;;;;;;;;;;;;;;;YAMjB,CAAC,2BACA,gZAAC;gBAAI,WAAU;;oBACZ,KAAK,KAAK,CAAC,GAAG,CAAC,CAAC,qBACf,gZAAC;4BAEC,WAAU;;8CAEV,gZAAC;oCACC,WAAU;oCACV,SAAS,IAAM,YAAY,KAAK,EAAE;oCAClC,OAAM;8CAEL,YAAY,CAAC,KAAK,MAAM,CAAC;;;;;;gCAG3B,cAAc,KAAK,EAAE,iBACpB,gZAAC;oCACC,WAAU;oCACV,OAAO;oCACP,UAAU,CAAC,IAAM,YAAY,EAAE,MAAM,CAAC,KAAK;oCAC3C,QAAQ;oCACR,WAAW,CAAC;wCACV,IAAI,EAAE,GAAG,KAAK,SAAS;wCACvB,IAAI,EAAE,GAAG,KAAK,UAAU;4CACtB,aAAa;4CACb,YAAY;wCACd;oCACF;oCACA,SAAS;;;;;yDAGX,gZAAC;oCACC,WAAW,CAAC,sBAAsB,EAChC,KAAK,MAAM,KAAK,SAAS,uCAAuC,yBAChE;oCACF,eAAe,IAAM,UAAU;8CAE9B,KAAK,IAAI;;;;;;8CAId,gZAAC;oCAAI,WAAU;;sDACb,gZAAC;4CACC,WAAU;4CACV,SAAS,IAAM,UAAU;4CACzB,OAAM;sDAEN,cAAA,gZAAC,oSAAM;gDAAC,MAAM;;;;;;;;;;;sDAEhB,gZAAC;4CACC,WAAU;4CACV,SAAS,IAAM,WAAW,KAAK,EAAE;4CACjC,OAAM;sDAEN,cAAA,gZAAC,qRAAC;gDAAC,MAAM;;;;;;;;;;;;;;;;;;2BAlDR,KAAK,EAAE;;;;;oBAyDf,2BACC,gZAAC;wBAAI,WAAU;;0CACb,gZAAC;gCAAK,WAAU;0CAAW;;;;;;0CAC3B,gZAAC;gCACC,KAAK;gCACL,WAAU;gCACV,aAAY;gCACZ,OAAO;gCACP,UAAU,CAAC,IAAM,WAAW,EAAE,MAAM,CAAC,KAAK;gCAC1C,QAAQ;gCACR,WAAW,CAAC;oCACV,IAAI,EAAE,GAAG,KAAK,SAAS;oCACvB,IAAI,EAAE,GAAG,KAAK,UAAU;wCACtB,aAAa;wCACb,WAAW;oCACb;gCACF;;;;;;;;;;;;oBAKL,CAAC,YAAY,CAAC,2BACb,gZAAC;wBAAI,WAAU;kCAAuD;;;;;;;;;;;;;;;;;;AAQlF","debugId":null}},
    {"offset": {"line": 4981, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/lib/gateway/use-session-settings.ts"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect, useCallback } from \"react\";\nimport { useGateway } from \"./hooks\";\n\nexport interface SessionInfo {\n  key: string;\n  model?: string;\n  thinking?: string;\n  verbose?: boolean;\n  label?: string;\n  totalTokens?: number;\n  contextTokens?: number;\n  messageCount?: number;\n}\n\nexport interface ModelInfo {\n  id: string;\n  name?: string;\n  provider?: string;\n}\n\n// Module-level cache for models (rarely changes)\nlet _modelsCache: ModelInfo[] = [];\n\nexport function useSessionSettings(sessionKey?: string) {\n  const { client, state } = useGateway();\n  const isConnected = state === \"connected\";\n\n  const [session, setSession] = useState<SessionInfo | null>(null);\n  const [models, setModels] = useState<ModelInfo[]>([]);\n  const [loading, setLoading] = useState(false);\n\n  // Fetch current session info (Gateway v3 does not expose sessions.get)\n  const fetchSession = useCallback(async () => {\n    if (!client || !isConnected || !sessionKey) return;\n    try {\n      const res = await client.request<{ sessions: Array<Record<string, unknown>> }>(\n        \"sessions.list\",\n        { limit: 500 }\n      );\n      const found = (res?.sessions || []).find((s) => s.key === sessionKey);\n      if (found) {\n        setSession({\n          key: String(found.key),\n          model: found.model as string | undefined,\n          thinking: found.thinking as string | undefined,\n          verbose: found.verbose as boolean | undefined,\n          label: found.label as string | undefined,\n          totalTokens: found.totalTokens as number | undefined,\n          contextTokens: found.contextTokens as number | undefined,\n          messageCount: found.messageCount as number | undefined,\n        });\n      }\n    } catch {\n      // silently fail\n    }\n  }, [client, isConnected, sessionKey]);\n\n  // Cache models globally — they rarely change\n  const fetchModels = useCallback(async () => {\n    if (!client || !isConnected) return;\n    // Use cached if available\n    if (_modelsCache.length > 0) {\n      setModels(_modelsCache);\n      return;\n    }\n    try {\n      const res = await client.request<{ models: Array<Record<string, unknown>> }>(\"models.list\");\n      const list = (res?.models || []).map((m) => ({\n        id: String(m.id || m.model || \"\"),\n        name: (m.name || m.label || m.id || m.model) as string | undefined,\n        provider: m.provider as string | undefined,\n      }));\n      _modelsCache = list;\n      setModels(list);\n    } catch {\n      // silently fail\n    }\n  }, [client, isConnected]);\n\n  // Fetch session on mount, models lazily\n  useEffect(() => {\n    fetchSession();\n    fetchModels();\n  }, [fetchSession, fetchModels]);\n\n  // Patch session (model/label only — fields supported by sessions.patch)\n  const patchSession = useCallback(\n    async (patch: { model?: string; label?: string }) => {\n      if (!client || !isConnected || !sessionKey) return;\n      setLoading(true);\n      try {\n        await client.request(\"sessions.patch\", { key: sessionKey, ...patch });\n        // Optimistic update\n        setSession((prev) => (prev ? { ...prev, ...patch } : prev));\n      } catch (err) {\n        console.error(\"[AWF] sessions.patch error:\", err);\n      } finally {\n        setLoading(false);\n      }\n    },\n    [client, isConnected, sessionKey]\n  );\n\n  // Set thinking level via chat directive (not sessions.patch)\n  const setThinking = useCallback(\n    async (level: string) => {\n      if (!client || !isConnected || !sessionKey) return;\n      setLoading(true);\n      try {\n        await client.request(\"chat.send\", {\n          sessionKey,\n          body: `/think:${level}`,\n        });\n        // Optimistic update\n        setSession((prev) => (prev ? { ...prev, thinking: level } : prev));\n      } catch (err) {\n        console.error(\"[AWF] setThinking error:\", err);\n      } finally {\n        setLoading(false);\n      }\n    },\n    [client, isConnected, sessionKey]\n  );\n\n  // Set verbose via chat directive (not sessions.patch)\n  const setVerbose = useCallback(\n    async (enabled: boolean) => {\n      if (!client || !isConnected || !sessionKey) return;\n      setLoading(true);\n      try {\n        await client.request(\"chat.send\", {\n          sessionKey,\n          body: `/verbose ${enabled ? \"on\" : \"off\"}`,\n        });\n        // Optimistic update\n        setSession((prev) => (prev ? { ...prev, verbose: enabled } : prev));\n      } catch (err) {\n        console.error(\"[AWF] setVerbose error:\", err);\n      } finally {\n        setLoading(false);\n      }\n    },\n    [client, isConnected, sessionKey]\n  );\n\n  // Reset session\n  const resetSession = useCallback(\n    async (model?: string) => {\n      if (!client || !isConnected || !sessionKey) return;\n      setLoading(true);\n      try {\n        await client.request(\"sessions.reset\", { key: sessionKey, model });\n        await fetchSession();\n      } catch (err) {\n        console.error(\"[AWF] sessions.reset error:\", err);\n      } finally {\n        setLoading(false);\n      }\n    },\n    [client, isConnected, sessionKey, fetchSession]\n  );\n\n  // Delete session\n  const deleteSession = useCallback(async () => {\n    if (!client || !isConnected || !sessionKey) return;\n    setLoading(true);\n    try {\n      await client.request(\"sessions.delete\", { key: sessionKey });\n    } catch (err) {\n      console.error(\"[AWF] sessions.delete error:\", err);\n    } finally {\n      setLoading(false);\n    }\n  }, [client, isConnected, sessionKey]);\n\n  return {\n    session,\n    models,\n    loading,\n    patchSession,\n    setThinking,\n    setVerbose,\n    resetSession,\n    deleteSession,\n    refresh: fetchSession,\n  };\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 5185, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/settings/session-settings.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport {\n  Settings2,\n  RotateCcw,\n  Trash2,\n  Brain,\n  Monitor,\n  Zap,\n  ChevronDown,\n} from \"lucide-react\";\nimport { useSessionSettings } from \"@/lib/gateway/use-session-settings\";\n\nconst THINKING_LEVELS = [\"off\", \"low\", \"medium\", \"high\"] as const;\ntype ThinkingLevel = (typeof THINKING_LEVELS)[number];\n\nconst THINKING_LABELS: Record<ThinkingLevel, string> = {\n  off: \"Off\",\n  low: \"Low\",\n  medium: \"Medium\",\n  high: \"High\",\n};\n\ninterface SessionSettingsProps {\n  sessionKey?: string;\n  onDelete?: () => void;\n  onReset?: () => void;\n}\n\nexport function SessionSettings({ sessionKey, onDelete, onReset }: SessionSettingsProps) {\n  const { session, models, loading, patchSession, setThinking, setVerbose, resetSession, deleteSession, refresh } =\n    useSessionSettings(sessionKey);\n\n  const [open, setOpen] = useState(false);\n  const [modelOpen, setModelOpen] = useState(false);\n  const [confirmDelete, setConfirmDelete] = useState(false);\n\n  // ESC to close\n  useEffect(() => {\n    if (!open) return;\n    const onKey = (e: KeyboardEvent) => {\n      if (e.key === \"Escape\") {\n        setOpen(false);\n        setModelOpen(false);\n        setConfirmDelete(false);\n      }\n    };\n    document.addEventListener(\"keydown\", onKey);\n    return () => document.removeEventListener(\"keydown\", onKey);\n  }, [open]);\n\n  // Refresh session on open\n  useEffect(() => {\n    if (open) refresh();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [open]);\n\n  if (!sessionKey) return null;\n\n  const currentThinking = (session?.thinking as ThinkingLevel) || \"off\";\n\n  const formatTokens = (n?: number) => {\n    if (n == null || n === 0) return null;\n    if (n >= 1_000_000) return `${(n / 1_000_000).toFixed(1)}M`;\n    if (n >= 1_000) return `${(n / 1_000).toFixed(1)}k`;\n    return String(n);\n  };\n\n  const totalStr = formatTokens(session?.totalTokens);\n  const ctxStr = formatTokens(session?.contextTokens);\n\n  const currentModelName = session?.model && session.model !== \"default\"\n    ? (models.find((m) => m.id === session.model)?.name || session.model.split(\"/\").pop())\n    : \"Default\";\n\n  return (\n    <>\n      <button\n        onClick={() => setOpen((p) => !p)}\n        className=\"flex h-7 w-7 items-center justify-center rounded-md text-zinc-500 hover:bg-zinc-800 hover:text-zinc-300 transition-colors\"\n      >\n        <Settings2 size={14} />\n      </button>\n\n      {open && (\n        <div className=\"fixed inset-0 z-[120]\" role=\"dialog\" aria-modal=\"true\">\n          <div className=\"absolute inset-0 bg-black/50\" onClick={() => setOpen(false)} />\n          <div className=\"absolute left-1/2 top-1/2 w-[min(92vw,520px)] -translate-x-1/2 -translate-y-1/2 rounded-xl border border-zinc-700/80 bg-zinc-900 shadow-2xl\">\n          {/* Token usage */}\n          {(totalStr || ctxStr) && (\n            <div className=\"flex items-center gap-3 border-b border-zinc-800 px-3 py-2\">\n              <Zap size={11} className=\"text-amber-500\" />\n              <div className=\"flex gap-3 text-[11px]\">\n                {totalStr && <span className=\"text-zinc-400\">Total: <span className=\"text-zinc-200\">{totalStr}</span></span>}\n                {ctxStr && <span className=\"text-zinc-400\">Context: <span className=\"text-zinc-200\">{ctxStr}</span></span>}\n              </div>\n            </div>\n          )}\n\n          {/* Model */}\n          <div className=\"border-b border-zinc-800 px-3 py-2\">\n            <div className=\"mb-1 flex items-center gap-1.5 text-[10px] font-medium text-zinc-500\">\n              <Monitor size={10} /> Model\n            </div>\n            <button\n              onClick={() => setModelOpen((p) => !p)}\n              className=\"flex w-full items-center justify-between rounded-md bg-zinc-800/60 px-2 py-1.5 text-[11px] text-zinc-300 hover:bg-zinc-800\"\n            >\n              <span className=\"truncate\">{currentModelName}</span>\n              <ChevronDown size={12} className={`text-zinc-500 transition-transform ${modelOpen ? \"rotate-180\" : \"\"}`} />\n            </button>\n            {modelOpen && (\n              <div className=\"mt-1 max-h-40 overflow-y-auto rounded-md border border-zinc-700/50 bg-zinc-850\">\n                <button\n                  onClick={() => { patchSession({ model: \"default\" }); setModelOpen(false); }}\n                  className=\"w-full px-2 py-1.5 text-left text-[11px] text-zinc-400 hover:bg-zinc-800 hover:text-zinc-200\"\n                >\n                  Default (agent config)\n                </button>\n                {models.map((m) => (\n                  <button\n                    key={m.id}\n                    onClick={() => { patchSession({ model: m.id }); setModelOpen(false); }}\n                    className={`w-full px-2 py-1.5 text-left text-[11px] hover:bg-zinc-800 hover:text-zinc-200 ${\n                      session?.model === m.id ? \"text-amber-400\" : \"text-zinc-400\"\n                    }`}\n                  >\n                    {m.name || m.id}\n                  </button>\n                ))}\n              </div>\n            )}\n          </div>\n\n          {/* Thinking */}\n          <div className=\"border-b border-zinc-800 px-3 py-2\">\n            <div className=\"mb-1.5 flex items-center gap-1.5 text-[10px] font-medium text-zinc-500\">\n              <Brain size={10} /> Thinking\n            </div>\n            <div className=\"flex gap-1\">\n              {THINKING_LEVELS.map((level) => (\n                <button\n                  key={level}\n                  onClick={() => setThinking(level)}\n                  disabled={loading}\n                  className={`flex-1 rounded-md py-1 text-[11px] font-medium transition-colors ${\n                    currentThinking === level\n                      ? \"bg-amber-600/80 text-white\"\n                      : \"bg-zinc-800 text-zinc-400 hover:bg-zinc-700 hover:text-zinc-300\"\n                  }`}\n                >\n                  {THINKING_LABELS[level]}\n                </button>\n              ))}\n            </div>\n          </div>\n\n          {/* Verbose */}\n          <div className=\"flex items-center justify-between border-b border-zinc-800 px-3 py-2\">\n            <span className=\"flex items-center gap-1.5 text-[10px] font-medium text-zinc-500\">\n              <Monitor size={10} /> Verbose\n            </span>\n            <button\n              onClick={() => setVerbose(!(session?.verbose ?? false))}\n              className={`h-5 w-9 rounded-full transition-colors ${\n                session?.verbose ? \"bg-amber-600\" : \"bg-zinc-700\"\n              }`}\n            >\n              <div className={`h-4 w-4 rounded-full bg-white transition-transform ${\n                session?.verbose ? \"translate-x-4.5\" : \"translate-x-0.5\"\n              }`} />\n            </button>\n          </div>\n\n          {/* Actions */}\n          <div className=\"flex gap-2 px-3 py-2\">\n            <button\n              onClick={async () => { await resetSession(); onReset?.(); setOpen(false); }}\n              disabled={loading}\n              className=\"flex flex-1 items-center justify-center gap-1 rounded-md bg-zinc-800 py-1.5 text-[11px] text-zinc-400 hover:bg-zinc-700 hover:text-zinc-200\"\n            >\n              <RotateCcw size={11} /> Reset\n            </button>\n            {confirmDelete ? (\n              <div className=\"flex flex-1 gap-1\">\n                <button\n                  onClick={async () => { await deleteSession(); onDelete?.(); setOpen(false); }}\n                  className=\"flex-1 rounded-md bg-red-600/80 py-1.5 text-[11px] text-white hover:bg-red-600\"\n                >\n                  확인\n                </button>\n                <button\n                  onClick={() => setConfirmDelete(false)}\n                  className=\"flex-1 rounded-md bg-zinc-800 py-1.5 text-[11px] text-zinc-400 hover:bg-zinc-700\"\n                >\n                  취소\n                </button>\n              </div>\n            ) : (\n              <button\n                onClick={() => setConfirmDelete(true)}\n                disabled={loading}\n                className=\"flex flex-1 items-center justify-center gap-1 rounded-md bg-zinc-800 py-1.5 text-[11px] text-red-400 hover:bg-zinc-700 hover:text-red-300\"\n              >\n                <Trash2 size={11} /> Delete\n              </button>\n            )}\n          </div>\n          </div>\n        </div>\n      )}\n    </>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 5622, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/chat/chat-header.tsx"],"sourcesContent":["\"use client\";\n\nimport { useMemo, useRef, useEffect, useState } from \"react\";\nimport { Bot, MessageSquare, Plus, X } from \"lucide-react\";\nimport { parseSessionKey } from \"@/lib/gateway/session-utils\";\nimport type { Agent, Session } from \"@/lib/gateway/protocol\";\nimport { cn } from \"@/lib/utils\";\n\ninterface ChatHeaderProps {\n  sessionKey?: string;\n  agents: Agent[];\n  sessions: Array<Partial<Session> & Record<string, unknown>>;\n  messages: Array<Record<string, unknown>>;\n  onSelectSession?: (key: string) => void;\n  onNewSession?: () => void;\n  onDeleteSession?: (key: string) => void;\n}\n\n/**\n * Derive a short display label for a session tab.\n */\nfunction sessionTabLabel(session: Partial<Session> & Record<string, unknown>): string {\n  // 1. Use label if set\n  if (session.label && typeof session.label === \"string\") {\n    const label = session.label as string;\n    // Strip agent prefix like \"main/...\"\n    const slashIdx = label.indexOf(\"/\");\n    if (slashIdx > 0 && slashIdx < 16) {\n      const rest = label.slice(slashIdx + 1);\n      return rest.length > 24 ? `${rest.slice(0, 22)}…` : rest;\n    }\n    return label.length > 24 ? `${label.slice(0, 22)}…` : label;\n  }\n\n  // 2. Title\n  if (session.title && typeof session.title === \"string\") {\n    const t = session.title as string;\n    return t.length > 24 ? `${t.slice(0, 22)}…` : t;\n  }\n\n  // 3. Last message snippet\n  if (session.lastMessage && typeof session.lastMessage === \"string\") {\n    const msg = (session.lastMessage as string).replace(/\\s+/g, \" \").trim();\n    if (msg && !msg.startsWith(\"/\")) {\n      return msg.length > 24 ? `${msg.slice(0, 22)}…` : msg;\n    }\n  }\n\n  // 4. Fallback: session type\n  const parsed = parseSessionKey(session.key || \"\");\n  if (parsed.type === \"main\") return \"메인\";\n  if (parsed.type === \"thread\") return `스레드 #${(parsed.detail || \"\").slice(0, 6)}`;\n  return parsed.type;\n}\n\n/**\n * Derive a topic summary from session metadata or first user message.\n */\nfunction deriveTopic(\n  session: (Partial<Session> & Record<string, unknown>) | undefined,\n  messages: Array<Record<string, unknown>>\n): string | null {\n  if (session?.label && typeof session.label === \"string\") {\n    const label = session.label as string;\n    const slashIdx = label.indexOf(\"/\");\n    if (slashIdx > 0 && slashIdx < 16) return label.slice(slashIdx + 1);\n    return label;\n  }\n\n  if (session?.title) return session.title;\n\n  const firstUser = messages.find(\n    (m) => (m.role === \"user\" || m.sender === \"user\") && typeof m.body === \"string\" && (m.body as string).trim()\n  );\n  if (firstUser) {\n    const text = (firstUser.body as string).replace(/\\s+/g, \" \").trim();\n    if (text.startsWith(\"/\")) return null;\n    return text.length > 60 ? `${text.slice(0, 57)}…` : text;\n  }\n\n  return null;\n}\n\nexport function ChatHeader({ sessionKey, agents, sessions, messages, onSelectSession, onNewSession, onDeleteSession }: ChatHeaderProps) {\n  const [confirmDeleteKey, setConfirmDeleteKey] = useState<string | null>(null);\n  if (!sessionKey) return null;\n\n  const parsed = parseSessionKey(sessionKey);\n  const agent = agents.find((a) => a.id === parsed.agentId);\n  const agentName = agent?.name || parsed.agentId;\n\n  const session = sessions.find((s) => s.key === sessionKey);\n\n  // Filter sessions belonging to the same agent (main + threads only, skip cron/subagent)\n  const agentSessions = useMemo(() => {\n    return sessions\n      .filter((s) => {\n        if (!s.key) return false;\n        const p = parseSessionKey(s.key as string);\n        return p.agentId === parsed.agentId && (p.type === \"main\" || p.type === \"thread\");\n      })\n      .sort((a, b) => ((b as any).updatedAt || 0) - ((a as any).updatedAt || 0));\n  }, [sessions, parsed.agentId]);\n\n  const sessionType = parsed.type === \"main\"\n    ? \"Main Session\"\n    : parsed.type === \"thread\"\n      ? \"Thread\"\n      : parsed.type === \"subagent\"\n        ? \"Sub-agent\"\n        : parsed.type === \"cron\"\n          ? \"Cron\"\n          : parsed.type === \"a2a\"\n            ? \"A2A\"\n            : \"\";\n\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  const topic = useMemo(() => deriveTopic(session, messages), [session, messages]);\n\n  // Auto-scroll active tab into view\n  const tabsRef = useRef<HTMLDivElement>(null);\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  useEffect(() => {\n    if (!tabsRef.current) return;\n    const active = tabsRef.current.querySelector(\"[data-active='true']\");\n    if (active) active.scrollIntoView({ behavior: \"smooth\", block: \"nearest\", inline: \"center\" });\n  }, [sessionKey]);\n\n  return (\n    <div className=\"flex-shrink-0 border-b border-zinc-700/50 bg-zinc-900/90\">\n      {/* Agent name row */}\n      <div className=\"flex items-center gap-3 px-5 pt-3.5 pb-2\">\n        <Bot size={22} className=\"text-amber-500 flex-shrink-0\" />\n        <span className=\"text-lg font-extrabold text-white truncate tracking-tight leading-tight\">\n          {agentName}\n        </span>\n        <span className=\"rounded-md bg-zinc-800 px-2 py-0.5 text-[10px] font-medium text-zinc-500 uppercase tracking-wide\">\n          {sessionType}\n        </span>\n      </div>\n\n      {/* Topic */}\n      {topic && (\n        <div className=\"flex items-center gap-2 px-5 pb-2 pl-[54px]\">\n          <MessageSquare size={12} className=\"text-zinc-600 flex-shrink-0\" />\n          <span className=\"text-[13px] text-zinc-400 truncate\">{topic}</span>\n        </div>\n      )}\n\n      {/* Session tabs */}\n      {agentSessions.length > 0 && (\n        <div\n          ref={tabsRef}\n          className=\"flex items-center gap-1 overflow-x-auto px-4 pb-2.5 scrollbar-none\"\n        >\n          {agentSessions.map((s) => {\n            const key = s.key as string;\n            const isActive = key === sessionKey;\n            const label = sessionTabLabel(s);\n            const isConfirming = confirmDeleteKey === key;\n\n            return (\n              <div key={key} className=\"group relative flex-shrink-0\">\n                {isConfirming ? (\n                  /* Delete confirmation inline */\n                  <div className=\"flex items-center gap-1 rounded-md bg-red-900/40 border border-red-700/50 px-2 py-1\">\n                    <span className=\"text-[10px] text-red-300 mr-1\">삭제?</span>\n                    <button\n                      onClick={() => {\n                        onDeleteSession?.(key);\n                        setConfirmDeleteKey(null);\n                      }}\n                      className=\"rounded px-1.5 py-0.5 text-[10px] bg-red-600/80 text-white hover:bg-red-600\"\n                    >\n                      확인\n                    </button>\n                    <button\n                      onClick={() => setConfirmDeleteKey(null)}\n                      className=\"rounded px-1.5 py-0.5 text-[10px] bg-zinc-700 text-zinc-300 hover:bg-zinc-600\"\n                    >\n                      취소\n                    </button>\n                  </div>\n                ) : (\n                  <button\n                    data-active={isActive}\n                    onClick={() => onSelectSession?.(key)}\n                    className={cn(\n                      \"flex items-center gap-1.5 flex-shrink-0 rounded-md px-3 py-1.5 text-[11px] font-medium transition-all max-w-[200px]\",\n                      isActive\n                        ? \"bg-amber-600/80 text-white shadow-sm\"\n                        : \"bg-zinc-800/70 text-zinc-400 hover:bg-zinc-700 hover:text-zinc-200\"\n                    )}\n                    title={label}\n                  >\n                    <span className=\"truncate\">{label}</span>\n                    {/* Close button — visible on hover */}\n                    <span\n                      role=\"button\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        setConfirmDeleteKey(key);\n                      }}\n                      className={cn(\n                        \"flex-shrink-0 rounded p-0.5 opacity-0 group-hover:opacity-100 transition-opacity\",\n                        isActive\n                          ? \"hover:bg-amber-700/80 text-white/70 hover:text-white\"\n                          : \"hover:bg-zinc-600 text-zinc-500 hover:text-zinc-200\"\n                      )}\n                    >\n                      <X size={10} />\n                    </span>\n                  </button>\n                )}\n              </div>\n            );\n          })}\n          {onNewSession && (\n            <button\n              onClick={onNewSession}\n              className=\"flex-shrink-0 flex items-center justify-center rounded-md bg-zinc-800/40 px-2 py-1.5 text-zinc-600 hover:bg-zinc-700 hover:text-zinc-300 transition\"\n              title=\"새 세션\"\n            >\n              <Plus size={13} />\n            </button>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AAEA;AANA;;;;;;AAkBA;;CAEC,GACD,SAAS,gBAAgB,OAAmD;IAC1E,sBAAsB;IACtB,IAAI,QAAQ,KAAK,IAAI,OAAO,QAAQ,KAAK,KAAK,UAAU;QACtD,MAAM,QAAQ,QAAQ,KAAK;QAC3B,qCAAqC;QACrC,MAAM,WAAW,MAAM,OAAO,CAAC;QAC/B,IAAI,WAAW,KAAK,WAAW,IAAI;YACjC,MAAM,OAAO,MAAM,KAAK,CAAC,WAAW;YACpC,OAAO,KAAK,MAAM,GAAG,KAAK,GAAG,KAAK,KAAK,CAAC,GAAG,IAAI,CAAC,CAAC,GAAG;QACtD;QACA,OAAO,MAAM,MAAM,GAAG,KAAK,GAAG,MAAM,KAAK,CAAC,GAAG,IAAI,CAAC,CAAC,GAAG;IACxD;IAEA,WAAW;IACX,IAAI,QAAQ,KAAK,IAAI,OAAO,QAAQ,KAAK,KAAK,UAAU;QACtD,MAAM,IAAI,QAAQ,KAAK;QACvB,OAAO,EAAE,MAAM,GAAG,KAAK,GAAG,EAAE,KAAK,CAAC,GAAG,IAAI,CAAC,CAAC,GAAG;IAChD;IAEA,0BAA0B;IAC1B,IAAI,QAAQ,WAAW,IAAI,OAAO,QAAQ,WAAW,KAAK,UAAU;QAClE,MAAM,MAAM,AAAC,QAAQ,WAAW,CAAY,OAAO,CAAC,QAAQ,KAAK,IAAI;QACrE,IAAI,OAAO,CAAC,IAAI,UAAU,CAAC,MAAM;YAC/B,OAAO,IAAI,MAAM,GAAG,KAAK,GAAG,IAAI,KAAK,CAAC,GAAG,IAAI,CAAC,CAAC,GAAG;QACpD;IACF;IAEA,4BAA4B;IAC5B,MAAM,SAAS,IAAA,4JAAe,EAAC,QAAQ,GAAG,IAAI;IAC9C,IAAI,OAAO,IAAI,KAAK,QAAQ,OAAO;IACnC,IAAI,OAAO,IAAI,KAAK,UAAU,OAAO,CAAC,KAAK,EAAE,CAAC,OAAO,MAAM,IAAI,EAAE,EAAE,KAAK,CAAC,GAAG,IAAI;IAChF,OAAO,OAAO,IAAI;AACpB;AAEA;;CAEC,GACD,SAAS,YACP,OAAiE,EACjE,QAAwC;IAExC,IAAI,SAAS,SAAS,OAAO,QAAQ,KAAK,KAAK,UAAU;QACvD,MAAM,QAAQ,QAAQ,KAAK;QAC3B,MAAM,WAAW,MAAM,OAAO,CAAC;QAC/B,IAAI,WAAW,KAAK,WAAW,IAAI,OAAO,MAAM,KAAK,CAAC,WAAW;QACjE,OAAO;IACT;IAEA,IAAI,SAAS,OAAO,OAAO,QAAQ,KAAK;IAExC,MAAM,YAAY,SAAS,IAAI,CAC7B,CAAC,IAAM,CAAC,EAAE,IAAI,KAAK,UAAU,EAAE,MAAM,KAAK,MAAM,KAAK,OAAO,EAAE,IAAI,KAAK,YAAY,AAAC,EAAE,IAAI,CAAY,IAAI;IAE5G,IAAI,WAAW;QACb,MAAM,OAAO,AAAC,UAAU,IAAI,CAAY,OAAO,CAAC,QAAQ,KAAK,IAAI;QACjE,IAAI,KAAK,UAAU,CAAC,MAAM,OAAO;QACjC,OAAO,KAAK,MAAM,GAAG,KAAK,GAAG,KAAK,KAAK,CAAC,GAAG,IAAI,CAAC,CAAC,GAAG;IACtD;IAEA,OAAO;AACT;AAEO,SAAS,WAAW,EAAE,UAAU,EAAE,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,eAAe,EAAE,YAAY,EAAE,eAAe,EAAmB;IACpI,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,mXAAQ,EAAgB;IACxE,IAAI,CAAC,YAAY,OAAO;IAExB,MAAM,SAAS,IAAA,4JAAe,EAAC;IAC/B,MAAM,QAAQ,OAAO,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,OAAO,OAAO;IACxD,MAAM,YAAY,OAAO,QAAQ,OAAO,OAAO;IAE/C,MAAM,UAAU,SAAS,IAAI,CAAC,CAAC,IAAM,EAAE,GAAG,KAAK;IAE/C,wFAAwF;IACxF,MAAM,gBAAgB,IAAA,kXAAO,EAAC;QAC5B,OAAO,SACJ,MAAM,CAAC,CAAC;YACP,IAAI,CAAC,EAAE,GAAG,EAAE,OAAO;YACnB,MAAM,IAAI,IAAA,4JAAe,EAAC,EAAE,GAAG;YAC/B,OAAO,EAAE,OAAO,KAAK,OAAO,OAAO,IAAI,CAAC,EAAE,IAAI,KAAK,UAAU,EAAE,IAAI,KAAK,QAAQ;QAClF,GACC,IAAI,CAAC,CAAC,GAAG,IAAM,CAAC,AAAC,EAAU,SAAS,IAAI,CAAC,IAAI,CAAC,AAAC,EAAU,SAAS,IAAI,CAAC;IAC5E,GAAG;QAAC;QAAU,OAAO,OAAO;KAAC;IAE7B,MAAM,cAAc,OAAO,IAAI,KAAK,SAChC,iBACA,OAAO,IAAI,KAAK,WACd,WACA,OAAO,IAAI,KAAK,aACd,cACA,OAAO,IAAI,KAAK,SACd,SACA,OAAO,IAAI,KAAK,QACd,QACA;IAEZ,sDAAsD;IACtD,MAAM,QAAQ,IAAA,kXAAO,EAAC,IAAM,YAAY,SAAS,WAAW;QAAC;QAAS;KAAS;IAE/E,mCAAmC;IACnC,MAAM,UAAU,IAAA,iXAAM,EAAiB;IACvC,sDAAsD;IACtD,IAAA,oXAAS,EAAC;QACR,IAAI,CAAC,QAAQ,OAAO,EAAE;QACtB,MAAM,SAAS,QAAQ,OAAO,CAAC,aAAa,CAAC;QAC7C,IAAI,QAAQ,OAAO,cAAc,CAAC;YAAE,UAAU;YAAU,OAAO;YAAW,QAAQ;QAAS;IAC7F,GAAG;QAAC;KAAW;IAEf,qBACE,gZAAC;QAAI,WAAU;;0BAEb,gZAAC;gBAAI,WAAU;;kCACb,gZAAC,2RAAG;wBAAC,MAAM;wBAAI,WAAU;;;;;;kCACzB,gZAAC;wBAAK,WAAU;kCACb;;;;;;kCAEH,gZAAC;wBAAK,WAAU;kCACb;;;;;;;;;;;;YAKJ,uBACC,gZAAC;gBAAI,WAAU;;kCACb,gZAAC,6TAAa;wBAAC,MAAM;wBAAI,WAAU;;;;;;kCACnC,gZAAC;wBAAK,WAAU;kCAAsC;;;;;;;;;;;;YAKzD,cAAc,MAAM,GAAG,mBACtB,gZAAC;gBACC,KAAK;gBACL,WAAU;;oBAET,cAAc,GAAG,CAAC,CAAC;wBAClB,MAAM,MAAM,EAAE,GAAG;wBACjB,MAAM,WAAW,QAAQ;wBACzB,MAAM,QAAQ,gBAAgB;wBAC9B,MAAM,eAAe,qBAAqB;wBAE1C,qBACE,gZAAC;4BAAc,WAAU;sCACtB,eACC,8BAA8B,iBAC9B,gZAAC;gCAAI,WAAU;;kDACb,gZAAC;wCAAK,WAAU;kDAAgC;;;;;;kDAChD,gZAAC;wCACC,SAAS;4CACP,kBAAkB;4CAClB,oBAAoB;wCACtB;wCACA,WAAU;kDACX;;;;;;kDAGD,gZAAC;wCACC,SAAS,IAAM,oBAAoB;wCACnC,WAAU;kDACX;;;;;;;;;;;qDAKH,gZAAC;gCACC,eAAa;gCACb,SAAS,IAAM,kBAAkB;gCACjC,WAAW,IAAA,yHAAE,EACX,uHACA,WACI,yCACA;gCAEN,OAAO;;kDAEP,gZAAC;wCAAK,WAAU;kDAAY;;;;;;kDAE5B,gZAAC;wCACC,MAAK;wCACL,SAAS,CAAC;4CACR,EAAE,eAAe;4CACjB,oBAAoB;wCACtB;wCACA,WAAW,IAAA,yHAAE,EACX,oFACA,WACI,yDACA;kDAGN,cAAA,gZAAC,qRAAC;4CAAC,MAAM;;;;;;;;;;;;;;;;;2BAhDP;;;;;oBAsDd;oBACC,8BACC,gZAAC;wBACC,SAAS;wBACT,WAAU;wBACV,OAAM;kCAEN,cAAA,gZAAC,8RAAI;4BAAC,MAAM;;;;;;;;;;;;;;;;;;;;;;;AAO1B","debugId":null}},
    {"offset": {"line": 5915, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/lib/shortcuts.ts"],"sourcesContent":["// --- Shortcut types ---\n\nexport type ShortcutDef = {\n  id: string;\n  /** Default key combo (display string) */\n  keys: string;\n  description: string;\n  scope?: \"global\" | \"panel\";\n};\n\n// --- Default shortcuts ---\n\nexport const DEFAULT_SHORTCUTS: ShortcutDef[] = [\n  { id: \"help\", keys: \"Cmd+/\", description: \"단축키 도움말 열기\", scope: \"global\" },\n  { id: \"add-panel\", keys: \"Cmd+\\\\\", description: \"패널 추가\", scope: \"global\" },\n  { id: \"focus-left\", keys: \"Ctrl+H\", description: \"왼쪽 패널 포커스\", scope: \"global\" },\n  { id: \"focus-right\", keys: \"Ctrl+L\", description: \"오른쪽 패널 포커스\", scope: \"global\" },\n  { id: \"swap-panels\", keys: \"Cmd+Ctrl+Shift+S\", description: \"패널 위치 스왑\", scope: \"global\" },\n  { id: \"close-panel\", keys: \"Ctrl+X\", description: \"현재 패널 닫기\", scope: \"global\" },\n  { id: \"reopen-panel\", keys: \"Ctrl+Shift+X\", description: \"닫은 패널 다시 열기\", scope: \"global\" },\n  { id: \"new-session\", keys: \"Ctrl+N\", description: \"현재 패널 새 세션\", scope: \"panel\" },\n  { id: \"session-switcher\", keys: \"Cmd+K\", description: \"세션 스위처 열기\", scope: \"panel\" },\n  { id: \"focus-panel-1\", keys: \"Ctrl+1\", description: \"패널 1 포커스\", scope: \"global\" },\n  { id: \"focus-panel-2\", keys: \"Ctrl+2\", description: \"패널 2 포커스\", scope: \"global\" },\n  { id: \"focus-panel-3\", keys: \"Ctrl+3\", description: \"패널 3 포커스\", scope: \"global\" },\n  { id: \"focus-panel-4\", keys: \"Ctrl+4\", description: \"패널 4 포커스\", scope: \"global\" },\n  { id: \"focus-panel-5\", keys: \"Ctrl+5\", description: \"패널 5 포커스\", scope: \"global\" },\n];\n\n// Re-export for backward compat\nexport const SHORTCUTS = DEFAULT_SHORTCUTS;\n\n// --- Storage ---\n\nconst STORAGE_KEY = \"awf:custom-shortcuts\";\n\nexport type CustomBindings = Record<string, string>; // id → keys\n\nexport function loadCustomBindings(): CustomBindings {\n  if (typeof window === \"undefined\") return {};\n  try {\n    const raw = localStorage.getItem(STORAGE_KEY);\n    return raw ? JSON.parse(raw) : {};\n  } catch {\n    return {};\n  }\n}\n\nexport function saveCustomBindings(bindings: CustomBindings) {\n  if (typeof window === \"undefined\") return;\n  localStorage.setItem(STORAGE_KEY, JSON.stringify(bindings));\n}\n\n/** Get effective shortcuts (defaults + user overrides merged) */\nexport function getEffectiveShortcuts(): ShortcutDef[] {\n  const custom = loadCustomBindings();\n  return DEFAULT_SHORTCUTS.map((s) => ({\n    ...s,\n    keys: custom[s.id] || s.keys,\n  }));\n}\n\n// --- Key matching ---\n\n/**\n * Parse a display key string like \"Cmd+Shift+K\" into a normalized set.\n * Supports: Cmd, Ctrl, Shift, Opt/Alt, plus a main key.\n */\nexport function parseKeys(keys: string): { meta: boolean; ctrl: boolean; shift: boolean; alt: boolean; key: string } {\n  const parts = keys.split(\"+\").map((p) => p.trim().toLowerCase());\n  return {\n    meta: parts.includes(\"cmd\") || parts.includes(\"meta\"),\n    ctrl: parts.includes(\"ctrl\") || parts.includes(\"control\"),\n    shift: parts.includes(\"shift\"),\n    alt: parts.includes(\"opt\") || parts.includes(\"alt\") || parts.includes(\"option\"),\n    key: parts.filter((p) => ![\"cmd\", \"meta\", \"ctrl\", \"control\", \"shift\", \"opt\", \"alt\", \"option\"].includes(p))[0] || \"\",\n  };\n}\n\n/** Check if a KeyboardEvent matches a key combo string */\nexport function matchesShortcut(e: KeyboardEvent, keys: string): boolean {\n  const combo = parseKeys(keys);\n\n  if (combo.meta !== e.metaKey) return false;\n  if (combo.ctrl !== e.ctrlKey) return false;\n  if (combo.shift !== e.shiftKey) return false;\n  if (combo.alt !== e.altKey) return false;\n\n  // Normalize the event key\n  const eventKey = e.key.toLowerCase();\n  const eventCode = e.code.toLowerCase();\n\n  // Match by key name or code\n  const target = combo.key.toLowerCase();\n  if (!target) return false;\n\n  // Special key mappings\n  const keyMap: Record<string, string[]> = {\n    \"/\": [\"/\", \"?\", \"slash\"],\n    \"?\": [\"/\", \"?\"],\n    \"\\\\\": [\"\\\\\", \"backslash\"],\n    \"-\": [\"-\", \"minus\"],\n    \"=\": [\"=\", \"equal\"],\n    \"[\": [\"[\", \"bracketleft\"],\n    \"]\": [\"]\", \"bracketright\"],\n  };\n\n  if (keyMap[target]) {\n    return keyMap[target].some((k) => eventKey === k || eventCode === `key${k}` || eventCode === k);\n  }\n\n  // Letter keys\n  if (target.length === 1 && target >= \"a\" && target <= \"z\") {\n    return eventCode === `key${target}` || eventKey === target;\n  }\n\n  // Number keys\n  if (target.length === 1 && target >= \"0\" && target <= \"9\") {\n    return eventKey === target || eventCode === `digit${target}`;\n  }\n\n  return eventKey === target;\n}\n\n/** Find a shortcut by id and check if event matches it */\nexport function matchesShortcutId(e: KeyboardEvent, id: string): boolean {\n  const shortcuts = getEffectiveShortcuts();\n  const shortcut = shortcuts.find((s) => s.id === id);\n  if (!shortcut) return false;\n  return matchesShortcut(e, shortcut.keys);\n}\n\n/** Convert a KeyboardEvent to a display string for recording custom shortcuts */\nexport function eventToKeyString(e: KeyboardEvent): string | null {\n  const parts: string[] = [];\n  if (e.metaKey) parts.push(\"Cmd\");\n  if (e.ctrlKey) parts.push(\"Ctrl\");\n  if (e.shiftKey) parts.push(\"Shift\");\n  if (e.altKey) parts.push(\"Opt\");\n\n  // Ignore modifier-only presses\n  if ([\"Meta\", \"Control\", \"Shift\", \"Alt\"].includes(e.key)) return null;\n\n  // Normalize key display\n  let key = e.key;\n  if (key.length === 1) key = key.toUpperCase();\n  else if (key === \"Escape\") key = \"Esc\";\n  else if (key === \"Backspace\") key = \"Backspace\";\n  else if (key === \"Enter\") key = \"Enter\";\n\n  parts.push(key);\n  return parts.join(\"+\");\n}\n\nexport function isShortcutHelp(e: KeyboardEvent) {\n  return matchesShortcutId(e, \"help\");\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 6155, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/settings/agent-manager.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect, useCallback } from \"react\";\nimport { Bot, Plus, Pencil, Trash2, Save, X, ChevronRight } from \"lucide-react\";\nimport { useGateway, useAgents } from \"@/lib/gateway/hooks\";\nimport type { Agent } from \"@/lib/gateway/protocol\";\nimport { getAgentAvatar } from \"@/lib/agent-avatars\";\nimport { cn } from \"@/lib/utils\";\n\n// --- Agent form fields ---\ninterface AgentFormData {\n  id: string;\n  name: string;\n  model: string;\n  description: string;\n  systemPrompt: string;\n}\n\nconst EMPTY_FORM: AgentFormData = { id: \"\", name: \"\", model: \"\", description: \"\", systemPrompt: \"\" };\n\n// --- New Session Picker (agent selection → callback) ---\n\nexport function NewSessionPicker({\n  open,\n  onClose,\n  onSelect,\n  onManageAgents,\n}: {\n  open: boolean;\n  onClose: () => void;\n  onSelect: (agentId: string) => void;\n  onManageAgents: () => void;\n}) {\n  const { agents, refresh } = useAgents();\n\n  useEffect(() => {\n    if (open) refresh();\n  }, [open, refresh]);\n\n  useEffect(() => {\n    if (!open) return;\n    const handler = (e: KeyboardEvent) => {\n      if (e.key === \"Escape\") onClose();\n    };\n    document.addEventListener(\"keydown\", handler);\n    return () => document.removeEventListener(\"keydown\", handler);\n  }, [open, onClose]);\n\n  if (!open) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-[150]\" role=\"dialog\" aria-modal=\"true\">\n      <div className=\"absolute inset-0 bg-black/60\" onClick={onClose} />\n      <div className=\"absolute left-1/2 top-1/2 w-[min(92vw,480px)] -translate-x-1/2 -translate-y-1/2 rounded-xl border border-zinc-700 bg-zinc-900 shadow-2xl\">\n        <div className=\"flex items-center justify-between border-b border-zinc-800 px-4 py-3\">\n          <h3 className=\"text-sm font-semibold text-zinc-100\">새 세션 — 에이전트 선택</h3>\n          <button onClick={onClose} className=\"rounded px-2 py-1 text-xs text-zinc-400 hover:bg-zinc-800 hover:text-zinc-200\">ESC</button>\n        </div>\n        <div className=\"max-h-[60vh] overflow-y-auto p-2\">\n          {agents.map((agent) => {\n            const av = getAgentAvatar(agent.id);\n            return (\n              <button\n                key={agent.id}\n                onClick={() => { onSelect(agent.id); onClose(); }}\n                className=\"flex w-full items-center gap-3 rounded-lg px-3 py-3 text-left transition hover:bg-zinc-800\"\n              >\n                <div className={cn(\"flex size-9 shrink-0 items-center justify-center rounded-full text-base\", av.color)}>\n                  {av.emoji}\n                </div>\n                <div className=\"flex-1 min-w-0\">\n                  <div className=\"text-sm font-semibold text-zinc-100 truncate\">{agent.name || agent.id}</div>\n                  {agent.description && (\n                    <div className=\"text-xs text-zinc-500 truncate\">{agent.description}</div>\n                  )}\n                  {agent.model && (\n                    <div className=\"text-[10px] text-zinc-600 truncate\">{agent.model}</div>\n                  )}\n                </div>\n                <ChevronRight size={14} className=\"text-zinc-600\" />\n              </button>\n            );\n          })}\n\n          {agents.length === 0 && (\n            <div className=\"py-8 text-center text-sm text-zinc-500\">에이전트가 없습니다</div>\n          )}\n        </div>\n        <div className=\"border-t border-zinc-800 px-3 py-2\">\n          <button\n            onClick={() => { onClose(); onManageAgents(); }}\n            className=\"flex w-full items-center justify-center gap-1.5 rounded-md bg-zinc-800 py-2 text-xs text-zinc-400 hover:bg-zinc-700 hover:text-zinc-200\"\n          >\n            <Bot size={12} />\n            에이전트 관리\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// --- Agent Manager (CRUD) ---\n\nexport function AgentManager({\n  open,\n  onClose,\n}: {\n  open: boolean;\n  onClose: () => void;\n}) {\n  const { client, state } = useGateway();\n  const { agents, refresh } = useAgents();\n  const isConnected = state === \"connected\";\n\n  const [editingAgent, setEditingAgent] = useState<AgentFormData | null>(null);\n  const [isNew, setIsNew] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [confirmDeleteId, setConfirmDeleteId] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (open) {\n      refresh();\n      setEditingAgent(null);\n      setIsNew(false);\n      setConfirmDeleteId(null);\n    }\n  }, [open, refresh]);\n\n  useEffect(() => {\n    if (!open) return;\n    const handler = (e: KeyboardEvent) => {\n      if (e.key === \"Escape\") {\n        if (editingAgent) { setEditingAgent(null); setIsNew(false); }\n        else onClose();\n      }\n    };\n    document.addEventListener(\"keydown\", handler);\n    return () => document.removeEventListener(\"keydown\", handler);\n  }, [open, editingAgent, onClose]);\n\n  const startCreate = () => {\n    setEditingAgent({ ...EMPTY_FORM });\n    setIsNew(true);\n  };\n\n  const startEdit = (agent: Agent) => {\n    setEditingAgent({\n      id: agent.id,\n      name: agent.name || \"\",\n      model: agent.model || \"\",\n      description: agent.description || \"\",\n      systemPrompt: agent.systemPrompt || \"\",\n    });\n    setIsNew(false);\n  };\n\n  const saveAgent = useCallback(async () => {\n    if (!client || !isConnected || !editingAgent) return;\n    if (!editingAgent.id.trim() || !editingAgent.name.trim()) return;\n\n    setLoading(true);\n    try {\n      // Get current config\n      const config = await client.request<{ config: Record<string, unknown> }>(\"config.get\");\n      const currentAgents = ((config?.config as any)?.agents?.list || {}) as Record<string, unknown>;\n\n      // Build agent config entry\n      const agentEntry: Record<string, unknown> = {};\n      if (editingAgent.name) agentEntry.name = editingAgent.name;\n      if (editingAgent.model) agentEntry.model = editingAgent.model;\n      if (editingAgent.description) agentEntry.description = editingAgent.description;\n      if (editingAgent.systemPrompt) agentEntry.systemPrompt = editingAgent.systemPrompt;\n\n      // Merge with existing (preserve fields we don't edit like workspace, heartbeat, etc.)\n      const existing = (currentAgents[editingAgent.id] || {}) as Record<string, unknown>;\n      const merged = { ...existing, ...agentEntry };\n\n      // Patch config\n      await client.request(\"config.patch\", {\n        patch: {\n          agents: {\n            list: {\n              [editingAgent.id]: merged,\n            },\n          },\n        },\n      });\n\n      await refresh();\n      setEditingAgent(null);\n      setIsNew(false);\n    } catch (err) {\n      console.error(\"[AWF] save agent error:\", err);\n    } finally {\n      setLoading(false);\n    }\n  }, [client, isConnected, editingAgent, refresh]);\n\n  const deleteAgent = useCallback(async (id: string) => {\n    if (!client || !isConnected) return;\n    setLoading(true);\n    try {\n      // Get current config, remove agent\n      const config = await client.request<{ config: Record<string, unknown> }>(\"config.get\");\n      const currentAgents = { ...((config?.config as any)?.agents?.list || {}) } as Record<string, unknown>;\n      delete currentAgents[id];\n\n      await client.request(\"config.apply\", {\n        config: {\n          ...((config?.config) || {}),\n          agents: {\n            ...((config?.config as any)?.agents || {}),\n            list: currentAgents,\n          },\n        },\n      });\n\n      await refresh();\n      setConfirmDeleteId(null);\n    } catch (err) {\n      console.error(\"[AWF] delete agent error:\", err);\n    } finally {\n      setLoading(false);\n    }\n  }, [client, isConnected, refresh]);\n\n  if (!open) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-[160]\" role=\"dialog\" aria-modal=\"true\">\n      <div className=\"absolute inset-0 bg-black/60\" onClick={onClose} />\n      <div className=\"absolute left-1/2 top-1/2 w-[min(92vw,600px)] -translate-x-1/2 -translate-y-1/2 rounded-xl border border-zinc-700 bg-zinc-900 shadow-2xl\">\n        <div className=\"flex items-center justify-between border-b border-zinc-800 px-4 py-3\">\n          <h3 className=\"text-sm font-semibold text-zinc-100\">\n            {editingAgent ? (isNew ? \"에이전트 생성\" : \"에이전트 수정\") : \"에이전트 관리\"}\n          </h3>\n          <button onClick={() => { if (editingAgent) { setEditingAgent(null); setIsNew(false); } else onClose(); }}\n            className=\"rounded px-2 py-1 text-xs text-zinc-400 hover:bg-zinc-800 hover:text-zinc-200\">\n            {editingAgent ? \"뒤로\" : \"ESC\"}\n          </button>\n        </div>\n\n        {editingAgent ? (\n          /* --- Edit / Create form --- */\n          <div className=\"space-y-3 p-4\">\n            <div>\n              <label className=\"mb-1 block text-[11px] font-medium text-zinc-500\">ID</label>\n              <input\n                value={editingAgent.id}\n                onChange={(e) => setEditingAgent({ ...editingAgent, id: e.target.value.toLowerCase().replace(/[^a-z0-9_-]/g, \"\") })}\n                disabled={!isNew}\n                placeholder=\"my-agent\"\n                className=\"w-full rounded-md border border-zinc-700 bg-zinc-800 px-3 py-2 text-sm text-zinc-200 outline-none focus:border-zinc-600 disabled:opacity-50\"\n              />\n            </div>\n            <div>\n              <label className=\"mb-1 block text-[11px] font-medium text-zinc-500\">이름</label>\n              <input\n                value={editingAgent.name}\n                onChange={(e) => setEditingAgent({ ...editingAgent, name: e.target.value })}\n                placeholder=\"My Agent\"\n                className=\"w-full rounded-md border border-zinc-700 bg-zinc-800 px-3 py-2 text-sm text-zinc-200 outline-none focus:border-zinc-600\"\n              />\n            </div>\n            <div>\n              <label className=\"mb-1 block text-[11px] font-medium text-zinc-500\">모델 (선택)</label>\n              <input\n                value={editingAgent.model}\n                onChange={(e) => setEditingAgent({ ...editingAgent, model: e.target.value })}\n                placeholder=\"anthropic/claude-sonnet-4-20250514\"\n                className=\"w-full rounded-md border border-zinc-700 bg-zinc-800 px-3 py-2 text-sm text-zinc-200 outline-none focus:border-zinc-600\"\n              />\n            </div>\n            <div>\n              <label className=\"mb-1 block text-[11px] font-medium text-zinc-500\">설명 (선택)</label>\n              <input\n                value={editingAgent.description}\n                onChange={(e) => setEditingAgent({ ...editingAgent, description: e.target.value })}\n                placeholder=\"이 에이전트의 역할 설명\"\n                className=\"w-full rounded-md border border-zinc-700 bg-zinc-800 px-3 py-2 text-sm text-zinc-200 outline-none focus:border-zinc-600\"\n              />\n            </div>\n            <div>\n              <label className=\"mb-1 block text-[11px] font-medium text-zinc-500\">시스템 프롬프트 (선택)</label>\n              <textarea\n                value={editingAgent.systemPrompt}\n                onChange={(e) => setEditingAgent({ ...editingAgent, systemPrompt: e.target.value })}\n                placeholder=\"에이전트의 성격과 역할을 정의하세요...\"\n                rows={4}\n                className=\"w-full rounded-md border border-zinc-700 bg-zinc-800 px-3 py-2 text-sm text-zinc-200 outline-none focus:border-zinc-600 resize-y\"\n              />\n            </div>\n            <button\n              onClick={saveAgent}\n              disabled={loading || !editingAgent.id.trim() || !editingAgent.name.trim()}\n              className=\"flex w-full items-center justify-center gap-1.5 rounded-md bg-amber-600/80 py-2 text-sm font-medium text-white hover:bg-amber-600 disabled:opacity-40\"\n            >\n              <Save size={14} />\n              {isNew ? \"생성\" : \"저장\"}\n            </button>\n          </div>\n        ) : (\n          /* --- Agent list --- */\n          <>\n            <div className=\"max-h-[55vh] overflow-y-auto p-2\">\n              {agents.map((agent) => {\n                const av = getAgentAvatar(agent.id);\n                const isDeleting = confirmDeleteId === agent.id;\n\n                return (\n                  <div key={agent.id} className=\"flex items-center gap-3 rounded-lg px-3 py-2.5 hover:bg-zinc-800/50\">\n                    <div className={cn(\"flex size-8 shrink-0 items-center justify-center rounded-full text-sm\", av.color)}>\n                      {av.emoji}\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"text-sm font-medium text-zinc-200 truncate\">{agent.name || agent.id}</div>\n                      <div className=\"text-[10px] text-zinc-600 truncate\">{agent.id} · {agent.model || \"default\"}</div>\n                    </div>\n                    <div className=\"flex items-center gap-1\">\n                      <button\n                        onClick={() => startEdit(agent)}\n                        className=\"rounded p-1.5 text-zinc-500 hover:bg-zinc-800 hover:text-zinc-300\"\n                        title=\"수정\"\n                      >\n                        <Pencil size={13} />\n                      </button>\n                      {isDeleting ? (\n                        <div className=\"flex gap-1\">\n                          <button\n                            onClick={() => deleteAgent(agent.id)}\n                            disabled={loading}\n                            className=\"rounded px-2 py-1 text-[10px] bg-red-600/80 text-white hover:bg-red-600\"\n                          >\n                            확인\n                          </button>\n                          <button\n                            onClick={() => setConfirmDeleteId(null)}\n                            className=\"rounded px-2 py-1 text-[10px] bg-zinc-800 text-zinc-400 hover:bg-zinc-700\"\n                          >\n                            취소\n                          </button>\n                        </div>\n                      ) : (\n                        <button\n                          onClick={() => setConfirmDeleteId(agent.id)}\n                          className=\"rounded p-1.5 text-zinc-600 hover:bg-zinc-800 hover:text-red-400\"\n                          title=\"삭제\"\n                        >\n                          <Trash2 size={13} />\n                        </button>\n                      )}\n                    </div>\n                  </div>\n                );\n              })}\n\n              {agents.length === 0 && (\n                <div className=\"py-8 text-center text-sm text-zinc-500\">등록된 에이전트가 없습니다</div>\n              )}\n            </div>\n            <div className=\"border-t border-zinc-800 px-3 py-2\">\n              <button\n                onClick={startCreate}\n                className=\"flex w-full items-center justify-center gap-1.5 rounded-md bg-zinc-800 py-2 text-xs text-zinc-400 hover:bg-zinc-700 hover:text-zinc-200\"\n              >\n                <Plus size={12} />\n                새 에이전트 생성\n              </button>\n            </div>\n          </>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 6901, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/chat/chat-panel.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useCallback, useEffect, useRef } from \"react\";\nimport { useGateway, useChat, useAgents, useSessions } from \"@/lib/gateway/hooks\";\nimport { MessageList } from \"./message-list\";\nimport { ChatInput } from \"./chat-input\";\nimport { AvatarAgentSelector } from \"./avatar-agent-selector\";\nimport { AgentSelector } from \"./agent-selector\";\nimport { SessionSwitcher } from \"./session-switcher\";\nimport { DropZone, useFileAttachments, attachmentToPayload } from \"./file-attachments\";\nimport { parseSessionKey, sessionDisplayName, type GatewaySession } from \"@/lib/gateway/session-utils\";\nimport { TaskMemo } from \"./task-memo\";\nimport { SessionSettings } from \"@/components/settings/session-settings\";\nimport { ChatHeader } from \"./chat-header\";\nimport { matchesShortcutId } from \"@/lib/shortcuts\";\nimport { NewSessionPicker, AgentManager } from \"@/components/settings/agent-manager\";\n\nexport interface ChatPanelProps {\n  /** Panel id for focus management */\n  panelId: string;\n  /** Whether this panel is the active/focused one */\n  isActive: boolean;\n  /** Called when this panel gains focus */\n  onFocus: () => void;\n  /** Show header controls (agent selector, session switcher) */\n  showHeader?: boolean;\n}\n\nexport function ChatPanel({ panelId, isActive, onFocus, showHeader = true }: ChatPanelProps) {\n  const { client, state, mainSessionKey } = useGateway();\n\n  const storagePrefix = `awf:panel:${panelId}:`;\n\n  const [sessionKey, setSessionKeyRaw] = useState<string | undefined>(undefined);\n  const [agentId, setAgentId] = useState<string>(process.env.NEXT_PUBLIC_DEFAULT_AGENT || \"default\");\n\n  // Load persisted panel state on mount (client only)\n  useEffect(() => {\n    if (typeof window === \"undefined\") return;\n    const savedSession = localStorage.getItem(`${storagePrefix}sessionKey`) || undefined;\n    const savedAgent = localStorage.getItem(`${storagePrefix}agentId`) || process.env.NEXT_PUBLIC_DEFAULT_AGENT || \"default\";\n    setSessionKeyRaw(savedSession);\n    setAgentId(savedAgent);\n  }, [storagePrefix]);\n\n  const setSessionKey = useCallback((key: string | undefined) => {\n    setSessionKeyRaw(key);\n    if (typeof window !== \"undefined\") {\n      if (key) localStorage.setItem(`${storagePrefix}sessionKey`, key);\n      else localStorage.removeItem(`${storagePrefix}sessionKey`);\n    }\n  }, [storagePrefix]);\n\n  const effectiveSessionKey =\n    sessionKey || (agentId ? `agent:${agentId}:main` : mainSessionKey) || undefined;\n\n  const { messages, streaming, loading, sendMessage, addUserMessage, cancelQueued, abort } = useChat(effectiveSessionKey);\n  const { agents } = useAgents();\n  const { sessions, loading: sessionsLoading, refresh: refreshSessions } = useSessions();\n\n  const { attachments, addFiles, removeAttachment, clearAttachments } = useFileAttachments();\n\n  const [sessionSwitcherOpen, setSessionSwitcherOpen] = useState(false);\n  const [newSessionPickerOpen, setNewSessionPickerOpen] = useState(false);\n  const [agentManagerOpen, setAgentManagerOpen] = useState(false);\n  const panelRef = useRef<HTMLDivElement>(null);\n\n  // Shortcuts (active panel only)\n  useEffect(() => {\n    function handleKeyDown(e: KeyboardEvent) {\n      if (!isActive) return;\n      if (matchesShortcutId(e, \"session-switcher\")) {\n        e.preventDefault();\n        setSessionSwitcherOpen((prev) => !prev);\n      }\n      if (matchesShortcutId(e, \"new-session\")) {\n        e.preventDefault();\n        setNewSessionPickerOpen(true);\n      }\n    }\n    document.addEventListener(\"keydown\", handleKeyDown);\n    return () => document.removeEventListener(\"keydown\", handleKeyDown);\n  }, [isActive, agentId, setSessionKey, refreshSessions]);\n\n  // Restore focus to this panel's textarea\n  const refocusPanel = useCallback(() => {\n    setTimeout(() => {\n      const textarea = panelRef.current?.querySelector(\"textarea\");\n      textarea?.focus();\n    }, 50);\n  }, []);\n\n  // Focus textarea when panel becomes active\n  useEffect(() => {\n    if (isActive) refocusPanel();\n  }, [isActive, refocusPanel]);\n\n  const isConnected = state === \"connected\";\n\n  const makeDefaultThreadLabel = useCallback((agent: string) => {\n    const now = new Date();\n    const mm = String(now.getMonth() + 1).padStart(2, \"0\");\n    const dd = String(now.getDate()).padStart(2, \"0\");\n    const hh = String(now.getHours()).padStart(2, \"0\");\n    const min = String(now.getMinutes()).padStart(2, \"0\");\n    return `${agent}/작업-${mm}${dd}-${hh}${min}`;\n  }, []);\n\n  const summarizeLabelFromText = useCallback((text: string, agent: string) => {\n    const clean = text\n      .replace(/^\\/(new|reset|status|help|reasoning|model\\s+\\S+|think\\S*|verbose\\S*)\\b/gi, \"\")\n      .replace(/\\s+/g, \" \")\n      .trim();\n    if (!clean) return makeDefaultThreadLabel(agent);\n    const snippet = clean.length > 40 ? `${clean.slice(0, 38)}…` : clean;\n    return `${agent}/${snippet}`;\n  }, [makeDefaultThreadLabel]);\n\n  async function maybeAutoLabelSession(key: string | undefined, text: string) {\n    if (!client || !isConnected || !key) return;\n    const parsed = parseSessionKey(key);\n    // Only auto-label main and thread sessions\n    if (parsed.type !== \"thread\" && parsed.type !== \"main\") return;\n\n    const session = (sessions as GatewaySession[]).find((s) => s.key === key);\n    const currentLabel = (session?.label || \"\").trim();\n    const isAutoOrEmpty =\n      !currentLabel ||\n      /스레드\\s*#|thread\\s*#|^thread[:\\s-]|작업-\\d{4}/i.test(currentLabel);\n\n    if (!isAutoOrEmpty) return;\n\n    // Skip slash commands\n    const clean = text.replace(/^\\/(new|reset|status|help|reasoning|model\\s+\\S+|think\\S*|verbose\\S*)\\b/gi, \"\").trim();\n    if (!clean) return;\n\n    try {\n      const label = summarizeLabelFromText(clean, parsed.agentId);\n      await client.request(\"sessions.patch\", { key, label });\n      refreshSessions();\n    } catch (err) {\n      console.error(\"[AWF] auto-label session failed:\", err);\n    }\n  }\n\n  const handleSend = useCallback(\n    async (text: string) => {\n      const trimmed = text.trim().toLowerCase();\n\n      // /stop — abort streaming\n      if (trimmed === \"/stop\" || trimmed === \"stop\" || trimmed === \"esc\" || trimmed === \"abort\") {\n        abort();\n        return;\n      }\n\n      // /new, /reset — send to gateway, then refresh sessions\n      if (trimmed === \"/new\" || trimmed === \"/reset\" || trimmed.startsWith(\"/new \") || trimmed.startsWith(\"/reset \")) {\n        sendMessage(text);\n        refreshSessions();\n        return;\n      }\n\n      // /status, /reasoning, /model, /help — pass to gateway as chat.send\n      if (trimmed === \"/status\" || trimmed === \"/reasoning\" || trimmed === \"/help\" ||\n          trimmed.startsWith(\"/model \") || trimmed === \"/model\") {\n        sendMessage(text);\n        // Force quick metadata refresh for header badge (model/tokens)\n        setTimeout(() => refreshSessions(), 400);\n        setTimeout(() => refreshSessions(), 1200);\n        return;\n      }\n\n      if (attachments.length > 0) {\n        await maybeAutoLabelSession(effectiveSessionKey, text);\n        const payloads = await Promise.all(attachments.map(attachmentToPayload));\n        const userMsg = text || \"\";\n        const displayAtts = attachments.map((att) => ({\n          fileName: att.file.name,\n          mimeType: att.file.type || \"application/octet-stream\",\n          dataUrl: att.preview || undefined,\n        }));\n        addUserMessage(userMsg || \"(첨부 파일)\", displayAtts);\n        if (client && isConnected) {\n          try {\n            await client.request(\"chat.send\", {\n              message: userMsg,\n              idempotencyKey: `awf-${Date.now()}-${Math.random().toString(36).slice(2)}`,\n              sessionKey: effectiveSessionKey,\n              attachments: payloads,\n            });\n          } catch (err) {\n            console.error(\"[AWF] chat.send with attachments error:\", err);\n          }\n        }\n        clearAttachments();\n      } else {\n        await maybeAutoLabelSession(effectiveSessionKey, text);\n        sendMessage(text);\n      }\n    },\n    [attachments, client, isConnected, effectiveSessionKey, clearAttachments, sendMessage, addUserMessage, abort, refreshSessions, sessions, summarizeLabelFromText]\n  );\n\n  const handleAgentChange = (id: string | undefined) => {\n    const newId = id || process.env.NEXT_PUBLIC_DEFAULT_AGENT || \"default\";\n    setAgentId(newId);\n    if (typeof window !== \"undefined\") {\n      localStorage.setItem(`${storagePrefix}agentId`, newId);\n    }\n    setSessionKey(undefined);\n  };\n\n    const handleNewSession = () => {\n    setNewSessionPickerOpen(true);\n  };\n\n  const createSessionForAgent = async (selectedAgentId: string) => {\n    const threadId = Date.now().toString(36) + Math.random().toString(36).slice(2, 6);\n    const newKey = `agent:${selectedAgentId}:main:thread:${threadId}`;\n\n    // Switch agent context if different\n    if (selectedAgentId !== agentId) {\n      setAgentId(selectedAgentId);\n      if (typeof window !== \"undefined\") {\n        localStorage.setItem(`${storagePrefix}agentId`, selectedAgentId);\n      }\n    }\n\n    setSessionKey(newKey);\n\n    // Pre-label the thread\n    if (client && isConnected) {\n      try {\n        await client.request(\"sessions.patch\", {\n          key: newKey,\n          label: makeDefaultThreadLabel(selectedAgentId),\n        });\n      } catch {\n        // ignore; auto-labeled on first message\n      }\n    }\n\n    refreshSessions();\n    refocusPanel();\n  };\n\n  const handleRename = useCallback(\n    async (key: string, label: string) => {\n      if (!client || !isConnected) return;\n      try {\n        await client.request(\"sessions.patch\", { key, label });\n        await refreshSessions();\n      } catch (err) {\n        console.error(\"[AWF] sessions.patch error:\", err);\n      } finally {\n        refocusPanel();\n      }\n    },\n    [client, isConnected, refreshSessions, refocusPanel]\n  );\n\n  const handleDelete = useCallback(\n    async (key: string) => {\n      if (!client || !isConnected) return;\n      try {\n        await client.request(\"sessions.delete\", { key });\n        if (sessionKey === key) setSessionKey(undefined);\n        await refreshSessions();\n      } catch (err) {\n        console.error(\"[AWF] sessions.delete error:\", err);\n      } finally {\n        refocusPanel();\n      }\n    },\n    [client, isConnected, sessionKey, setSessionKey, refreshSessions, refocusPanel]\n  );\n\n  const handleReset = useCallback(\n    async (key: string) => {\n      if (!client || !isConnected) return;\n      try {\n        await client.request(\"sessions.reset\", { key });\n        await refreshSessions();\n      } catch (err) {\n        console.error(\"[AWF] sessions.reset error:\", err);\n      } finally {\n        refocusPanel();\n      }\n    },\n    [client, isConnected, refreshSessions, refocusPanel]\n  );\n\n  // Derive agent from session key\n  const parsedSession = effectiveSessionKey ? parseSessionKey(effectiveSessionKey) : null;\n  const currentAgentId = parsedSession?.agentId || agentId;\n\n  // Find current session metadata\n  const currentSession = (sessions as GatewaySession[]).find(\n    (s) => s.key === effectiveSessionKey || s.key === sessionKey\n  );\n  const tokenCount = currentSession?.totalTokens;\n  const tokenStr = tokenCount != null && tokenCount > 0\n    ? tokenCount >= 1_000_000\n      ? `${(tokenCount / 1_000_000).toFixed(1)}M`\n      : tokenCount >= 1_000\n        ? `${(tokenCount / 1_000).toFixed(0)}k`\n        : `${tokenCount}`\n    : null;\n\n  return (\n    <div\n      ref={panelRef}\n      className=\"relative flex h-full flex-col bg-background\"\n      onClick={onFocus}\n    >\n      {/* Chat Header — agent name + topic */}\n      {showHeader && effectiveSessionKey && (\n        <ChatHeader\n          sessionKey={effectiveSessionKey}\n          agents={agents}\n          sessions={sessions as unknown as Array<Record<string, unknown>>}\n          messages={messages as unknown as Array<Record<string, unknown>>}\n          onSelectSession={setSessionKey}\n          onNewSession={handleNewSession}\n          onDeleteSession={(key) => handleDelete(key)}\n        />\n      )}\n\n      {/* Task Memo */}\n      {effectiveSessionKey && (\n        <TaskMemo key={effectiveSessionKey} sessionKey={effectiveSessionKey} messages={messages as unknown as Array<Record<string, unknown>>} />\n      )}\n\n      {/* Messages */}\n      <DropZone onDrop={addFiles}>\n        <MessageList messages={messages} loading={loading} streaming={streaming} onCancelQueued={cancelQueued} />\n      </DropZone>\n\n      {/* Input with integrated toolbar */}\n      <ChatInput\n        onSend={handleSend}\n        onAbort={abort}\n        streaming={streaming}\n        disabled={!isConnected}\n        attachments={attachments}\n        onAttachFiles={addFiles}\n        onRemoveAttachment={removeAttachment}\n        panelId={panelId}\n        toolbar={showHeader ? (\n          <>\n            <AvatarAgentSelector\n              agents={agents}\n              selectedId={currentAgentId}\n              onSelect={handleAgentChange}\n            />\n            <SessionSettings\n              sessionKey={effectiveSessionKey}\n              onDelete={() => setSessionKey(undefined)}\n              onReset={() => {\n                refreshSessions();\n              }}\n            />\n            <SessionSwitcher\n              sessions={sessions as GatewaySession[]}\n              currentKey={sessionKey}\n              onSelect={setSessionKey}\n              onNew={handleNewSession}\n              onRename={handleRename}\n              onDelete={handleDelete}\n              onReset={handleReset}\n              open={sessionSwitcherOpen}\n              onOpenChange={setSessionSwitcherOpen}\n              portalContainer={panelRef.current}\n            />\n            <div className=\"ml-auto flex items-center gap-2\">\n              {currentSession?.model && (\n                <span className=\"text-[10px] text-muted-foreground\" title={currentSession.model}>\n                  {currentSession.model.split(\"/\").pop()}\n                </span>\n              )}\n              {tokenStr && (\n                <span className=\"text-[10px] text-muted-foreground\">{tokenStr} tokens</span>\n              )}\n            </div>\n          </>\n        ) : undefined}\n      />\n\n      {/* New Session Picker */}\n      <NewSessionPicker\n        open={newSessionPickerOpen}\n        onClose={() => setNewSessionPickerOpen(false)}\n        onSelect={createSessionForAgent}\n        onManageAgents={() => setAgentManagerOpen(true)}\n      />\n\n      {/* Agent Manager */}\n      <AgentManager\n        open={agentManagerOpen}\n        onClose={() => setAgentManagerOpen(false)}\n      />\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 7355, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/chat/split-view.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useCallback, useRef, useEffect } from \"react\";\nimport { ChatPanel } from \"./chat-panel\";\nimport { useIsMobile } from \"@/lib/hooks/use-mobile\";\nimport { ChevronLeft, ChevronRight, X } from \"lucide-react\";\nimport { matchesShortcutId } from \"@/lib/shortcuts\";\n\nfunction uid() {\n  return Math.random().toString(36).slice(2, 8);\n}\n\n// --- Types ---\n\ninterface PanelState {\n  id: string;\n  /** Flex-basis width in fractions (not percentages). All panels sum to 1. */\n  width: number;\n}\n\ninterface SplitState {\n  panels: PanelState[];\n  activePanelId: string;\n}\n\n// --- Storage helpers ---\n\nconst STORAGE_KEY = \"awf:split-panels\";\n\nfunction loadState(): SplitState | null {\n  if (typeof window === \"undefined\") return null;\n  try {\n    const raw = localStorage.getItem(STORAGE_KEY);\n    if (!raw) return null;\n    const parsed = JSON.parse(raw) as SplitState;\n    if (parsed.panels?.length >= 1) return parsed;\n  } catch {}\n  return null;\n}\n\nfunction saveState(state: SplitState) {\n  if (typeof window === \"undefined\") return;\n  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));\n}\n\nfunction defaultState(): SplitState {\n  // Must be deterministic for SSR/client hydration match\n  const id = \"panel-1\";\n  return { panels: [{ id, width: 1 }], activePanelId: id };\n}\n\n// --- Helpers ---\n\nfunction equalWidths(count: number): number {\n  return 1 / count;\n}\n\nconst MIN_PANEL_PX = 200;\n\n// --- Component ---\n\nexport interface SplitViewProps {\n  /** Number of panels requested. Controlled from parent via addPanel/removePanel. */\n  panelCount?: number;\n  /** Called by parent to imperatively add a panel */\n  onAddPanel?: () => void;\n}\n\nexport function SplitView() {\n  const [state, setState] = useState<SplitState>(defaultState);\n  const [hydrated, setHydrated] = useState(false);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const dragRef = useRef<{ index: number; startX: number; startWidths: number[] } | null>(null);\n  const closedPanelsRef = useRef<PanelState[]>([]);\n  const isMobile = useIsMobile();\n\n  // Restore from localStorage after hydration\n  useEffect(() => {\n    const saved = loadState();\n    if (saved) setState(saved);\n    setHydrated(true);\n  }, []);\n\n  // Persist on change (debounced to avoid thrashing on rapid switches)\n  useEffect(() => {\n    if (!hydrated) return;\n    const timer = setTimeout(() => saveState(state), 200);\n    return () => clearTimeout(timer);\n  }, [state, hydrated]);\n\n  // --- Panel management ---\n\n  const addPanel = useCallback(() => {\n    setState((prev) => {\n      const newId = uid();\n      const count = prev.panels.length + 1;\n      const w = equalWidths(count);\n      const panels = [...prev.panels.map((p) => ({ ...p, width: w })), { id: newId, width: w }];\n      return { panels, activePanelId: newId };\n    });\n  }, []);\n\n  const removePanel = useCallback((id: string) => {\n    setState((prev) => {\n      if (prev.panels.length <= 1) return prev;\n      const removed = prev.panels.find((p) => p.id === id);\n      if (removed) closedPanelsRef.current.push(removed);\n      const remaining = prev.panels.filter((p) => p.id !== id);\n      const w = equalWidths(remaining.length);\n      const panels = remaining.map((p) => ({ ...p, width: w }));\n      const activePanelId =\n        prev.activePanelId === id ? panels[0].id : prev.activePanelId;\n      return { panels, activePanelId };\n    });\n  }, []);\n\n  const reopenLastClosedPanel = useCallback(() => {\n    setState((prev) => {\n      const last = closedPanelsRef.current.pop();\n      if (!last) return prev;\n      const count = prev.panels.length + 1;\n      const w = equalWidths(count);\n      const panels = [...prev.panels.map((p) => ({ ...p, width: w })), { ...last, width: w }];\n      return { panels, activePanelId: last.id };\n    });\n  }, []);\n\n  const setActive = useCallback((id: string) => {\n    setState((prev) => (prev.activePanelId === id ? prev : { ...prev, activePanelId: id }));\n  }, []);\n\n  /** Navigate focus to prev (-1) or next (+1) panel */\n  const navPanel = useCallback((dir: -1 | 1) => {\n    setState((prev) => {\n      const idx = prev.panels.findIndex((p) => p.id === prev.activePanelId);\n      const next = idx + dir;\n      if (next < 0 || next >= prev.panels.length) return prev;\n      return { ...prev, activePanelId: prev.panels[next].id };\n    });\n  }, []);\n\n  /** Move a panel's position left/right */\n  const movePanel = useCallback((id: string, dir: -1 | 1) => {\n    setState((prev) => {\n      const idx = prev.panels.findIndex((p) => p.id === id);\n      const next = idx + dir;\n      if (idx < 0 || next < 0 || next >= prev.panels.length) return prev;\n      const panels = [...prev.panels];\n      [panels[idx], panels[next]] = [panels[next], panels[idx]];\n      return { ...prev, panels };\n    });\n  }, []);\n\n  /** Move currently focused panel */\n  const moveActivePanel = useCallback((dir: -1 | 1) => {\n    setState((prev) => {\n      const idx = prev.panels.findIndex((p) => p.id === prev.activePanelId);\n      const next = idx + dir;\n      if (idx < 0 || next < 0 || next >= prev.panels.length) return prev;\n      const panels = [...prev.panels];\n      [panels[idx], panels[next]] = [panels[next], panels[idx]];\n      return { ...prev, panels };\n    });\n  }, []);\n\n  // Expose functions globally so chat-view can call them\n  useEffect(() => {\n    (window as any).__awfSplitAddPanel = addPanel;\n    (window as any).__awfSplitNavPanel = navPanel;\n    (window as any).__awfSplitCloseActivePanel = () => removePanel(state.activePanelId);\n    (window as any).__awfSplitReopenLastPanel = reopenLastClosedPanel;\n    (window as any).__awfSplitFocusPanel = (index: number) => {\n      setState((prev) => {\n        if (index < 0 || index >= prev.panels.length) return prev;\n        return { ...prev, activePanelId: prev.panels[index].id };\n      });\n    };\n    return () => {\n      delete (window as any).__awfSplitAddPanel;\n      delete (window as any).__awfSplitNavPanel;\n      delete (window as any).__awfSplitCloseActivePanel;\n      delete (window as any).__awfSplitReopenLastPanel;\n      delete (window as any).__awfSplitFocusPanel;\n    };\n  });\n\n  // Customizable shortcuts — resolved via matchesShortcutId\n  useEffect(() => {\n    const handler = (e: KeyboardEvent) => {\n      if (matchesShortcutId(e, \"focus-left\")) {\n        e.preventDefault(); e.stopPropagation();\n        if (!e.repeat) navPanel(-1);\n      } else if (matchesShortcutId(e, \"focus-right\")) {\n        e.preventDefault(); e.stopPropagation();\n        if (!e.repeat) navPanel(1);\n      } else if (matchesShortcutId(e, \"swap-panels\")) {\n        e.preventDefault(); e.stopPropagation();\n        // Swap active panel with the next one (wraps around)\n        setState((prev) => {\n          if (prev.panels.length < 2) return prev;\n          const idx = prev.panels.findIndex((p) => p.id === prev.activePanelId);\n          const next = (idx + 1) % prev.panels.length;\n          const panels = [...prev.panels];\n          [panels[idx], panels[next]] = [panels[next], panels[idx]];\n          return { ...prev, panels };\n        });\n      } else if (matchesShortcutId(e, \"close-panel\")) {\n        e.preventDefault(); e.stopPropagation();\n        removePanel(state.activePanelId);\n      } else if (matchesShortcutId(e, \"reopen-panel\")) {\n        e.preventDefault(); e.stopPropagation();\n        reopenLastClosedPanel();\n      }\n    };\n    window.addEventListener(\"keydown\", handler);\n    return () => window.removeEventListener(\"keydown\", handler);\n  }, [navPanel, removePanel, reopenLastClosedPanel, state.activePanelId]);\n\n  // --- Resize ---\n\n  const handleMouseDown = useCallback((index: number, e: React.MouseEvent) => {\n    e.preventDefault();\n    dragRef.current = {\n      index,\n      startX: e.clientX,\n      startWidths: state.panels.map((p) => p.width),\n    };\n    document.body.style.cursor = \"col-resize\";\n    document.body.style.userSelect = \"none\";\n  }, [state.panels]);\n\n  useEffect(() => {\n    const handleMouseMove = (e: MouseEvent) => {\n      const drag = dragRef.current;\n      if (!drag || !containerRef.current) return;\n      const containerWidth = containerRef.current.getBoundingClientRect().width;\n      const dx = e.clientX - drag.startX;\n      const dFrac = dx / containerWidth;\n\n      const minFrac = MIN_PANEL_PX / containerWidth;\n      const widths = [...drag.startWidths];\n      const i = drag.index;\n\n      let newLeft = widths[i] + dFrac;\n      let newRight = widths[i + 1] - dFrac;\n\n      if (newLeft < minFrac) {\n        newLeft = minFrac;\n        newRight = widths[i] + widths[i + 1] - minFrac;\n      }\n      if (newRight < minFrac) {\n        newRight = minFrac;\n        newLeft = widths[i] + widths[i + 1] - minFrac;\n      }\n\n      widths[i] = newLeft;\n      widths[i + 1] = newRight;\n\n      setState((prev) => ({\n        ...prev,\n        panels: prev.panels.map((p, idx) => ({ ...p, width: widths[idx] ?? p.width })),\n      }));\n    };\n\n    const handleMouseUp = () => {\n      if (dragRef.current) {\n        dragRef.current = null;\n        document.body.style.cursor = \"\";\n        document.body.style.userSelect = \"\";\n      }\n    };\n\n    document.addEventListener(\"mousemove\", handleMouseMove);\n    document.addEventListener(\"mouseup\", handleMouseUp);\n    return () => {\n      document.removeEventListener(\"mousemove\", handleMouseMove);\n      document.removeEventListener(\"mouseup\", handleMouseUp);\n    };\n  }, []);\n\n  // --- Render ---\n\n  const { panels, activePanelId } = state;\n\n  // Mobile: show only the active panel\n  const visiblePanels = isMobile\n    ? panels.filter((p) => p.id === activePanelId)\n    : panels;\n\n  return (\n    <div ref={containerRef} className=\"flex h-full\">\n      {visiblePanels.map((panel, i) => (\n        <div key={panel.id} className={`flex h-full min-w-0 ${!isMobile ? \"px-1 first:pl-2 last:pr-2\" : \"\"}`} style={{ flex: isMobile ? \"1 0 0%\" : `${panel.width} 0 0%` }}>\n          {/* Panel */}\n          <div\n            className={`relative h-full min-w-0 flex-1 overflow-hidden ${\n              !isMobile ? \"rounded-lg transition-all duration-300\" : \"\"\n            }`}\n            style={!isMobile ? (\n              panel.id === activePanelId\n                ? {\n                    border: \"2px solid rgba(255, 107, 53, 0.5)\",\n                    boxShadow: \"0 0 10px rgba(255, 107, 53, 0.2), 0 0 25px rgba(255, 107, 53, 0.08), inset 0 0 10px rgba(255, 107, 53, 0.03)\",\n                  }\n                : {\n                    border: \"1px solid rgba(34, 34, 34, 0.8)\",\n                    boxShadow: \"none\",\n                  }\n            ) : undefined}\n            onClick={() => setActive(panel.id)}\n            onFocusCapture={() => setActive(panel.id)}\n          >\n            {/* Panel controls (desktop only, multi-panel) */}\n            {!isMobile && panels.length > 1 && (\n              <div className=\"absolute right-2 top-2 z-30 flex items-center gap-0.5 rounded-md border border-border bg-background/80 p-0.5 backdrop-blur\">\n                <button\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    movePanel(panel.id, -1);\n                  }}\n                  disabled={i === 0}\n                  className=\"rounded p-0.5 text-muted-foreground transition enabled:hover:bg-muted enabled:hover:text-foreground disabled:opacity-30\"\n                  title=\"패널 왼쪽으로 이동\"\n                >\n                  <ChevronLeft size={13} />\n                </button>\n                <button\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    movePanel(panel.id, 1);\n                  }}\n                  disabled={i === panels.length - 1}\n                  className=\"rounded p-0.5 text-muted-foreground transition enabled:hover:bg-muted enabled:hover:text-foreground disabled:opacity-30\"\n                  title=\"패널 오른쪽으로 이동\"\n                >\n                  <ChevronRight size={13} />\n                </button>\n                <button\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    removePanel(panel.id);\n                  }}\n                  className=\"rounded p-0.5 text-muted-foreground transition hover:bg-muted hover:text-foreground\"\n                  title=\"패널 닫기\"\n                >\n                  <X size={13} />\n                </button>\n              </div>\n            )}\n            <ChatPanel\n              panelId={panel.id}\n              isActive={panel.id === activePanelId}\n              onFocus={() => setActive(panel.id)}\n              showHeader={true}\n            />\n          </div>\n\n          {/* Resize handle between panels (desktop only) */}\n          {!isMobile && i < visiblePanels.length - 1 && (\n            <div\n              onMouseDown={(e) => handleMouseDown(i, e)}\n              className=\"group relative z-10 flex w-1 shrink-0 cursor-col-resize items-center justify-center bg-muted transition-colors hover:bg-primary\"\n            >\n              <div className=\"absolute inset-y-0 -left-1 -right-1\" />\n            </div>\n          )}\n        </div>\n      ))}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 7815, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/chat/shortcut-help-dialog.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect, useCallback } from \"react\";\nimport {\n  getEffectiveShortcuts,\n  loadCustomBindings,\n  saveCustomBindings,\n  eventToKeyString,\n  type ShortcutDef,\n  type CustomBindings,\n} from \"@/lib/shortcuts\";\nimport { Pencil, RotateCcw } from \"lucide-react\";\n\nexport function ShortcutHelpDialog({ open, onClose }: { open: boolean; onClose: () => void }) {\n  const [shortcuts, setShortcuts] = useState<ShortcutDef[]>([]);\n  const [customBindings, setCustomBindings] = useState<CustomBindings>({});\n  const [editingId, setEditingId] = useState<string | null>(null);\n  const [recording, setRecording] = useState(false);\n\n  // Load on open\n  useEffect(() => {\n    if (open) {\n      setShortcuts(getEffectiveShortcuts());\n      setCustomBindings(loadCustomBindings());\n      setEditingId(null);\n      setRecording(false);\n    }\n  }, [open]);\n\n  // Record key combo when editing\n  useEffect(() => {\n    if (!recording || !editingId) return;\n\n    const handler = (e: KeyboardEvent) => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      const keyStr = eventToKeyString(e);\n      if (!keyStr) return; // modifier-only press\n\n      // Save the new binding\n      const updated = { ...customBindings, [editingId]: keyStr };\n      setCustomBindings(updated);\n      saveCustomBindings(updated);\n      setShortcuts(getEffectiveShortcuts());\n      setEditingId(null);\n      setRecording(false);\n    };\n\n    // Use capture to intercept before other handlers\n    document.addEventListener(\"keydown\", handler, true);\n    return () => document.removeEventListener(\"keydown\", handler, true);\n  }, [recording, editingId, customBindings]);\n\n  const startEditing = useCallback((id: string) => {\n    setEditingId(id);\n    setRecording(true);\n  }, []);\n\n  const resetBinding = useCallback((id: string) => {\n    const updated = { ...customBindings };\n    delete updated[id];\n    setCustomBindings(updated);\n    saveCustomBindings(updated);\n    setShortcuts(getEffectiveShortcuts());\n    setEditingId(null);\n    setRecording(false);\n  }, [customBindings]);\n\n  const resetAll = useCallback(() => {\n    setCustomBindings({});\n    saveCustomBindings({});\n    setShortcuts(getEffectiveShortcuts());\n    setEditingId(null);\n    setRecording(false);\n  }, []);\n\n  if (!open) return null;\n\n  const hasCustom = Object.keys(customBindings).length > 0;\n\n  return (\n    <div className=\"fixed inset-0 z-[200]\" role=\"dialog\" aria-modal=\"true\">\n      <div className=\"absolute inset-0 bg-black/60\" onClick={onClose} />\n      <div className=\"absolute left-1/2 top-1/2 w-[min(92vw,640px)] -translate-x-1/2 -translate-y-1/2 rounded-xl border border-zinc-700 bg-zinc-900 shadow-2xl\">\n        <div className=\"flex items-center justify-between border-b border-zinc-800 px-4 py-3\">\n          <h3 className=\"text-sm font-semibold text-zinc-100\">Keyboard Shortcuts</h3>\n          <div className=\"flex items-center gap-2\">\n            {hasCustom && (\n              <button\n                onClick={resetAll}\n                className=\"flex items-center gap-1 rounded px-2 py-1 text-[10px] text-zinc-500 hover:bg-zinc-800 hover:text-zinc-300\"\n                title=\"모든 단축키 초기화\"\n              >\n                <RotateCcw size={10} />\n                전체 초기화\n              </button>\n            )}\n            <button onClick={onClose} className=\"rounded px-2 py-1 text-xs text-zinc-400 hover:bg-zinc-800 hover:text-zinc-200\">ESC</button>\n          </div>\n        </div>\n        <div className=\"max-h-[65vh] overflow-y-auto p-3\">\n          <p className=\"mb-3 text-[11px] text-zinc-500\">\n            단축키를 변경하려면 ✏️ 아이콘을 클릭 후 원하는 키 조합을 누르세요.\n          </p>\n          {shortcuts.map((s) => {\n            const isEditing = editingId === s.id && recording;\n            const isCustom = !!customBindings[s.id];\n\n            return (\n              <div key={s.id} className=\"flex items-center justify-between rounded-md px-2 py-2 hover:bg-zinc-800/50\">\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-sm text-zinc-200\">{s.description}</span>\n                  {isCustom && (\n                    <button\n                      onClick={() => resetBinding(s.id)}\n                      className=\"rounded p-0.5 text-zinc-600 hover:text-zinc-400\"\n                      title=\"기본값으로 복원\"\n                    >\n                      <RotateCcw size={10} />\n                    </button>\n                  )}\n                </div>\n                <div className=\"flex items-center gap-1.5\">\n                  {isEditing ? (\n                    <kbd className=\"animate-pulse rounded border border-amber-600 bg-amber-900/30 px-2 py-0.5 text-xs text-amber-300\">\n                      키 입력 대기중…\n                    </kbd>\n                  ) : (\n                    <kbd className={`rounded border px-2 py-0.5 text-xs ${\n                      isCustom\n                        ? \"border-amber-700 bg-amber-900/20 text-amber-300\"\n                        : \"border-zinc-700 bg-zinc-800 text-zinc-300\"\n                    }`}>\n                      {s.keys}\n                    </kbd>\n                  )}\n                  <button\n                    onClick={() => startEditing(s.id)}\n                    className=\"rounded p-1 text-zinc-600 hover:bg-zinc-800 hover:text-zinc-300\"\n                    title=\"단축키 변경\"\n                  >\n                    <Pencil size={11} />\n                  </button>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 8088, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/BIGNO-FC2T/Projects/intelli-claw/src/components/chat/chat-view.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { useGateway } from \"@/lib/gateway/hooks\";\nimport { useIsMobile } from \"@/lib/hooks/use-mobile\";\nimport { ConnectionStatus } from \"./connection-status\";\nimport { SplitView } from \"./split-view\";\nimport { ShortcutHelpDialog } from \"./shortcut-help-dialog\";\nimport { isShortcutHelp, matchesShortcutId } from \"@/lib/shortcuts\";\nimport { Zap, Plus, Keyboard } from \"lucide-react\";\n\nexport function ChatView() {\n  const { state } = useGateway();\n  const isMobile = useIsMobile();\n  const [shortcutOpen, setShortcutOpen] = useState(false);\n  const [mounted, setMounted] = useState(false);\n\n  useEffect(() => {\n    setMounted(true);\n  }, []);\n\n  useEffect(() => {\n    function handleKeyDown(e: KeyboardEvent) {\n      if (isShortcutHelp(e)) {\n        e.preventDefault();\n        setShortcutOpen((v) => !v);\n        return;\n      }\n      if (e.key === \"Escape\") setShortcutOpen(false);\n\n      if (matchesShortcutId(e, \"add-panel\")) {\n        e.preventDefault();\n        (window as any).__awfSplitAddPanel?.();\n      }\n\n      // Ctrl+1~9: focus panel by index (ignore key repeat)\n      if (!e.repeat && e.ctrlKey && !e.metaKey && !e.shiftKey && !e.altKey && e.key >= \"1\" && e.key <= \"9\") {\n        e.preventDefault();\n        (window as any).__awfSplitFocusPanel?.(parseInt(e.key, 10) - 1);\n      }\n    }\n    document.addEventListener(\"keydown\", handleKeyDown);\n    return () => document.removeEventListener(\"keydown\", handleKeyDown);\n  }, []);\n\n  if (!mounted) return <div className=\"h-dvh bg-background\" />;\n\n  return (\n    <div className=\"flex h-dvh flex-col bg-background overflow-x-hidden max-w-[100vw]\">\n      <header className=\"relative z-20 flex items-center justify-between border-b border-border bg-background/80 px-3 py-2 md:px-4 md:py-2.5 backdrop-blur-sm\">\n        <div className=\"flex items-center gap-2 md:gap-3\">\n          <div className=\"flex items-center gap-2\">\n            <Zap size={isMobile ? 18 : 20} className=\"text-primary\" />\n            <span className=\"text-sm font-semibold text-foreground\">AWF</span>\n          </div>\n        </div>\n\n        <div className=\"flex items-center gap-2 md:gap-3\">\n          <ConnectionStatus state={state} />\n          <button\n            onClick={() => setShortcutOpen(true)}\n            className=\"flex items-center gap-1.5 rounded-lg px-2.5 py-1.5 text-xs font-medium text-muted-foreground transition hover:bg-muted hover:text-foreground\"\n            title=\"단축키 (Cmd+/)\"\n          >\n            <Keyboard size={14} />\n            <span className=\"hidden sm:inline\">단축키</span>\n          </button>\n          {!isMobile && (\n            <button\n              onClick={() => (window as any).__awfSplitAddPanel?.()}\n              className=\"flex items-center gap-1.5 rounded-lg px-2.5 py-1.5 text-xs font-medium text-muted-foreground transition hover:bg-muted hover:text-foreground\"\n              title=\"패널 추가 (Cmd+\\\\)\"\n            >\n              <Plus size={14} />\n              <span className=\"hidden sm:inline\">패널 추가</span>\n            </button>\n          )}\n        </div>\n      </header>\n\n      <div className=\"flex-1 overflow-hidden\">\n        <SplitView />\n      </div>\n\n      <ShortcutHelpDialog open={shortcutOpen} onClose={() => setShortcutOpen(false)} />\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AATA;;;;;;;;;;AAWO,SAAS;IACd,MAAM,EAAE,KAAK,EAAE,GAAG,IAAA,6IAAU;IAC5B,MAAM,WAAW,IAAA,mJAAW;IAC5B,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,mXAAQ,EAAC;IACjD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,mXAAQ,EAAC;IAEvC,IAAA,oXAAS,EAAC;QACR,WAAW;IACb,GAAG,EAAE;IAEL,IAAA,oXAAS,EAAC;QACR,SAAS,cAAc,CAAgB;YACrC,IAAI,IAAA,yIAAc,EAAC,IAAI;gBACrB,EAAE,cAAc;gBAChB,gBAAgB,CAAC,IAAM,CAAC;gBACxB;YACF;YACA,IAAI,EAAE,GAAG,KAAK,UAAU,gBAAgB;YAExC,IAAI,IAAA,4IAAiB,EAAC,GAAG,cAAc;gBACrC,EAAE,cAAc;gBACf,OAAe,kBAAkB;YACpC;YAEA,qDAAqD;YACrD,IAAI,CAAC,EAAE,MAAM,IAAI,EAAE,OAAO,IAAI,CAAC,EAAE,OAAO,IAAI,CAAC,EAAE,QAAQ,IAAI,CAAC,EAAE,MAAM,IAAI,EAAE,GAAG,IAAI,OAAO,EAAE,GAAG,IAAI,KAAK;gBACpG,EAAE,cAAc;gBACf,OAAe,oBAAoB,GAAG,SAAS,EAAE,GAAG,EAAE,MAAM;YAC/D;QACF;QACA,SAAS,gBAAgB,CAAC,WAAW;QACrC,OAAO,IAAM,SAAS,mBAAmB,CAAC,WAAW;IACvD,GAAG,EAAE;IAEL,IAAI,CAAC,SAAS,qBAAO,gZAAC;QAAI,WAAU;;;;;;IAEpC,qBACE,gZAAC;QAAI,WAAU;;0BACb,gZAAC;gBAAO,WAAU;;kCAChB,gZAAC;wBAAI,WAAU;kCACb,cAAA,gZAAC;4BAAI,WAAU;;8CACb,gZAAC,2RAAG;oCAAC,MAAM,WAAW,KAAK;oCAAI,WAAU;;;;;;8CACzC,gZAAC;oCAAK,WAAU;8CAAwC;;;;;;;;;;;;;;;;;kCAI5D,gZAAC;wBAAI,WAAU;;0CACb,gZAAC,sKAAgB;gCAAC,OAAO;;;;;;0CACzB,gZAAC;gCACC,SAAS,IAAM,gBAAgB;gCAC/B,WAAU;gCACV,OAAM;;kDAEN,gZAAC,0SAAQ;wCAAC,MAAM;;;;;;kDAChB,gZAAC;wCAAK,WAAU;kDAAmB;;;;;;;;;;;;4BAEpC,CAAC,0BACA,gZAAC;gCACC,SAAS,IAAM,AAAC,OAAe,kBAAkB;gCACjD,WAAU;gCACV,OAAM;;kDAEN,gZAAC,8RAAI;wCAAC,MAAM;;;;;;kDACZ,gZAAC;wCAAK,WAAU;kDAAmB;;;;;;;;;;;;;;;;;;;;;;;;0BAM3C,gZAAC;gBAAI,WAAU;0BACb,cAAA,gZAAC,wJAAS;;;;;;;;;;0BAGZ,gZAAC,8KAAkB;gBAAC,MAAM;gBAAc,SAAS,IAAM,gBAAgB;;;;;;;;;;;;AAG7E","debugId":null}}]
}